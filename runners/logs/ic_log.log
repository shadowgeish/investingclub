 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Running on http://0.0.0.0:5005/ (Press CTRL+C to quit)
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'STZ.PA', 'LQQ.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'STZ.PA', 'LQQ.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'STZ.PA', 'LQQ.PA', 'CAC.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 18:46:10] "[35m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 500 -
127.0.0.1 - - [21/Nov/2021 18:46:11] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 18:46:11] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 18:46:11] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 18:46:12] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 18:46:12] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/asset_prices/prices.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['CAC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 18:46:47] "[35m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 500 -
127.0.0.1 - - [21/Nov/2021 18:46:48] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 18:46:48] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 18:46:48] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 18:46:49] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 18:46:50] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'STZ.PA', 'OBLI.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'STZ.PA', 'OBLI.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['LQQ.PA', 'STZ.PA', 'OBLI.PA', 'CAC.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 18:47:16] "[35m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 500 -
127.0.0.1 - - [21/Nov/2021 18:47:17] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 18:47:17] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 18:47:17] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 18:47:17] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 18:47:17] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['STZ.PA', 'LQQ.PA', 'CAC.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['STZ.PA', 'LQQ.PA', 'CAC.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['STZ.PA', 'LQQ.PA', 'CAC.PA', 'OBLI.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 18:48:26] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/asset_prices/prices.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/asset_prices/prices.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/asset_prices/prices.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/asset_prices/prices.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/asset_prices/prices.py', reloading
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/asset_prices/prices.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/asset_prices/prices.py', reloading
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/asset_prices/prices.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/asset_prices/prices.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['STZ.PA', 'LQQ.PA', 'CAC.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['STZ.PA', 'LQQ.PA', 'CAC.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['STZ.PA', 'LQQ.PA', 'CAC.PA', 'OBLI.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 19:53:59] "[35m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 500 -
127.0.0.1 - - [21/Nov/2021 19:54:00] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:54:00] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:54:00] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:54:01] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:54:01] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 19:56:59] "[35m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 500 -
127.0.0.1 - - [21/Nov/2021 19:57:00] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:57:00] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:57:00] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:57:00] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:57:00] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/asset_prices/prices.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'STZ.PA', 'OBLI.PA', 'LQQ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'STZ.PA', 'OBLI.PA', 'LQQ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['CAC.PA', 'STZ.PA', 'OBLI.PA', 'LQQ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 19:57:49] "[35m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 500 -
127.0.0.1 - - [21/Nov/2021 19:57:50] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:57:50] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:57:50] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:57:51] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:57:51] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['CAC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 19:59:11] "[35m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 500 -
127.0.0.1 - - [21/Nov/2021 19:59:12] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:59:12] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:59:12] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:59:13] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 19:59:13] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/asset_prices/prices.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/asset_prices/prices.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'STZ.PA', 'CAC.PA', 'LQQ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'STZ.PA', 'CAC.PA', 'LQQ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'STZ.PA', 'CAC.PA', 'LQQ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 20:01:26] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'OBLI.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'OBLI.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'OBLI.PA', 'STZ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 20:04:06] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'STZ.PA', 'OBLI.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 20:08:45] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 20:10:07] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'OBLI.PA', 'CAC.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'OBLI.PA', 'CAC.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['LQQ.PA', 'OBLI.PA', 'CAC.PA', 'STZ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 20:16:09] "[35m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 500 -
127.0.0.1 - - [21/Nov/2021 20:16:11] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 20:16:11] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 20:16:11] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 20:16:11] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 20:16:11] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 20:17:18] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 20:18:12] "[31m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 400 -
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-19 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-19 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637276400.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-19 00:00:00 to 2021-11-19 00:00:00
Data returned          date     open      high  ...     volume       code  converted_date
0  2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
1  2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2  2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
3  2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
4  2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns]
df_h_p =         date     open      high  ...     volume       code  converted_date
0  2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
1  2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2  2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
3  2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
4  2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
1  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[1 rows x 9 columns]
b_daily_returns =            close
date             
2021-11-19    NaN
g_daily_returns =Empty DataFrame
Columns: [value]
Index: [], g_b_daily_returns =Empty DataFrame
Columns: [close]
Index: []
127.0.0.1 - - [21/Nov/2021 20:18:39] "[35m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 500 -
127.0.0.1 - - [21/Nov/2021 20:18:40] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 20:18:40] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 20:18:40] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 20:18:40] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 20:18:41] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 200 -
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-19 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-19 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637276400.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-19 00:00:00 to 2021-11-19 00:00:00
Data returned          date     open      high  ...     volume       code  converted_date
0  2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
1  2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2  2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
3  2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
4  2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns]
df_h_p =         date     open      high  ...     volume       code  converted_date
0  2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
1  2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2  2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
3  2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
4  2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
1  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[1 rows x 9 columns]
b_daily_returns =            close
date             
2021-11-19    NaN
g_daily_returns =Empty DataFrame
Columns: [value]
Index: [], g_b_daily_returns =Empty DataFrame
Columns: [close]
Index: []
127.0.0.1 - - [21/Nov/2021 20:18:51] "[35m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 500 -
127.0.0.1 - - [21/Nov/2021 20:18:51] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 20:18:51] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 20:18:51] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 20:18:52] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1[0m" 200 -
127.0.0.1 - - [21/Nov/2021 20:18:52] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 200 -
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-18 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-18 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637190000.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-18 00:00:00 to 2021-11-19 00:00:00
Data returned          date      open      high  ...     volume       code  converted_date
0  2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
1  2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
2  2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
3  2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
4  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
5  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
6  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
7  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
8  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
9  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[10 rows x 9 columns]
df_h_p =         date      open      high  ...     volume       code  converted_date
0  2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
1  2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
2  2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
3  2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
4  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
5  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
6  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
7  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
8  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
9  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[10 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
2  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
3  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[2 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-18       NaN
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-19 -0.004157
result beta nan, alpha nan
127.0.0.1 - - [21/Nov/2021 20:19:01] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'STZ.PA', 'OBLI.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [21/Nov/2021 20:22:52] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}, {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}]} 
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
Query itx = {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0000120578   SAN  ...          BBB            6
1  FR0007052782   CAC  ...          BBB            6
2  IE00BKWQ0G16   STZ  ...          BBB            6
3  CH0454664001  ABTC  ...          BBB            6
4  FR0010342592   LQQ  ...          BBB            6
5  FR0013346681  OBLI  ...          BBB            6
6  CH0454664027  AETH  ...          BBB            6

[7 rows x 21 columns] 
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['SAN.PA', 'CAC.PA', 'STZ.PA', 'ABTC.PA', 'LQQ.PA', 'OBLI.PA', 'AETH.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}, 'code': 1}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
 max_diversification cov =           OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA   AETH.PA   ABTC.PA
OBLI.PA  0.001239  0.001860 -0.001289  0.000080  0.000190  0.002099 -0.001060
LQQ.PA   0.001860  0.066896  0.018576  0.019846  0.006959  0.048179  0.030435
STZ.PA  -0.001289  0.018576  0.026961  0.017663  0.005396  0.038127  0.030392
CAC.PA   0.000080  0.019846  0.017663  0.017986  0.005755  0.025707  0.014029
SAN.PA   0.000190  0.006959  0.005396  0.005755  0.021866  0.021535  0.021395
AETH.PA  0.002099  0.048179  0.038127  0.025707  0.021535  0.714188  0.510074
ABTC.PA -0.001060  0.030435  0.030392  0.014029  0.021395  0.510074  0.540178
 df_full  =             OBLI.PA  LQQ.PA  STZ.PA   CAC.PA  SAN.PA  AETH.PA  ABTC.PA
2021-06-01   10.790   616.3   58.36  63.6755   85.86   23.666   10.545
2021-06-02   10.798   621.8   58.52  64.0097   85.51   25.805   11.109
2021-06-03   10.790   613.1   58.61  63.8720   85.48   26.178   11.343
2021-06-04   10.812   629.0   58.34  63.9900   86.08   24.623   10.776
2021-06-07   10.792   625.2   58.57  64.2652   86.18   25.829   10.534
...             ...     ...     ...      ...     ...      ...      ...
2021-11-15   10.880   921.6   63.31  70.2300   90.07   45.555   19.913
2021-11-16   10.876   942.5   63.14  70.4700   90.17   42.700   18.909
2021-11-17   10.862   951.7   63.19  70.4700   90.60   41.977   18.862
2021-11-18   10.914   956.9   62.69  70.3100   88.27   39.717   17.886
2021-11-19   10.954   979.2   61.77  70.0200   88.90   42.002   18.114

[124 rows x 7 columns]
expected_returns [0.02984907 1.69211059 0.16011365 0.24816114 0.09971106 3.90697062
 2.93833753]
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540005731189
w=[0.14285716 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540013081518
w=[0.14285714 0.14285716 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539996692569
w=[0.14285714 0.14285714 0.14285716 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539994997065
w=[0.14285714 0.14285714 0.14285714 0.14285716 0.14285714 0.14285714
 0.14285714]
obj_value=-5.3755400006288685
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285716 0.14285714
 0.14285714]
obj_value=-5.3755400106248254
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285716
 0.14285714]
obj_value=-5.375539705195182
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285716]
obj_value=-5.375539758185792
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591925940692
w=[5.82432941e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919275733133
w=[5.82432926e-01 1.49011612e-08 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591962775734
w=[5.82432926e-01 0.00000000e+00 1.49011612e-08 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919628210003
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 1.49011612e-08
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919400496845
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567089e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015918558038898
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 1.49021251e-08 7.20534743e-13]
obj_value=-19.015920832513256
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 1.49018817e-08]
obj_value=-19.01592070181166
w=[0.00000000e+00 5.38662039e-01 4.50210940e-01 7.42461648e-14
 0.00000000e+00 0.00000000e+00 1.11270211e-02]
obj_value=-6.395574890819457
w=[3.55501109e-01 2.09877481e-01 1.75414510e-01 2.89283389e-14
 2.54871508e-01 5.88335498e-13 4.33539210e-03]
obj_value=-16.532238044351185
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216102849144
w=[4.83169859e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216111613336
w=[4.83169844e-01 9.18032965e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321541042118
w=[4.83169844e-01 9.18032816e-02 7.67287217e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321591785512
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.49011738e-08
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043215803059784
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401822e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321536416609
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 1.49019608e-08 1.89635982e-03]
obj_value=-22.043216428047483
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89637472e-03]
obj_value=-22.043216597770734
w=[7.65801887e-01 0.00000000e+00 6.05775152e-12 0.00000000e+00
 0.00000000e+00 3.90184116e-13 2.34198113e-01]
obj_value=-6.64186628565387
w=[5.76833390e-01 6.13799059e-02 5.13010071e-02 8.46026316e-15
 2.31605123e-01 6.63934310e-13 7.88805743e-02]
obj_value=-19.423440187508398
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316631453148
w=[5.20304377e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131663290693
w=[5.20304362e-01 7.97414279e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781315892415428
w=[5.20304362e-01 7.97414130e-02 6.66474745e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316379887127
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.49011722e-08
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316322329516
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888710e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131589323628
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 1.49019070e-08 3.24180707e-02]
obj_value=-23.781314817425844
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180856e-02]
obj_value=-23.781314863723377
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902559875025
w=[9.86071324e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099025022294676
w=[9.86071309e-01 1.49011612e-08 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902676367056
w=[9.86071309e-01 0.00000000e+00 1.49221312e-08 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099028201610196
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 1.49214292e-08
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026935362225
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 1.49011612e-08 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026923094144
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 1.49011612e-08 1.39286915e-02]
obj_value=-35.09902793856798
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39287064e-02]
obj_value=-35.099028858929316
w=[6.25747465e-01 8.93535246e-12 3.74252535e-01 0.00000000e+00
 2.05383488e-11 8.06299472e-12 0.00000000e+00]
obj_value=-22.82214592064075
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578139097654
w=[8.30890146e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578092031261
w=[8.30890132e-01 1.49050094e-08 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779214329565
w=[8.30890132e-01 3.84820082e-12 1.61179881e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03577949453445
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.49127004e-08
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779678113954
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 1.49100065e-08 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578179254781
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 1.49046337e-08 7.93000230e-03]
obj_value=-47.035778230114964
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93001720e-03]
obj_value=-47.035780867710166
w=[0.00000000e+00 3.27962947e-11 7.97825972e-11 0.00000000e+00
 1.00000000e+00 0.00000000e+00 9.52851548e-11]
obj_value=-6.762586079004216
w=[5.61879491e-01 1.32204933e-11 1.08995952e-01 7.80321676e-12
 3.23761988e-01 2.34823737e-12 5.36256902e-03]
obj_value=-26.20923967776448
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76492022295066
w=[7.58941340e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491983773814
w=[7.58941325e-01 1.49075161e-08 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491799427883
w=[7.58941325e-01 6.35488701e-12 1.47222923e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918292400104
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.49117011e-08
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918393537215
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924584e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918805378784
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 1.49043330e-08 7.24332403e-03]
obj_value=-47.764916362299
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24333893e-03]
obj_value=-47.76491850732435
w=[9.35013321e-01 0.00000000e+00 7.24078020e-11 0.00000000e+00
 6.49866792e-02 0.00000000e+00 1.08677466e-10]
obj_value=-35.47201751397131
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442391764858
w=[8.10544351e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.054423238692536
w=[8.10544336e-01 1.49056536e-08 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442186001478
w=[8.10544336e-01 4.49240283e-12 1.04074974e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442297678593
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 1.49086121e-08
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442249320169
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602618e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442248237479
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 1.49034034e-08 5.12045761e-03]
obj_value=-51.0544217200494
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12047251e-03]
obj_value=-51.05442443896617
w=[9.34286418e-01 1.26426979e-12 1.21143373e-12 0.00000000e+00
 3.58574281e-12 1.11653027e-11 6.57135823e-02]
obj_value=-24.720627953704415
w=[8.28519561e-01 4.02347248e-12 8.89566520e-02 6.36856712e-12
 6.86013513e-02 3.53841793e-12 1.39224354e-02]
obj_value=-50.881075801838044
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025346459842
w=[8.18636475e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252770711504
w=[8.18636460e-01 1.49054425e-08 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.4002514353683
w=[8.18636460e-01 4.28129879e-12 9.72689834e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252645352886
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 1.49081249e-08
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025215829412
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116361e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025210990398
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 1.49039869e-08 9.08295017e-03]
obj_value=-51.40024911704559
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08296507e-03]
obj_value=-51.40025163948705
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036323427809
w=[8.53015347e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036241653888
w=[8.53015332e-01 1.49011612e-08 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820361257067255
w=[8.53015332e-01 0.00000000e+00 9.77293231e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820362669055655
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 1.49580619e-08
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036206259256
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838702e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036276976336
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 1.49011612e-08 7.67150518e-03]
obj_value=-51.82036023195818
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67152008e-03]
obj_value=-51.82036322326711
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629368536147
w=[8.38310423e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292919502614
w=[8.38310408e-01 1.49011612e-08 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966291574043865
w=[8.38310408e-01 0.00000000e+00 1.01793434e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629286223483
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 1.49033159e-08
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629235918433
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16791138e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292890825315
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 1.49011612e-08 8.21707417e-03]
obj_value=-51.9662899057134
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21708907e-03]
obj_value=-51.96629277494531
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938537679447
w=[8.39985616e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460202549
w=[8.39985601e-01 1.49260123e-08 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938329170353
w=[8.39985601e-01 2.48511244e-11 1.00424031e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460821014
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 1.49011612e-08
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938408030388
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788964e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938459691375
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.50546410e-08 8.11150142e-03]
obj_value=-51.96938172296389
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11151632e-03]
obj_value=-51.96938460286133
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946768096141
w=[8.40036684e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946690651665
w=[8.40036669e-01 1.49011612e-08 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946559257332
w=[8.40036669e-01 0.00000000e+00 1.00654031e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466906205014
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.49148878e-08
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946638110884
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12014108e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466907626874
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 1.49011612e-08 8.10791878e-03]
obj_value=-51.96946402540161
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10793368e-03]
obj_value=-51.96946690822093
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946950311214
w=[8.40013047e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728709394
w=[8.40013032e-01 1.49211992e-08 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969467414929234
w=[8.40013032e-01 2.00380280e-11 1.00634479e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946872869365
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 1.49011612e-08
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946820344675
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427529e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728696874
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.50251437e-08 8.10976601e-03]
obj_value=-51.96946584636145
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10978091e-03]
obj_value=-51.96946872864314
_make_output_weights = OrderedDict([('OBLI.PA', 0.8400130320747131), ('LQQ.PA', 2.003802800889311e-11), ('STZ.PA', 0.10063446376694996), ('CAC.PA', 0.0), ('SAN.PA', 0.05124273801343399), ('AETH.PA', 1.23982524942074e-10), ('ABTC.PA', 0.008109766013414356)])
opto from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done
{'weights': OrderedDict([('OBLI.PA', 0.84001), ('LQQ.PA', 0.0), ('STZ.PA', 0.10063), ('CAC.PA', 0.0), ('SAN.PA', 0.05124), ('AETH.PA', 0.0), ('ABTC.PA', 0.00811)]), 'expected_return': 0.07012525988061888, 'volatility': 0.033874230190483384, 'sharpe_ratio': 1.4797460960367759, 'asset_type_weights': {'Equity': 0.15187, 'Crypto': 0.00811, 'Fixed Income': 0.84001}}
--- 0.841630220413208 seconds ---
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
Getting data --- 0.29100513458251953 seconds ---
--- end init 0.4057941436767578 seconds ---
back_test_portfolio from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done, columns Index(['OBLI.PA_adjusted_close', 'date_x', 'OBLI.PA_return', 'OBLI.PA_weight',
       'OBLI.PA_nb_shares', 'OBLI.PA_value', 'LQQ.PA_adjusted_close', 'date_y',
       'LQQ.PA_return', 'LQQ.PA_weight', 'LQQ.PA_nb_shares', 'LQQ.PA_value',
       'STZ.PA_adjusted_close', 'date_x', 'STZ.PA_return', 'STZ.PA_weight',
       'STZ.PA_nb_shares', 'STZ.PA_value', 'CAC.PA_adjusted_close', 'date_y',
       'CAC.PA_return', 'CAC.PA_weight', 'CAC.PA_nb_shares', 'CAC.PA_value',
       'SAN.PA_adjusted_close', 'date_x', 'SAN.PA_return', 'SAN.PA_weight',
       'SAN.PA_nb_shares', 'SAN.PA_value', 'AETH.PA_adjusted_close', 'date_y',
       'AETH.PA_return', 'AETH.PA_weight', 'AETH.PA_nb_shares',
       'AETH.PA_value', 'ABTC.PA_adjusted_close', 'date', 'ABTC.PA_return',
       'ABTC.PA_weight', 'ABTC.PA_nb_shares', 'ABTC.PA_value',
       'portfolio_value', 'portfolio_return'],
      dtype='object')
            OBLI.PA_adjusted_close  ... portfolio_return
date                                ...                 
2021-06-06                  10.812  ...        -0.000508
2021-06-13                  10.868  ...         0.005577
2021-06-20                  10.822  ...        -0.005760
2021-06-27                  10.770  ...        -0.003284
2021-07-04                  10.854  ...         0.004866
2021-07-11                  10.898  ...         0.002651
2021-07-18                  10.958  ...         0.003229
2021-07-25                  11.024  ...         0.006882
2021-08-01                  11.030  ...         0.002077
2021-08-08                  11.054  ...         0.005718
2021-08-15                  11.056  ...         0.003539
2021-08-22                  11.074  ...         0.001312
2021-08-29                  10.998  ...        -0.006255
2021-09-05                  10.942  ...        -0.004638
2021-09-12                  10.932  ...        -0.006183
2021-09-19                  10.912  ...        -0.001023
2021-09-26                  10.862  ...        -0.004425
2021-10-03                  10.844  ...         0.000921
2021-10-10                  10.786  ...         0.001782
2021-10-17                  10.824  ...         0.005316
2021-10-24                  10.780  ...        -0.001935
2021-10-31                  10.774  ...         0.001735
2021-11-07                  10.922  ...         0.013330
2021-11-14                  10.896  ...        -0.001280
2021-11-21                  10.954  ...         0.002029

[25 rows x 44 columns]
--- 0.5240523815155029 seconds ---
127.0.0.1 - - [21/Nov/2021 20:24:18] "[37mGET /api/v1/maximum_diversificaton HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
127.0.0.1 - - [21/Nov/2021 21:19:56] "[31m[1mPOST /api/v1/maximum_diversificaton HTTP/1.1[0m" 405 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}, {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}]} 
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
Query itx = {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0000120578   SAN  ...          BBB            6
1  FR0007052782   CAC  ...          BBB            6
2  IE00BKWQ0G16   STZ  ...          BBB            6
3  CH0454664001  ABTC  ...          BBB            6
4  FR0010342592   LQQ  ...          BBB            6
5  FR0013346681  OBLI  ...          BBB            6
6  CH0454664027  AETH  ...          BBB            6

[7 rows x 21 columns] 
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['SAN.PA', 'CAC.PA', 'STZ.PA', 'ABTC.PA', 'LQQ.PA', 'OBLI.PA', 'AETH.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}, 'code': 1}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
 max_diversification cov =           OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA   AETH.PA   ABTC.PA
OBLI.PA  0.001239  0.001860 -0.001289  0.000080  0.000190  0.002099 -0.001060
LQQ.PA   0.001860  0.066896  0.018576  0.019846  0.006959  0.048179  0.030435
STZ.PA  -0.001289  0.018576  0.026961  0.017663  0.005396  0.038127  0.030392
CAC.PA   0.000080  0.019846  0.017663  0.017986  0.005755  0.025707  0.014029
SAN.PA   0.000190  0.006959  0.005396  0.005755  0.021866  0.021535  0.021395
AETH.PA  0.002099  0.048179  0.038127  0.025707  0.021535  0.714188  0.510074
ABTC.PA -0.001060  0.030435  0.030392  0.014029  0.021395  0.510074  0.540178
 df_full  =             OBLI.PA  LQQ.PA  STZ.PA   CAC.PA  SAN.PA  AETH.PA  ABTC.PA
2021-06-01   10.790   616.3   58.36  63.6755   85.86   23.666   10.545
2021-06-02   10.798   621.8   58.52  64.0097   85.51   25.805   11.109
2021-06-03   10.790   613.1   58.61  63.8720   85.48   26.178   11.343
2021-06-04   10.812   629.0   58.34  63.9900   86.08   24.623   10.776
2021-06-07   10.792   625.2   58.57  64.2652   86.18   25.829   10.534
...             ...     ...     ...      ...     ...      ...      ...
2021-11-15   10.880   921.6   63.31  70.2300   90.07   45.555   19.913
2021-11-16   10.876   942.5   63.14  70.4700   90.17   42.700   18.909
2021-11-17   10.862   951.7   63.19  70.4700   90.60   41.977   18.862
2021-11-18   10.914   956.9   62.69  70.3100   88.27   39.717   17.886
2021-11-19   10.954   979.2   61.77  70.0200   88.90   42.002   18.114

[124 rows x 7 columns]
expected_returns [0.02984907 1.69211059 0.16011365 0.24816114 0.09971106 3.90697062
 2.93833753]
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540005731189
w=[0.14285716 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540013081518
w=[0.14285714 0.14285716 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539996692569
w=[0.14285714 0.14285714 0.14285716 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539994997065
w=[0.14285714 0.14285714 0.14285714 0.14285716 0.14285714 0.14285714
 0.14285714]
obj_value=-5.3755400006288685
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285716 0.14285714
 0.14285714]
obj_value=-5.3755400106248254
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285716
 0.14285714]
obj_value=-5.375539705195182
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285716]
obj_value=-5.375539758185792
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591925940692
w=[5.82432941e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919275733133
w=[5.82432926e-01 1.49011612e-08 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591962775734
w=[5.82432926e-01 0.00000000e+00 1.49011612e-08 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919628210003
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 1.49011612e-08
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919400496845
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567089e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015918558038898
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 1.49021251e-08 7.20534743e-13]
obj_value=-19.015920832513256
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 1.49018817e-08]
obj_value=-19.01592070181166
w=[0.00000000e+00 5.38662039e-01 4.50210940e-01 7.42461648e-14
 0.00000000e+00 0.00000000e+00 1.11270211e-02]
obj_value=-6.395574890819457
w=[3.55501109e-01 2.09877481e-01 1.75414510e-01 2.89283389e-14
 2.54871508e-01 5.88335498e-13 4.33539210e-03]
obj_value=-16.532238044351185
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216102849144
w=[4.83169859e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216111613336
w=[4.83169844e-01 9.18032965e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321541042118
w=[4.83169844e-01 9.18032816e-02 7.67287217e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321591785512
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.49011738e-08
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043215803059784
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401822e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321536416609
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 1.49019608e-08 1.89635982e-03]
obj_value=-22.043216428047483
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89637472e-03]
obj_value=-22.043216597770734
w=[7.65801887e-01 0.00000000e+00 6.05775152e-12 0.00000000e+00
 0.00000000e+00 3.90184116e-13 2.34198113e-01]
obj_value=-6.64186628565387
w=[5.76833390e-01 6.13799059e-02 5.13010071e-02 8.46026316e-15
 2.31605123e-01 6.63934310e-13 7.88805743e-02]
obj_value=-19.423440187508398
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316631453148
w=[5.20304377e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131663290693
w=[5.20304362e-01 7.97414279e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781315892415428
w=[5.20304362e-01 7.97414130e-02 6.66474745e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316379887127
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.49011722e-08
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316322329516
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888710e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131589323628
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 1.49019070e-08 3.24180707e-02]
obj_value=-23.781314817425844
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180856e-02]
obj_value=-23.781314863723377
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902559875025
w=[9.86071324e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099025022294676
w=[9.86071309e-01 1.49011612e-08 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902676367056
w=[9.86071309e-01 0.00000000e+00 1.49221312e-08 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099028201610196
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 1.49214292e-08
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026935362225
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 1.49011612e-08 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026923094144
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 1.49011612e-08 1.39286915e-02]
obj_value=-35.09902793856798
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39287064e-02]
obj_value=-35.099028858929316
w=[6.25747465e-01 8.93535246e-12 3.74252535e-01 0.00000000e+00
 2.05383488e-11 8.06299472e-12 0.00000000e+00]
obj_value=-22.82214592064075
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578139097654
w=[8.30890146e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578092031261
w=[8.30890132e-01 1.49050094e-08 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779214329565
w=[8.30890132e-01 3.84820082e-12 1.61179881e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03577949453445
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.49127004e-08
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779678113954
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 1.49100065e-08 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578179254781
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 1.49046337e-08 7.93000230e-03]
obj_value=-47.035778230114964
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93001720e-03]
obj_value=-47.035780867710166
w=[0.00000000e+00 3.27962947e-11 7.97825972e-11 0.00000000e+00
 1.00000000e+00 0.00000000e+00 9.52851548e-11]
obj_value=-6.762586079004216
w=[5.61879491e-01 1.32204933e-11 1.08995952e-01 7.80321676e-12
 3.23761988e-01 2.34823737e-12 5.36256902e-03]
obj_value=-26.20923967776448
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76492022295066
w=[7.58941340e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491983773814
w=[7.58941325e-01 1.49075161e-08 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491799427883
w=[7.58941325e-01 6.35488701e-12 1.47222923e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918292400104
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.49117011e-08
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918393537215
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924584e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918805378784
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 1.49043330e-08 7.24332403e-03]
obj_value=-47.764916362299
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24333893e-03]
obj_value=-47.76491850732435
w=[9.35013321e-01 0.00000000e+00 7.24078020e-11 0.00000000e+00
 6.49866792e-02 0.00000000e+00 1.08677466e-10]
obj_value=-35.47201751397131
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442391764858
w=[8.10544351e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.054423238692536
w=[8.10544336e-01 1.49056536e-08 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442186001478
w=[8.10544336e-01 4.49240283e-12 1.04074974e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442297678593
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 1.49086121e-08
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442249320169
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602618e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442248237479
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 1.49034034e-08 5.12045761e-03]
obj_value=-51.0544217200494
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12047251e-03]
obj_value=-51.05442443896617
w=[9.34286418e-01 1.26426979e-12 1.21143373e-12 0.00000000e+00
 3.58574281e-12 1.11653027e-11 6.57135823e-02]
obj_value=-24.720627953704415
w=[8.28519561e-01 4.02347248e-12 8.89566520e-02 6.36856712e-12
 6.86013513e-02 3.53841793e-12 1.39224354e-02]
obj_value=-50.881075801838044
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025346459842
w=[8.18636475e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252770711504
w=[8.18636460e-01 1.49054425e-08 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.4002514353683
w=[8.18636460e-01 4.28129879e-12 9.72689834e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252645352886
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 1.49081249e-08
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025215829412
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116361e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025210990398
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 1.49039869e-08 9.08295017e-03]
obj_value=-51.40024911704559
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08296507e-03]
obj_value=-51.40025163948705
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036323427809
w=[8.53015347e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036241653888
w=[8.53015332e-01 1.49011612e-08 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820361257067255
w=[8.53015332e-01 0.00000000e+00 9.77293231e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820362669055655
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 1.49580619e-08
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036206259256
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838702e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036276976336
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 1.49011612e-08 7.67150518e-03]
obj_value=-51.82036023195818
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67152008e-03]
obj_value=-51.82036322326711
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629368536147
w=[8.38310423e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292919502614
w=[8.38310408e-01 1.49011612e-08 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966291574043865
w=[8.38310408e-01 0.00000000e+00 1.01793434e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629286223483
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 1.49033159e-08
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629235918433
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16791138e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292890825315
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 1.49011612e-08 8.21707417e-03]
obj_value=-51.9662899057134
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21708907e-03]
obj_value=-51.96629277494531
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938537679447
w=[8.39985616e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460202549
w=[8.39985601e-01 1.49260123e-08 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938329170353
w=[8.39985601e-01 2.48511244e-11 1.00424031e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460821014
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 1.49011612e-08
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938408030388
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788964e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938459691375
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.50546410e-08 8.11150142e-03]
obj_value=-51.96938172296389
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11151632e-03]
obj_value=-51.96938460286133
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946768096141
w=[8.40036684e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946690651665
w=[8.40036669e-01 1.49011612e-08 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946559257332
w=[8.40036669e-01 0.00000000e+00 1.00654031e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466906205014
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.49148878e-08
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946638110884
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12014108e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466907626874
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 1.49011612e-08 8.10791878e-03]
obj_value=-51.96946402540161
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10793368e-03]
obj_value=-51.96946690822093
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946950311214
w=[8.40013047e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728709394
w=[8.40013032e-01 1.49211992e-08 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969467414929234
w=[8.40013032e-01 2.00380280e-11 1.00634479e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946872869365
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 1.49011612e-08
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946820344675
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427529e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728696874
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.50251437e-08 8.10976601e-03]
obj_value=-51.96946584636145
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10978091e-03]
obj_value=-51.96946872864314
_make_output_weights = OrderedDict([('OBLI.PA', 0.8400130320747131), ('LQQ.PA', 2.003802800889311e-11), ('STZ.PA', 0.10063446376694996), ('CAC.PA', 0.0), ('SAN.PA', 0.05124273801343399), ('AETH.PA', 1.23982524942074e-10), ('ABTC.PA', 0.008109766013414356)])
opto from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done
{'weights': OrderedDict([('OBLI.PA', 0.84001), ('LQQ.PA', 0.0), ('STZ.PA', 0.10063), ('CAC.PA', 0.0), ('SAN.PA', 0.05124), ('AETH.PA', 0.0), ('ABTC.PA', 0.00811)]), 'expected_return': 0.07012525988061888, 'volatility': 0.033874230190483384, 'sharpe_ratio': 1.4797460960367759, 'asset_type_weights': {'Equity': 0.15187, 'Crypto': 0.00811, 'Fixed Income': 0.84001}}
--- 1.1145308017730713 seconds ---
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
Getting data --- 0.27561378479003906 seconds ---
--- end init 0.38177490234375 seconds ---
back_test_portfolio from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done, columns Index(['OBLI.PA_adjusted_close', 'date_x', 'OBLI.PA_return', 'OBLI.PA_weight',
       'OBLI.PA_nb_shares', 'OBLI.PA_value', 'LQQ.PA_adjusted_close', 'date_y',
       'LQQ.PA_return', 'LQQ.PA_weight', 'LQQ.PA_nb_shares', 'LQQ.PA_value',
       'STZ.PA_adjusted_close', 'date_x', 'STZ.PA_return', 'STZ.PA_weight',
       'STZ.PA_nb_shares', 'STZ.PA_value', 'CAC.PA_adjusted_close', 'date_y',
       'CAC.PA_return', 'CAC.PA_weight', 'CAC.PA_nb_shares', 'CAC.PA_value',
       'SAN.PA_adjusted_close', 'date_x', 'SAN.PA_return', 'SAN.PA_weight',
       'SAN.PA_nb_shares', 'SAN.PA_value', 'AETH.PA_adjusted_close', 'date_y',
       'AETH.PA_return', 'AETH.PA_weight', 'AETH.PA_nb_shares',
       'AETH.PA_value', 'ABTC.PA_adjusted_close', 'date', 'ABTC.PA_return',
       'ABTC.PA_weight', 'ABTC.PA_nb_shares', 'ABTC.PA_value',
       'portfolio_value', 'portfolio_return'],
      dtype='object')
            OBLI.PA_adjusted_close  ... portfolio_return
date                                ...                 
2021-06-06                  10.812  ...        -0.000508
2021-06-13                  10.868  ...         0.005577
2021-06-20                  10.822  ...        -0.005760
2021-06-27                  10.770  ...        -0.003284
2021-07-04                  10.854  ...         0.004866
2021-07-11                  10.898  ...         0.002651
2021-07-18                  10.958  ...         0.003229
2021-07-25                  11.024  ...         0.006882
2021-08-01                  11.030  ...         0.002077
2021-08-08                  11.054  ...         0.005718
2021-08-15                  11.056  ...         0.003539
2021-08-22                  11.074  ...         0.001312
2021-08-29                  10.998  ...        -0.006255
2021-09-05                  10.942  ...        -0.004638
2021-09-12                  10.932  ...        -0.006183
2021-09-19                  10.912  ...        -0.001023
2021-09-26                  10.862  ...        -0.004425
2021-10-03                  10.844  ...         0.000921
2021-10-10                  10.786  ...         0.001782
2021-10-17                  10.824  ...         0.005316
2021-10-24                  10.780  ...        -0.001935
2021-10-31                  10.774  ...         0.001735
2021-11-07                  10.922  ...         0.013330
2021-11-14                  10.896  ...        -0.001280
2021-11-21                  10.954  ...         0.002029

[25 rows x 44 columns]
--- 0.4672377109527588 seconds ---
127.0.0.1 - - [21/Nov/2021 21:26:36] "[37mPOST /api/v1/maximum_diversificaton HTTP/1.1[0m" 200 -
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}, {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}]} 
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
Query itx = {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0000120578   SAN  ...          BBB            6
1  FR0007052782   CAC  ...          BBB            6
2  IE00BKWQ0G16   STZ  ...          BBB            6
3  CH0454664001  ABTC  ...          BBB            6
4  FR0010342592   LQQ  ...          BBB            6
5  FR0013346681  OBLI  ...          BBB            6
6  CH0454664027  AETH  ...          BBB            6

[7 rows x 21 columns] 
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['SAN.PA', 'CAC.PA', 'STZ.PA', 'ABTC.PA', 'LQQ.PA', 'OBLI.PA', 'AETH.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}, 'code': 1}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
 max_diversification cov =           OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA   AETH.PA   ABTC.PA
OBLI.PA  0.001239  0.001860 -0.001289  0.000080  0.000190  0.002099 -0.001060
LQQ.PA   0.001860  0.066896  0.018576  0.019846  0.006959  0.048179  0.030435
STZ.PA  -0.001289  0.018576  0.026961  0.017663  0.005396  0.038127  0.030392
CAC.PA   0.000080  0.019846  0.017663  0.017986  0.005755  0.025707  0.014029
SAN.PA   0.000190  0.006959  0.005396  0.005755  0.021866  0.021535  0.021395
AETH.PA  0.002099  0.048179  0.038127  0.025707  0.021535  0.714188  0.510074
ABTC.PA -0.001060  0.030435  0.030392  0.014029  0.021395  0.510074  0.540178
 df_full  =             OBLI.PA  LQQ.PA  STZ.PA   CAC.PA  SAN.PA  AETH.PA  ABTC.PA
2021-06-01   10.790   616.3   58.36  63.6755   85.86   23.666   10.545
2021-06-02   10.798   621.8   58.52  64.0097   85.51   25.805   11.109
2021-06-03   10.790   613.1   58.61  63.8720   85.48   26.178   11.343
2021-06-04   10.812   629.0   58.34  63.9900   86.08   24.623   10.776
2021-06-07   10.792   625.2   58.57  64.2652   86.18   25.829   10.534
...             ...     ...     ...      ...     ...      ...      ...
2021-11-15   10.880   921.6   63.31  70.2300   90.07   45.555   19.913
2021-11-16   10.876   942.5   63.14  70.4700   90.17   42.700   18.909
2021-11-17   10.862   951.7   63.19  70.4700   90.60   41.977   18.862
2021-11-18   10.914   956.9   62.69  70.3100   88.27   39.717   17.886
2021-11-19   10.954   979.2   61.77  70.0200   88.90   42.002   18.114

[124 rows x 7 columns]
expected_returns [0.02984907 1.69211059 0.16011365 0.24816114 0.09971106 3.90697062
 2.93833753]
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540005731189
w=[0.14285716 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540013081518
w=[0.14285714 0.14285716 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539996692569
w=[0.14285714 0.14285714 0.14285716 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539994997065
w=[0.14285714 0.14285714 0.14285714 0.14285716 0.14285714 0.14285714
 0.14285714]
obj_value=-5.3755400006288685
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285716 0.14285714
 0.14285714]
obj_value=-5.3755400106248254
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285716
 0.14285714]
obj_value=-5.375539705195182
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285716]
obj_value=-5.375539758185792
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591925940692
w=[5.82432941e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919275733133
w=[5.82432926e-01 1.49011612e-08 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591962775734
w=[5.82432926e-01 0.00000000e+00 1.49011612e-08 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919628210003
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 1.49011612e-08
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919400496845
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567089e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015918558038898
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 1.49021251e-08 7.20534743e-13]
obj_value=-19.015920832513256
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 1.49018817e-08]
obj_value=-19.01592070181166
w=[0.00000000e+00 5.38662039e-01 4.50210940e-01 7.42461648e-14
 0.00000000e+00 0.00000000e+00 1.11270211e-02]
obj_value=-6.395574890819457
w=[3.55501109e-01 2.09877481e-01 1.75414510e-01 2.89283389e-14
 2.54871508e-01 5.88335498e-13 4.33539210e-03]
obj_value=-16.532238044351185
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216102849144
w=[4.83169859e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216111613336
w=[4.83169844e-01 9.18032965e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321541042118
w=[4.83169844e-01 9.18032816e-02 7.67287217e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321591785512
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.49011738e-08
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043215803059784
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401822e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321536416609
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 1.49019608e-08 1.89635982e-03]
obj_value=-22.043216428047483
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89637472e-03]
obj_value=-22.043216597770734
w=[7.65801887e-01 0.00000000e+00 6.05775152e-12 0.00000000e+00
 0.00000000e+00 3.90184116e-13 2.34198113e-01]
obj_value=-6.64186628565387
w=[5.76833390e-01 6.13799059e-02 5.13010071e-02 8.46026316e-15
 2.31605123e-01 6.63934310e-13 7.88805743e-02]
obj_value=-19.423440187508398
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316631453148
w=[5.20304377e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131663290693
w=[5.20304362e-01 7.97414279e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781315892415428
w=[5.20304362e-01 7.97414130e-02 6.66474745e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316379887127
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.49011722e-08
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316322329516
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888710e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131589323628
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 1.49019070e-08 3.24180707e-02]
obj_value=-23.781314817425844
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180856e-02]
obj_value=-23.781314863723377
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902559875025
w=[9.86071324e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099025022294676
w=[9.86071309e-01 1.49011612e-08 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902676367056
w=[9.86071309e-01 0.00000000e+00 1.49221312e-08 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099028201610196
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 1.49214292e-08
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026935362225
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 1.49011612e-08 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026923094144
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 1.49011612e-08 1.39286915e-02]
obj_value=-35.09902793856798
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39287064e-02]
obj_value=-35.099028858929316
w=[6.25747465e-01 8.93535246e-12 3.74252535e-01 0.00000000e+00
 2.05383488e-11 8.06299472e-12 0.00000000e+00]
obj_value=-22.82214592064075
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578139097654
w=[8.30890146e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578092031261
w=[8.30890132e-01 1.49050094e-08 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779214329565
w=[8.30890132e-01 3.84820082e-12 1.61179881e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03577949453445
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.49127004e-08
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779678113954
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 1.49100065e-08 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578179254781
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 1.49046337e-08 7.93000230e-03]
obj_value=-47.035778230114964
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93001720e-03]
obj_value=-47.035780867710166
w=[0.00000000e+00 3.27962947e-11 7.97825972e-11 0.00000000e+00
 1.00000000e+00 0.00000000e+00 9.52851548e-11]
obj_value=-6.762586079004216
w=[5.61879491e-01 1.32204933e-11 1.08995952e-01 7.80321676e-12
 3.23761988e-01 2.34823737e-12 5.36256902e-03]
obj_value=-26.20923967776448
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76492022295066
w=[7.58941340e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491983773814
w=[7.58941325e-01 1.49075161e-08 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491799427883
w=[7.58941325e-01 6.35488701e-12 1.47222923e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918292400104
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.49117011e-08
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918393537215
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924584e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918805378784
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 1.49043330e-08 7.24332403e-03]
obj_value=-47.764916362299
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24333893e-03]
obj_value=-47.76491850732435
w=[9.35013321e-01 0.00000000e+00 7.24078020e-11 0.00000000e+00
 6.49866792e-02 0.00000000e+00 1.08677466e-10]
obj_value=-35.47201751397131
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442391764858
w=[8.10544351e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.054423238692536
w=[8.10544336e-01 1.49056536e-08 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442186001478
w=[8.10544336e-01 4.49240283e-12 1.04074974e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442297678593
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 1.49086121e-08
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442249320169
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602618e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442248237479
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 1.49034034e-08 5.12045761e-03]
obj_value=-51.0544217200494
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12047251e-03]
obj_value=-51.05442443896617
w=[9.34286418e-01 1.26426979e-12 1.21143373e-12 0.00000000e+00
 3.58574281e-12 1.11653027e-11 6.57135823e-02]
obj_value=-24.720627953704415
w=[8.28519561e-01 4.02347248e-12 8.89566520e-02 6.36856712e-12
 6.86013513e-02 3.53841793e-12 1.39224354e-02]
obj_value=-50.881075801838044
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025346459842
w=[8.18636475e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252770711504
w=[8.18636460e-01 1.49054425e-08 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.4002514353683
w=[8.18636460e-01 4.28129879e-12 9.72689834e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252645352886
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 1.49081249e-08
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025215829412
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116361e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025210990398
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 1.49039869e-08 9.08295017e-03]
obj_value=-51.40024911704559
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08296507e-03]
obj_value=-51.40025163948705
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036323427809
w=[8.53015347e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036241653888
w=[8.53015332e-01 1.49011612e-08 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820361257067255
w=[8.53015332e-01 0.00000000e+00 9.77293231e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820362669055655
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 1.49580619e-08
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036206259256
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838702e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036276976336
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 1.49011612e-08 7.67150518e-03]
obj_value=-51.82036023195818
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67152008e-03]
obj_value=-51.82036322326711
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629368536147
w=[8.38310423e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292919502614
w=[8.38310408e-01 1.49011612e-08 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966291574043865
w=[8.38310408e-01 0.00000000e+00 1.01793434e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629286223483
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 1.49033159e-08
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629235918433
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16791138e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292890825315
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 1.49011612e-08 8.21707417e-03]
obj_value=-51.9662899057134
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21708907e-03]
obj_value=-51.96629277494531
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938537679447
w=[8.39985616e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460202549
w=[8.39985601e-01 1.49260123e-08 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938329170353
w=[8.39985601e-01 2.48511244e-11 1.00424031e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460821014
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 1.49011612e-08
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938408030388
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788964e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938459691375
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.50546410e-08 8.11150142e-03]
obj_value=-51.96938172296389
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11151632e-03]
obj_value=-51.96938460286133
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946768096141
w=[8.40036684e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946690651665
w=[8.40036669e-01 1.49011612e-08 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946559257332
w=[8.40036669e-01 0.00000000e+00 1.00654031e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466906205014
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.49148878e-08
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946638110884
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12014108e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466907626874
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 1.49011612e-08 8.10791878e-03]
obj_value=-51.96946402540161
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10793368e-03]
obj_value=-51.96946690822093
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946950311214
w=[8.40013047e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728709394
w=[8.40013032e-01 1.49211992e-08 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969467414929234
w=[8.40013032e-01 2.00380280e-11 1.00634479e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946872869365
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 1.49011612e-08
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946820344675
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427529e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728696874
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.50251437e-08 8.10976601e-03]
obj_value=-51.96946584636145
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10978091e-03]
obj_value=-51.96946872864314
_make_output_weights = OrderedDict([('OBLI.PA', 0.8400130320747131), ('LQQ.PA', 2.003802800889311e-11), ('STZ.PA', 0.10063446376694996), ('CAC.PA', 0.0), ('SAN.PA', 0.05124273801343399), ('AETH.PA', 1.23982524942074e-10), ('ABTC.PA', 0.008109766013414356)])
opto from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done
{'weights': OrderedDict([('OBLI.PA', 0.84001), ('LQQ.PA', 0.0), ('STZ.PA', 0.10063), ('CAC.PA', 0.0), ('SAN.PA', 0.05124), ('AETH.PA', 0.0), ('ABTC.PA', 0.00811)]), 'expected_return': 0.07012525988061888, 'volatility': 0.033874230190483384, 'sharpe_ratio': 1.4797460960367759, 'asset_type_weights': {'Equity': 0.15187, 'Crypto': 0.00811, 'Fixed Income': 0.84001}}
--- 0.7453958988189697 seconds ---
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
Getting data --- 0.295773983001709 seconds ---
--- end init 0.37145495414733887 seconds ---
back_test_portfolio from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done, columns Index(['OBLI.PA_adjusted_close', 'date_x', 'OBLI.PA_return', 'OBLI.PA_weight',
       'OBLI.PA_nb_shares', 'OBLI.PA_value', 'LQQ.PA_adjusted_close', 'date_y',
       'LQQ.PA_return', 'LQQ.PA_weight', 'LQQ.PA_nb_shares', 'LQQ.PA_value',
       'STZ.PA_adjusted_close', 'date_x', 'STZ.PA_return', 'STZ.PA_weight',
       'STZ.PA_nb_shares', 'STZ.PA_value', 'CAC.PA_adjusted_close', 'date_y',
       'CAC.PA_return', 'CAC.PA_weight', 'CAC.PA_nb_shares', 'CAC.PA_value',
       'SAN.PA_adjusted_close', 'date_x', 'SAN.PA_return', 'SAN.PA_weight',
       'SAN.PA_nb_shares', 'SAN.PA_value', 'AETH.PA_adjusted_close', 'date_y',
       'AETH.PA_return', 'AETH.PA_weight', 'AETH.PA_nb_shares',
       'AETH.PA_value', 'ABTC.PA_adjusted_close', 'date', 'ABTC.PA_return',
       'ABTC.PA_weight', 'ABTC.PA_nb_shares', 'ABTC.PA_value',
       'portfolio_value', 'portfolio_return'],
      dtype='object')
            OBLI.PA_adjusted_close  ... portfolio_return
date                                ...                 
2021-06-06                  10.812  ...        -0.000508
2021-06-13                  10.868  ...         0.005577
2021-06-20                  10.822  ...        -0.005760
2021-06-27                  10.770  ...        -0.003284
2021-07-04                  10.854  ...         0.004866
2021-07-11                  10.898  ...         0.002651
2021-07-18                  10.958  ...         0.003229
2021-07-25                  11.024  ...         0.006882
2021-08-01                  11.030  ...         0.002077
2021-08-08                  11.054  ...         0.005718
2021-08-15                  11.056  ...         0.003539
2021-08-22                  11.074  ...         0.001312
2021-08-29                  10.998  ...        -0.006255
2021-09-05                  10.942  ...        -0.004638
2021-09-12                  10.932  ...        -0.006183
2021-09-19                  10.912  ...        -0.001023
2021-09-26                  10.862  ...        -0.004425
2021-10-03                  10.844  ...         0.000921
2021-10-10                  10.786  ...         0.001782
2021-10-17                  10.824  ...         0.005316
2021-10-24                  10.780  ...        -0.001935
2021-10-31                  10.774  ...         0.001735
2021-11-07                  10.922  ...         0.013330
2021-11-14                  10.896  ...        -0.001280
2021-11-21                  10.954  ...         0.002029

[25 rows x 44 columns]
--- 0.48149609565734863 seconds ---
127.0.0.1 - - [21/Nov/2021 21:27:41] "[37mPOST /api/v1/maximum_diversificaton HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}, {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}]} 
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
Query itx = {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0000120578   SAN  ...          BBB            6
1  FR0007052782   CAC  ...          BBB            6
2  IE00BKWQ0G16   STZ  ...          BBB            6
3  CH0454664001  ABTC  ...          BBB            6
4  FR0010342592   LQQ  ...          BBB            6
5  FR0013346681  OBLI  ...          BBB            6
6  CH0454664027  AETH  ...          BBB            6

[7 rows x 21 columns] 
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['SAN.PA', 'CAC.PA', 'STZ.PA', 'ABTC.PA', 'LQQ.PA', 'OBLI.PA', 'AETH.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}, 'code': 1}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
 max_diversification cov =           OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA   AETH.PA   ABTC.PA
OBLI.PA  0.001239  0.001860 -0.001289  0.000080  0.000190  0.002099 -0.001060
LQQ.PA   0.001860  0.066896  0.018576  0.019846  0.006959  0.048179  0.030435
STZ.PA  -0.001289  0.018576  0.026961  0.017663  0.005396  0.038127  0.030392
CAC.PA   0.000080  0.019846  0.017663  0.017986  0.005755  0.025707  0.014029
SAN.PA   0.000190  0.006959  0.005396  0.005755  0.021866  0.021535  0.021395
AETH.PA  0.002099  0.048179  0.038127  0.025707  0.021535  0.714188  0.510074
ABTC.PA -0.001060  0.030435  0.030392  0.014029  0.021395  0.510074  0.540178
 df_full  =             OBLI.PA  LQQ.PA  STZ.PA   CAC.PA  SAN.PA  AETH.PA  ABTC.PA
2021-06-01   10.790   616.3   58.36  63.6755   85.86   23.666   10.545
2021-06-02   10.798   621.8   58.52  64.0097   85.51   25.805   11.109
2021-06-03   10.790   613.1   58.61  63.8720   85.48   26.178   11.343
2021-06-04   10.812   629.0   58.34  63.9900   86.08   24.623   10.776
2021-06-07   10.792   625.2   58.57  64.2652   86.18   25.829   10.534
...             ...     ...     ...      ...     ...      ...      ...
2021-11-15   10.880   921.6   63.31  70.2300   90.07   45.555   19.913
2021-11-16   10.876   942.5   63.14  70.4700   90.17   42.700   18.909
2021-11-17   10.862   951.7   63.19  70.4700   90.60   41.977   18.862
2021-11-18   10.914   956.9   62.69  70.3100   88.27   39.717   17.886
2021-11-19   10.954   979.2   61.77  70.0200   88.90   42.002   18.114

[124 rows x 7 columns]
expected_returns [0.02984907 1.69211059 0.16011365 0.24816114 0.09971106 3.90697062
 2.93833753]
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540005731189
w=[0.14285716 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540013081518
w=[0.14285714 0.14285716 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539996692569
w=[0.14285714 0.14285714 0.14285716 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539994997065
w=[0.14285714 0.14285714 0.14285714 0.14285716 0.14285714 0.14285714
 0.14285714]
obj_value=-5.3755400006288685
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285716 0.14285714
 0.14285714]
obj_value=-5.3755400106248254
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285716
 0.14285714]
obj_value=-5.375539705195182
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285716]
obj_value=-5.375539758185792
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591925940692
w=[5.82432941e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919275733133
w=[5.82432926e-01 1.49011612e-08 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591962775734
w=[5.82432926e-01 0.00000000e+00 1.49011612e-08 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919628210003
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 1.49011612e-08
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919400496845
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567089e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015918558038898
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 1.49021251e-08 7.20534743e-13]
obj_value=-19.015920832513256
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 1.49018817e-08]
obj_value=-19.01592070181166
w=[0.00000000e+00 5.38662039e-01 4.50210940e-01 7.42461648e-14
 0.00000000e+00 0.00000000e+00 1.11270211e-02]
obj_value=-6.395574890819457
w=[3.55501109e-01 2.09877481e-01 1.75414510e-01 2.89283389e-14
 2.54871508e-01 5.88335498e-13 4.33539210e-03]
obj_value=-16.532238044351185
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216102849144
w=[4.83169859e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216111613336
w=[4.83169844e-01 9.18032965e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321541042118
w=[4.83169844e-01 9.18032816e-02 7.67287217e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321591785512
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.49011738e-08
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043215803059784
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401822e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321536416609
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 1.49019608e-08 1.89635982e-03]
obj_value=-22.043216428047483
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89637472e-03]
obj_value=-22.043216597770734
w=[7.65801887e-01 0.00000000e+00 6.05775152e-12 0.00000000e+00
 0.00000000e+00 3.90184116e-13 2.34198113e-01]
obj_value=-6.64186628565387
w=[5.76833390e-01 6.13799059e-02 5.13010071e-02 8.46026316e-15
 2.31605123e-01 6.63934310e-13 7.88805743e-02]
obj_value=-19.423440187508398
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316631453148
w=[5.20304377e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131663290693
w=[5.20304362e-01 7.97414279e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781315892415428
w=[5.20304362e-01 7.97414130e-02 6.66474745e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316379887127
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.49011722e-08
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316322329516
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888710e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131589323628
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 1.49019070e-08 3.24180707e-02]
obj_value=-23.781314817425844
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180856e-02]
obj_value=-23.781314863723377
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902559875025
w=[9.86071324e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099025022294676
w=[9.86071309e-01 1.49011612e-08 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902676367056
w=[9.86071309e-01 0.00000000e+00 1.49221312e-08 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099028201610196
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 1.49214292e-08
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026935362225
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 1.49011612e-08 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026923094144
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 1.49011612e-08 1.39286915e-02]
obj_value=-35.09902793856798
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39287064e-02]
obj_value=-35.099028858929316
w=[6.25747465e-01 8.93535246e-12 3.74252535e-01 0.00000000e+00
 2.05383488e-11 8.06299472e-12 0.00000000e+00]
obj_value=-22.82214592064075
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578139097654
w=[8.30890146e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578092031261
w=[8.30890132e-01 1.49050094e-08 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779214329565
w=[8.30890132e-01 3.84820082e-12 1.61179881e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03577949453445
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.49127004e-08
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779678113954
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 1.49100065e-08 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578179254781
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 1.49046337e-08 7.93000230e-03]
obj_value=-47.035778230114964
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93001720e-03]
obj_value=-47.035780867710166
w=[0.00000000e+00 3.27962947e-11 7.97825972e-11 0.00000000e+00
 1.00000000e+00 0.00000000e+00 9.52851548e-11]
obj_value=-6.762586079004216
w=[5.61879491e-01 1.32204933e-11 1.08995952e-01 7.80321676e-12
 3.23761988e-01 2.34823737e-12 5.36256902e-03]
obj_value=-26.20923967776448
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76492022295066
w=[7.58941340e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491983773814
w=[7.58941325e-01 1.49075161e-08 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491799427883
w=[7.58941325e-01 6.35488701e-12 1.47222923e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918292400104
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.49117011e-08
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918393537215
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924584e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918805378784
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 1.49043330e-08 7.24332403e-03]
obj_value=-47.764916362299
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24333893e-03]
obj_value=-47.76491850732435
w=[9.35013321e-01 0.00000000e+00 7.24078020e-11 0.00000000e+00
 6.49866792e-02 0.00000000e+00 1.08677466e-10]
obj_value=-35.47201751397131
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442391764858
w=[8.10544351e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.054423238692536
w=[8.10544336e-01 1.49056536e-08 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442186001478
w=[8.10544336e-01 4.49240283e-12 1.04074974e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442297678593
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 1.49086121e-08
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442249320169
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602618e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442248237479
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 1.49034034e-08 5.12045761e-03]
obj_value=-51.0544217200494
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12047251e-03]
obj_value=-51.05442443896617
w=[9.34286418e-01 1.26426979e-12 1.21143373e-12 0.00000000e+00
 3.58574281e-12 1.11653027e-11 6.57135823e-02]
obj_value=-24.720627953704415
w=[8.28519561e-01 4.02347248e-12 8.89566520e-02 6.36856712e-12
 6.86013513e-02 3.53841793e-12 1.39224354e-02]
obj_value=-50.881075801838044
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025346459842
w=[8.18636475e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252770711504
w=[8.18636460e-01 1.49054425e-08 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.4002514353683
w=[8.18636460e-01 4.28129879e-12 9.72689834e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252645352886
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 1.49081249e-08
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025215829412
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116361e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025210990398
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 1.49039869e-08 9.08295017e-03]
obj_value=-51.40024911704559
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08296507e-03]
obj_value=-51.40025163948705
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036323427809
w=[8.53015347e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036241653888
w=[8.53015332e-01 1.49011612e-08 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820361257067255
w=[8.53015332e-01 0.00000000e+00 9.77293231e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820362669055655
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 1.49580619e-08
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036206259256
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838702e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036276976336
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 1.49011612e-08 7.67150518e-03]
obj_value=-51.82036023195818
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67152008e-03]
obj_value=-51.82036322326711
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629368536147
w=[8.38310423e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292919502614
w=[8.38310408e-01 1.49011612e-08 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966291574043865
w=[8.38310408e-01 0.00000000e+00 1.01793434e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629286223483
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 1.49033159e-08
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629235918433
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16791138e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292890825315
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 1.49011612e-08 8.21707417e-03]
obj_value=-51.9662899057134
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21708907e-03]
obj_value=-51.96629277494531
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938537679447
w=[8.39985616e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460202549
w=[8.39985601e-01 1.49260123e-08 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938329170353
w=[8.39985601e-01 2.48511244e-11 1.00424031e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460821014
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 1.49011612e-08
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938408030388
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788964e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938459691375
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.50546410e-08 8.11150142e-03]
obj_value=-51.96938172296389
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11151632e-03]
obj_value=-51.96938460286133
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946768096141
w=[8.40036684e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946690651665
w=[8.40036669e-01 1.49011612e-08 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946559257332
w=[8.40036669e-01 0.00000000e+00 1.00654031e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466906205014
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.49148878e-08
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946638110884
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12014108e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466907626874
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 1.49011612e-08 8.10791878e-03]
obj_value=-51.96946402540161
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10793368e-03]
obj_value=-51.96946690822093
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946950311214
w=[8.40013047e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728709394
w=[8.40013032e-01 1.49211992e-08 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969467414929234
w=[8.40013032e-01 2.00380280e-11 1.00634479e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946872869365
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 1.49011612e-08
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946820344675
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427529e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728696874
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.50251437e-08 8.10976601e-03]
obj_value=-51.96946584636145
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10978091e-03]
obj_value=-51.96946872864314
_make_output_weights = OrderedDict([('OBLI.PA', 0.8400130320747131), ('LQQ.PA', 2.003802800889311e-11), ('STZ.PA', 0.10063446376694996), ('CAC.PA', 0.0), ('SAN.PA', 0.05124273801343399), ('AETH.PA', 1.23982524942074e-10), ('ABTC.PA', 0.008109766013414356)])
opto from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done
{'weights': OrderedDict([('OBLI.PA', 0.84001), ('LQQ.PA', 0.0), ('STZ.PA', 0.10063), ('CAC.PA', 0.0), ('SAN.PA', 0.05124), ('AETH.PA', 0.0), ('ABTC.PA', 0.00811)]), 'expected_return': 0.07012525988061888, 'volatility': 0.033874230190483384, 'sharpe_ratio': 1.4797460960367759, 'asset_type_weights': {'Equity': 0.15187, 'Crypto': 0.00811, 'Fixed Income': 0.84001}}
--- 1.0195529460906982 seconds ---
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
Getting data --- 0.2910430431365967 seconds ---
--- end init 0.4368441104888916 seconds ---
back_test_portfolio from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done, columns Index(['OBLI.PA_adjusted_close', 'date_x', 'OBLI.PA_return', 'OBLI.PA_weight',
       'OBLI.PA_nb_shares', 'OBLI.PA_value', 'LQQ.PA_adjusted_close', 'date_y',
       'LQQ.PA_return', 'LQQ.PA_weight', 'LQQ.PA_nb_shares', 'LQQ.PA_value',
       'STZ.PA_adjusted_close', 'date_x', 'STZ.PA_return', 'STZ.PA_weight',
       'STZ.PA_nb_shares', 'STZ.PA_value', 'CAC.PA_adjusted_close', 'date_y',
       'CAC.PA_return', 'CAC.PA_weight', 'CAC.PA_nb_shares', 'CAC.PA_value',
       'SAN.PA_adjusted_close', 'date_x', 'SAN.PA_return', 'SAN.PA_weight',
       'SAN.PA_nb_shares', 'SAN.PA_value', 'AETH.PA_adjusted_close', 'date_y',
       'AETH.PA_return', 'AETH.PA_weight', 'AETH.PA_nb_shares',
       'AETH.PA_value', 'ABTC.PA_adjusted_close', 'date', 'ABTC.PA_return',
       'ABTC.PA_weight', 'ABTC.PA_nb_shares', 'ABTC.PA_value',
       'portfolio_value', 'portfolio_return'],
      dtype='object')
            OBLI.PA_adjusted_close  ... portfolio_return
date                                ...                 
2021-06-06                  10.812  ...        -0.000508
2021-06-13                  10.868  ...         0.005577
2021-06-20                  10.822  ...        -0.005760
2021-06-27                  10.770  ...        -0.003284
2021-07-04                  10.854  ...         0.004866
2021-07-11                  10.898  ...         0.002651
2021-07-18                  10.958  ...         0.003229
2021-07-25                  11.024  ...         0.006882
2021-08-01                  11.030  ...         0.002077
2021-08-08                  11.054  ...         0.005718
2021-08-15                  11.056  ...         0.003539
2021-08-22                  11.074  ...         0.001312
2021-08-29                  10.998  ...        -0.006255
2021-09-05                  10.942  ...        -0.004638
2021-09-12                  10.932  ...        -0.006183
2021-09-19                  10.912  ...        -0.001023
2021-09-26                  10.862  ...        -0.004425
2021-10-03                  10.844  ...         0.000921
2021-10-10                  10.786  ...         0.001782
2021-10-17                  10.824  ...         0.005316
2021-10-24                  10.780  ...        -0.001935
2021-10-31                  10.774  ...         0.001735
2021-11-07                  10.922  ...         0.013330
2021-11-14                  10.896  ...        -0.001280
2021-11-21                  10.954  ...         0.002029

[25 rows x 44 columns]
--- 0.5762403011322021 seconds ---
127.0.0.1 - - [21/Nov/2021 21:47:37] "[37mPOST /api/v1/maximum_diversificaton HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}, {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}]} 
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
Query itx = {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0000120578   SAN  ...          BBB            6
1  FR0007052782   CAC  ...          BBB            6
2  IE00BKWQ0G16   STZ  ...          BBB            6
3  CH0454664001  ABTC  ...          BBB            6
4  FR0010342592   LQQ  ...          BBB            6
5  FR0013346681  OBLI  ...          BBB            6
6  CH0454664027  AETH  ...          BBB            6

[7 rows x 21 columns] 
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['SAN.PA', 'CAC.PA', 'STZ.PA', 'ABTC.PA', 'LQQ.PA', 'OBLI.PA', 'AETH.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}, 'code': 1}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
 max_diversification cov =           OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA   AETH.PA   ABTC.PA
OBLI.PA  0.001239  0.001860 -0.001289  0.000080  0.000190  0.002099 -0.001060
LQQ.PA   0.001860  0.066896  0.018576  0.019846  0.006959  0.048179  0.030435
STZ.PA  -0.001289  0.018576  0.026961  0.017663  0.005396  0.038127  0.030392
CAC.PA   0.000080  0.019846  0.017663  0.017986  0.005755  0.025707  0.014029
SAN.PA   0.000190  0.006959  0.005396  0.005755  0.021866  0.021535  0.021395
AETH.PA  0.002099  0.048179  0.038127  0.025707  0.021535  0.714188  0.510074
ABTC.PA -0.001060  0.030435  0.030392  0.014029  0.021395  0.510074  0.540178
 df_full  =             OBLI.PA  LQQ.PA  STZ.PA   CAC.PA  SAN.PA  AETH.PA  ABTC.PA
2021-06-01   10.790   616.3   58.36  63.6755   85.86   23.666   10.545
2021-06-02   10.798   621.8   58.52  64.0097   85.51   25.805   11.109
2021-06-03   10.790   613.1   58.61  63.8720   85.48   26.178   11.343
2021-06-04   10.812   629.0   58.34  63.9900   86.08   24.623   10.776
2021-06-07   10.792   625.2   58.57  64.2652   86.18   25.829   10.534
...             ...     ...     ...      ...     ...      ...      ...
2021-11-15   10.880   921.6   63.31  70.2300   90.07   45.555   19.913
2021-11-16   10.876   942.5   63.14  70.4700   90.17   42.700   18.909
2021-11-17   10.862   951.7   63.19  70.4700   90.60   41.977   18.862
2021-11-18   10.914   956.9   62.69  70.3100   88.27   39.717   17.886
2021-11-19   10.954   979.2   61.77  70.0200   88.90   42.002   18.114

[124 rows x 7 columns]
expected_returns [0.02984907 1.69211059 0.16011365 0.24816114 0.09971106 3.90697062
 2.93833753]
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540005731189
w=[0.14285716 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540013081518
w=[0.14285714 0.14285716 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539996692569
w=[0.14285714 0.14285714 0.14285716 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539994997065
w=[0.14285714 0.14285714 0.14285714 0.14285716 0.14285714 0.14285714
 0.14285714]
obj_value=-5.3755400006288685
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285716 0.14285714
 0.14285714]
obj_value=-5.3755400106248254
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285716
 0.14285714]
obj_value=-5.375539705195182
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285716]
obj_value=-5.375539758185792
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591925940692
w=[5.82432941e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919275733133
w=[5.82432926e-01 1.49011612e-08 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591962775734
w=[5.82432926e-01 0.00000000e+00 1.49011612e-08 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919628210003
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 1.49011612e-08
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919400496845
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567089e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015918558038898
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 1.49021251e-08 7.20534743e-13]
obj_value=-19.015920832513256
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 1.49018817e-08]
obj_value=-19.01592070181166
w=[0.00000000e+00 5.38662039e-01 4.50210940e-01 7.42461648e-14
 0.00000000e+00 0.00000000e+00 1.11270211e-02]
obj_value=-6.395574890819457
w=[3.55501109e-01 2.09877481e-01 1.75414510e-01 2.89283389e-14
 2.54871508e-01 5.88335498e-13 4.33539210e-03]
obj_value=-16.532238044351185
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216102849144
w=[4.83169859e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216111613336
w=[4.83169844e-01 9.18032965e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321541042118
w=[4.83169844e-01 9.18032816e-02 7.67287217e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321591785512
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.49011738e-08
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043215803059784
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401822e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321536416609
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 1.49019608e-08 1.89635982e-03]
obj_value=-22.043216428047483
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89637472e-03]
obj_value=-22.043216597770734
w=[7.65801887e-01 0.00000000e+00 6.05775152e-12 0.00000000e+00
 0.00000000e+00 3.90184116e-13 2.34198113e-01]
obj_value=-6.64186628565387
w=[5.76833390e-01 6.13799059e-02 5.13010071e-02 8.46026316e-15
 2.31605123e-01 6.63934310e-13 7.88805743e-02]
obj_value=-19.423440187508398
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316631453148
w=[5.20304377e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131663290693
w=[5.20304362e-01 7.97414279e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781315892415428
w=[5.20304362e-01 7.97414130e-02 6.66474745e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316379887127
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.49011722e-08
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316322329516
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888710e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131589323628
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 1.49019070e-08 3.24180707e-02]
obj_value=-23.781314817425844
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180856e-02]
obj_value=-23.781314863723377
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902559875025
w=[9.86071324e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099025022294676
w=[9.86071309e-01 1.49011612e-08 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902676367056
w=[9.86071309e-01 0.00000000e+00 1.49221312e-08 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099028201610196
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 1.49214292e-08
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026935362225
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 1.49011612e-08 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026923094144
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 1.49011612e-08 1.39286915e-02]
obj_value=-35.09902793856798
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39287064e-02]
obj_value=-35.099028858929316
w=[6.25747465e-01 8.93535246e-12 3.74252535e-01 0.00000000e+00
 2.05383488e-11 8.06299472e-12 0.00000000e+00]
obj_value=-22.82214592064075
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578139097654
w=[8.30890146e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578092031261
w=[8.30890132e-01 1.49050094e-08 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779214329565
w=[8.30890132e-01 3.84820082e-12 1.61179881e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03577949453445
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.49127004e-08
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779678113954
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 1.49100065e-08 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578179254781
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 1.49046337e-08 7.93000230e-03]
obj_value=-47.035778230114964
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93001720e-03]
obj_value=-47.035780867710166
w=[0.00000000e+00 3.27962947e-11 7.97825972e-11 0.00000000e+00
 1.00000000e+00 0.00000000e+00 9.52851548e-11]
obj_value=-6.762586079004216
w=[5.61879491e-01 1.32204933e-11 1.08995952e-01 7.80321676e-12
 3.23761988e-01 2.34823737e-12 5.36256902e-03]
obj_value=-26.20923967776448
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76492022295066
w=[7.58941340e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491983773814
w=[7.58941325e-01 1.49075161e-08 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491799427883
w=[7.58941325e-01 6.35488701e-12 1.47222923e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918292400104
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.49117011e-08
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918393537215
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924584e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918805378784
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 1.49043330e-08 7.24332403e-03]
obj_value=-47.764916362299
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24333893e-03]
obj_value=-47.76491850732435
w=[9.35013321e-01 0.00000000e+00 7.24078020e-11 0.00000000e+00
 6.49866792e-02 0.00000000e+00 1.08677466e-10]
obj_value=-35.47201751397131
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442391764858
w=[8.10544351e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.054423238692536
w=[8.10544336e-01 1.49056536e-08 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442186001478
w=[8.10544336e-01 4.49240283e-12 1.04074974e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442297678593
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 1.49086121e-08
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442249320169
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602618e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442248237479
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 1.49034034e-08 5.12045761e-03]
obj_value=-51.0544217200494
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12047251e-03]
obj_value=-51.05442443896617
w=[9.34286418e-01 1.26426979e-12 1.21143373e-12 0.00000000e+00
 3.58574281e-12 1.11653027e-11 6.57135823e-02]
obj_value=-24.720627953704415
w=[8.28519561e-01 4.02347248e-12 8.89566520e-02 6.36856712e-12
 6.86013513e-02 3.53841793e-12 1.39224354e-02]
obj_value=-50.881075801838044
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025346459842
w=[8.18636475e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252770711504
w=[8.18636460e-01 1.49054425e-08 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.4002514353683
w=[8.18636460e-01 4.28129879e-12 9.72689834e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252645352886
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 1.49081249e-08
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025215829412
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116361e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025210990398
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 1.49039869e-08 9.08295017e-03]
obj_value=-51.40024911704559
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08296507e-03]
obj_value=-51.40025163948705
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036323427809
w=[8.53015347e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036241653888
w=[8.53015332e-01 1.49011612e-08 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820361257067255
w=[8.53015332e-01 0.00000000e+00 9.77293231e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820362669055655
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 1.49580619e-08
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036206259256
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838702e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036276976336
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 1.49011612e-08 7.67150518e-03]
obj_value=-51.82036023195818
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67152008e-03]
obj_value=-51.82036322326711
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629368536147
w=[8.38310423e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292919502614
w=[8.38310408e-01 1.49011612e-08 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966291574043865
w=[8.38310408e-01 0.00000000e+00 1.01793434e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629286223483
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 1.49033159e-08
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629235918433
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16791138e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292890825315
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 1.49011612e-08 8.21707417e-03]
obj_value=-51.9662899057134
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21708907e-03]
obj_value=-51.96629277494531
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938537679447
w=[8.39985616e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460202549
w=[8.39985601e-01 1.49260123e-08 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938329170353
w=[8.39985601e-01 2.48511244e-11 1.00424031e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460821014
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 1.49011612e-08
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938408030388
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788964e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938459691375
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.50546410e-08 8.11150142e-03]
obj_value=-51.96938172296389
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11151632e-03]
obj_value=-51.96938460286133
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946768096141
w=[8.40036684e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946690651665
w=[8.40036669e-01 1.49011612e-08 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946559257332
w=[8.40036669e-01 0.00000000e+00 1.00654031e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466906205014
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.49148878e-08
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946638110884
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12014108e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466907626874
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 1.49011612e-08 8.10791878e-03]
obj_value=-51.96946402540161
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10793368e-03]
obj_value=-51.96946690822093
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946950311214
w=[8.40013047e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728709394
w=[8.40013032e-01 1.49211992e-08 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969467414929234
w=[8.40013032e-01 2.00380280e-11 1.00634479e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946872869365
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 1.49011612e-08
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946820344675
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427529e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728696874
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.50251437e-08 8.10976601e-03]
obj_value=-51.96946584636145
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10978091e-03]
obj_value=-51.96946872864314
_make_output_weights = OrderedDict([('OBLI.PA', 0.8400130320747131), ('LQQ.PA', 2.003802800889311e-11), ('STZ.PA', 0.10063446376694996), ('CAC.PA', 0.0), ('SAN.PA', 0.05124273801343399), ('AETH.PA', 1.23982524942074e-10), ('ABTC.PA', 0.008109766013414356)])
opto from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done
{'weights': OrderedDict([('OBLI.PA', 0.84001), ('LQQ.PA', 0.0), ('STZ.PA', 0.10063), ('CAC.PA', 0.0), ('SAN.PA', 0.05124), ('AETH.PA', 0.0), ('ABTC.PA', 0.00811)]), 'expected_return': 0.07012525988061888, 'volatility': 0.033874230190483384, 'sharpe_ratio': 1.4797460960367759, 'asset_type_weights': {'Equity': 0.15187, 'Crypto': 0.00811, 'Fixed Income': 0.84001}}
--- 1.1891310214996338 seconds ---
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
Getting data --- 0.36569690704345703 seconds ---
--- end init 0.4932069778442383 seconds ---
back_test_portfolio from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done, columns Index(['OBLI.PA_adjusted_close', 'date_x', 'OBLI.PA_return', 'OBLI.PA_weight',
       'OBLI.PA_nb_shares', 'OBLI.PA_value', 'LQQ.PA_adjusted_close', 'date_y',
       'LQQ.PA_return', 'LQQ.PA_weight', 'LQQ.PA_nb_shares', 'LQQ.PA_value',
       'STZ.PA_adjusted_close', 'date_x', 'STZ.PA_return', 'STZ.PA_weight',
       'STZ.PA_nb_shares', 'STZ.PA_value', 'CAC.PA_adjusted_close', 'date_y',
       'CAC.PA_return', 'CAC.PA_weight', 'CAC.PA_nb_shares', 'CAC.PA_value',
       'SAN.PA_adjusted_close', 'date_x', 'SAN.PA_return', 'SAN.PA_weight',
       'SAN.PA_nb_shares', 'SAN.PA_value', 'AETH.PA_adjusted_close', 'date_y',
       'AETH.PA_return', 'AETH.PA_weight', 'AETH.PA_nb_shares',
       'AETH.PA_value', 'ABTC.PA_adjusted_close', 'date', 'ABTC.PA_return',
       'ABTC.PA_weight', 'ABTC.PA_nb_shares', 'ABTC.PA_value',
       'portfolio_value', 'portfolio_return'],
      dtype='object')
            OBLI.PA_adjusted_close  ... portfolio_return
date                                ...                 
2021-06-06                  10.812  ...        -0.000508
2021-06-13                  10.868  ...         0.005577
2021-06-20                  10.822  ...        -0.005760
2021-06-27                  10.770  ...        -0.003284
2021-07-04                  10.854  ...         0.004866
2021-07-11                  10.898  ...         0.002651
2021-07-18                  10.958  ...         0.003229
2021-07-25                  11.024  ...         0.006882
2021-08-01                  11.030  ...         0.002077
2021-08-08                  11.054  ...         0.005718
2021-08-15                  11.056  ...         0.003539
2021-08-22                  11.074  ...         0.001312
2021-08-29                  10.998  ...        -0.006255
2021-09-05                  10.942  ...        -0.004638
2021-09-12                  10.932  ...        -0.006183
2021-09-19                  10.912  ...        -0.001023
2021-09-26                  10.862  ...        -0.004425
2021-10-03                  10.844  ...         0.000921
2021-10-10                  10.786  ...         0.001782
2021-10-17                  10.824  ...         0.005316
2021-10-24                  10.780  ...        -0.001935
2021-10-31                  10.774  ...         0.001735
2021-11-07                  10.922  ...         0.013330
2021-11-14                  10.896  ...        -0.001280
2021-11-21                  10.954  ...         0.002029

[25 rows x 44 columns]
--- 0.6337740421295166 seconds ---
127.0.0.1 - - [21/Nov/2021 22:13:06] "[37mPOST /api/v1/maximum_diversificaton HTTP/1.1[0m" 200 -
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}, {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}]} 
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
Query itx = {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0000120578   SAN  ...          BBB            6
1  FR0007052782   CAC  ...          BBB            6
2  IE00BKWQ0G16   STZ  ...          BBB            6
3  CH0454664001  ABTC  ...          BBB            6
4  FR0010342592   LQQ  ...          BBB            6
5  FR0013346681  OBLI  ...          BBB            6
6  CH0454664027  AETH  ...          BBB            6

[7 rows x 21 columns] 
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['SAN.PA', 'CAC.PA', 'STZ.PA', 'ABTC.PA', 'LQQ.PA', 'OBLI.PA', 'AETH.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}, 'code': 1}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
 max_diversification cov =           OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA   AETH.PA   ABTC.PA
OBLI.PA  0.001239  0.001860 -0.001289  0.000080  0.000190  0.002099 -0.001060
LQQ.PA   0.001860  0.066896  0.018576  0.019846  0.006959  0.048179  0.030435
STZ.PA  -0.001289  0.018576  0.026961  0.017663  0.005396  0.038127  0.030392
CAC.PA   0.000080  0.019846  0.017663  0.017986  0.005755  0.025707  0.014029
SAN.PA   0.000190  0.006959  0.005396  0.005755  0.021866  0.021535  0.021395
AETH.PA  0.002099  0.048179  0.038127  0.025707  0.021535  0.714188  0.510074
ABTC.PA -0.001060  0.030435  0.030392  0.014029  0.021395  0.510074  0.540178
 df_full  =             OBLI.PA  LQQ.PA  STZ.PA   CAC.PA  SAN.PA  AETH.PA  ABTC.PA
2021-06-01   10.790   616.3   58.36  63.6755   85.86   23.666   10.545
2021-06-02   10.798   621.8   58.52  64.0097   85.51   25.805   11.109
2021-06-03   10.790   613.1   58.61  63.8720   85.48   26.178   11.343
2021-06-04   10.812   629.0   58.34  63.9900   86.08   24.623   10.776
2021-06-07   10.792   625.2   58.57  64.2652   86.18   25.829   10.534
...             ...     ...     ...      ...     ...      ...      ...
2021-11-15   10.880   921.6   63.31  70.2300   90.07   45.555   19.913
2021-11-16   10.876   942.5   63.14  70.4700   90.17   42.700   18.909
2021-11-17   10.862   951.7   63.19  70.4700   90.60   41.977   18.862
2021-11-18   10.914   956.9   62.69  70.3100   88.27   39.717   17.886
2021-11-19   10.954   979.2   61.77  70.0200   88.90   42.002   18.114

[124 rows x 7 columns]
expected_returns [0.02984907 1.69211059 0.16011365 0.24816114 0.09971106 3.90697062
 2.93833753]
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540005731189
w=[0.14285716 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540013081518
w=[0.14285714 0.14285716 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539996692569
w=[0.14285714 0.14285714 0.14285716 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539994997065
w=[0.14285714 0.14285714 0.14285714 0.14285716 0.14285714 0.14285714
 0.14285714]
obj_value=-5.3755400006288685
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285716 0.14285714
 0.14285714]
obj_value=-5.3755400106248254
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285716
 0.14285714]
obj_value=-5.375539705195182
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285716]
obj_value=-5.375539758185792
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591925940692
w=[5.82432941e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919275733133
w=[5.82432926e-01 1.49011612e-08 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591962775734
w=[5.82432926e-01 0.00000000e+00 1.49011612e-08 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919628210003
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 1.49011612e-08
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919400496845
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567089e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015918558038898
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 1.49021251e-08 7.20534743e-13]
obj_value=-19.015920832513256
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 1.49018817e-08]
obj_value=-19.01592070181166
w=[0.00000000e+00 5.38662039e-01 4.50210940e-01 7.42461648e-14
 0.00000000e+00 0.00000000e+00 1.11270211e-02]
obj_value=-6.395574890819457
w=[3.55501109e-01 2.09877481e-01 1.75414510e-01 2.89283389e-14
 2.54871508e-01 5.88335498e-13 4.33539210e-03]
obj_value=-16.532238044351185
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216102849144
w=[4.83169859e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216111613336
w=[4.83169844e-01 9.18032965e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321541042118
w=[4.83169844e-01 9.18032816e-02 7.67287217e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321591785512
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.49011738e-08
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043215803059784
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401822e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321536416609
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 1.49019608e-08 1.89635982e-03]
obj_value=-22.043216428047483
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89637472e-03]
obj_value=-22.043216597770734
w=[7.65801887e-01 0.00000000e+00 6.05775152e-12 0.00000000e+00
 0.00000000e+00 3.90184116e-13 2.34198113e-01]
obj_value=-6.64186628565387
w=[5.76833390e-01 6.13799059e-02 5.13010071e-02 8.46026316e-15
 2.31605123e-01 6.63934310e-13 7.88805743e-02]
obj_value=-19.423440187508398
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316631453148
w=[5.20304377e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131663290693
w=[5.20304362e-01 7.97414279e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781315892415428
w=[5.20304362e-01 7.97414130e-02 6.66474745e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316379887127
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.49011722e-08
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316322329516
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888710e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131589323628
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 1.49019070e-08 3.24180707e-02]
obj_value=-23.781314817425844
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180856e-02]
obj_value=-23.781314863723377
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902559875025
w=[9.86071324e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099025022294676
w=[9.86071309e-01 1.49011612e-08 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902676367056
w=[9.86071309e-01 0.00000000e+00 1.49221312e-08 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099028201610196
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 1.49214292e-08
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026935362225
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 1.49011612e-08 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026923094144
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 1.49011612e-08 1.39286915e-02]
obj_value=-35.09902793856798
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39287064e-02]
obj_value=-35.099028858929316
w=[6.25747465e-01 8.93535246e-12 3.74252535e-01 0.00000000e+00
 2.05383488e-11 8.06299472e-12 0.00000000e+00]
obj_value=-22.82214592064075
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578139097654
w=[8.30890146e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578092031261
w=[8.30890132e-01 1.49050094e-08 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779214329565
w=[8.30890132e-01 3.84820082e-12 1.61179881e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03577949453445
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.49127004e-08
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779678113954
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 1.49100065e-08 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578179254781
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 1.49046337e-08 7.93000230e-03]
obj_value=-47.035778230114964
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93001720e-03]
obj_value=-47.035780867710166
w=[0.00000000e+00 3.27962947e-11 7.97825972e-11 0.00000000e+00
 1.00000000e+00 0.00000000e+00 9.52851548e-11]
obj_value=-6.762586079004216
w=[5.61879491e-01 1.32204933e-11 1.08995952e-01 7.80321676e-12
 3.23761988e-01 2.34823737e-12 5.36256902e-03]
obj_value=-26.20923967776448
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76492022295066
w=[7.58941340e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491983773814
w=[7.58941325e-01 1.49075161e-08 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491799427883
w=[7.58941325e-01 6.35488701e-12 1.47222923e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918292400104
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.49117011e-08
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918393537215
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924584e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918805378784
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 1.49043330e-08 7.24332403e-03]
obj_value=-47.764916362299
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24333893e-03]
obj_value=-47.76491850732435
w=[9.35013321e-01 0.00000000e+00 7.24078020e-11 0.00000000e+00
 6.49866792e-02 0.00000000e+00 1.08677466e-10]
obj_value=-35.47201751397131
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442391764858
w=[8.10544351e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.054423238692536
w=[8.10544336e-01 1.49056536e-08 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442186001478
w=[8.10544336e-01 4.49240283e-12 1.04074974e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442297678593
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 1.49086121e-08
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442249320169
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602618e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442248237479
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 1.49034034e-08 5.12045761e-03]
obj_value=-51.0544217200494
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12047251e-03]
obj_value=-51.05442443896617
w=[9.34286418e-01 1.26426979e-12 1.21143373e-12 0.00000000e+00
 3.58574281e-12 1.11653027e-11 6.57135823e-02]
obj_value=-24.720627953704415
w=[8.28519561e-01 4.02347248e-12 8.89566520e-02 6.36856712e-12
 6.86013513e-02 3.53841793e-12 1.39224354e-02]
obj_value=-50.881075801838044
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025346459842
w=[8.18636475e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252770711504
w=[8.18636460e-01 1.49054425e-08 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.4002514353683
w=[8.18636460e-01 4.28129879e-12 9.72689834e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252645352886
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 1.49081249e-08
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025215829412
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116361e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025210990398
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 1.49039869e-08 9.08295017e-03]
obj_value=-51.40024911704559
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08296507e-03]
obj_value=-51.40025163948705
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036323427809
w=[8.53015347e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036241653888
w=[8.53015332e-01 1.49011612e-08 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820361257067255
w=[8.53015332e-01 0.00000000e+00 9.77293231e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820362669055655
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 1.49580619e-08
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036206259256
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838702e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036276976336
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 1.49011612e-08 7.67150518e-03]
obj_value=-51.82036023195818
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67152008e-03]
obj_value=-51.82036322326711
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629368536147
w=[8.38310423e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292919502614
w=[8.38310408e-01 1.49011612e-08 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966291574043865
w=[8.38310408e-01 0.00000000e+00 1.01793434e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629286223483
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 1.49033159e-08
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629235918433
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16791138e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292890825315
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 1.49011612e-08 8.21707417e-03]
obj_value=-51.9662899057134
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21708907e-03]
obj_value=-51.96629277494531
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938537679447
w=[8.39985616e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460202549
w=[8.39985601e-01 1.49260123e-08 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938329170353
w=[8.39985601e-01 2.48511244e-11 1.00424031e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460821014
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 1.49011612e-08
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938408030388
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788964e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938459691375
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.50546410e-08 8.11150142e-03]
obj_value=-51.96938172296389
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11151632e-03]
obj_value=-51.96938460286133
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946768096141
w=[8.40036684e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946690651665
w=[8.40036669e-01 1.49011612e-08 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946559257332
w=[8.40036669e-01 0.00000000e+00 1.00654031e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466906205014
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.49148878e-08
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946638110884
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12014108e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466907626874
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 1.49011612e-08 8.10791878e-03]
obj_value=-51.96946402540161
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10793368e-03]
obj_value=-51.96946690822093
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946950311214
w=[8.40013047e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728709394
w=[8.40013032e-01 1.49211992e-08 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969467414929234
w=[8.40013032e-01 2.00380280e-11 1.00634479e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946872869365
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 1.49011612e-08
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946820344675
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427529e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728696874
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.50251437e-08 8.10976601e-03]
obj_value=-51.96946584636145
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10978091e-03]
obj_value=-51.96946872864314
_make_output_weights = OrderedDict([('OBLI.PA', 0.8400130320747131), ('LQQ.PA', 2.003802800889311e-11), ('STZ.PA', 0.10063446376694996), ('CAC.PA', 0.0), ('SAN.PA', 0.05124273801343399), ('AETH.PA', 1.23982524942074e-10), ('ABTC.PA', 0.008109766013414356)])
opto from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done
{'weights': OrderedDict([('OBLI.PA', 0.84001), ('LQQ.PA', 0.0), ('STZ.PA', 0.10063), ('CAC.PA', 0.0), ('SAN.PA', 0.05124), ('AETH.PA', 0.0), ('ABTC.PA', 0.00811)]), 'expected_return': 0.07012525988061888, 'volatility': 0.033874230190483384, 'sharpe_ratio': 1.4797460960367759, 'asset_type_weights': {'Equity': 0.15187, 'Crypto': 0.00811, 'Fixed Income': 0.84001}}
--- 0.786250114440918 seconds ---
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
Getting data --- 0.33289599418640137 seconds ---
--- end init 0.3934342861175537 seconds ---
back_test_portfolio from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done, columns Index(['OBLI.PA_adjusted_close', 'date_x', 'OBLI.PA_return', 'OBLI.PA_weight',
       'OBLI.PA_nb_shares', 'OBLI.PA_value', 'LQQ.PA_adjusted_close', 'date_y',
       'LQQ.PA_return', 'LQQ.PA_weight', 'LQQ.PA_nb_shares', 'LQQ.PA_value',
       'STZ.PA_adjusted_close', 'date_x', 'STZ.PA_return', 'STZ.PA_weight',
       'STZ.PA_nb_shares', 'STZ.PA_value', 'CAC.PA_adjusted_close', 'date_y',
       'CAC.PA_return', 'CAC.PA_weight', 'CAC.PA_nb_shares', 'CAC.PA_value',
       'SAN.PA_adjusted_close', 'date_x', 'SAN.PA_return', 'SAN.PA_weight',
       'SAN.PA_nb_shares', 'SAN.PA_value', 'AETH.PA_adjusted_close', 'date_y',
       'AETH.PA_return', 'AETH.PA_weight', 'AETH.PA_nb_shares',
       'AETH.PA_value', 'ABTC.PA_adjusted_close', 'date', 'ABTC.PA_return',
       'ABTC.PA_weight', 'ABTC.PA_nb_shares', 'ABTC.PA_value',
       'portfolio_value', 'portfolio_return'],
      dtype='object')
            OBLI.PA_adjusted_close  ... portfolio_return
date                                ...                 
2021-06-06                  10.812  ...        -0.000508
2021-06-13                  10.868  ...         0.005577
2021-06-20                  10.822  ...        -0.005760
2021-06-27                  10.770  ...        -0.003284
2021-07-04                  10.854  ...         0.004866
2021-07-11                  10.898  ...         0.002651
2021-07-18                  10.958  ...         0.003229
2021-07-25                  11.024  ...         0.006882
2021-08-01                  11.030  ...         0.002077
2021-08-08                  11.054  ...         0.005718
2021-08-15                  11.056  ...         0.003539
2021-08-22                  11.074  ...         0.001312
2021-08-29                  10.998  ...        -0.006255
2021-09-05                  10.942  ...        -0.004638
2021-09-12                  10.932  ...        -0.006183
2021-09-19                  10.912  ...        -0.001023
2021-09-26                  10.862  ...        -0.004425
2021-10-03                  10.844  ...         0.000921
2021-10-10                  10.786  ...         0.001782
2021-10-17                  10.824  ...         0.005316
2021-10-24                  10.780  ...        -0.001935
2021-10-31                  10.774  ...         0.001735
2021-11-07                  10.922  ...         0.013330
2021-11-14                  10.896  ...        -0.001280
2021-11-21                  10.954  ...         0.002029

[25 rows x 44 columns]
--- 0.5023303031921387 seconds ---
127.0.0.1 - - [21/Nov/2021 22:14:45] "[37mPOST /api/v1/maximum_diversificaton HTTP/1.1[0m" 200 -
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}, {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}]} 
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
Query itx = {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0000120578   SAN  ...          BBB            6
1  FR0007052782   CAC  ...          BBB            6
2  IE00BKWQ0G16   STZ  ...          BBB            6
3  CH0454664001  ABTC  ...          BBB            6
4  FR0010342592   LQQ  ...          BBB            6
5  FR0013346681  OBLI  ...          BBB            6
6  CH0454664027  AETH  ...          BBB            6

[7 rows x 21 columns] 
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['SAN.PA', 'CAC.PA', 'STZ.PA', 'ABTC.PA', 'LQQ.PA', 'OBLI.PA', 'AETH.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}, 'code': 1}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
 max_diversification cov =           OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA   AETH.PA   ABTC.PA
OBLI.PA  0.001239  0.001860 -0.001289  0.000080  0.000190  0.002099 -0.001060
LQQ.PA   0.001860  0.066896  0.018576  0.019846  0.006959  0.048179  0.030435
STZ.PA  -0.001289  0.018576  0.026961  0.017663  0.005396  0.038127  0.030392
CAC.PA   0.000080  0.019846  0.017663  0.017986  0.005755  0.025707  0.014029
SAN.PA   0.000190  0.006959  0.005396  0.005755  0.021866  0.021535  0.021395
AETH.PA  0.002099  0.048179  0.038127  0.025707  0.021535  0.714188  0.510074
ABTC.PA -0.001060  0.030435  0.030392  0.014029  0.021395  0.510074  0.540178
 df_full  =             OBLI.PA  LQQ.PA  STZ.PA   CAC.PA  SAN.PA  AETH.PA  ABTC.PA
2021-06-01   10.790   616.3   58.36  63.6755   85.86   23.666   10.545
2021-06-02   10.798   621.8   58.52  64.0097   85.51   25.805   11.109
2021-06-03   10.790   613.1   58.61  63.8720   85.48   26.178   11.343
2021-06-04   10.812   629.0   58.34  63.9900   86.08   24.623   10.776
2021-06-07   10.792   625.2   58.57  64.2652   86.18   25.829   10.534
...             ...     ...     ...      ...     ...      ...      ...
2021-11-15   10.880   921.6   63.31  70.2300   90.07   45.555   19.913
2021-11-16   10.876   942.5   63.14  70.4700   90.17   42.700   18.909
2021-11-17   10.862   951.7   63.19  70.4700   90.60   41.977   18.862
2021-11-18   10.914   956.9   62.69  70.3100   88.27   39.717   17.886
2021-11-19   10.954   979.2   61.77  70.0200   88.90   42.002   18.114

[124 rows x 7 columns]
expected_returns [0.02984907 1.69211059 0.16011365 0.24816114 0.09971106 3.90697062
 2.93833753]
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540005731189
w=[0.14285716 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540013081518
w=[0.14285714 0.14285716 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539996692569
w=[0.14285714 0.14285714 0.14285716 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539994997065
w=[0.14285714 0.14285714 0.14285714 0.14285716 0.14285714 0.14285714
 0.14285714]
obj_value=-5.3755400006288685
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285716 0.14285714
 0.14285714]
obj_value=-5.3755400106248254
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285716
 0.14285714]
obj_value=-5.375539705195182
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285716]
obj_value=-5.375539758185792
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591925940692
w=[5.82432941e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919275733133
w=[5.82432926e-01 1.49011612e-08 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591962775734
w=[5.82432926e-01 0.00000000e+00 1.49011612e-08 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919628210003
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 1.49011612e-08
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919400496845
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567089e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015918558038898
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 1.49021251e-08 7.20534743e-13]
obj_value=-19.015920832513256
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 1.49018817e-08]
obj_value=-19.01592070181166
w=[0.00000000e+00 5.38662039e-01 4.50210940e-01 7.42461648e-14
 0.00000000e+00 0.00000000e+00 1.11270211e-02]
obj_value=-6.395574890819457
w=[3.55501109e-01 2.09877481e-01 1.75414510e-01 2.89283389e-14
 2.54871508e-01 5.88335498e-13 4.33539210e-03]
obj_value=-16.532238044351185
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216102849144
w=[4.83169859e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216111613336
w=[4.83169844e-01 9.18032965e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321541042118
w=[4.83169844e-01 9.18032816e-02 7.67287217e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321591785512
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.49011738e-08
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043215803059784
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401822e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321536416609
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 1.49019608e-08 1.89635982e-03]
obj_value=-22.043216428047483
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89637472e-03]
obj_value=-22.043216597770734
w=[7.65801887e-01 0.00000000e+00 6.05775152e-12 0.00000000e+00
 0.00000000e+00 3.90184116e-13 2.34198113e-01]
obj_value=-6.64186628565387
w=[5.76833390e-01 6.13799059e-02 5.13010071e-02 8.46026316e-15
 2.31605123e-01 6.63934310e-13 7.88805743e-02]
obj_value=-19.423440187508398
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316631453148
w=[5.20304377e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131663290693
w=[5.20304362e-01 7.97414279e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781315892415428
w=[5.20304362e-01 7.97414130e-02 6.66474745e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316379887127
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.49011722e-08
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316322329516
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888710e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131589323628
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 1.49019070e-08 3.24180707e-02]
obj_value=-23.781314817425844
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180856e-02]
obj_value=-23.781314863723377
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902559875025
w=[9.86071324e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099025022294676
w=[9.86071309e-01 1.49011612e-08 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902676367056
w=[9.86071309e-01 0.00000000e+00 1.49221312e-08 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099028201610196
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 1.49214292e-08
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026935362225
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 1.49011612e-08 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026923094144
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 1.49011612e-08 1.39286915e-02]
obj_value=-35.09902793856798
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39287064e-02]
obj_value=-35.099028858929316
w=[6.25747465e-01 8.93535246e-12 3.74252535e-01 0.00000000e+00
 2.05383488e-11 8.06299472e-12 0.00000000e+00]
obj_value=-22.82214592064075
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578139097654
w=[8.30890146e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578092031261
w=[8.30890132e-01 1.49050094e-08 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779214329565
w=[8.30890132e-01 3.84820082e-12 1.61179881e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03577949453445
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.49127004e-08
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779678113954
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 1.49100065e-08 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578179254781
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 1.49046337e-08 7.93000230e-03]
obj_value=-47.035778230114964
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93001720e-03]
obj_value=-47.035780867710166
w=[0.00000000e+00 3.27962947e-11 7.97825972e-11 0.00000000e+00
 1.00000000e+00 0.00000000e+00 9.52851548e-11]
obj_value=-6.762586079004216
w=[5.61879491e-01 1.32204933e-11 1.08995952e-01 7.80321676e-12
 3.23761988e-01 2.34823737e-12 5.36256902e-03]
obj_value=-26.20923967776448
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76492022295066
w=[7.58941340e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491983773814
w=[7.58941325e-01 1.49075161e-08 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491799427883
w=[7.58941325e-01 6.35488701e-12 1.47222923e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918292400104
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.49117011e-08
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918393537215
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924584e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918805378784
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 1.49043330e-08 7.24332403e-03]
obj_value=-47.764916362299
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24333893e-03]
obj_value=-47.76491850732435
w=[9.35013321e-01 0.00000000e+00 7.24078020e-11 0.00000000e+00
 6.49866792e-02 0.00000000e+00 1.08677466e-10]
obj_value=-35.47201751397131
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442391764858
w=[8.10544351e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.054423238692536
w=[8.10544336e-01 1.49056536e-08 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442186001478
w=[8.10544336e-01 4.49240283e-12 1.04074974e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442297678593
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 1.49086121e-08
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442249320169
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602618e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442248237479
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 1.49034034e-08 5.12045761e-03]
obj_value=-51.0544217200494
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12047251e-03]
obj_value=-51.05442443896617
w=[9.34286418e-01 1.26426979e-12 1.21143373e-12 0.00000000e+00
 3.58574281e-12 1.11653027e-11 6.57135823e-02]
obj_value=-24.720627953704415
w=[8.28519561e-01 4.02347248e-12 8.89566520e-02 6.36856712e-12
 6.86013513e-02 3.53841793e-12 1.39224354e-02]
obj_value=-50.881075801838044
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025346459842
w=[8.18636475e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252770711504
w=[8.18636460e-01 1.49054425e-08 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.4002514353683
w=[8.18636460e-01 4.28129879e-12 9.72689834e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252645352886
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 1.49081249e-08
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025215829412
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116361e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025210990398
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 1.49039869e-08 9.08295017e-03]
obj_value=-51.40024911704559
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08296507e-03]
obj_value=-51.40025163948705
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036323427809
w=[8.53015347e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036241653888
w=[8.53015332e-01 1.49011612e-08 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820361257067255
w=[8.53015332e-01 0.00000000e+00 9.77293231e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820362669055655
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 1.49580619e-08
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036206259256
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838702e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036276976336
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 1.49011612e-08 7.67150518e-03]
obj_value=-51.82036023195818
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67152008e-03]
obj_value=-51.82036322326711
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629368536147
w=[8.38310423e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292919502614
w=[8.38310408e-01 1.49011612e-08 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966291574043865
w=[8.38310408e-01 0.00000000e+00 1.01793434e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629286223483
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 1.49033159e-08
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629235918433
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16791138e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292890825315
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 1.49011612e-08 8.21707417e-03]
obj_value=-51.9662899057134
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21708907e-03]
obj_value=-51.96629277494531
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938537679447
w=[8.39985616e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460202549
w=[8.39985601e-01 1.49260123e-08 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938329170353
w=[8.39985601e-01 2.48511244e-11 1.00424031e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460821014
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 1.49011612e-08
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938408030388
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788964e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938459691375
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.50546410e-08 8.11150142e-03]
obj_value=-51.96938172296389
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11151632e-03]
obj_value=-51.96938460286133
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946768096141
w=[8.40036684e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946690651665
w=[8.40036669e-01 1.49011612e-08 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946559257332
w=[8.40036669e-01 0.00000000e+00 1.00654031e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466906205014
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.49148878e-08
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946638110884
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12014108e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466907626874
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 1.49011612e-08 8.10791878e-03]
obj_value=-51.96946402540161
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10793368e-03]
obj_value=-51.96946690822093
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946950311214
w=[8.40013047e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728709394
w=[8.40013032e-01 1.49211992e-08 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969467414929234
w=[8.40013032e-01 2.00380280e-11 1.00634479e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946872869365
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 1.49011612e-08
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946820344675
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427529e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728696874
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.50251437e-08 8.10976601e-03]
obj_value=-51.96946584636145
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10978091e-03]
obj_value=-51.96946872864314
_make_output_weights = OrderedDict([('OBLI.PA', 0.8400130320747131), ('LQQ.PA', 2.003802800889311e-11), ('STZ.PA', 0.10063446376694996), ('CAC.PA', 0.0), ('SAN.PA', 0.05124273801343399), ('AETH.PA', 1.23982524942074e-10), ('ABTC.PA', 0.008109766013414356)])
opto from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done
{'weights': OrderedDict([('OBLI.PA', 0.84001), ('LQQ.PA', 0.0), ('STZ.PA', 0.10063), ('CAC.PA', 0.0), ('SAN.PA', 0.05124), ('AETH.PA', 0.0), ('ABTC.PA', 0.00811)]), 'expected_return': 0.07012525988061888, 'volatility': 0.033874230190483384, 'sharpe_ratio': 1.4797460960367759, 'asset_type_weights': {'Equity': 0.15187, 'Crypto': 0.00811, 'Fixed Income': 0.84001}}
--- 0.6810228824615479 seconds ---
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
Getting data --- 0.30489182472229004 seconds ---
--- end init 0.36680078506469727 seconds ---
back_test_portfolio from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done, columns Index(['OBLI.PA_adjusted_close', 'date_x', 'OBLI.PA_return', 'OBLI.PA_weight',
       'OBLI.PA_nb_shares', 'OBLI.PA_value', 'LQQ.PA_adjusted_close', 'date_y',
       'LQQ.PA_return', 'LQQ.PA_weight', 'LQQ.PA_nb_shares', 'LQQ.PA_value',
       'STZ.PA_adjusted_close', 'date_x', 'STZ.PA_return', 'STZ.PA_weight',
       'STZ.PA_nb_shares', 'STZ.PA_value', 'CAC.PA_adjusted_close', 'date_y',
       'CAC.PA_return', 'CAC.PA_weight', 'CAC.PA_nb_shares', 'CAC.PA_value',
       'SAN.PA_adjusted_close', 'date_x', 'SAN.PA_return', 'SAN.PA_weight',
       'SAN.PA_nb_shares', 'SAN.PA_value', 'AETH.PA_adjusted_close', 'date_y',
       'AETH.PA_return', 'AETH.PA_weight', 'AETH.PA_nb_shares',
       'AETH.PA_value', 'ABTC.PA_adjusted_close', 'date', 'ABTC.PA_return',
       'ABTC.PA_weight', 'ABTC.PA_nb_shares', 'ABTC.PA_value',
       'portfolio_value', 'portfolio_return'],
      dtype='object')
            OBLI.PA_adjusted_close  ... portfolio_return
date                                ...                 
2021-06-06                  10.812  ...        -0.000508
2021-06-13                  10.868  ...         0.005577
2021-06-20                  10.822  ...        -0.005760
2021-06-27                  10.770  ...        -0.003284
2021-07-04                  10.854  ...         0.004866
2021-07-11                  10.898  ...         0.002651
2021-07-18                  10.958  ...         0.003229
2021-07-25                  11.024  ...         0.006882
2021-08-01                  11.030  ...         0.002077
2021-08-08                  11.054  ...         0.005718
2021-08-15                  11.056  ...         0.003539
2021-08-22                  11.074  ...         0.001312
2021-08-29                  10.998  ...        -0.006255
2021-09-05                  10.942  ...        -0.004638
2021-09-12                  10.932  ...        -0.006183
2021-09-19                  10.912  ...        -0.001023
2021-09-26                  10.862  ...        -0.004425
2021-10-03                  10.844  ...         0.000921
2021-10-10                  10.786  ...         0.001782
2021-10-17                  10.824  ...         0.005316
2021-10-24                  10.780  ...        -0.001935
2021-10-31                  10.774  ...         0.001735
2021-11-07                  10.922  ...         0.013330
2021-11-14                  10.896  ...        -0.001280
2021-11-21                  10.954  ...         0.002029

[25 rows x 44 columns]
--- 0.4722628593444824 seconds ---
127.0.0.1 - - [21/Nov/2021 22:14:56] "[37mPOST /api/v1/maximum_diversificaton HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/simulation.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}, {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}]} 
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
Query itx = {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0000120578   SAN  ...          BBB            6
1  FR0007052782   CAC  ...          BBB            6
2  IE00BKWQ0G16   STZ  ...          BBB            6
3  CH0454664001  ABTC  ...          BBB            6
4  FR0010342592   LQQ  ...          BBB            6
5  FR0013346681  OBLI  ...          BBB            6
6  CH0454664027  AETH  ...          BBB            6

[7 rows x 21 columns] 
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['SAN.PA', 'CAC.PA', 'STZ.PA', 'ABTC.PA', 'LQQ.PA', 'OBLI.PA', 'AETH.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}, 'code': 1}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
 max_diversification cov =           OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA   AETH.PA   ABTC.PA
OBLI.PA  0.001239  0.001860 -0.001289  0.000080  0.000190  0.002099 -0.001060
LQQ.PA   0.001860  0.066896  0.018576  0.019846  0.006959  0.048179  0.030435
STZ.PA  -0.001289  0.018576  0.026961  0.017663  0.005396  0.038127  0.030392
CAC.PA   0.000080  0.019846  0.017663  0.017986  0.005755  0.025707  0.014029
SAN.PA   0.000190  0.006959  0.005396  0.005755  0.021866  0.021535  0.021395
AETH.PA  0.002099  0.048179  0.038127  0.025707  0.021535  0.714188  0.510074
ABTC.PA -0.001060  0.030435  0.030392  0.014029  0.021395  0.510074  0.540178
 df_full  =             OBLI.PA  LQQ.PA  STZ.PA   CAC.PA  SAN.PA  AETH.PA  ABTC.PA
2021-06-01   10.790   616.3   58.36  63.6755   85.86   23.666   10.545
2021-06-02   10.798   621.8   58.52  64.0097   85.51   25.805   11.109
2021-06-03   10.790   613.1   58.61  63.8720   85.48   26.178   11.343
2021-06-04   10.812   629.0   58.34  63.9900   86.08   24.623   10.776
2021-06-07   10.792   625.2   58.57  64.2652   86.18   25.829   10.534
...             ...     ...     ...      ...     ...      ...      ...
2021-11-15   10.880   921.6   63.31  70.2300   90.07   45.555   19.913
2021-11-16   10.876   942.5   63.14  70.4700   90.17   42.700   18.909
2021-11-17   10.862   951.7   63.19  70.4700   90.60   41.977   18.862
2021-11-18   10.914   956.9   62.69  70.3100   88.27   39.717   17.886
2021-11-19   10.954   979.2   61.77  70.0200   88.90   42.002   18.114

[124 rows x 7 columns]
expected_returns [0.02984907 1.69211059 0.16011365 0.24816114 0.09971106 3.90697062
 2.93833753]
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540005731189
w=[0.14285716 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540013081518
w=[0.14285714 0.14285716 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539996692569
w=[0.14285714 0.14285714 0.14285716 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539994997065
w=[0.14285714 0.14285714 0.14285714 0.14285716 0.14285714 0.14285714
 0.14285714]
obj_value=-5.3755400006288685
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285716 0.14285714
 0.14285714]
obj_value=-5.3755400106248254
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285716
 0.14285714]
obj_value=-5.375539705195182
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285716]
obj_value=-5.375539758185792
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591925940692
w=[5.82432941e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919275733133
w=[5.82432926e-01 1.49011612e-08 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591962775734
w=[5.82432926e-01 0.00000000e+00 1.49011612e-08 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919628210003
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 1.49011612e-08
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919400496845
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567089e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015918558038898
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 1.49021251e-08 7.20534743e-13]
obj_value=-19.015920832513256
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 1.49018817e-08]
obj_value=-19.01592070181166
w=[0.00000000e+00 5.38662039e-01 4.50210940e-01 7.42461648e-14
 0.00000000e+00 0.00000000e+00 1.11270211e-02]
obj_value=-6.395574890819457
w=[3.55501109e-01 2.09877481e-01 1.75414510e-01 2.89283389e-14
 2.54871508e-01 5.88335498e-13 4.33539210e-03]
obj_value=-16.532238044351185
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216102849144
w=[4.83169859e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216111613336
w=[4.83169844e-01 9.18032965e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321541042118
w=[4.83169844e-01 9.18032816e-02 7.67287217e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321591785512
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.49011738e-08
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043215803059784
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401822e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321536416609
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 1.49019608e-08 1.89635982e-03]
obj_value=-22.043216428047483
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89637472e-03]
obj_value=-22.043216597770734
w=[7.65801887e-01 0.00000000e+00 6.05775152e-12 0.00000000e+00
 0.00000000e+00 3.90184116e-13 2.34198113e-01]
obj_value=-6.64186628565387
w=[5.76833390e-01 6.13799059e-02 5.13010071e-02 8.46026316e-15
 2.31605123e-01 6.63934310e-13 7.88805743e-02]
obj_value=-19.423440187508398
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316631453148
w=[5.20304377e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131663290693
w=[5.20304362e-01 7.97414279e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781315892415428
w=[5.20304362e-01 7.97414130e-02 6.66474745e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316379887127
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.49011722e-08
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316322329516
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888710e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131589323628
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 1.49019070e-08 3.24180707e-02]
obj_value=-23.781314817425844
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180856e-02]
obj_value=-23.781314863723377
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902559875025
w=[9.86071324e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099025022294676
w=[9.86071309e-01 1.49011612e-08 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902676367056
w=[9.86071309e-01 0.00000000e+00 1.49221312e-08 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099028201610196
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 1.49214292e-08
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026935362225
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 1.49011612e-08 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026923094144
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 1.49011612e-08 1.39286915e-02]
obj_value=-35.09902793856798
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39287064e-02]
obj_value=-35.099028858929316
w=[6.25747465e-01 8.93535246e-12 3.74252535e-01 0.00000000e+00
 2.05383488e-11 8.06299472e-12 0.00000000e+00]
obj_value=-22.82214592064075
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578139097654
w=[8.30890146e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578092031261
w=[8.30890132e-01 1.49050094e-08 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779214329565
w=[8.30890132e-01 3.84820082e-12 1.61179881e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03577949453445
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.49127004e-08
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779678113954
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 1.49100065e-08 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578179254781
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 1.49046337e-08 7.93000230e-03]
obj_value=-47.035778230114964
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93001720e-03]
obj_value=-47.035780867710166
w=[0.00000000e+00 3.27962947e-11 7.97825972e-11 0.00000000e+00
 1.00000000e+00 0.00000000e+00 9.52851548e-11]
obj_value=-6.762586079004216
w=[5.61879491e-01 1.32204933e-11 1.08995952e-01 7.80321676e-12
 3.23761988e-01 2.34823737e-12 5.36256902e-03]
obj_value=-26.20923967776448
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76492022295066
w=[7.58941340e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491983773814
w=[7.58941325e-01 1.49075161e-08 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491799427883
w=[7.58941325e-01 6.35488701e-12 1.47222923e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918292400104
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.49117011e-08
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918393537215
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924584e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918805378784
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 1.49043330e-08 7.24332403e-03]
obj_value=-47.764916362299
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24333893e-03]
obj_value=-47.76491850732435
w=[9.35013321e-01 0.00000000e+00 7.24078020e-11 0.00000000e+00
 6.49866792e-02 0.00000000e+00 1.08677466e-10]
obj_value=-35.47201751397131
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442391764858
w=[8.10544351e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.054423238692536
w=[8.10544336e-01 1.49056536e-08 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442186001478
w=[8.10544336e-01 4.49240283e-12 1.04074974e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442297678593
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 1.49086121e-08
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442249320169
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602618e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442248237479
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 1.49034034e-08 5.12045761e-03]
obj_value=-51.0544217200494
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12047251e-03]
obj_value=-51.05442443896617
w=[9.34286418e-01 1.26426979e-12 1.21143373e-12 0.00000000e+00
 3.58574281e-12 1.11653027e-11 6.57135823e-02]
obj_value=-24.720627953704415
w=[8.28519561e-01 4.02347248e-12 8.89566520e-02 6.36856712e-12
 6.86013513e-02 3.53841793e-12 1.39224354e-02]
obj_value=-50.881075801838044
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025346459842
w=[8.18636475e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252770711504
w=[8.18636460e-01 1.49054425e-08 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.4002514353683
w=[8.18636460e-01 4.28129879e-12 9.72689834e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252645352886
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 1.49081249e-08
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025215829412
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116361e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025210990398
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 1.49039869e-08 9.08295017e-03]
obj_value=-51.40024911704559
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08296507e-03]
obj_value=-51.40025163948705
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036323427809
w=[8.53015347e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036241653888
w=[8.53015332e-01 1.49011612e-08 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820361257067255
w=[8.53015332e-01 0.00000000e+00 9.77293231e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820362669055655
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 1.49580619e-08
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036206259256
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838702e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036276976336
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 1.49011612e-08 7.67150518e-03]
obj_value=-51.82036023195818
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67152008e-03]
obj_value=-51.82036322326711
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629368536147
w=[8.38310423e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292919502614
w=[8.38310408e-01 1.49011612e-08 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966291574043865
w=[8.38310408e-01 0.00000000e+00 1.01793434e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629286223483
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 1.49033159e-08
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629235918433
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16791138e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292890825315
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 1.49011612e-08 8.21707417e-03]
obj_value=-51.9662899057134
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21708907e-03]
obj_value=-51.96629277494531
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938537679447
w=[8.39985616e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460202549
w=[8.39985601e-01 1.49260123e-08 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938329170353
w=[8.39985601e-01 2.48511244e-11 1.00424031e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460821014
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 1.49011612e-08
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938408030388
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788964e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938459691375
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.50546410e-08 8.11150142e-03]
obj_value=-51.96938172296389
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11151632e-03]
obj_value=-51.96938460286133
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946768096141
w=[8.40036684e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946690651665
w=[8.40036669e-01 1.49011612e-08 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946559257332
w=[8.40036669e-01 0.00000000e+00 1.00654031e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466906205014
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.49148878e-08
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946638110884
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12014108e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466907626874
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 1.49011612e-08 8.10791878e-03]
obj_value=-51.96946402540161
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10793368e-03]
obj_value=-51.96946690822093
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946950311214
w=[8.40013047e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728709394
w=[8.40013032e-01 1.49211992e-08 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969467414929234
w=[8.40013032e-01 2.00380280e-11 1.00634479e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946872869365
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 1.49011612e-08
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946820344675
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427529e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728696874
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.50251437e-08 8.10976601e-03]
obj_value=-51.96946584636145
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10978091e-03]
obj_value=-51.96946872864314
_make_output_weights = OrderedDict([('OBLI.PA', 0.8400130320747131), ('LQQ.PA', 2.003802800889311e-11), ('STZ.PA', 0.10063446376694996), ('CAC.PA', 0.0), ('SAN.PA', 0.05124273801343399), ('AETH.PA', 1.23982524942074e-10), ('ABTC.PA', 0.008109766013414356)])
opto from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done
{'weights': OrderedDict([('OBLI.PA', 0.84001), ('LQQ.PA', 0.0), ('STZ.PA', 0.10063), ('CAC.PA', 0.0), ('SAN.PA', 0.05124), ('AETH.PA', 0.0), ('ABTC.PA', 0.00811)]), 'expected_return': 0.07012525988061888, 'volatility': 0.033874230190483384, 'sharpe_ratio': 1.4797460960367759, 'asset_type_weights': {'Equity': 0.15187, 'Crypto': 0.00811, 'Fixed Income': 0.84001}}
--- 1.2900238037109375 seconds ---
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
Getting data --- 0.336439847946167 seconds ---
--- end init 0.44890403747558594 seconds ---
back_test_portfolio from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done, columns Index(['OBLI.PA_adjusted_close', 'date_x', 'OBLI.PA_return', 'OBLI.PA_weight',
       'OBLI.PA_nb_shares', 'OBLI.PA_value', 'LQQ.PA_adjusted_close', 'date_y',
       'LQQ.PA_return', 'LQQ.PA_weight', 'LQQ.PA_nb_shares', 'LQQ.PA_value',
       'STZ.PA_adjusted_close', 'date_x', 'STZ.PA_return', 'STZ.PA_weight',
       'STZ.PA_nb_shares', 'STZ.PA_value', 'CAC.PA_adjusted_close', 'date_y',
       'CAC.PA_return', 'CAC.PA_weight', 'CAC.PA_nb_shares', 'CAC.PA_value',
       'SAN.PA_adjusted_close', 'date_x', 'SAN.PA_return', 'SAN.PA_weight',
       'SAN.PA_nb_shares', 'SAN.PA_value', 'AETH.PA_adjusted_close', 'date_y',
       'AETH.PA_return', 'AETH.PA_weight', 'AETH.PA_nb_shares',
       'AETH.PA_value', 'ABTC.PA_adjusted_close', 'date', 'ABTC.PA_return',
       'ABTC.PA_weight', 'ABTC.PA_nb_shares', 'ABTC.PA_value',
       'portfolio_value', 'portfolio_return'],
      dtype='object')
            OBLI.PA_adjusted_close  ... portfolio_return
date                                ...                 
2021-06-06                  10.812  ...        -0.000508
2021-06-13                  10.868  ...         0.005577
2021-06-20                  10.822  ...        -0.005760
2021-06-27                  10.770  ...        -0.003284
2021-07-04                  10.854  ...         0.004866
2021-07-11                  10.898  ...         0.002651
2021-07-18                  10.958  ...         0.003229
2021-07-25                  11.024  ...         0.006882
2021-08-01                  11.030  ...         0.002077
2021-08-08                  11.054  ...         0.005718
2021-08-15                  11.056  ...         0.003539
2021-08-22                  11.074  ...         0.001312
2021-08-29                  10.998  ...        -0.006255
2021-09-05                  10.942  ...        -0.004638
2021-09-12                  10.932  ...        -0.006183
2021-09-19                  10.912  ...        -0.001023
2021-09-26                  10.862  ...        -0.004425
2021-10-03                  10.844  ...         0.000921
2021-10-10                  10.786  ...         0.001782
2021-10-17                  10.824  ...         0.005316
2021-10-24                  10.780  ...        -0.001935
2021-10-31                  10.774  ...         0.001735
2021-11-07                  10.922  ...         0.013330
2021-11-14                  10.896  ...        -0.001280
2021-11-21                  10.954  ...         0.002029

[25 rows x 44 columns]
--- 0.5881979465484619 seconds ---
127.0.0.1 - - [21/Nov/2021 22:29:31] "[37mPOST /api/v1/maximum_diversificaton HTTP/1.1[0m" 200 -
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}, {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}]} 
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
Query itx = {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0000120578   SAN  ...          BBB            6
1  FR0007052782   CAC  ...          BBB            6
2  IE00BKWQ0G16   STZ  ...          BBB            6
3  CH0454664001  ABTC  ...          BBB            6
4  FR0010342592   LQQ  ...          BBB            6
5  FR0013346681  OBLI  ...          BBB            6
6  CH0454664027  AETH  ...          BBB            6

[7 rows x 21 columns] 
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['SAN.PA', 'CAC.PA', 'STZ.PA', 'ABTC.PA', 'LQQ.PA', 'OBLI.PA', 'AETH.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}, 'code': 1}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
 max_diversification cov =           OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA   AETH.PA   ABTC.PA
OBLI.PA  0.001239  0.001860 -0.001289  0.000080  0.000190  0.002099 -0.001060
LQQ.PA   0.001860  0.066896  0.018576  0.019846  0.006959  0.048179  0.030435
STZ.PA  -0.001289  0.018576  0.026961  0.017663  0.005396  0.038127  0.030392
CAC.PA   0.000080  0.019846  0.017663  0.017986  0.005755  0.025707  0.014029
SAN.PA   0.000190  0.006959  0.005396  0.005755  0.021866  0.021535  0.021395
AETH.PA  0.002099  0.048179  0.038127  0.025707  0.021535  0.714188  0.510074
ABTC.PA -0.001060  0.030435  0.030392  0.014029  0.021395  0.510074  0.540178
 df_full  =             OBLI.PA  LQQ.PA  STZ.PA   CAC.PA  SAN.PA  AETH.PA  ABTC.PA
2021-06-01   10.790   616.3   58.36  63.6755   85.86   23.666   10.545
2021-06-02   10.798   621.8   58.52  64.0097   85.51   25.805   11.109
2021-06-03   10.790   613.1   58.61  63.8720   85.48   26.178   11.343
2021-06-04   10.812   629.0   58.34  63.9900   86.08   24.623   10.776
2021-06-07   10.792   625.2   58.57  64.2652   86.18   25.829   10.534
...             ...     ...     ...      ...     ...      ...      ...
2021-11-15   10.880   921.6   63.31  70.2300   90.07   45.555   19.913
2021-11-16   10.876   942.5   63.14  70.4700   90.17   42.700   18.909
2021-11-17   10.862   951.7   63.19  70.4700   90.60   41.977   18.862
2021-11-18   10.914   956.9   62.69  70.3100   88.27   39.717   17.886
2021-11-19   10.954   979.2   61.77  70.0200   88.90   42.002   18.114

[124 rows x 7 columns]
expected_returns [0.02984907 1.69211059 0.16011365 0.24816114 0.09971106 3.90697062
 2.93833753]
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540005731189
w=[0.14285716 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540013081518
w=[0.14285714 0.14285716 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539996692569
w=[0.14285714 0.14285714 0.14285716 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539994997065
w=[0.14285714 0.14285714 0.14285714 0.14285716 0.14285714 0.14285714
 0.14285714]
obj_value=-5.3755400006288685
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285716 0.14285714
 0.14285714]
obj_value=-5.3755400106248254
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285716
 0.14285714]
obj_value=-5.375539705195182
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285716]
obj_value=-5.375539758185792
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591925940692
w=[5.82432941e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919275733133
w=[5.82432926e-01 1.49011612e-08 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591962775734
w=[5.82432926e-01 0.00000000e+00 1.49011612e-08 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919628210003
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 1.49011612e-08
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919400496845
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567089e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015918558038898
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 1.49021251e-08 7.20534743e-13]
obj_value=-19.015920832513256
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 1.49018817e-08]
obj_value=-19.01592070181166
w=[0.00000000e+00 5.38662039e-01 4.50210940e-01 7.42461648e-14
 0.00000000e+00 0.00000000e+00 1.11270211e-02]
obj_value=-6.395574890819457
w=[3.55501109e-01 2.09877481e-01 1.75414510e-01 2.89283389e-14
 2.54871508e-01 5.88335498e-13 4.33539210e-03]
obj_value=-16.532238044351185
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216102849144
w=[4.83169859e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216111613336
w=[4.83169844e-01 9.18032965e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321541042118
w=[4.83169844e-01 9.18032816e-02 7.67287217e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321591785512
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.49011738e-08
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043215803059784
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401822e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321536416609
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 1.49019608e-08 1.89635982e-03]
obj_value=-22.043216428047483
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89637472e-03]
obj_value=-22.043216597770734
w=[7.65801887e-01 0.00000000e+00 6.05775152e-12 0.00000000e+00
 0.00000000e+00 3.90184116e-13 2.34198113e-01]
obj_value=-6.64186628565387
w=[5.76833390e-01 6.13799059e-02 5.13010071e-02 8.46026316e-15
 2.31605123e-01 6.63934310e-13 7.88805743e-02]
obj_value=-19.423440187508398
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316631453148
w=[5.20304377e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131663290693
w=[5.20304362e-01 7.97414279e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781315892415428
w=[5.20304362e-01 7.97414130e-02 6.66474745e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316379887127
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.49011722e-08
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316322329516
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888710e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131589323628
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 1.49019070e-08 3.24180707e-02]
obj_value=-23.781314817425844
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180856e-02]
obj_value=-23.781314863723377
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902559875025
w=[9.86071324e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099025022294676
w=[9.86071309e-01 1.49011612e-08 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902676367056
w=[9.86071309e-01 0.00000000e+00 1.49221312e-08 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099028201610196
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 1.49214292e-08
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026935362225
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 1.49011612e-08 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026923094144
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 1.49011612e-08 1.39286915e-02]
obj_value=-35.09902793856798
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39287064e-02]
obj_value=-35.099028858929316
w=[6.25747465e-01 8.93535246e-12 3.74252535e-01 0.00000000e+00
 2.05383488e-11 8.06299472e-12 0.00000000e+00]
obj_value=-22.82214592064075
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578139097654
w=[8.30890146e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578092031261
w=[8.30890132e-01 1.49050094e-08 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779214329565
w=[8.30890132e-01 3.84820082e-12 1.61179881e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03577949453445
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.49127004e-08
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779678113954
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 1.49100065e-08 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578179254781
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 1.49046337e-08 7.93000230e-03]
obj_value=-47.035778230114964
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93001720e-03]
obj_value=-47.035780867710166
w=[0.00000000e+00 3.27962947e-11 7.97825972e-11 0.00000000e+00
 1.00000000e+00 0.00000000e+00 9.52851548e-11]
obj_value=-6.762586079004216
w=[5.61879491e-01 1.32204933e-11 1.08995952e-01 7.80321676e-12
 3.23761988e-01 2.34823737e-12 5.36256902e-03]
obj_value=-26.20923967776448
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76492022295066
w=[7.58941340e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491983773814
w=[7.58941325e-01 1.49075161e-08 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491799427883
w=[7.58941325e-01 6.35488701e-12 1.47222923e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918292400104
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.49117011e-08
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918393537215
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924584e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918805378784
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 1.49043330e-08 7.24332403e-03]
obj_value=-47.764916362299
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24333893e-03]
obj_value=-47.76491850732435
w=[9.35013321e-01 0.00000000e+00 7.24078020e-11 0.00000000e+00
 6.49866792e-02 0.00000000e+00 1.08677466e-10]
obj_value=-35.47201751397131
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442391764858
w=[8.10544351e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.054423238692536
w=[8.10544336e-01 1.49056536e-08 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442186001478
w=[8.10544336e-01 4.49240283e-12 1.04074974e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442297678593
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 1.49086121e-08
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442249320169
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602618e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442248237479
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 1.49034034e-08 5.12045761e-03]
obj_value=-51.0544217200494
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12047251e-03]
obj_value=-51.05442443896617
w=[9.34286418e-01 1.26426979e-12 1.21143373e-12 0.00000000e+00
 3.58574281e-12 1.11653027e-11 6.57135823e-02]
obj_value=-24.720627953704415
w=[8.28519561e-01 4.02347248e-12 8.89566520e-02 6.36856712e-12
 6.86013513e-02 3.53841793e-12 1.39224354e-02]
obj_value=-50.881075801838044
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025346459842
w=[8.18636475e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252770711504
w=[8.18636460e-01 1.49054425e-08 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.4002514353683
w=[8.18636460e-01 4.28129879e-12 9.72689834e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252645352886
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 1.49081249e-08
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025215829412
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116361e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025210990398
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 1.49039869e-08 9.08295017e-03]
obj_value=-51.40024911704559
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08296507e-03]
obj_value=-51.40025163948705
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036323427809
w=[8.53015347e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036241653888
w=[8.53015332e-01 1.49011612e-08 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820361257067255
w=[8.53015332e-01 0.00000000e+00 9.77293231e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820362669055655
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 1.49580619e-08
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036206259256
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838702e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036276976336
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 1.49011612e-08 7.67150518e-03]
obj_value=-51.82036023195818
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67152008e-03]
obj_value=-51.82036322326711
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629368536147
w=[8.38310423e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292919502614
w=[8.38310408e-01 1.49011612e-08 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966291574043865
w=[8.38310408e-01 0.00000000e+00 1.01793434e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629286223483
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 1.49033159e-08
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629235918433
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16791138e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292890825315
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 1.49011612e-08 8.21707417e-03]
obj_value=-51.9662899057134
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21708907e-03]
obj_value=-51.96629277494531
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938537679447
w=[8.39985616e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460202549
w=[8.39985601e-01 1.49260123e-08 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938329170353
w=[8.39985601e-01 2.48511244e-11 1.00424031e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460821014
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 1.49011612e-08
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938408030388
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788964e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938459691375
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.50546410e-08 8.11150142e-03]
obj_value=-51.96938172296389
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11151632e-03]
obj_value=-51.96938460286133
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946768096141
w=[8.40036684e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946690651665
w=[8.40036669e-01 1.49011612e-08 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946559257332
w=[8.40036669e-01 0.00000000e+00 1.00654031e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466906205014
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.49148878e-08
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946638110884
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12014108e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466907626874
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 1.49011612e-08 8.10791878e-03]
obj_value=-51.96946402540161
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10793368e-03]
obj_value=-51.96946690822093
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946950311214
w=[8.40013047e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728709394
w=[8.40013032e-01 1.49211992e-08 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969467414929234
w=[8.40013032e-01 2.00380280e-11 1.00634479e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946872869365
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 1.49011612e-08
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946820344675
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427529e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728696874
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.50251437e-08 8.10976601e-03]
obj_value=-51.96946584636145
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10978091e-03]
obj_value=-51.96946872864314
_make_output_weights = OrderedDict([('OBLI.PA', 0.8400130320747131), ('LQQ.PA', 2.003802800889311e-11), ('STZ.PA', 0.10063446376694996), ('CAC.PA', 0.0), ('SAN.PA', 0.05124273801343399), ('AETH.PA', 1.23982524942074e-10), ('ABTC.PA', 0.008109766013414356)])
opto from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done
{'weights': OrderedDict([('OBLI.PA', 0.84001), ('LQQ.PA', 0.0), ('STZ.PA', 0.10063), ('CAC.PA', 0.0), ('SAN.PA', 0.05124), ('AETH.PA', 0.0), ('ABTC.PA', 0.00811)]), 'expected_return': 0.07012525988061888, 'volatility': 0.033874230190483384, 'sharpe_ratio': 1.4797460960367759, 'asset_type_weights': {'Equity': 0.15187, 'Crypto': 0.00811, 'Fixed Income': 0.84001}}
--- 0.7485470771789551 seconds ---
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
Getting data --- 0.2803049087524414 seconds ---
--- end init 0.40326499938964844 seconds ---
back_test_portfolio from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done, columns Index(['OBLI.PA_adjusted_close', 'date_x', 'OBLI.PA_return', 'OBLI.PA_weight',
       'OBLI.PA_nb_shares', 'OBLI.PA_value', 'LQQ.PA_adjusted_close', 'date_y',
       'LQQ.PA_return', 'LQQ.PA_weight', 'LQQ.PA_nb_shares', 'LQQ.PA_value',
       'STZ.PA_adjusted_close', 'date_x', 'STZ.PA_return', 'STZ.PA_weight',
       'STZ.PA_nb_shares', 'STZ.PA_value', 'CAC.PA_adjusted_close', 'date_y',
       'CAC.PA_return', 'CAC.PA_weight', 'CAC.PA_nb_shares', 'CAC.PA_value',
       'SAN.PA_adjusted_close', 'date_x', 'SAN.PA_return', 'SAN.PA_weight',
       'SAN.PA_nb_shares', 'SAN.PA_value', 'AETH.PA_adjusted_close', 'date_y',
       'AETH.PA_return', 'AETH.PA_weight', 'AETH.PA_nb_shares',
       'AETH.PA_value', 'ABTC.PA_adjusted_close', 'date', 'ABTC.PA_return',
       'ABTC.PA_weight', 'ABTC.PA_nb_shares', 'ABTC.PA_value',
       'portfolio_value', 'portfolio_return'],
      dtype='object')
            OBLI.PA_adjusted_close  ... portfolio_return
date                                ...                 
2021-06-06                  10.812  ...        -0.000508
2021-06-13                  10.868  ...         0.005577
2021-06-20                  10.822  ...        -0.005760
2021-06-27                  10.770  ...        -0.003284
2021-07-04                  10.854  ...         0.004866
2021-07-11                  10.898  ...         0.002651
2021-07-18                  10.958  ...         0.003229
2021-07-25                  11.024  ...         0.006882
2021-08-01                  11.030  ...         0.002077
2021-08-08                  11.054  ...         0.005718
2021-08-15                  11.056  ...         0.003539
2021-08-22                  11.074  ...         0.001312
2021-08-29                  10.998  ...        -0.006255
2021-09-05                  10.942  ...        -0.004638
2021-09-12                  10.932  ...        -0.006183
2021-09-19                  10.912  ...        -0.001023
2021-09-26                  10.862  ...        -0.004425
2021-10-03                  10.844  ...         0.000921
2021-10-10                  10.786  ...         0.001782
2021-10-17                  10.824  ...         0.005316
2021-10-24                  10.780  ...        -0.001935
2021-10-31                  10.774  ...         0.001735
2021-11-07                  10.922  ...         0.013330
2021-11-14                  10.896  ...        -0.001280
2021-11-21                  10.954  ...         0.002029

[25 rows x 44 columns]
--- 0.5407528877258301 seconds ---
127.0.0.1 - - [21/Nov/2021 22:29:48] "[37mPOST /api/v1/maximum_diversificaton HTTP/1.1[0m" 200 -
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}, {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}]} 
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2868489, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6186a0a3c2785d1035dd43f7'), 'AssetType': 'Crypto', 'Code': 'ABTC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': '21Shares Bitcoin ETP EUR', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664001', 'Type': 'ETN', 'last_price_volume': 6326}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
Query itx = {'_id': ObjectId('6186a0a1c2785d1035dd3efe'), 'AssetType': 'Crypto', 'Code': 'AETH', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Amun Coin Market Cap Fund', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'CH0454664027', 'Type': 'ETN', 'last_price_volume': 702}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0000120578   SAN  ...          BBB            6
1  FR0007052782   CAC  ...          BBB            6
2  IE00BKWQ0G16   STZ  ...          BBB            6
3  CH0454664001  ABTC  ...          BBB            6
4  FR0010342592   LQQ  ...          BBB            6
5  FR0013346681  OBLI  ...          BBB            6
6  CH0454664027  AETH  ...          BBB            6

[7 rows x 21 columns] 
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['SAN.PA', 'CAC.PA', 'STZ.PA', 'ABTC.PA', 'LQQ.PA', 'OBLI.PA', 'AETH.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}, 'code': 1}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
 max_diversification cov =           OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA   AETH.PA   ABTC.PA
OBLI.PA  0.001239  0.001860 -0.001289  0.000080  0.000190  0.002099 -0.001060
LQQ.PA   0.001860  0.066896  0.018576  0.019846  0.006959  0.048179  0.030435
STZ.PA  -0.001289  0.018576  0.026961  0.017663  0.005396  0.038127  0.030392
CAC.PA   0.000080  0.019846  0.017663  0.017986  0.005755  0.025707  0.014029
SAN.PA   0.000190  0.006959  0.005396  0.005755  0.021866  0.021535  0.021395
AETH.PA  0.002099  0.048179  0.038127  0.025707  0.021535  0.714188  0.510074
ABTC.PA -0.001060  0.030435  0.030392  0.014029  0.021395  0.510074  0.540178
 df_full  =             OBLI.PA  LQQ.PA  STZ.PA   CAC.PA  SAN.PA  AETH.PA  ABTC.PA
2021-06-01   10.790   616.3   58.36  63.6755   85.86   23.666   10.545
2021-06-02   10.798   621.8   58.52  64.0097   85.51   25.805   11.109
2021-06-03   10.790   613.1   58.61  63.8720   85.48   26.178   11.343
2021-06-04   10.812   629.0   58.34  63.9900   86.08   24.623   10.776
2021-06-07   10.792   625.2   58.57  64.2652   86.18   25.829   10.534
...             ...     ...     ...      ...     ...      ...      ...
2021-11-15   10.880   921.6   63.31  70.2300   90.07   45.555   19.913
2021-11-16   10.876   942.5   63.14  70.4700   90.17   42.700   18.909
2021-11-17   10.862   951.7   63.19  70.4700   90.60   41.977   18.862
2021-11-18   10.914   956.9   62.69  70.3100   88.27   39.717   17.886
2021-11-19   10.954   979.2   61.77  70.0200   88.90   42.002   18.114

[124 rows x 7 columns]
expected_returns [0.02984907 1.69211059 0.16011365 0.24816114 0.09971106 3.90697062
 2.93833753]
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540005731189
w=[0.14285716 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375540013081518
w=[0.14285714 0.14285716 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539996692569
w=[0.14285714 0.14285714 0.14285716 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-5.375539994997065
w=[0.14285714 0.14285714 0.14285714 0.14285716 0.14285714 0.14285714
 0.14285714]
obj_value=-5.3755400006288685
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285716 0.14285714
 0.14285714]
obj_value=-5.3755400106248254
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285716
 0.14285714]
obj_value=-5.375539705195182
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285716]
obj_value=-5.375539758185792
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591925940692
w=[5.82432941e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919275733133
w=[5.82432926e-01 1.49011612e-08 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.01591962775734
w=[5.82432926e-01 0.00000000e+00 1.49011612e-08 0.00000000e+00
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919628210003
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 1.49011612e-08
 4.17567074e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015919400496845
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567089e-01 9.63895630e-13 7.20534743e-13]
obj_value=-19.015918558038898
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 1.49021251e-08 7.20534743e-13]
obj_value=-19.015920832513256
w=[5.82432926e-01 0.00000000e+00 0.00000000e+00 0.00000000e+00
 4.17567074e-01 9.63895630e-13 1.49018817e-08]
obj_value=-19.01592070181166
w=[0.00000000e+00 5.38662039e-01 4.50210940e-01 7.42461648e-14
 0.00000000e+00 0.00000000e+00 1.11270211e-02]
obj_value=-6.395574890819457
w=[3.55501109e-01 2.09877481e-01 1.75414510e-01 2.89283389e-14
 2.54871508e-01 5.88335498e-13 4.33539210e-03]
obj_value=-16.532238044351185
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216102849144
w=[4.83169859e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043216111613336
w=[4.83169844e-01 9.18032965e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321541042118
w=[4.83169844e-01 9.18032816e-02 7.67287217e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321591785512
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.49011738e-08
 3.46401808e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.043215803059784
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401822e-01 7.99620490e-13 1.89635982e-03]
obj_value=-22.04321536416609
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 1.49019608e-08 1.89635982e-03]
obj_value=-22.043216428047483
w=[4.83169844e-01 9.18032816e-02 7.67287068e-02 1.26536512e-14
 3.46401808e-01 7.99620490e-13 1.89637472e-03]
obj_value=-22.043216597770734
w=[7.65801887e-01 0.00000000e+00 6.05775152e-12 0.00000000e+00
 0.00000000e+00 3.90184116e-13 2.34198113e-01]
obj_value=-6.64186628565387
w=[5.76833390e-01 6.13799059e-02 5.13010071e-02 8.46026316e-15
 2.31605123e-01 6.63934310e-13 7.88805743e-02]
obj_value=-19.423440187508398
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316631453148
w=[5.20304377e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131663290693
w=[5.20304362e-01 7.97414279e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781315892415428
w=[5.20304362e-01 7.97414130e-02 6.66474745e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316379887127
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.49011722e-08
 3.00888695e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.781316322329516
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888710e-01 7.45825379e-13 3.24180707e-02]
obj_value=-23.78131589323628
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 1.49019070e-08 3.24180707e-02]
obj_value=-23.781314817425844
w=[5.20304362e-01 7.97414130e-02 6.66474596e-02 1.09911107e-14
 3.00888695e-01 7.45825379e-13 3.24180856e-02]
obj_value=-23.781314863723377
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902559875025
w=[9.86071324e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099025022294676
w=[9.86071309e-01 1.49011612e-08 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.09902676367056
w=[9.86071309e-01 0.00000000e+00 1.49221312e-08 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099028201610196
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 1.49214292e-08
 0.00000000e+00 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026935362225
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 1.49011612e-08 0.00000000e+00 1.39286915e-02]
obj_value=-35.099026923094144
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 1.49011612e-08 1.39286915e-02]
obj_value=-35.09902793856798
w=[9.86071309e-01 0.00000000e+00 2.09700174e-11 2.02680094e-11
 0.00000000e+00 0.00000000e+00 1.39287064e-02]
obj_value=-35.099028858929316
w=[6.25747465e-01 8.93535246e-12 3.74252535e-01 0.00000000e+00
 2.05383488e-11 8.06299472e-12 0.00000000e+00]
obj_value=-22.82214592064075
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578139097654
w=[8.30890146e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578092031261
w=[8.30890132e-01 1.49050094e-08 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779214329565
w=[8.30890132e-01 3.84820082e-12 1.61179881e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.03577949453445
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.49127004e-08
 8.84527959e-12 3.47250128e-12 7.93000230e-03]
obj_value=-47.035779678113954
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 1.49100065e-08 3.47250128e-12 7.93000230e-03]
obj_value=-47.03578179254781
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 1.49046337e-08 7.93000230e-03]
obj_value=-47.035778230114964
w=[8.30890132e-01 3.84820082e-12 1.61179866e-01 1.15391573e-11
 8.84527959e-12 3.47250128e-12 7.93001720e-03]
obj_value=-47.035780867710166
w=[0.00000000e+00 3.27962947e-11 7.97825972e-11 0.00000000e+00
 1.00000000e+00 0.00000000e+00 9.52851548e-11]
obj_value=-6.762586079004216
w=[5.61879491e-01 1.32204933e-11 1.08995952e-01 7.80321676e-12
 3.23761988e-01 2.34823737e-12 5.36256902e-03]
obj_value=-26.20923967776448
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76492022295066
w=[7.58941340e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491983773814
w=[7.58941325e-01 1.49075161e-08 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.76491799427883
w=[7.58941325e-01 6.35488701e-12 1.47222923e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918292400104
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.49117011e-08
 8.65924435e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918393537215
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924584e-02 3.17180891e-12 7.24332403e-03]
obj_value=-47.764918805378784
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 1.49043330e-08 7.24332403e-03]
obj_value=-47.764916362299
w=[7.58941325e-01 6.35488701e-12 1.47222908e-01 1.05399534e-11
 8.65924435e-02 3.17180891e-12 7.24333893e-03]
obj_value=-47.76491850732435
w=[9.35013321e-01 0.00000000e+00 7.24078020e-11 0.00000000e+00
 6.49866792e-02 0.00000000e+00 1.08677466e-10]
obj_value=-35.47201751397131
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442391764858
w=[8.10544351e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.054423238692536
w=[8.10544336e-01 1.49056536e-08 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442186001478
w=[8.10544336e-01 4.49240283e-12 1.04074974e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442297678593
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 1.49086121e-08
 8.02602469e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442249320169
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602618e-02 2.24221820e-12 5.12045761e-03]
obj_value=-51.05442248237479
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 1.49034034e-08 5.12045761e-03]
obj_value=-51.0544217200494
w=[8.10544336e-01 4.49240283e-12 1.04074959e-01 7.45091401e-12
 8.02602469e-02 2.24221820e-12 5.12047251e-03]
obj_value=-51.05442443896617
w=[9.34286418e-01 1.26426979e-12 1.21143373e-12 0.00000000e+00
 3.58574281e-12 1.11653027e-11 6.57135823e-02]
obj_value=-24.720627953704415
w=[8.28519561e-01 4.02347248e-12 8.89566520e-02 6.36856712e-12
 6.86013513e-02 3.53841793e-12 1.39224354e-02]
obj_value=-50.881075801838044
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025346459842
w=[8.18636475e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252770711504
w=[8.18636460e-01 1.49054425e-08 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.4002514353683
w=[8.18636460e-01 4.28129879e-12 9.72689834e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.400252645352886
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 1.49081249e-08
 7.50116212e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025215829412
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116361e-02 2.82574408e-12 9.08295017e-03]
obj_value=-51.40025210990398
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 1.49039869e-08 9.08295017e-03]
obj_value=-51.40024911704559
w=[8.18636460e-01 4.28129879e-12 9.72689685e-02 6.96366085e-12
 7.50116212e-02 2.82574408e-12 9.08296507e-03]
obj_value=-51.40025163948705
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036323427809
w=[8.53015347e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036241653888
w=[8.53015332e-01 1.49011612e-08 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820361257067255
w=[8.53015332e-01 0.00000000e+00 9.77293231e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.820362669055655
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 1.49580619e-08
 4.15838553e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036206259256
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838702e-02 0.00000000e+00 7.67150518e-03]
obj_value=-51.82036276976336
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 1.49011612e-08 7.67150518e-03]
obj_value=-51.82036023195818
w=[8.53015332e-01 0.00000000e+00 9.77293082e-02 5.69007136e-11
 4.15838553e-02 0.00000000e+00 7.67152008e-03]
obj_value=-51.82036322326711
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629368536147
w=[8.38310423e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292919502614
w=[8.38310408e-01 1.49011612e-08 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966291574043865
w=[8.38310408e-01 0.00000000e+00 1.01793434e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629286223483
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 1.49033159e-08
 5.16790989e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.96629235918433
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16791138e-02 0.00000000e+00 8.21707417e-03]
obj_value=-51.966292890825315
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 1.49011612e-08 8.21707417e-03]
obj_value=-51.9662899057134
w=[8.38310408e-01 0.00000000e+00 1.01793419e-01 2.15467604e-12
 5.16790989e-02 0.00000000e+00 8.21708907e-03]
obj_value=-51.96629277494531
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938537679447
w=[8.39985616e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460202549
w=[8.39985601e-01 1.49260123e-08 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938329170353
w=[8.39985601e-01 2.48511244e-11 1.00424031e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938460821014
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 1.49011612e-08
 5.14788815e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938408030388
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788964e-02 1.53479844e-10 8.11150142e-03]
obj_value=-51.96938459691375
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.50546410e-08 8.11150142e-03]
obj_value=-51.96938172296389
w=[8.39985601e-01 2.48511244e-11 1.00424016e-01 0.00000000e+00
 5.14788815e-02 1.53479844e-10 8.11151632e-03]
obj_value=-51.96938460286133
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946768096141
w=[8.40036684e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946690651665
w=[8.40036669e-01 1.49011612e-08 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946559257332
w=[8.40036669e-01 0.00000000e+00 1.00654031e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466906205014
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.49148878e-08
 5.12013959e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.96946638110884
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12014108e-02 0.00000000e+00 8.10791878e-03]
obj_value=-51.969466907626874
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 1.49011612e-08 8.10791878e-03]
obj_value=-51.96946402540161
w=[8.40036669e-01 0.00000000e+00 1.00654017e-01 1.37266297e-11
 5.12013959e-02 0.00000000e+00 8.10793368e-03]
obj_value=-51.96946690822093
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946950311214
w=[8.40013047e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728709394
w=[8.40013032e-01 1.49211992e-08 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969467414929234
w=[8.40013032e-01 2.00380280e-11 1.00634479e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946872869365
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 1.49011612e-08
 5.12427380e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.96946820344675
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427529e-02 1.23982525e-10 8.10976601e-03]
obj_value=-51.969468728696874
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.50251437e-08 8.10976601e-03]
obj_value=-51.96946584636145
w=[8.40013032e-01 2.00380280e-11 1.00634464e-01 0.00000000e+00
 5.12427380e-02 1.23982525e-10 8.10978091e-03]
obj_value=-51.96946872864314
_make_output_weights = OrderedDict([('OBLI.PA', 0.8400130320747131), ('LQQ.PA', 2.003802800889311e-11), ('STZ.PA', 0.10063446376694996), ('CAC.PA', 0.0), ('SAN.PA', 0.05124273801343399), ('AETH.PA', 1.23982524942074e-10), ('ABTC.PA', 0.008109766013414356)])
opto from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done
{'weights': OrderedDict([('OBLI.PA', 0.84001), ('LQQ.PA', 0.0), ('STZ.PA', 0.10063), ('CAC.PA', 0.0), ('SAN.PA', 0.05124), ('AETH.PA', 0.0), ('ABTC.PA', 0.00811)]), 'expected_return': 0.07012525988061888, 'volatility': 0.033874230190483384, 'sharpe_ratio': 1.4797460960367759, 'asset_type_weights': {'Equity': 0.15187, 'Crypto': 0.00811, 'Fixed Income': 0.84001}}
--- 0.8500139713287354 seconds ---
dates sent from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
dates Computed from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA', 'AETH.PA', 'ABTC.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620165600.0]}, {'$lte': ['$$price.converted_date', 1637535600.0]}]}}}}}]: dates from 2021-05-05 00:00:00 to 2021-11-22 00:00:00
Data returned            date    open    high  ...  volume     code  converted_date
0    2021-06-01  10.840  10.840  ...    9879  ABTC.PA    1.622498e+09
1    2021-06-02  10.752  11.109  ...    3192  ABTC.PA    1.622585e+09
2    2021-06-03  11.359  11.524  ...   10825  ABTC.PA    1.622671e+09
3    2021-06-04  10.745  10.866  ...   11585  ABTC.PA    1.622758e+09
4    2021-06-07  10.574  10.625  ...     576  ABTC.PA    1.623017e+09
..          ...     ...     ...  ...     ...      ...             ...
958  2021-11-15  62.530  63.310  ...    3810   STZ.PA    1.636931e+09
959  2021-11-16  63.400  63.400  ...    3694   STZ.PA    1.637017e+09
960  2021-11-17  63.310  63.460  ...    5832   STZ.PA    1.637104e+09
961  2021-11-18  63.100  63.330  ...    6674   STZ.PA    1.637190e+09
962  2021-11-19  62.820  62.900  ...   18663   STZ.PA    1.637276e+09

[963 rows x 9 columns]
Getting data --- 0.3368489742279053 seconds ---
--- end init 0.39747190475463867 seconds ---
back_test_portfolio from 2021-05-05 00:00:00 to 2021-11-22 00:00:00 done, columns Index(['OBLI.PA_adjusted_close', 'date_x', 'OBLI.PA_return', 'OBLI.PA_weight',
       'OBLI.PA_nb_shares', 'OBLI.PA_value', 'LQQ.PA_adjusted_close', 'date_y',
       'LQQ.PA_return', 'LQQ.PA_weight', 'LQQ.PA_nb_shares', 'LQQ.PA_value',
       'STZ.PA_adjusted_close', 'date_x', 'STZ.PA_return', 'STZ.PA_weight',
       'STZ.PA_nb_shares', 'STZ.PA_value', 'CAC.PA_adjusted_close', 'date_y',
       'CAC.PA_return', 'CAC.PA_weight', 'CAC.PA_nb_shares', 'CAC.PA_value',
       'SAN.PA_adjusted_close', 'date_x', 'SAN.PA_return', 'SAN.PA_weight',
       'SAN.PA_nb_shares', 'SAN.PA_value', 'AETH.PA_adjusted_close', 'date_y',
       'AETH.PA_return', 'AETH.PA_weight', 'AETH.PA_nb_shares',
       'AETH.PA_value', 'ABTC.PA_adjusted_close', 'date', 'ABTC.PA_return',
       'ABTC.PA_weight', 'ABTC.PA_nb_shares', 'ABTC.PA_value',
       'portfolio_value', 'portfolio_return'],
      dtype='object')
            OBLI.PA_adjusted_close  ... portfolio_return
date                                ...                 
2021-06-06                  10.812  ...        -0.000508
2021-06-13                  10.868  ...         0.005577
2021-06-20                  10.822  ...        -0.005760
2021-06-27                  10.770  ...        -0.003284
2021-07-04                  10.854  ...         0.004866
2021-07-11                  10.898  ...         0.002651
2021-07-18                  10.958  ...         0.003229
2021-07-25                  11.024  ...         0.006882
2021-08-01                  11.030  ...         0.002077
2021-08-08                  11.054  ...         0.005718
2021-08-15                  11.056  ...         0.003539
2021-08-22                  11.074  ...         0.001312
2021-08-29                  10.998  ...        -0.006255
2021-09-05                  10.942  ...        -0.004638
2021-09-12                  10.932  ...        -0.006183
2021-09-19                  10.912  ...        -0.001023
2021-09-26                  10.862  ...        -0.004425
2021-10-03                  10.844  ...         0.000921
2021-10-10                  10.786  ...         0.001782
2021-10-17                  10.824  ...         0.005316
2021-10-24                  10.780  ...        -0.001935
2021-10-31                  10.774  ...         0.001735
2021-11-07                  10.922  ...         0.013330
2021-11-14                  10.896  ...        -0.001280
2021-11-21                  10.954  ...         0.002029

[25 rows x 44 columns]
--- 0.5042769908905029 seconds ---
127.0.0.1 - - [21/Nov/2021 22:56:37] "[37mPOST /api/v1/maximum_diversificaton HTTP/1.1[0m" 200 -
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'CAC.PA', 'LQQ.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'CAC.PA', 'LQQ.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'CAC.PA', 'LQQ.PA', 'STZ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [22/Nov/2021 16:57:16] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/application.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'STZ.PA', 'OBLI.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [22/Nov/2021 17:17:10] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'STZ.PA', 'OBLI.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [22/Nov/2021 17:21:45] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'STZ.PA', 'OBLI.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['CAC.PA', 'LQQ.PA', 'STZ.PA', 'OBLI.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [22/Nov/2021 17:24:03] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/tools/logger.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open    high  ...  volume     code  converted_date
date                                  ...                                 
2021-11-19 2021-11-19  10.91  10.964  ...    4281  OBLI.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  972.2  981.0  ...    5866  LQQ.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-19 2021-11-19  62.82  62.9  ...   18663  STZ.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  70.66  70.71  ...   43776  CAC.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date    open    high  ...  volume     code  converted_date
date                                   ...                                 
2021-11-18 2021-11-18  10.916  10.916  ...     733  OBLI.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  951.7  956.9  ...    2905  LQQ.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open   high  ...  volume    code  converted_date
date                                ...                                
2021-11-18 2021-11-18  63.1  63.33  ...    6674  STZ.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  70.46  70.73  ...   24410  CAC.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-17 2021-11-17  10.9  10.9  ...    3088  OBLI.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  946.1  952.1  ...    3439  LQQ.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  63.31  63.46  ...    5832  STZ.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-17 2021-11-17  70.48  70.6  ...   21757  CAC.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-16 2021-11-16  11.0  11.0  ...    1226  OBLI.PA    1.637017e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  927.9  942.5  ...    3594  LQQ.PA    1.637017e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume    code  converted_date
date                               ...                                
2021-11-16 2021-11-16  63.4  63.4  ...    3694  STZ.PA    1.637017e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  70.45  70.55  ...   27998  CAC.PA    1.637017e+09

[1 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [22/Nov/2021 17:32:09] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open    high  ...  volume     code  converted_date
date                                  ...                                 
2021-11-19 2021-11-19  10.91  10.964  ...    4281  OBLI.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  972.2  981.0  ...    5866  LQQ.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-19 2021-11-19  62.82  62.9  ...   18663  STZ.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  70.66  70.71  ...   43776  CAC.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date    open    high  ...  volume     code  converted_date
date                                   ...                                 
2021-11-18 2021-11-18  10.916  10.916  ...     733  OBLI.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  951.7  956.9  ...    2905  LQQ.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open   high  ...  volume    code  converted_date
date                                ...                                
2021-11-18 2021-11-18  63.1  63.33  ...    6674  STZ.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  70.46  70.73  ...   24410  CAC.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-17 2021-11-17  10.9  10.9  ...    3088  OBLI.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  946.1  952.1  ...    3439  LQQ.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  63.31  63.46  ...    5832  STZ.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-17 2021-11-17  70.48  70.6  ...   21757  CAC.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-16 2021-11-16  11.0  11.0  ...    1226  OBLI.PA    1.637017e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  927.9  942.5  ...    3594  LQQ.PA    1.637017e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume    code  converted_date
date                               ...                                
2021-11-16 2021-11-16  63.4  63.4  ...    3694  STZ.PA    1.637017e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  70.45  70.55  ...   27998  CAC.PA    1.637017e+09

[1 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [22/Nov/2021 17:32:14] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open    high  ...  volume     code  converted_date
date                                  ...                                 
2021-11-19 2021-11-19  10.91  10.964  ...    4281  OBLI.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  972.2  981.0  ...    5866  LQQ.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-19 2021-11-19  62.82  62.9  ...   18663  STZ.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  70.66  70.71  ...   43776  CAC.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date    open    high  ...  volume     code  converted_date
date                                   ...                                 
2021-11-18 2021-11-18  10.916  10.916  ...     733  OBLI.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  951.7  956.9  ...    2905  LQQ.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open   high  ...  volume    code  converted_date
date                                ...                                
2021-11-18 2021-11-18  63.1  63.33  ...    6674  STZ.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  70.46  70.73  ...   24410  CAC.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-17 2021-11-17  10.9  10.9  ...    3088  OBLI.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  946.1  952.1  ...    3439  LQQ.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  63.31  63.46  ...    5832  STZ.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-17 2021-11-17  70.48  70.6  ...   21757  CAC.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-16 2021-11-16  11.0  11.0  ...    1226  OBLI.PA    1.637017e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  927.9  942.5  ...    3594  LQQ.PA    1.637017e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume    code  converted_date
date                               ...                                
2021-11-16 2021-11-16  63.4  63.4  ...    3694  STZ.PA    1.637017e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  70.45  70.55  ...   27998  CAC.PA    1.637017e+09

[1 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [22/Nov/2021 17:40:31] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'CAC.PA', 'STZ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open    high  ...  volume     code  converted_date
date                                  ...                                 
2021-11-19 2021-11-19  10.91  10.964  ...    4281  OBLI.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  972.2  981.0  ...    5866  LQQ.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-19 2021-11-19  62.82  62.9  ...   18663  STZ.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  70.66  70.71  ...   43776  CAC.PA    1.637276e+09

[1 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date    open    high  ...  volume     code  converted_date
date                                   ...                                 
2021-11-18 2021-11-18  10.916  10.916  ...     733  OBLI.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  951.7  956.9  ...    2905  LQQ.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open   high  ...  volume    code  converted_date
date                                ...                                
2021-11-18 2021-11-18  63.1  63.33  ...    6674  STZ.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  70.46  70.73  ...   24410  CAC.PA    1.637190e+09

[1 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-17 2021-11-17  10.9  10.9  ...    3088  OBLI.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  946.1  952.1  ...    3439  LQQ.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  63.31  63.46  ...    5832  STZ.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-17 2021-11-17  70.48  70.6  ...   21757  CAC.PA    1.637104e+09

[1 rows x 9 columns]
stock_code = OBLI.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-16 2021-11-16  11.0  11.0  ...    1226  OBLI.PA    1.637017e+09

[1 rows x 9 columns]
stock_code = LQQ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  927.9  942.5  ...    3594  LQQ.PA    1.637017e+09

[1 rows x 9 columns]
stock_code = STZ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume    code  converted_date
date                               ...                                
2021-11-16 2021-11-16  63.4  63.4  ...    3694  STZ.PA    1.637017e+09

[1 rows x 9 columns]
stock_code = CAC.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  70.45  70.55  ...   27998  CAC.PA    1.637017e+09

[1 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [23/Nov/2021 15:21:32] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'CAC.PA', 'LQQ.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'CAC.PA', 'LQQ.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'CAC.PA', 'LQQ.PA', 'STZ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 10.91, 'high': 10.964, 'low': 10.892, 'close': 10.954, 'adjusted_close': 10.954, 'volume': 4281, 'code': 'OBLI.PA', 'converted_date': 1637276400.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open    high  ...  volume     code  converted_date
date                                  ...                                 
2021-11-19 2021-11-19  10.91  10.964  ...    4281  OBLI.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 972.2, 'high': 981.0, 'low': 970.0, 'close': 979.2, 'adjusted_close': 979.2, 'volume': 5866, 'code': 'LQQ.PA', 'converted_date': 1637276400.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  972.2  981.0  ...    5866  LQQ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 62.82, 'high': 62.9, 'low': 61.29, 'close': 61.77, 'adjusted_close': 61.77, 'volume': 18663, 'code': 'STZ.PA', 'converted_date': 1637276400.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-19 2021-11-19  62.82  62.9  ...   18663  STZ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 70.66, 'high': 70.71, 'low': 69.62, 'close': 70.02, 'adjusted_close': 70.02, 'volume': 43776, 'code': 'CAC.PA', 'converted_date': 1637276400.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  70.66  70.71  ...   43776  CAC.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 10.916, 'high': 10.916, 'low': 10.888, 'close': 10.914, 'adjusted_close': 10.914, 'volume': 733, 'code': 'OBLI.PA', 'converted_date': 1637190000.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date    open    high  ...  volume     code  converted_date
date                                   ...                                 
2021-11-18 2021-11-18  10.916  10.916  ...     733  OBLI.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 951.7, 'high': 956.9, 'low': 942.4, 'close': 956.9, 'adjusted_close': 956.9, 'volume': 2905, 'code': 'LQQ.PA', 'converted_date': 1637190000.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  951.7  956.9  ...    2905  LQQ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 63.1, 'high': 63.33, 'low': 62.54, 'close': 62.69, 'adjusted_close': 62.69, 'volume': 6674, 'code': 'STZ.PA', 'converted_date': 1637190000.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open   high  ...  volume    code  converted_date
date                                ...                                
2021-11-18 2021-11-18  63.1  63.33  ...    6674  STZ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 70.46, 'high': 70.73, 'low': 70.29, 'close': 70.31, 'adjusted_close': 70.31, 'volume': 24410, 'code': 'CAC.PA', 'converted_date': 1637190000.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  70.46  70.73  ...   24410  CAC.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 10.9, 'high': 10.9, 'low': 10.826, 'close': 10.862, 'adjusted_close': 10.862, 'volume': 3088, 'code': 'OBLI.PA', 'converted_date': 1637103600.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-17 2021-11-17  10.9  10.9  ...    3088  OBLI.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 946.1, 'high': 952.1, 'low': 940.9, 'close': 951.7, 'adjusted_close': 951.7, 'volume': 3439, 'code': 'LQQ.PA', 'converted_date': 1637103600.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  946.1  952.1  ...    3439  LQQ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 63.31, 'high': 63.46, 'low': 63.19, 'close': 63.19, 'adjusted_close': 63.19, 'volume': 5832, 'code': 'STZ.PA', 'converted_date': 1637103600.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  63.31  63.46  ...    5832  STZ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 70.48, 'high': 70.6, 'low': 70.4, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 21757, 'code': 'CAC.PA', 'converted_date': 1637103600.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-17 2021-11-17  70.48  70.6  ...   21757  CAC.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 11.0, 'high': 11.0, 'low': 10.85, 'close': 10.876, 'adjusted_close': 10.876, 'volume': 1226, 'code': 'OBLI.PA', 'converted_date': 1637017200.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-16 2021-11-16  11.0  11.0  ...    1226  OBLI.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 927.9, 'high': 942.5, 'low': 923.4, 'close': 942.5, 'adjusted_close': 942.5, 'volume': 3594, 'code': 'LQQ.PA', 'converted_date': 1637017200.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  927.9  942.5  ...    3594  LQQ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 63.4, 'high': 63.4, 'low': 63.08, 'close': 63.14, 'adjusted_close': 63.14, 'volume': 3694, 'code': 'STZ.PA', 'converted_date': 1637017200.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume    code  converted_date
date                               ...                                
2021-11-16 2021-11-16  63.4  63.4  ...    3694  STZ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 70.45, 'high': 70.55, 'low': 70.3, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 27998, 'code': 'CAC.PA', 'converted_date': 1637017200.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  70.45  70.55  ...   27998  CAC.PA    1.637017e+09

[1 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [23/Nov/2021 15:43:16] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['STZ.PA', 'OBLI.PA', 'LQQ.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['STZ.PA', 'OBLI.PA', 'LQQ.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
dates Computed from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['STZ.PA', 'OBLI.PA', 'LQQ.PA', 'CAC.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1637017200.0]}, {'$lte': ['$$price.converted_date', 1637276400.0]}]}}}}}]: dates from 2021-11-16 00:00:00 to 2021-11-19 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
1   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
3   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
4   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
5   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
6   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
7   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
8   2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
9   2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
10  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
11  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
12  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
13  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
14  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
15  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
16  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
17  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
18  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
19  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
4  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
5  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
6  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
7  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[4 rows x 9 columns]
stock_code_prices =                  date      open      high  ...     volume       code  converted_date
date                                       ...                                      
2021-11-16 2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2021-11-17 2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2021-11-18 2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
2021-11-19 2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-16 2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
2021-11-17 2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
2021-11-19 2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-16 2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
2021-11-17 2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
2021-11-18 2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
2021-11-19 2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-16 2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
2021-11-17 2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
2021-11-18 2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
2021-11-19 2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-16 2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
2021-11-17 2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
2021-11-18 2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
2021-11-19 2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[20 rows x 9 columns],
date = 20211119,
sub_date_df =                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 10.91, 'high': 10.964, 'low': 10.892, 'close': 10.954, 'adjusted_close': 10.954, 'volume': 4281, 'code': 'OBLI.PA', 'converted_date': 1637276400.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open    high  ...  volume     code  converted_date
date                                  ...                                 
2021-11-19 2021-11-19  10.91  10.964  ...    4281  OBLI.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 972.2, 'high': 981.0, 'low': 970.0, 'close': 979.2, 'adjusted_close': 979.2, 'volume': 5866, 'code': 'LQQ.PA', 'converted_date': 1637276400.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  972.2  981.0  ...    5866  LQQ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 62.82, 'high': 62.9, 'low': 61.29, 'close': 61.77, 'adjusted_close': 61.77, 'volume': 18663, 'code': 'STZ.PA', 'converted_date': 1637276400.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-19 2021-11-19  62.82  62.9  ...   18663  STZ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 70.66, 'high': 70.71, 'low': 69.62, 'close': 70.02, 'adjusted_close': 70.02, 'volume': 43776, 'code': 'CAC.PA', 'converted_date': 1637276400.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  70.66  70.71  ...   43776  CAC.PA    1.637276e+09

[1 rows x 9 columns]
date = 20211118,
sub_date_df =                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 10.916, 'high': 10.916, 'low': 10.888, 'close': 10.914, 'adjusted_close': 10.914, 'volume': 733, 'code': 'OBLI.PA', 'converted_date': 1637190000.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date    open    high  ...  volume     code  converted_date
date                                   ...                                 
2021-11-18 2021-11-18  10.916  10.916  ...     733  OBLI.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 951.7, 'high': 956.9, 'low': 942.4, 'close': 956.9, 'adjusted_close': 956.9, 'volume': 2905, 'code': 'LQQ.PA', 'converted_date': 1637190000.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  951.7  956.9  ...    2905  LQQ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 63.1, 'high': 63.33, 'low': 62.54, 'close': 62.69, 'adjusted_close': 62.69, 'volume': 6674, 'code': 'STZ.PA', 'converted_date': 1637190000.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open   high  ...  volume    code  converted_date
date                                ...                                
2021-11-18 2021-11-18  63.1  63.33  ...    6674  STZ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 70.46, 'high': 70.73, 'low': 70.29, 'close': 70.31, 'adjusted_close': 70.31, 'volume': 24410, 'code': 'CAC.PA', 'converted_date': 1637190000.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  70.46  70.73  ...   24410  CAC.PA    1.637190e+09

[1 rows x 9 columns]
date = 20211117,
sub_date_df =                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 10.9, 'high': 10.9, 'low': 10.826, 'close': 10.862, 'adjusted_close': 10.862, 'volume': 3088, 'code': 'OBLI.PA', 'converted_date': 1637103600.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-17 2021-11-17  10.9  10.9  ...    3088  OBLI.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 946.1, 'high': 952.1, 'low': 940.9, 'close': 951.7, 'adjusted_close': 951.7, 'volume': 3439, 'code': 'LQQ.PA', 'converted_date': 1637103600.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  946.1  952.1  ...    3439  LQQ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 63.31, 'high': 63.46, 'low': 63.19, 'close': 63.19, 'adjusted_close': 63.19, 'volume': 5832, 'code': 'STZ.PA', 'converted_date': 1637103600.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  63.31  63.46  ...    5832  STZ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 70.48, 'high': 70.6, 'low': 70.4, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 21757, 'code': 'CAC.PA', 'converted_date': 1637103600.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-17 2021-11-17  70.48  70.6  ...   21757  CAC.PA    1.637104e+09

[1 rows x 9 columns]
date = 20211116,
sub_date_df =                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 11.0, 'high': 11.0, 'low': 10.85, 'close': 10.876, 'adjusted_close': 10.876, 'volume': 1226, 'code': 'OBLI.PA', 'converted_date': 1637017200.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-16 2021-11-16  11.0  11.0  ...    1226  OBLI.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 927.9, 'high': 942.5, 'low': 923.4, 'close': 942.5, 'adjusted_close': 942.5, 'volume': 3594, 'code': 'LQQ.PA', 'converted_date': 1637017200.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  927.9  942.5  ...    3594  LQQ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 63.4, 'high': 63.4, 'low': 63.08, 'close': 63.14, 'adjusted_close': 63.14, 'volume': 3694, 'code': 'STZ.PA', 'converted_date': 1637017200.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume    code  converted_date
date                               ...                                
2021-11-16 2021-11-16  63.4  63.4  ...    3694  STZ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 70.45, 'high': 70.55, 'low': 70.3, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 27998, 'code': 'CAC.PA', 'converted_date': 1637017200.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  70.45  70.55  ...   27998  CAC.PA    1.637017e+09

[1 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-16       NaN
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [23/Nov/2021 16:10:34] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/asset_prices/prices.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
dates Computed from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['LQQ.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1636930800.0]}, {'$lte': ['$$price.converted_date', 1637362800.0]}]}}}}}]: dates from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
1   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
3   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
4   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
5   2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
6   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
7   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
8   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
9   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
10  2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
11  2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
12  2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
13  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
14  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
15  2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
16  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
17  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
18  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
19  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
20  2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
21  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
22  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
23  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
24  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
1   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
3   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
4   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
5   2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
6   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
7   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
8   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
9   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
10  2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
11  2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
12  2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
13  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
14  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
15  2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
16  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
17  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
18  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
19  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
20  2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
21  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
22  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
23  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
24  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
5  2021-11-15  7090.96  7136.13  ...   64255100  FCHI.INDX    1.636931e+09
6  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
7  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
8  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
9  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[5 rows x 9 columns]
stock_code_prices =                  date      open      high  ...     volume       code  converted_date
date                                       ...                                      
2021-11-15 2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
2021-11-16 2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2021-11-17 2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2021-11-18 2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
2021-11-19 2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-15 2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
2021-11-16 2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
2021-11-17 2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
2021-11-19 2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-15 2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
2021-11-16 2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
2021-11-17 2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
2021-11-18 2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
2021-11-19 2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-15 2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
2021-11-16 2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
2021-11-17 2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
2021-11-18 2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
2021-11-19 2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-15 2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
2021-11-16 2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
2021-11-17 2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
2021-11-18 2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
2021-11-19 2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns],
date = 20211119,
sub_date_df =                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 10.91, 'high': 10.964, 'low': 10.892, 'close': 10.954, 'adjusted_close': 10.954, 'volume': 4281, 'code': 'OBLI.PA', 'converted_date': 1637276400.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open    high  ...  volume     code  converted_date
date                                  ...                                 
2021-11-19 2021-11-19  10.91  10.964  ...    4281  OBLI.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 972.2, 'high': 981.0, 'low': 970.0, 'close': 979.2, 'adjusted_close': 979.2, 'volume': 5866, 'code': 'LQQ.PA', 'converted_date': 1637276400.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  972.2  981.0  ...    5866  LQQ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 62.82, 'high': 62.9, 'low': 61.29, 'close': 61.77, 'adjusted_close': 61.77, 'volume': 18663, 'code': 'STZ.PA', 'converted_date': 1637276400.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-19 2021-11-19  62.82  62.9  ...   18663  STZ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 70.66, 'high': 70.71, 'low': 69.62, 'close': 70.02, 'adjusted_close': 70.02, 'volume': 43776, 'code': 'CAC.PA', 'converted_date': 1637276400.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  70.66  70.71  ...   43776  CAC.PA    1.637276e+09

[1 rows x 9 columns]
date = 20211118,
sub_date_df =                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 10.916, 'high': 10.916, 'low': 10.888, 'close': 10.914, 'adjusted_close': 10.914, 'volume': 733, 'code': 'OBLI.PA', 'converted_date': 1637190000.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date    open    high  ...  volume     code  converted_date
date                                   ...                                 
2021-11-18 2021-11-18  10.916  10.916  ...     733  OBLI.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 951.7, 'high': 956.9, 'low': 942.4, 'close': 956.9, 'adjusted_close': 956.9, 'volume': 2905, 'code': 'LQQ.PA', 'converted_date': 1637190000.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  951.7  956.9  ...    2905  LQQ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 63.1, 'high': 63.33, 'low': 62.54, 'close': 62.69, 'adjusted_close': 62.69, 'volume': 6674, 'code': 'STZ.PA', 'converted_date': 1637190000.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open   high  ...  volume    code  converted_date
date                                ...                                
2021-11-18 2021-11-18  63.1  63.33  ...    6674  STZ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 70.46, 'high': 70.73, 'low': 70.29, 'close': 70.31, 'adjusted_close': 70.31, 'volume': 24410, 'code': 'CAC.PA', 'converted_date': 1637190000.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  70.46  70.73  ...   24410  CAC.PA    1.637190e+09

[1 rows x 9 columns]
date = 20211117,
sub_date_df =                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 10.9, 'high': 10.9, 'low': 10.826, 'close': 10.862, 'adjusted_close': 10.862, 'volume': 3088, 'code': 'OBLI.PA', 'converted_date': 1637103600.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-17 2021-11-17  10.9  10.9  ...    3088  OBLI.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 946.1, 'high': 952.1, 'low': 940.9, 'close': 951.7, 'adjusted_close': 951.7, 'volume': 3439, 'code': 'LQQ.PA', 'converted_date': 1637103600.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  946.1  952.1  ...    3439  LQQ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 63.31, 'high': 63.46, 'low': 63.19, 'close': 63.19, 'adjusted_close': 63.19, 'volume': 5832, 'code': 'STZ.PA', 'converted_date': 1637103600.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  63.31  63.46  ...    5832  STZ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 70.48, 'high': 70.6, 'low': 70.4, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 21757, 'code': 'CAC.PA', 'converted_date': 1637103600.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-17 2021-11-17  70.48  70.6  ...   21757  CAC.PA    1.637104e+09

[1 rows x 9 columns]
date = 20211116,
sub_date_df =                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 11.0, 'high': 11.0, 'low': 10.85, 'close': 10.876, 'adjusted_close': 10.876, 'volume': 1226, 'code': 'OBLI.PA', 'converted_date': 1637017200.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-16 2021-11-16  11.0  11.0  ...    1226  OBLI.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 927.9, 'high': 942.5, 'low': 923.4, 'close': 942.5, 'adjusted_close': 942.5, 'volume': 3594, 'code': 'LQQ.PA', 'converted_date': 1637017200.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  927.9  942.5  ...    3594  LQQ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 63.4, 'high': 63.4, 'low': 63.08, 'close': 63.14, 'adjusted_close': 63.14, 'volume': 3694, 'code': 'STZ.PA', 'converted_date': 1637017200.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume    code  converted_date
date                               ...                                
2021-11-16 2021-11-16  63.4  63.4  ...    3694  STZ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 70.45, 'high': 70.55, 'low': 70.3, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 27998, 'code': 'CAC.PA', 'converted_date': 1637017200.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  70.45  70.55  ...   27998  CAC.PA    1.637017e+09

[1 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-15       NaN
2021-11-16  0.003362
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-16  0.003362
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
127.0.0.1 - - [23/Nov/2021 16:22:15] "[35m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 500 -
127.0.0.1 - - [23/Nov/2021 16:22:17] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:22:17] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:22:17] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:22:17] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:22:17] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'STZ.PA', 'LQQ.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'STZ.PA', 'LQQ.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
dates Computed from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['OBLI.PA', 'STZ.PA', 'LQQ.PA', 'CAC.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1636930800.0]}, {'$lte': ['$$price.converted_date', 1637362800.0]}]}}}}}]: dates from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
1   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
3   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
4   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
5   2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
6   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
7   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
8   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
9   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
10  2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
11  2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
12  2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
13  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
14  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
15  2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
16  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
17  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
18  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
19  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
20  2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
21  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
22  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
23  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
24  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
1   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
3   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
4   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
5   2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
6   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
7   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
8   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
9   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
10  2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
11  2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
12  2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
13  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
14  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
15  2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
16  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
17  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
18  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
19  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
20  2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
21  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
22  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
23  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
24  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
5  2021-11-15  7090.96  7136.13  ...   64255100  FCHI.INDX    1.636931e+09
6  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
7  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
8  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
9  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[5 rows x 9 columns]
stock_code_prices =                  date      open      high  ...     volume       code  converted_date
date                                       ...                                      
2021-11-15 2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
2021-11-16 2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2021-11-17 2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2021-11-18 2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
2021-11-19 2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-15 2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
2021-11-16 2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
2021-11-17 2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
2021-11-19 2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-15 2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
2021-11-16 2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
2021-11-17 2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
2021-11-18 2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
2021-11-19 2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-15 2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
2021-11-16 2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
2021-11-17 2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
2021-11-18 2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
2021-11-19 2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-15 2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
2021-11-16 2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
2021-11-17 2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
2021-11-18 2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
2021-11-19 2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns],
date = 20211119,
sub_date_df =                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 10.91, 'high': 10.964, 'low': 10.892, 'close': 10.954, 'adjusted_close': 10.954, 'volume': 4281, 'code': 'OBLI.PA', 'converted_date': 1637276400.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open    high  ...  volume     code  converted_date
date                                  ...                                 
2021-11-19 2021-11-19  10.91  10.964  ...    4281  OBLI.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 972.2, 'high': 981.0, 'low': 970.0, 'close': 979.2, 'adjusted_close': 979.2, 'volume': 5866, 'code': 'LQQ.PA', 'converted_date': 1637276400.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  972.2  981.0  ...    5866  LQQ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 62.82, 'high': 62.9, 'low': 61.29, 'close': 61.77, 'adjusted_close': 61.77, 'volume': 18663, 'code': 'STZ.PA', 'converted_date': 1637276400.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-19 2021-11-19  62.82  62.9  ...   18663  STZ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 70.66, 'high': 70.71, 'low': 69.62, 'close': 70.02, 'adjusted_close': 70.02, 'volume': 43776, 'code': 'CAC.PA', 'converted_date': 1637276400.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  70.66  70.71  ...   43776  CAC.PA    1.637276e+09

[1 rows x 9 columns]
date = 20211118,
sub_date_df =                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 10.916, 'high': 10.916, 'low': 10.888, 'close': 10.914, 'adjusted_close': 10.914, 'volume': 733, 'code': 'OBLI.PA', 'converted_date': 1637190000.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date    open    high  ...  volume     code  converted_date
date                                   ...                                 
2021-11-18 2021-11-18  10.916  10.916  ...     733  OBLI.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 951.7, 'high': 956.9, 'low': 942.4, 'close': 956.9, 'adjusted_close': 956.9, 'volume': 2905, 'code': 'LQQ.PA', 'converted_date': 1637190000.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  951.7  956.9  ...    2905  LQQ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 63.1, 'high': 63.33, 'low': 62.54, 'close': 62.69, 'adjusted_close': 62.69, 'volume': 6674, 'code': 'STZ.PA', 'converted_date': 1637190000.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open   high  ...  volume    code  converted_date
date                                ...                                
2021-11-18 2021-11-18  63.1  63.33  ...    6674  STZ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 70.46, 'high': 70.73, 'low': 70.29, 'close': 70.31, 'adjusted_close': 70.31, 'volume': 24410, 'code': 'CAC.PA', 'converted_date': 1637190000.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  70.46  70.73  ...   24410  CAC.PA    1.637190e+09

[1 rows x 9 columns]
date = 20211117,
sub_date_df =                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 10.9, 'high': 10.9, 'low': 10.826, 'close': 10.862, 'adjusted_close': 10.862, 'volume': 3088, 'code': 'OBLI.PA', 'converted_date': 1637103600.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-17 2021-11-17  10.9  10.9  ...    3088  OBLI.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 946.1, 'high': 952.1, 'low': 940.9, 'close': 951.7, 'adjusted_close': 951.7, 'volume': 3439, 'code': 'LQQ.PA', 'converted_date': 1637103600.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  946.1  952.1  ...    3439  LQQ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 63.31, 'high': 63.46, 'low': 63.19, 'close': 63.19, 'adjusted_close': 63.19, 'volume': 5832, 'code': 'STZ.PA', 'converted_date': 1637103600.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  63.31  63.46  ...    5832  STZ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 70.48, 'high': 70.6, 'low': 70.4, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 21757, 'code': 'CAC.PA', 'converted_date': 1637103600.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-17 2021-11-17  70.48  70.6  ...   21757  CAC.PA    1.637104e+09

[1 rows x 9 columns]
date = 20211116,
sub_date_df =                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 11.0, 'high': 11.0, 'low': 10.85, 'close': 10.876, 'adjusted_close': 10.876, 'volume': 1226, 'code': 'OBLI.PA', 'converted_date': 1637017200.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-16 2021-11-16  11.0  11.0  ...    1226  OBLI.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 927.9, 'high': 942.5, 'low': 923.4, 'close': 942.5, 'adjusted_close': 942.5, 'volume': 3594, 'code': 'LQQ.PA', 'converted_date': 1637017200.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  927.9  942.5  ...    3594  LQQ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 63.4, 'high': 63.4, 'low': 63.08, 'close': 63.14, 'adjusted_close': 63.14, 'volume': 3694, 'code': 'STZ.PA', 'converted_date': 1637017200.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume    code  converted_date
date                               ...                                
2021-11-16 2021-11-16  63.4  63.4  ...    3694  STZ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 70.45, 'high': 70.55, 'low': 70.3, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 27998, 'code': 'CAC.PA', 'converted_date': 1637017200.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  70.45  70.55  ...   27998  CAC.PA    1.637017e+09

[1 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-15       NaN
2021-11-16  0.003362
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-16  0.003362
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
127.0.0.1 - - [23/Nov/2021 16:28:40] "[35m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 500 -
127.0.0.1 - - [23/Nov/2021 16:28:41] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:28:41] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:28:41] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:28:41] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:28:42] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['STZ.PA', 'LQQ.PA', 'OBLI.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['STZ.PA', 'LQQ.PA', 'OBLI.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
dates Computed from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['STZ.PA', 'LQQ.PA', 'OBLI.PA', 'CAC.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1636930800.0]}, {'$lte': ['$$price.converted_date', 1637362800.0]}]}}}}}]: dates from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
1   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
3   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
4   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
5   2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
6   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
7   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
8   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
9   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
10  2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
11  2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
12  2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
13  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
14  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
15  2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
16  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
17  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
18  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
19  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
20  2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
21  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
22  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
23  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
24  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
1   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
3   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
4   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
5   2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
6   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
7   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
8   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
9   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
10  2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
11  2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
12  2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
13  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
14  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
15  2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
16  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
17  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
18  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
19  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
20  2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
21  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
22  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
23  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
24  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
5  2021-11-15  7090.96  7136.13  ...   64255100  FCHI.INDX    1.636931e+09
6  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
7  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
8  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
9  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[5 rows x 9 columns]
stock_code_prices =                  date      open      high  ...     volume       code  converted_date
date                                       ...                                      
2021-11-15 2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
2021-11-16 2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2021-11-17 2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2021-11-18 2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
2021-11-19 2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-15 2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
2021-11-16 2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
2021-11-17 2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
2021-11-19 2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-15 2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
2021-11-16 2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
2021-11-17 2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
2021-11-18 2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
2021-11-19 2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-15 2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
2021-11-16 2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
2021-11-17 2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
2021-11-18 2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
2021-11-19 2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-15 2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
2021-11-16 2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
2021-11-17 2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
2021-11-18 2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
2021-11-19 2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns],
date = 20211119,
sub_date_df =                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 10.91, 'high': 10.964, 'low': 10.892, 'close': 10.954, 'adjusted_close': 10.954, 'volume': 4281, 'code': 'OBLI.PA', 'converted_date': 1637276400.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open    high  ...  volume     code  converted_date
date                                  ...                                 
2021-11-19 2021-11-19  10.91  10.964  ...    4281  OBLI.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 972.2, 'high': 981.0, 'low': 970.0, 'close': 979.2, 'adjusted_close': 979.2, 'volume': 5866, 'code': 'LQQ.PA', 'converted_date': 1637276400.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  972.2  981.0  ...    5866  LQQ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 62.82, 'high': 62.9, 'low': 61.29, 'close': 61.77, 'adjusted_close': 61.77, 'volume': 18663, 'code': 'STZ.PA', 'converted_date': 1637276400.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-19 2021-11-19  62.82  62.9  ...   18663  STZ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 70.66, 'high': 70.71, 'low': 69.62, 'close': 70.02, 'adjusted_close': 70.02, 'volume': 43776, 'code': 'CAC.PA', 'converted_date': 1637276400.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  70.66  70.71  ...   43776  CAC.PA    1.637276e+09

[1 rows x 9 columns]
date = 20211118,
sub_date_df =                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 10.916, 'high': 10.916, 'low': 10.888, 'close': 10.914, 'adjusted_close': 10.914, 'volume': 733, 'code': 'OBLI.PA', 'converted_date': 1637190000.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date    open    high  ...  volume     code  converted_date
date                                   ...                                 
2021-11-18 2021-11-18  10.916  10.916  ...     733  OBLI.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 951.7, 'high': 956.9, 'low': 942.4, 'close': 956.9, 'adjusted_close': 956.9, 'volume': 2905, 'code': 'LQQ.PA', 'converted_date': 1637190000.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  951.7  956.9  ...    2905  LQQ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 63.1, 'high': 63.33, 'low': 62.54, 'close': 62.69, 'adjusted_close': 62.69, 'volume': 6674, 'code': 'STZ.PA', 'converted_date': 1637190000.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open   high  ...  volume    code  converted_date
date                                ...                                
2021-11-18 2021-11-18  63.1  63.33  ...    6674  STZ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 70.46, 'high': 70.73, 'low': 70.29, 'close': 70.31, 'adjusted_close': 70.31, 'volume': 24410, 'code': 'CAC.PA', 'converted_date': 1637190000.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  70.46  70.73  ...   24410  CAC.PA    1.637190e+09

[1 rows x 9 columns]
date = 20211117,
sub_date_df =                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 10.9, 'high': 10.9, 'low': 10.826, 'close': 10.862, 'adjusted_close': 10.862, 'volume': 3088, 'code': 'OBLI.PA', 'converted_date': 1637103600.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-17 2021-11-17  10.9  10.9  ...    3088  OBLI.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 946.1, 'high': 952.1, 'low': 940.9, 'close': 951.7, 'adjusted_close': 951.7, 'volume': 3439, 'code': 'LQQ.PA', 'converted_date': 1637103600.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  946.1  952.1  ...    3439  LQQ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 63.31, 'high': 63.46, 'low': 63.19, 'close': 63.19, 'adjusted_close': 63.19, 'volume': 5832, 'code': 'STZ.PA', 'converted_date': 1637103600.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  63.31  63.46  ...    5832  STZ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 70.48, 'high': 70.6, 'low': 70.4, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 21757, 'code': 'CAC.PA', 'converted_date': 1637103600.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-17 2021-11-17  70.48  70.6  ...   21757  CAC.PA    1.637104e+09

[1 rows x 9 columns]
date = 20211116,
sub_date_df =                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 11.0, 'high': 11.0, 'low': 10.85, 'close': 10.876, 'adjusted_close': 10.876, 'volume': 1226, 'code': 'OBLI.PA', 'converted_date': 1637017200.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-16 2021-11-16  11.0  11.0  ...    1226  OBLI.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 927.9, 'high': 942.5, 'low': 923.4, 'close': 942.5, 'adjusted_close': 942.5, 'volume': 3594, 'code': 'LQQ.PA', 'converted_date': 1637017200.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  927.9  942.5  ...    3594  LQQ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 63.4, 'high': 63.4, 'low': 63.08, 'close': 63.14, 'adjusted_close': 63.14, 'volume': 3694, 'code': 'STZ.PA', 'converted_date': 1637017200.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume    code  converted_date
date                               ...                                
2021-11-16 2021-11-16  63.4  63.4  ...    3694  STZ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 70.45, 'high': 70.55, 'low': 70.3, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 27998, 'code': 'CAC.PA', 'converted_date': 1637017200.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  70.45  70.55  ...   27998  CAC.PA    1.637017e+09

[1 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-15       NaN
2021-11-16  0.003362
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-16  0.003362
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
127.0.0.1 - - [23/Nov/2021 16:46:13] "[35m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 500 -
127.0.0.1 - - [23/Nov/2021 16:46:14] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:46:14] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:46:14] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:46:15] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:46:15] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['STZ.PA', 'OBLI.PA', 'LQQ.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['STZ.PA', 'OBLI.PA', 'LQQ.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
dates Computed from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['STZ.PA', 'OBLI.PA', 'LQQ.PA', 'CAC.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1636930800.0]}, {'$lte': ['$$price.converted_date', 1637362800.0]}]}}}}}]: dates from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
1   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
3   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
4   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
5   2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
6   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
7   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
8   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
9   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
10  2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
11  2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
12  2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
13  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
14  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
15  2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
16  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
17  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
18  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
19  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
20  2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
21  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
22  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
23  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
24  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
1   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
3   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
4   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
5   2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
6   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
7   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
8   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
9   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
10  2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
11  2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
12  2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
13  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
14  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
15  2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
16  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
17  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
18  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
19  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
20  2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
21  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
22  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
23  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
24  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
5  2021-11-15  7090.96  7136.13  ...   64255100  FCHI.INDX    1.636931e+09
6  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
7  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
8  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
9  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[5 rows x 9 columns]
stock_code_prices =                  date      open      high  ...     volume       code  converted_date
date                                       ...                                      
2021-11-15 2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
2021-11-16 2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2021-11-17 2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2021-11-18 2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
2021-11-19 2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-15 2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
2021-11-16 2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
2021-11-17 2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
2021-11-19 2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-15 2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
2021-11-16 2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
2021-11-17 2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
2021-11-18 2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
2021-11-19 2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-15 2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
2021-11-16 2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
2021-11-17 2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
2021-11-18 2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
2021-11-19 2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-15 2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
2021-11-16 2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
2021-11-17 2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
2021-11-18 2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
2021-11-19 2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns],
date = 20211119,
sub_date_df =                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 10.91, 'high': 10.964, 'low': 10.892, 'close': 10.954, 'adjusted_close': 10.954, 'volume': 4281, 'code': 'OBLI.PA', 'converted_date': 1637276400.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open    high  ...  volume     code  converted_date
date                                  ...                                 
2021-11-19 2021-11-19  10.91  10.964  ...    4281  OBLI.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 972.2, 'high': 981.0, 'low': 970.0, 'close': 979.2, 'adjusted_close': 979.2, 'volume': 5866, 'code': 'LQQ.PA', 'converted_date': 1637276400.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  972.2  981.0  ...    5866  LQQ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 62.82, 'high': 62.9, 'low': 61.29, 'close': 61.77, 'adjusted_close': 61.77, 'volume': 18663, 'code': 'STZ.PA', 'converted_date': 1637276400.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-19 2021-11-19  62.82  62.9  ...   18663  STZ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 70.66, 'high': 70.71, 'low': 69.62, 'close': 70.02, 'adjusted_close': 70.02, 'volume': 43776, 'code': 'CAC.PA', 'converted_date': 1637276400.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  70.66  70.71  ...   43776  CAC.PA    1.637276e+09

[1 rows x 9 columns]
date = 20211118,
sub_date_df =                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 10.916, 'high': 10.916, 'low': 10.888, 'close': 10.914, 'adjusted_close': 10.914, 'volume': 733, 'code': 'OBLI.PA', 'converted_date': 1637190000.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date    open    high  ...  volume     code  converted_date
date                                   ...                                 
2021-11-18 2021-11-18  10.916  10.916  ...     733  OBLI.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 951.7, 'high': 956.9, 'low': 942.4, 'close': 956.9, 'adjusted_close': 956.9, 'volume': 2905, 'code': 'LQQ.PA', 'converted_date': 1637190000.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  951.7  956.9  ...    2905  LQQ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 63.1, 'high': 63.33, 'low': 62.54, 'close': 62.69, 'adjusted_close': 62.69, 'volume': 6674, 'code': 'STZ.PA', 'converted_date': 1637190000.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open   high  ...  volume    code  converted_date
date                                ...                                
2021-11-18 2021-11-18  63.1  63.33  ...    6674  STZ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 70.46, 'high': 70.73, 'low': 70.29, 'close': 70.31, 'adjusted_close': 70.31, 'volume': 24410, 'code': 'CAC.PA', 'converted_date': 1637190000.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  70.46  70.73  ...   24410  CAC.PA    1.637190e+09

[1 rows x 9 columns]
date = 20211117,
sub_date_df =                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 10.9, 'high': 10.9, 'low': 10.826, 'close': 10.862, 'adjusted_close': 10.862, 'volume': 3088, 'code': 'OBLI.PA', 'converted_date': 1637103600.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-17 2021-11-17  10.9  10.9  ...    3088  OBLI.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 946.1, 'high': 952.1, 'low': 940.9, 'close': 951.7, 'adjusted_close': 951.7, 'volume': 3439, 'code': 'LQQ.PA', 'converted_date': 1637103600.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  946.1  952.1  ...    3439  LQQ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 63.31, 'high': 63.46, 'low': 63.19, 'close': 63.19, 'adjusted_close': 63.19, 'volume': 5832, 'code': 'STZ.PA', 'converted_date': 1637103600.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  63.31  63.46  ...    5832  STZ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 70.48, 'high': 70.6, 'low': 70.4, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 21757, 'code': 'CAC.PA', 'converted_date': 1637103600.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-17 2021-11-17  70.48  70.6  ...   21757  CAC.PA    1.637104e+09

[1 rows x 9 columns]
date = 20211116,
sub_date_df =                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 11.0, 'high': 11.0, 'low': 10.85, 'close': 10.876, 'adjusted_close': 10.876, 'volume': 1226, 'code': 'OBLI.PA', 'converted_date': 1637017200.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-16 2021-11-16  11.0  11.0  ...    1226  OBLI.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 927.9, 'high': 942.5, 'low': 923.4, 'close': 942.5, 'adjusted_close': 942.5, 'volume': 3594, 'code': 'LQQ.PA', 'converted_date': 1637017200.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  927.9  942.5  ...    3594  LQQ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 63.4, 'high': 63.4, 'low': 63.08, 'close': 63.14, 'adjusted_close': 63.14, 'volume': 3694, 'code': 'STZ.PA', 'converted_date': 1637017200.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume    code  converted_date
date                               ...                                
2021-11-16 2021-11-16  63.4  63.4  ...    3694  STZ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 70.45, 'high': 70.55, 'low': 70.3, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 27998, 'code': 'CAC.PA', 'converted_date': 1637017200.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  70.45  70.55  ...   27998  CAC.PA    1.637017e+09

[1 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-15       NaN
2021-11-16  0.003362
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-16  0.003362
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
127.0.0.1 - - [23/Nov/2021 16:53:51] "[35m[1mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 500 -
127.0.0.1 - - [23/Nov/2021 16:53:52] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:53:52] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:53:52] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=jquery.js HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:53:53] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=ubuntu.ttf HTTP/1.1[0m" 200 -
127.0.0.1 - - [23/Nov/2021 16:53:53] "[37mGET /api/v1/compute_portfolio_analytics?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 200 -
 * Detected change in '/Users/sergengoube/PycharmProjects/investingclub/api/utils.py', reloading
 * Restarting with fsevents reloader
Unknown option passed to Flask-CORS: support_credentials
Unknown option passed to Flask-CORS: support_credentials
 * Debugger is active!
 * Debugger PIN: 139-003-692
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'STZ.PA', 'OBLI.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'STZ.PA', 'OBLI.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
dates Computed from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['LQQ.PA', 'STZ.PA', 'OBLI.PA', 'CAC.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1636930800.0]}, {'$lte': ['$$price.converted_date', 1637362800.0]}]}}}}}]: dates from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
1   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
3   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
4   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
5   2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
6   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
7   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
8   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
9   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
10  2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
11  2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
12  2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
13  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
14  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
15  2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
16  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
17  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
18  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
19  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
20  2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
21  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
22  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
23  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
24  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
1   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
3   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
4   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
5   2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
6   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
7   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
8   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
9   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
10  2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
11  2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
12  2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
13  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
14  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
15  2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
16  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
17  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
18  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
19  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
20  2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
21  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
22  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
23  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
24  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
5  2021-11-15  7090.96  7136.13  ...   64255100  FCHI.INDX    1.636931e+09
6  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
7  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
8  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
9  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[5 rows x 9 columns]
stock_code_prices =                  date      open      high  ...     volume       code  converted_date
date                                       ...                                      
2021-11-15 2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
2021-11-16 2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2021-11-17 2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2021-11-18 2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
2021-11-19 2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-15 2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
2021-11-16 2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
2021-11-17 2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
2021-11-19 2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-15 2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
2021-11-16 2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
2021-11-17 2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
2021-11-18 2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
2021-11-19 2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-15 2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
2021-11-16 2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
2021-11-17 2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
2021-11-18 2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
2021-11-19 2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-15 2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
2021-11-16 2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
2021-11-17 2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
2021-11-18 2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
2021-11-19 2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns],
date = 20211119,
sub_date_df =                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 10.91, 'high': 10.964, 'low': 10.892, 'close': 10.954, 'adjusted_close': 10.954, 'volume': 4281, 'code': 'OBLI.PA', 'converted_date': 1637276400.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open    high  ...  volume     code  converted_date
date                                  ...                                 
2021-11-19 2021-11-19  10.91  10.964  ...    4281  OBLI.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 972.2, 'high': 981.0, 'low': 970.0, 'close': 979.2, 'adjusted_close': 979.2, 'volume': 5866, 'code': 'LQQ.PA', 'converted_date': 1637276400.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  972.2  981.0  ...    5866  LQQ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 62.82, 'high': 62.9, 'low': 61.29, 'close': 61.77, 'adjusted_close': 61.77, 'volume': 18663, 'code': 'STZ.PA', 'converted_date': 1637276400.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-19 2021-11-19  62.82  62.9  ...   18663  STZ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 70.66, 'high': 70.71, 'low': 69.62, 'close': 70.02, 'adjusted_close': 70.02, 'volume': 43776, 'code': 'CAC.PA', 'converted_date': 1637276400.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  70.66  70.71  ...   43776  CAC.PA    1.637276e+09

[1 rows x 9 columns]
date = 20211118,
sub_date_df =                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 10.916, 'high': 10.916, 'low': 10.888, 'close': 10.914, 'adjusted_close': 10.914, 'volume': 733, 'code': 'OBLI.PA', 'converted_date': 1637190000.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date    open    high  ...  volume     code  converted_date
date                                   ...                                 
2021-11-18 2021-11-18  10.916  10.916  ...     733  OBLI.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 951.7, 'high': 956.9, 'low': 942.4, 'close': 956.9, 'adjusted_close': 956.9, 'volume': 2905, 'code': 'LQQ.PA', 'converted_date': 1637190000.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  951.7  956.9  ...    2905  LQQ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 63.1, 'high': 63.33, 'low': 62.54, 'close': 62.69, 'adjusted_close': 62.69, 'volume': 6674, 'code': 'STZ.PA', 'converted_date': 1637190000.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open   high  ...  volume    code  converted_date
date                                ...                                
2021-11-18 2021-11-18  63.1  63.33  ...    6674  STZ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 70.46, 'high': 70.73, 'low': 70.29, 'close': 70.31, 'adjusted_close': 70.31, 'volume': 24410, 'code': 'CAC.PA', 'converted_date': 1637190000.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  70.46  70.73  ...   24410  CAC.PA    1.637190e+09

[1 rows x 9 columns]
date = 20211117,
sub_date_df =                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 10.9, 'high': 10.9, 'low': 10.826, 'close': 10.862, 'adjusted_close': 10.862, 'volume': 3088, 'code': 'OBLI.PA', 'converted_date': 1637103600.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-17 2021-11-17  10.9  10.9  ...    3088  OBLI.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 946.1, 'high': 952.1, 'low': 940.9, 'close': 951.7, 'adjusted_close': 951.7, 'volume': 3439, 'code': 'LQQ.PA', 'converted_date': 1637103600.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  946.1  952.1  ...    3439  LQQ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 63.31, 'high': 63.46, 'low': 63.19, 'close': 63.19, 'adjusted_close': 63.19, 'volume': 5832, 'code': 'STZ.PA', 'converted_date': 1637103600.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  63.31  63.46  ...    5832  STZ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 70.48, 'high': 70.6, 'low': 70.4, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 21757, 'code': 'CAC.PA', 'converted_date': 1637103600.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-17 2021-11-17  70.48  70.6  ...   21757  CAC.PA    1.637104e+09

[1 rows x 9 columns]
date = 20211116,
sub_date_df =                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 11.0, 'high': 11.0, 'low': 10.85, 'close': 10.876, 'adjusted_close': 10.876, 'volume': 1226, 'code': 'OBLI.PA', 'converted_date': 1637017200.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-16 2021-11-16  11.0  11.0  ...    1226  OBLI.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 927.9, 'high': 942.5, 'low': 923.4, 'close': 942.5, 'adjusted_close': 942.5, 'volume': 3594, 'code': 'LQQ.PA', 'converted_date': 1637017200.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  927.9  942.5  ...    3594  LQQ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 63.4, 'high': 63.4, 'low': 63.08, 'close': 63.14, 'adjusted_close': 63.14, 'volume': 3694, 'code': 'STZ.PA', 'converted_date': 1637017200.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume    code  converted_date
date                               ...                                
2021-11-16 2021-11-16  63.4  63.4  ...    3694  STZ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 70.45, 'high': 70.55, 'low': 70.3, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 27998, 'code': 'CAC.PA', 'converted_date': 1637017200.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  70.45  70.55  ...   27998  CAC.PA    1.637017e+09

[1 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-15       NaN
2021-11-16  0.003362
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-16  0.003362
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [23/Nov/2021 16:54:11] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
params ={'portfolioId': 'max_diversification', 'portfolioHistoricalHoldings': [{'id': '121F4343564ACD', 'date': '2021-11-19T19:40:06+00:00', 'holdings': {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8}}, {'id': '121F4343564ACD', 'date': '2021-11-18T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-17T19:40:06+00:00', 'holdings': {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10}}, {'id': '121F4343564ACD', 'date': '2021-11-16T19:40:06+00:00', 'holdings': {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9}}], 'benchmarkStockCode': 'FCHI.INDX'}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'STZ.PA', 'OBLI.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['LQQ.PA', 'STZ.PA', 'OBLI.PA', 'CAC.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 4}], 'data': [{'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}]} 
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 43776, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 18663, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 5866, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 4281, 'AssetType': 'Fixed Income'}
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0007052782   CAC  ...          BBB            3
1  IE00BKWQ0G16   STZ  ...          BBB            3
2  FR0010342592   LQQ  ...          BBB            3
3  FR0013346681  OBLI  ...          BBB            3

[4 rows x 21 columns] 
stock_data_df =           ISIN  Code  ... total_stocks     code
0  FR0007052782   CAC  ...            3   CAC.PA
1  IE00BKWQ0G16   STZ  ...            3   STZ.PA
2  FR0010342592   LQQ  ...            3   LQQ.PA
3  FR0013346681  OBLI  ...            3  OBLI.PA

[4 rows x 22 columns]
dates sent from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
dates Computed from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['LQQ.PA', 'STZ.PA', 'OBLI.PA', 'CAC.PA', 'FCHI.INDX']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1636930800.0]}, {'$lte': ['$$price.converted_date', 1637362800.0]}]}}}}}]: dates from 2021-11-15 00:00:00 to 2021-11-20 00:00:00
Data returned           date      open      high  ...     volume       code  converted_date
0   2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
1   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
3   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
4   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
5   2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
6   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
7   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
8   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
9   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
10  2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
11  2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
12  2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
13  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
14  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
15  2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
16  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
17  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
18  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
19  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
20  2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
21  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
22  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
23  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
24  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns]
df_h_p =          date      open      high  ...     volume       code  converted_date
0   2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
1   2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2   2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
3   2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
4   2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
5   2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
6   2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
7   2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
8   2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
9   2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
10  2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
11  2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
12  2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
13  2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
14  2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
15  2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
16  2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
17  2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
18  2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
19  2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
20  2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
21  2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
22  2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
23  2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
24  2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns]
df_bhp =         date     open     high  ...     volume       code  converted_date
5  2021-11-15  7090.96  7136.13  ...   64255100  FCHI.INDX    1.636931e+09
6  2021-11-16  7146.37  7164.27  ...   69021696  FCHI.INDX    1.637017e+09
7  2021-11-17  7149.30  7167.80  ...   68243504  FCHI.INDX    1.637104e+09
8  2021-11-18  7155.05  7181.55  ...   75845600  FCHI.INDX    1.637190e+09
9  2021-11-19  7172.72  7183.08  ...  117988000  FCHI.INDX    1.637276e+09

[5 rows x 9 columns]
stock_code_prices =                  date      open      high  ...     volume       code  converted_date
date                                       ...                                      
2021-11-15 2021-11-15    69.910    70.270  ...      30501     CAC.PA    1.636931e+09
2021-11-16 2021-11-16    70.450    70.550  ...      27998     CAC.PA    1.637017e+09
2021-11-17 2021-11-17    70.480    70.600  ...      21757     CAC.PA    1.637104e+09
2021-11-18 2021-11-18    70.460    70.730  ...      24410     CAC.PA    1.637190e+09
2021-11-19 2021-11-19    70.660    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-15 2021-11-15  7090.960  7136.130  ...   64255100  FCHI.INDX    1.636931e+09
2021-11-16 2021-11-16  7146.370  7164.270  ...   69021696  FCHI.INDX    1.637017e+09
2021-11-17 2021-11-17  7149.300  7167.800  ...   68243504  FCHI.INDX    1.637104e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...   75845600  FCHI.INDX    1.637190e+09
2021-11-19 2021-11-19  7172.720  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-15 2021-11-15   924.400   931.100  ...       4147     LQQ.PA    1.636931e+09
2021-11-16 2021-11-16   927.900   942.500  ...       3594     LQQ.PA    1.637017e+09
2021-11-17 2021-11-17   946.100   952.100  ...       3439     LQQ.PA    1.637104e+09
2021-11-18 2021-11-18   951.700   956.900  ...       2905     LQQ.PA    1.637190e+09
2021-11-19 2021-11-19   972.200   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-15 2021-11-15    10.890    10.930  ...       2497    OBLI.PA    1.636931e+09
2021-11-16 2021-11-16    11.000    11.000  ...       1226    OBLI.PA    1.637017e+09
2021-11-17 2021-11-17    10.900    10.900  ...       3088    OBLI.PA    1.637104e+09
2021-11-18 2021-11-18    10.916    10.916  ...        733    OBLI.PA    1.637190e+09
2021-11-19 2021-11-19    10.910    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-15 2021-11-15    62.530    63.310  ...       3810     STZ.PA    1.636931e+09
2021-11-16 2021-11-16    63.400    63.400  ...       3694     STZ.PA    1.637017e+09
2021-11-17 2021-11-17    63.310    63.460  ...       5832     STZ.PA    1.637104e+09
2021-11-18 2021-11-18    63.100    63.330  ...       6674     STZ.PA    1.637190e+09
2021-11-19 2021-11-19    62.820    62.900  ...      18663     STZ.PA    1.637276e+09

[25 rows x 9 columns],
date = 20211119,
sub_date_df =                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 10.91, 'high': 10.964, 'low': 10.892, 'close': 10.954, 'adjusted_close': 10.954, 'volume': 4281, 'code': 'OBLI.PA', 'converted_date': 1637276400.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open    high  ...  volume     code  converted_date
date                                  ...                                 
2021-11-19 2021-11-19  10.91  10.964  ...    4281  OBLI.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 972.2, 'high': 981.0, 'low': 970.0, 'close': 979.2, 'adjusted_close': 979.2, 'volume': 5866, 'code': 'LQQ.PA', 'converted_date': 1637276400.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  972.2  981.0  ...    5866  LQQ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 62.82, 'high': 62.9, 'low': 61.29, 'close': 61.77, 'adjusted_close': 61.77, 'volume': 18663, 'code': 'STZ.PA', 'converted_date': 1637276400.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-19 2021-11-19  62.82  62.9  ...   18663  STZ.PA    1.637276e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-19 00:00:00'), 'open': 70.66, 'high': 70.71, 'low': 69.62, 'close': 70.02, 'adjusted_close': 70.02, 'volume': 43776, 'code': 'CAC.PA', 'converted_date': 1637276400.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 20, 'LQQ.PA': 1, 'STZ.PA': 10, 'CAC.PA': 8} sub_date_df=                  date     open      high  ...     volume       code  converted_date
date                                      ...                                      
2021-11-19 2021-11-19    70.66    70.710  ...      43776     CAC.PA    1.637276e+09
2021-11-19 2021-11-19  7172.72  7183.080  ...  117988000  FCHI.INDX    1.637276e+09
2021-11-19 2021-11-19   972.20   981.000  ...       5866     LQQ.PA    1.637276e+09
2021-11-19 2021-11-19    10.91    10.964  ...       4281    OBLI.PA    1.637276e+09
2021-11-19 2021-11-19    62.82    62.900  ...      18663     STZ.PA    1.637276e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-19       CAC.PA
2021-11-19    FCHI.INDX
2021-11-19       LQQ.PA
2021-11-19      OBLI.PA
2021-11-19       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-19 2021-11-19  70.66  70.71  ...   43776  CAC.PA    1.637276e+09

[1 rows x 9 columns]
date = 20211118,
sub_date_df =                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 10.916, 'high': 10.916, 'low': 10.888, 'close': 10.914, 'adjusted_close': 10.914, 'volume': 733, 'code': 'OBLI.PA', 'converted_date': 1637190000.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date    open    high  ...  volume     code  converted_date
date                                   ...                                 
2021-11-18 2021-11-18  10.916  10.916  ...     733  OBLI.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 951.7, 'high': 956.9, 'low': 942.4, 'close': 956.9, 'adjusted_close': 956.9, 'volume': 2905, 'code': 'LQQ.PA', 'converted_date': 1637190000.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  951.7  956.9  ...    2905  LQQ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 63.1, 'high': 63.33, 'low': 62.54, 'close': 62.69, 'adjusted_close': 62.69, 'volume': 6674, 'code': 'STZ.PA', 'converted_date': 1637190000.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open   high  ...  volume    code  converted_date
date                                ...                                
2021-11-18 2021-11-18  63.1  63.33  ...    6674  STZ.PA    1.637190e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-18 00:00:00'), 'open': 70.46, 'high': 70.73, 'low': 70.29, 'close': 70.31, 'adjusted_close': 70.31, 'volume': 24410, 'code': 'CAC.PA', 'converted_date': 1637190000.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 3, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date      open      high  ...    volume       code  converted_date
date                                       ...                                     
2021-11-18 2021-11-18    70.460    70.730  ...     24410     CAC.PA    1.637190e+09
2021-11-18 2021-11-18  7155.050  7181.550  ...  75845600  FCHI.INDX    1.637190e+09
2021-11-18 2021-11-18   951.700   956.900  ...      2905     LQQ.PA    1.637190e+09
2021-11-18 2021-11-18    10.916    10.916  ...       733    OBLI.PA    1.637190e+09
2021-11-18 2021-11-18    63.100    63.330  ...      6674     STZ.PA    1.637190e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-18       CAC.PA
2021-11-18    FCHI.INDX
2021-11-18       LQQ.PA
2021-11-18      OBLI.PA
2021-11-18       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-18 2021-11-18  70.46  70.73  ...   24410  CAC.PA    1.637190e+09

[1 rows x 9 columns]
date = 20211117,
sub_date_df =                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 10.9, 'high': 10.9, 'low': 10.826, 'close': 10.862, 'adjusted_close': 10.862, 'volume': 3088, 'code': 'OBLI.PA', 'converted_date': 1637103600.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-17 2021-11-17  10.9  10.9  ...    3088  OBLI.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 946.1, 'high': 952.1, 'low': 940.9, 'close': 951.7, 'adjusted_close': 951.7, 'volume': 3439, 'code': 'LQQ.PA', 'converted_date': 1637103600.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  946.1  952.1  ...    3439  LQQ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 63.31, 'high': 63.46, 'low': 63.19, 'close': 63.19, 'adjusted_close': 63.19, 'volume': 5832, 'code': 'STZ.PA', 'converted_date': 1637103600.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-17 2021-11-17  63.31  63.46  ...    5832  STZ.PA    1.637104e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-17 00:00:00'), 'open': 70.48, 'high': 70.6, 'low': 70.4, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 21757, 'code': 'CAC.PA', 'converted_date': 1637103600.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 1, 'LQQ.PA': 2, 'STZ.PA': 6, 'CAC.PA': 10} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-17 2021-11-17    70.48    70.60  ...     21757     CAC.PA    1.637104e+09
2021-11-17 2021-11-17  7149.30  7167.80  ...  68243504  FCHI.INDX    1.637104e+09
2021-11-17 2021-11-17   946.10   952.10  ...      3439     LQQ.PA    1.637104e+09
2021-11-17 2021-11-17    10.90    10.90  ...      3088    OBLI.PA    1.637104e+09
2021-11-17 2021-11-17    63.31    63.46  ...      5832     STZ.PA    1.637104e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-17       CAC.PA
2021-11-17    FCHI.INDX
2021-11-17       LQQ.PA
2021-11-17      OBLI.PA
2021-11-17       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open  high  ...  volume    code  converted_date
date                                ...                                
2021-11-17 2021-11-17  70.48  70.6  ...   21757  CAC.PA    1.637104e+09

[1 rows x 9 columns]
date = 20211116,
sub_date_df =                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns],
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 11.0, 'high': 11.0, 'low': 10.85, 'close': 10.876, 'adjusted_close': 10.876, 'volume': 1226, 'code': 'OBLI.PA', 'converted_date': 1637017200.0}], stock_code = OBLI.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume     code  converted_date
date                               ...                                 
2021-11-16 2021-11-16  11.0  11.0  ...    1226  OBLI.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 927.9, 'high': 942.5, 'low': 923.4, 'close': 942.5, 'adjusted_close': 942.5, 'volume': 3594, 'code': 'LQQ.PA', 'converted_date': 1637017200.0}], stock_code = LQQ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  927.9  942.5  ...    3594  LQQ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 63.4, 'high': 63.4, 'low': 63.08, 'close': 63.14, 'adjusted_close': 63.14, 'volume': 3694, 'code': 'STZ.PA', 'converted_date': 1637017200.0}], stock_code = STZ.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date  open  high  ...  volume    code  converted_date
date                               ...                                
2021-11-16 2021-11-16  63.4  63.4  ...    3694  STZ.PA    1.637017e+09

[1 rows x 9 columns]
stock_data = [{'date': Timestamp('2021-11-16 00:00:00'), 'open': 70.45, 'high': 70.55, 'low': 70.3, 'close': 70.47, 'adjusted_close': 70.47, 'volume': 27998, 'code': 'CAC.PA', 'converted_date': 1637017200.0}], stock_code = CAC.PA, holdings = {'OBLI.PA': 5, 'LQQ.PA': 1, 'STZ.PA': 6, 'CAC.PA': 9} sub_date_df=                  date     open     high  ...    volume       code  converted_date
date                                     ...                                     
2021-11-16 2021-11-16    70.45    70.55  ...     27998     CAC.PA    1.637017e+09
2021-11-16 2021-11-16  7146.37  7164.27  ...  69021696  FCHI.INDX    1.637017e+09
2021-11-16 2021-11-16   927.90   942.50  ...      3594     LQQ.PA    1.637017e+09
2021-11-16 2021-11-16    11.00    11.00  ...      1226    OBLI.PA    1.637017e+09
2021-11-16 2021-11-16    63.40    63.40  ...      3694     STZ.PA    1.637017e+09

[5 rows x 9 columns] sub_date_df_code = date
2021-11-16       CAC.PA
2021-11-16    FCHI.INDX
2021-11-16       LQQ.PA
2021-11-16      OBLI.PA
2021-11-16       STZ.PA
Name: code, dtype: object sub_holding_df=                 date   open   high  ...  volume    code  converted_date
date                                 ...                                
2021-11-16 2021-11-16  70.45  70.55  ...   27998  CAC.PA    1.637017e+09

[1 rows x 9 columns]
b_daily_returns =               close
date                
2021-11-15       NaN
2021-11-16  0.003362
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
g_daily_returns =               value
date                
2021-11-17  0.491630
2021-11-18  0.321120
2021-11-19 -0.400094, g_b_daily_returns =               close
date                
2021-11-16  0.003362
2021-11-17  0.000594
2021-11-18 -0.002078
2021-11-19 -0.004157
result beta 0.004605872897015799, alpha -0.0025137648720715295
127.0.0.1 - - [23/Nov/2021 16:56:41] "[37mPOST /api/v1/compute_portfolio_analytics HTTP/1.1[0m" 200 -
