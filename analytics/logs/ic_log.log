dates sent from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['IWDA.LSE', 'TDT.AS', 'BX4.PA', 'IAEX.AS', 'VUSA.LSE', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1334354400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}}}]: dates from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
dates sent from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['IWDA.LSE', 'TDT.AS', 'BX4.PA', 'IAEX.AS', 'VUSA.LSE', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1334354400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}}}]: dates from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
dates sent from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['IWDA.LSE', 'TDT.AS', 'BX4.PA', 'IAEX.AS', 'VUSA.LSE', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1334354400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}}}]: dates from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
dates sent from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['IWDA.LSE', 'TDT.AS', 'BX4.PA', 'IAEX.AS', 'VUSA.LSE', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1334354400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}}}]: dates from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
dates sent from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['IWDA.LSE', 'TDT.AS', 'BX4.PA', 'IAEX.AS', 'VUSA.LSE', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1334354400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}}}]: dates from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
max_diversification = {}
dates sent from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['IWDA.LSE', 'TDT.AS', 'BX4.PA', 'IAEX.AS', 'VUSA.LSE', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1334354400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}}}]: dates from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
max_diversification = {}
dates sent from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1334354400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}}}]: dates from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
max_diversification = {}
dates sent from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1334354400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}}}]: dates from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
max_diversification = {}
dates sent from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1334354400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}}}]: dates from 2012-04-14 00:00:00 to 2021-11-14 00:00:00
max_diversification = {}
dates sent from None to None
dates Computed from 2021-11-06 23:00:00 to 2021-11-14 23:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1636236000.0]}, {'$lte': ['$$price.converted_date', 1636927200.0]}]}}}}}]: dates from 2021-11-06 23:00:00 to 2021-11-14 23:00:00
max_diversification = {}
dates sent from None to None
dates Computed from 2021-11-06 23:00:00 to 2021-11-14 23:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1636236000.0]}, {'$lte': ['$$price.converted_date', 1636927200.0]}]}}}}}]: dates from 2021-11-06 23:00:00 to 2021-11-14 23:00:00
Data returned Empty DataFrame
Columns: []
Index: []
max_diversification = {}
dates sent from None to None
dates Computed from 2021-11-06 23:00:00 to 2021-11-14 23:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1636236000.0]}, {'$lte': ['$$price.converted_date', 1636927200.0]}]}}}}}]: dates from 2021-11-06 23:00:00 to 2021-11-14 23:00:00
Data returned Empty DataFrame
Columns: []
Index: []
max_diversification = {}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('60deacf3094f5da1d4661e5a'), 'Code': 'LVC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor Daily Leverage CAC 40 UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010592014', 'Type': 'ETF', 'last_price_volume': 515573}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('60deacf3094f5da1d4661e5a'), 'Code': 'LVC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor Daily Leverage CAC 40 UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010592014', 'Type': 'ETF', 'last_price_volume': 515573}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            6
1  FR0000120578   SAN  ...          BBB            6
2  FR0010592014   LVC  ...          BBB            6
3  FR0007052782   CAC  ...          BBB            6
4  FR0013346681  OBLI  ...          BBB            6
5  IE00BKWQ0G16   STZ  ...          BBB            6
6  FR0010342592   LQQ  ...          BBB            6

[7 rows x 20 columns] 
dates sent from None to None
dates Computed from 2021-11-06 23:00:00 to 2021-11-14 23:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'LVC.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1636236000.0]}, {'$lte': ['$$price.converted_date', 1636927200.0]}]}}}, 'code': 1}}]: dates from 2021-11-06 23:00:00 to 2021-11-14 23:00:00
Data returned Empty DataFrame
Columns: []
Index: []
max_diversification = {}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('60deacf3094f5da1d4661e5a'), 'Code': 'LVC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor Daily Leverage CAC 40 UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010592014', 'Type': 'ETF', 'last_price_volume': 515573}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('60deacf3094f5da1d4661e5a'), 'Code': 'LVC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor Daily Leverage CAC 40 UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010592014', 'Type': 'ETF', 'last_price_volume': 515573}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            6
1  FR0000120578   SAN  ...          BBB            6
2  FR0010592014   LVC  ...          BBB            6
3  FR0007052782   CAC  ...          BBB            6
4  FR0013346681  OBLI  ...          BBB            6
5  IE00BKWQ0G16   STZ  ...          BBB            6
6  FR0010342592   LQQ  ...          BBB            6

[7 rows x 20 columns] 
dates sent from None to None
dates Computed from 2021-04-27 23:00:00 to 2021-11-14 23:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'LVC.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619557200.0]}, {'$lte': ['$$price.converted_date', 1636927200.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 23:00:00 to 2021-11-14 23:00:00
Data returned            date     open     high  ...    volume    code  converted_date
0    2021-04-28   1.7220   1.7282  ...   4411200  BX4.PA    1.619561e+09
1    2021-04-29   1.6996   1.7252  ...   4494761  BX4.PA    1.619647e+09
2    2021-04-30   1.7108   1.7354  ...   4020190  BX4.PA    1.619734e+09
3    2021-05-03   1.7274   1.7444  ...   4487623  BX4.PA    1.619993e+09
4    2021-05-04   1.7062   1.7490  ...  12616073  BX4.PA    1.620079e+09
..          ...      ...      ...  ...       ...     ...             ...
961  2021-11-01  62.5400  63.2700  ...      4444  STZ.PA    1.635721e+09
962  2021-11-02  62.9300  63.0400  ...      3303  STZ.PA    1.635808e+09
963  2021-11-03  62.8500  63.2600  ...    297542  STZ.PA    1.635894e+09
964  2021-11-04  63.7400  63.7400  ...      6536  STZ.PA    1.635980e+09
965  2021-11-05  62.4400  63.2400  ...      5383  STZ.PA    1.636067e+09

[966 rows x 9 columns]
max_diversification = {}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('60deacf3094f5da1d4661e5a'), 'Code': 'LVC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor Daily Leverage CAC 40 UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010592014', 'Type': 'ETF', 'last_price_volume': 515573}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('60deacf3094f5da1d4661e5a'), 'Code': 'LVC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor Daily Leverage CAC 40 UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010592014', 'Type': 'ETF', 'last_price_volume': 515573}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            6
1  FR0000120578   SAN  ...          BBB            6
2  FR0010592014   LVC  ...          BBB            6
3  FR0007052782   CAC  ...          BBB            6
4  FR0013346681  OBLI  ...          BBB            6
5  IE00BKWQ0G16   STZ  ...          BBB            6
6  FR0010342592   LQQ  ...          BBB            6

[7 rows x 20 columns] 
dates sent from None to None
dates Computed from 2021-04-27 23:00:00 to 2021-11-14 23:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'LVC.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619557200.0]}, {'$lte': ['$$price.converted_date', 1636927200.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 23:00:00 to 2021-11-14 23:00:00
Data returned            date     open     high  ...    volume    code  converted_date
0    2021-04-28   1.7220   1.7282  ...   4411200  BX4.PA    1.619561e+09
1    2021-04-29   1.6996   1.7252  ...   4494761  BX4.PA    1.619647e+09
2    2021-04-30   1.7108   1.7354  ...   4020190  BX4.PA    1.619734e+09
3    2021-05-03   1.7274   1.7444  ...   4487623  BX4.PA    1.619993e+09
4    2021-05-04   1.7062   1.7490  ...  12616073  BX4.PA    1.620079e+09
..          ...      ...      ...  ...       ...     ...             ...
961  2021-11-01  62.5400  63.2700  ...      4444  STZ.PA    1.635721e+09
962  2021-11-02  62.9300  63.0400  ...      3303  STZ.PA    1.635808e+09
963  2021-11-03  62.8500  63.2600  ...    297542  STZ.PA    1.635894e+09
964  2021-11-04  63.7400  63.7400  ...      6536  STZ.PA    1.635980e+09
965  2021-11-05  62.4400  63.2400  ...      5383  STZ.PA    1.636067e+09

[966 rows x 9 columns]
max_diversification = {}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('60deacf3094f5da1d4661e5a'), 'Code': 'LVC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor Daily Leverage CAC 40 UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010592014', 'Type': 'ETF', 'last_price_volume': 515573}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('60deacf3094f5da1d4661e5a'), 'Code': 'LVC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor Daily Leverage CAC 40 UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010592014', 'Type': 'ETF', 'last_price_volume': 515573}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            6
1  FR0000120578   SAN  ...          BBB            6
2  FR0010592014   LVC  ...          BBB            6
3  FR0007052782   CAC  ...          BBB            6
4  FR0013346681  OBLI  ...          BBB            6
5  IE00BKWQ0G16   STZ  ...          BBB            6
6  FR0010342592   LQQ  ...          BBB            6

[7 rows x 20 columns] 
dates sent from 2012-04-14 to 2021-11-14
dates Computed from 2012-04-14 to 2021-11-14
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('60deacf3094f5da1d4661e5a'), 'Code': 'LVC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor Daily Leverage CAC 40 UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010592014', 'Type': 'ETF', 'last_price_volume': 515573}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('60deacf3094f5da1d4661e5a'), 'Code': 'LVC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor Daily Leverage CAC 40 UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010592014', 'Type': 'ETF', 'last_price_volume': 515573}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            6
1  FR0000120578   SAN  ...          BBB            6
2  FR0010592014   LVC  ...          BBB            6
3  FR0007052782   CAC  ...          BBB            6
4  FR0013346681  OBLI  ...          BBB            6
5  IE00BKWQ0G16   STZ  ...          BBB            6
6  FR0010342592   LQQ  ...          BBB            6

[7 rows x 20 columns] 
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'LVC.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
968  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
969  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
970  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
971  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
972  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[973 rows x 9 columns]
max_diversification = {}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'LVC.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 7}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('60deacf3094f5da1d4661e5a'), 'Code': 'LVC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor Daily Leverage CAC 40 UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010592014', 'Type': 'ETF', 'last_price_volume': 515573}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('60deacf3094f5da1d4661e5a'), 'Code': 'LVC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor Daily Leverage CAC 40 UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010592014', 'Type': 'ETF', 'last_price_volume': 515573}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            6
1  FR0000120578   SAN  ...          BBB            6
2  FR0010592014   LVC  ...          BBB            6
3  FR0007052782   CAC  ...          BBB            6
4  FR0013346681  OBLI  ...          BBB            6
5  IE00BKWQ0G16   STZ  ...          BBB            6
6  FR0010342592   LQQ  ...          BBB            6

[7 rows x 20 columns] 
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'LVC.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
968  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
969  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
970  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
971  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
972  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[973 rows x 9 columns]
 max_diversification cov =            BX4.PA    LVC.PA   OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA
BX4.PA   0.071251 -0.071768 -0.000744 -0.046688 -0.036749 -0.035772 -0.014192
LVC.PA  -0.071768  0.072515  0.000741  0.047483  0.036991  0.036084  0.014254
OBLI.PA -0.000744  0.000741  0.001107  0.001840 -0.000955  0.000239  0.000640
LQQ.PA  -0.046688  0.047483  0.001840  0.085409  0.022117  0.023811  0.009105
STZ.PA  -0.036749  0.036991 -0.000955  0.022117  0.027707  0.018931  0.005820
CAC.PA  -0.035772  0.036084  0.000239  0.023811  0.018931  0.019121  0.006685
SAN.PA  -0.014192  0.014254  0.000640  0.009105  0.005820  0.006685  0.022572
 df_full  =             BX4.PA  LVC.PA  OBLI.PA  LQQ.PA  STZ.PA   CAC.PA   SAN.PA
2021-04-27  1.7336  25.210   10.842   655.4   55.19  60.8151  82.2534
2021-04-28  1.7146  25.505   10.826   650.5   55.77  61.1296  84.2472
2021-04-29  1.7188  25.425   10.792   648.4   56.03  61.1198  83.6404
2021-04-30  1.7350  25.170   10.786   650.7   55.86  60.7463  84.0545
2021-05-03  1.7154  25.470   10.792   642.1   56.14  61.1100  83.4959
...            ...     ...      ...     ...     ...      ...      ...
2021-11-01  1.3300  31.160   10.756   873.4   63.17  67.8700  88.3000
2021-11-02  1.3174  31.450   10.826   882.3   63.04  68.2100  89.6100
2021-11-03  1.3068  31.700   10.834   887.9   63.17  68.4500  90.2400
2021-11-04  1.2938  32.020   10.876   925.2   62.52  68.7800  89.6900
2021-11-05  1.2740  32.500   10.922   938.3   62.93  69.3100  88.4600

[139 rows x 7 columns]
expected_returns [-0.41817932  0.67185601  0.01455338  1.14692491  0.30828684  0.29031185
  0.14822153]
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-27.477759913412683
w=[0.14285716 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-27.4777627957213
w=[0.14285714 0.14285716 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-27.477758170286943
w=[0.14285714 0.14285714 0.14285716 0.14285714 0.14285714 0.14285714
 0.14285714]
obj_value=-27.477759936821727
w=[0.14285714 0.14285714 0.14285714 0.14285716 0.14285714 0.14285714
 0.14285714]
obj_value=-27.477758104468954
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285716 0.14285714
 0.14285714]
obj_value=-27.477759013488615
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285716
 0.14285714]
obj_value=-27.47775903353812
w=[0.14285714 0.14285714 0.14285714 0.14285714 0.14285714 0.14285714
 0.14285716]
obj_value=-27.4777594734098
w=[1.00000000e+00 0.00000000e+00 7.23344079e-10 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00]
obj_value=-3.7463294403648164
w=[0.52985438 0.0783576  0.0783576  0.0783576  0.0783576  0.0783576
 0.0783576 ]
obj_value=-31.703268659313398
w=[0.34491617 0.10918064 0.10918064 0.10918064 0.10918064 0.10918064
 0.10918064]
obj_value=-201.40231162889407
w=[0.34491619 0.10918064 0.10918064 0.10918064 0.10918064 0.10918064
 0.10918064]
obj_value=-201.4023032577735
w=[0.34491617 0.10918065 0.10918064 0.10918064 0.10918064 0.10918064
 0.10918064]
obj_value=-201.40232745170337
w=[0.34491617 0.10918064 0.10918065 0.10918064 0.10918064 0.10918064
 0.10918064]
obj_value=-201.40231130594205
w=[0.34491617 0.10918064 0.10918064 0.10918065 0.10918064 0.10918064
 0.10918064]
obj_value=-201.40228887849872
w=[0.34491617 0.10918064 0.10918064 0.10918064 0.10918065 0.10918064
 0.10918064]
obj_value=-201.4023175470785
w=[0.34491617 0.10918064 0.10918064 0.10918064 0.10918064 0.10918065
 0.10918064]
obj_value=-201.40231883199544
w=[0.34491617 0.10918064 0.10918064 0.10918064 0.10918064 0.10918064
 0.10918065]
obj_value=-201.40230471588407
w=[0.65553151 0.34446855 0.         0.         0.         0.
 0.        ]
obj_value=-39.31163390388266
w=[0.43049097 0.17400266 0.07910128 0.07910128 0.07910128 0.07910128
 0.07910128]
obj_value=-168.87687465708638
w=[0.37176708 0.12951992 0.0997426  0.0997426  0.0997426  0.0997426
 0.0997426 ]
obj_value=-209.16971132132855
w=[0.37176709 0.12951992 0.0997426  0.0997426  0.0997426  0.0997426
 0.0997426 ]
obj_value=-209.16969178780292
w=[0.37176708 0.12951994 0.0997426  0.0997426  0.0997426  0.0997426
 0.0997426 ]
obj_value=-209.16973846190717
w=[0.37176708 0.12951992 0.09974262 0.0997426  0.0997426  0.0997426
 0.0997426 ]
obj_value=-209.16971115958336
w=[0.37176708 0.12951992 0.0997426  0.09974262 0.0997426  0.0997426
 0.0997426 ]
obj_value=-209.16969725920734
w=[0.37176708 0.12951992 0.0997426  0.0997426  0.09974262 0.0997426
 0.0997426 ]
obj_value=-209.16972316747578
w=[0.37176708 0.12951992 0.0997426  0.0997426  0.0997426  0.09974262
 0.0997426 ]
obj_value=-209.1697242063811
w=[0.37176708 0.12951992 0.0997426  0.0997426  0.0997426  0.0997426
 0.09974262]
obj_value=-209.16970712828572
w=[4.93392141e-01 5.06605520e-01 5.74422156e-07 6.61097075e-08
 6.24621604e-07 6.52689222e-07 4.21140453e-07]
obj_value=-3415.6257487141647
w=[4.93392156e-01 5.06605520e-01 5.74422156e-07 6.61097075e-08
 6.24621604e-07 6.52689222e-07 4.21140453e-07]
obj_value=-3415.627360058262
w=[4.93392141e-01 5.06605535e-01 5.74422156e-07 6.61097075e-08
 6.24621604e-07 6.52689222e-07 4.21140453e-07]
obj_value=-3415.624078933633
w=[4.93392141e-01 5.06605520e-01 5.89323317e-07 6.61097075e-08
 6.24621604e-07 6.52689222e-07 4.21140453e-07]
obj_value=-3415.625744151872
w=[4.93392141e-01 5.06605520e-01 5.74422156e-07 8.10108687e-08
 6.24621604e-07 6.52689222e-07 4.21140453e-07]
obj_value=-3415.6244819361987
w=[4.93392141e-01 5.06605520e-01 5.74422156e-07 6.61097075e-08
 6.39522766e-07 6.52689222e-07 4.21140453e-07]
obj_value=-3415.6249912649123
w=[4.93392141e-01 5.06605520e-01 5.74422156e-07 6.61097075e-08
 6.24621604e-07 6.67590383e-07 4.21140453e-07]
obj_value=-3415.624956471294
w=[4.93392141e-01 5.06605520e-01 5.74422156e-07 6.61097075e-08
 6.24621604e-07 6.52689222e-07 4.36041614e-07]
obj_value=-3415.625493035339
w=[5.33099044e-01 4.66900998e-01 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 8.04098465e-09]
obj_value=-811.0060306757111
w=[5.08688620e-01 4.91309959e-01 3.53134787e-07 4.06419516e-08
 3.83995664e-07 4.01250660e-07 2.62000187e-07]
obj_value=-3924.993608987036
w=[5.08688635e-01 4.91309959e-01 3.53134787e-07 4.06419516e-08
 3.83995664e-07 4.01250660e-07 2.62000187e-07]
obj_value=-3924.9919818514986
w=[5.08688620e-01 4.91309973e-01 3.53134787e-07 4.06419516e-08
 3.83995664e-07 4.01250660e-07 2.62000187e-07]
obj_value=-3924.9951746327815
w=[5.08688620e-01 4.91309959e-01 3.68035948e-07 4.06419516e-08
 3.83995664e-07 4.01250660e-07 2.62000187e-07]
obj_value=-3924.9936407596574
w=[5.08688620e-01 4.91309959e-01 3.53134787e-07 5.55431128e-08
 3.83995664e-07 4.01250660e-07 2.62000187e-07]
obj_value=-3924.994393399168
w=[5.08688620e-01 4.91309959e-01 3.53134787e-07 4.06419516e-08
 3.98896825e-07 4.01250660e-07 2.62000187e-07]
obj_value=-3924.9945349162317
w=[5.08688620e-01 4.91309959e-01 3.53134787e-07 4.06419516e-08
 3.83995664e-07 4.16151821e-07 2.62000187e-07]
obj_value=-3924.99444053765
w=[5.08688620e-01 4.91309959e-01 3.53134787e-07 4.06419516e-08
 3.83995664e-07 4.01250660e-07 2.76901348e-07]
obj_value=-3924.9940116155967
w=[0.16738743 0.         0.00218782 0.         0.00299694 0.00243722
 0.83191614]
obj_value=-12.489239926826368
w=[3.92296710e-01 3.23761450e-01 7.46332888e-04 2.67820690e-08
 1.02228239e-03 8.31414296e-04 2.83703576e-01]
obj_value=-145.85150390512086
w=[4.83543136e-01 4.55112527e-01 1.61515724e-04 3.76476417e-08
 2.21156463e-04 1.79934560e-04 6.12919532e-02]
obj_value=-2001.8159028962075
w=[5.05615796e-01 4.86886567e-01 2.00474931e-05 4.02760415e-08
 2.73627883e-05 2.23405440e-05 7.49021691e-03]
obj_value=-3937.0676975592846
w=[5.05615811e-01 4.86886567e-01 2.00474931e-05 4.02760415e-08
 2.73627883e-05 2.23405440e-05 7.49021691e-03]
obj_value=-3937.0660713852517
w=[5.05615796e-01 4.86886582e-01 2.00474931e-05 4.02760415e-08
 2.73627883e-05 2.23405440e-05 7.49021691e-03]
obj_value=-3937.069263437029
w=[5.05615796e-01 4.86886567e-01 2.00623942e-05 4.02760415e-08
 2.73627883e-05 2.23405440e-05 7.49021691e-03]
obj_value=-3937.067723037347
w=[5.05615796e-01 4.86886567e-01 2.00474931e-05 5.51772027e-08
 2.73627883e-05 2.23405440e-05 7.49021691e-03]
obj_value=-3937.0684843961644
w=[5.05615796e-01 4.86886567e-01 2.00474931e-05 4.02760415e-08
 2.73776895e-05 2.23405440e-05 7.49021691e-03]
obj_value=-3937.0686424603005
w=[5.05615796e-01 4.86886567e-01 2.00474931e-05 4.02760415e-08
 2.73627883e-05 2.23554452e-05 7.49021691e-03]
obj_value=-3937.0685346243536
w=[5.05615796e-01 4.86886567e-01 2.00474931e-05 4.02760415e-08
 2.73627883e-05 2.23405440e-05 7.49023181e-03]
obj_value=-3937.067844693763
w=[3.04187939e-03 1.00000000e+00 0.00000000e+00 9.66432921e-04
 0.00000000e+00 0.00000000e+00 0.00000000e+00]
obj_value=-3.7463986293536222
w=[2.63595095e-01 7.33982703e-01 1.03933742e-05 4.65418636e-04
 1.41858983e-05 1.15821781e-05 3.88321009e-03]
obj_value=-16.46574178026382
w=[3.93255432e-01 6.01603250e-01 1.55654785e-05 2.16096514e-04
 2.12452944e-05 1.73458724e-05 5.81563040e-03]
obj_value=-80.05734663487989
w=[4.57216467e-01 5.36300883e-01 1.81168612e-05 9.31066974e-05
 2.47276722e-05 2.01890847e-05 6.76888724e-03]
obj_value=-466.4567077044879
w=[4.87468630e-01 5.05414300e-01 1.93236091e-05 3.49352195e-05
 2.63747603e-05 2.15338615e-05 7.21975676e-03]
obj_value=-2765.4718439552557
w=[4.98638759e-01 4.94009921e-01 1.97691815e-05 1.34563284e-05
 2.69829214e-05 2.20303990e-05 7.38623315e-03]
obj_value=-4762.59837834902
w=[4.98638773e-01 4.94009921e-01 1.97691815e-05 1.34563284e-05
 2.69829214e-05 2.20303990e-05 7.38623315e-03]
obj_value=-4762.598532534066
w=[4.98638759e-01 4.94009936e-01 1.97691815e-05 1.34563284e-05
 2.69829214e-05 2.20303990e-05 7.38623315e-03]
obj_value=-4762.598083480231
w=[4.98638759e-01 4.94009921e-01 1.97840827e-05 1.34563284e-05
 2.69829214e-05 2.20303990e-05 7.38623315e-03]
obj_value=-4762.598387412482
w=[4.98638759e-01 4.94009921e-01 1.97691815e-05 1.34712296e-05
 2.69829214e-05 2.20303990e-05 7.38623315e-03]
obj_value=-4762.5978333469975
w=[4.98638759e-01 4.94009921e-01 1.97691815e-05 1.34563284e-05
 2.69978225e-05 2.20303990e-05 7.38623315e-03]
obj_value=-4762.598437354108
w=[4.98638759e-01 4.94009921e-01 1.97691815e-05 1.34563284e-05
 2.69829214e-05 2.20453001e-05 7.38623315e-03]
obj_value=-4762.598314888079
w=[4.98638759e-01 4.94009921e-01 1.97691815e-05 1.34563284e-05
 2.69829214e-05 2.20303990e-05 7.38624805e-03]
obj_value=-4762.59808360775
w=[0.30912089 0.         0.00282425 0.         0.64808462 0.003109
 0.0438055 ]
obj_value=-53.14739597367348
w=[4.35893759e-01 3.30454616e-01 9.48268473e-04 9.00124803e-06
 2.14583938e-01 1.04405364e-03 1.94438127e-02]
obj_value=-569.3209720192428
w=[4.85199650e-01 4.58978644e-01 2.18640848e-04 1.25021120e-05
 4.59821061e-02 2.40933599e-04 9.96879940e-03]
obj_value=-3970.5383941272707
w=[4.95555613e-01 4.85973187e-01 6.53935137e-05 1.32374159e-05
 1.05698211e-02 7.22502843e-05 7.97871504e-03]
obj_value=-4835.905203561172
w=[4.95555628e-01 4.85973187e-01 6.53935137e-05 1.32374159e-05
 1.05698211e-02 7.22502843e-05 7.97871504e-03]
obj_value=-4835.905468320617
w=[4.95555613e-01 4.85973202e-01 6.53935137e-05 1.32374159e-05
 1.05698211e-02 7.22502843e-05 7.97871504e-03]
obj_value=-4835.904795625331
w=[4.95555613e-01 4.85973187e-01 6.54084149e-05 1.32374159e-05
 1.05698211e-02 7.22502843e-05 7.97871504e-03]
obj_value=-4835.905247619431
w=[4.95555613e-01 4.85973187e-01 6.53935137e-05 1.32523171e-05
 1.05698211e-02 7.22502843e-05 7.97871504e-03]
obj_value=-4835.904632351038
w=[4.95555613e-01 4.85973187e-01 6.53935137e-05 1.32374159e-05
 1.05698360e-02 7.22502843e-05 7.97871504e-03]
obj_value=-4835.904969388444
w=[4.95555613e-01 4.85973187e-01 6.53935137e-05 1.32374159e-05
 1.05698211e-02 7.22651854e-05 7.97871504e-03]
obj_value=-4835.905072332777
w=[4.95555613e-01 4.85973187e-01 6.53935137e-05 1.32374159e-05
 1.05698211e-02 7.22502843e-05 7.97872994e-03]
obj_value=-4835.904886509783
w=[5.65627206e-02 0.00000000e+00 8.18264728e-01 0.00000000e+00
 1.25394289e-01 6.51543167e-04 0.00000000e+00]
obj_value=-102.21340714356263
w=[3.70454011e-01 3.47483418e-01 2.33231008e-01 9.46509531e-06
 4.32918198e-02 2.37333749e-04 5.70498794e-03]
obj_value=-2680.2748241873414
w=[4.67184278e-01 4.54565599e-01 5.29441702e-02 1.23819051e-05
 1.79907235e-02 1.09688959e-04 7.46306479e-03]
obj_value=-5007.365439605331
w=[4.67184293e-01 4.54565599e-01 5.29441702e-02 1.23819051e-05
 1.79907235e-02 1.09688959e-04 7.46306479e-03]
obj_value=-5007.3659522526195
w=[4.67184278e-01 4.54565614e-01 5.29441702e-02 1.23819051e-05
 1.79907235e-02 1.09688959e-04 7.46306479e-03]
obj_value=-5007.364781087786
w=[4.67184278e-01 4.54565599e-01 5.29441851e-02 1.23819051e-05
 1.79907235e-02 1.09688959e-04 7.46306479e-03]
obj_value=-5007.365344410275
w=[4.67184278e-01 4.54565599e-01 5.29441702e-02 1.23968063e-05
 1.79907235e-02 1.09688959e-04 7.46306479e-03]
obj_value=-5007.364524147573
w=[4.67184278e-01 4.54565599e-01 5.29441702e-02 1.23819051e-05
 1.79907384e-02 1.09688959e-04 7.46306479e-03]
obj_value=-5007.365074600541
w=[4.67184278e-01 4.54565599e-01 5.29441702e-02 1.23819051e-05
 1.79907235e-02 1.09703860e-04 7.46306479e-03]
obj_value=-5007.365195795609
w=[4.67184278e-01 4.54565599e-01 5.29441702e-02 1.23819051e-05
 1.79907235e-02 1.09688959e-04 7.46307969e-03]
obj_value=-5007.365019715986
w=[3.18893526e-01 1.54191935e-05 3.88329883e-01 1.43293456e-05
 2.00789823e-06 0.00000000e+00 2.92771696e-01]
obj_value=-21.33383311046764
w=[4.29153466e-01 3.37991152e-01 1.38957565e-01 1.28813479e-05
 1.33773174e-02 8.15580063e-05 8.06336349e-02]
obj_value=-476.97533310166483
w=[4.62828315e-01 4.41213425e-01 6.27959505e-02 1.24391102e-05
 1.74623144e-02 1.06466903e-04 1.58438569e-02]
obj_value=-4617.524990892995
w=[4.66566979e-01 4.52673416e-01 5.43403003e-02 1.23900119e-05
 1.79158408e-02 1.09232351e-04 8.65073599e-03]
obj_value=-5017.768873074685
w=[4.66566994e-01 4.52673416e-01 5.43403003e-02 1.23900119e-05
 1.79158408e-02 1.09232351e-04 8.65073599e-03]
obj_value=-5017.769160774613
w=[4.66566979e-01 4.52673431e-01 5.43403003e-02 1.23900119e-05
 1.79158408e-02 1.09232351e-04 8.65073599e-03]
obj_value=-5017.768441400806
w=[4.66566979e-01 4.52673416e-01 5.43403152e-02 1.23900119e-05
 1.79158408e-02 1.09232351e-04 8.65073599e-03]
obj_value=-5017.768773028097
w=[4.66566979e-01 4.52673416e-01 5.43403003e-02 1.24049130e-05
 1.79158408e-02 1.09232351e-04 8.65073599e-03]
obj_value=-5017.7680984574445
w=[4.66566979e-01 4.52673416e-01 5.43403003e-02 1.23900119e-05
 1.79158557e-02 1.09232351e-04 8.65073599e-03]
obj_value=-5017.768635957997
w=[4.66566979e-01 4.52673416e-01 5.43403003e-02 1.23900119e-05
 1.79158408e-02 1.09247252e-04 8.65073599e-03]
obj_value=-5017.768744630278
w=[4.66566979e-01 4.52673416e-01 5.43403003e-02 1.23900119e-05
 1.79158408e-02 1.09232351e-04 8.65075089e-03]
obj_value=-5017.7684236832
w=[3.08946411e-01 1.36303179e-06 6.93837405e-02 1.11750950e-06
 1.63423762e-07 6.07173849e-01 1.44933560e-02]
obj_value=-407.18847636829275
w=[4.26171089e-01 3.36660064e-01 5.81957182e-02 9.50103124e-06
 1.33243097e-02 1.55691183e-01 1.01481157e-02]
obj_value=-3722.1810132665655
w=[4.56679043e-01 4.24276156e-01 5.52840133e-02 1.16828593e-05
 1.67919451e-02 3.81919279e-02 9.01725829e-03]
obj_value=-5157.957594989091
w=[4.56679058e-01 4.24276156e-01 5.52840133e-02 1.16828593e-05
 1.67919451e-02 3.81919279e-02 9.01725829e-03]
obj_value=-5157.957881692841
w=[4.56679043e-01 4.24276171e-01 5.52840133e-02 1.16828593e-05
 1.67919451e-02 3.81919279e-02 9.01725829e-03]
obj_value=-5157.957162625177
w=[4.56679043e-01 4.24276156e-01 5.52840282e-02 1.16828593e-05
 1.67919451e-02 3.81919279e-02 9.01725829e-03]
obj_value=-5157.9574938854
w=[4.56679043e-01 4.24276156e-01 5.52840133e-02 1.16977605e-05
 1.67919451e-02 3.81919279e-02 9.01725829e-03]
obj_value=-5157.9567563580795
w=[4.56679043e-01 4.24276156e-01 5.52840133e-02 1.16828593e-05
 1.67919601e-02 3.81919279e-02 9.01725829e-03]
obj_value=-5157.9573252228
w=[4.56679043e-01 4.24276156e-01 5.52840133e-02 1.16828593e-05
 1.67919451e-02 3.81919428e-02 9.01725829e-03]
obj_value=-5157.957331649878
w=[4.56679043e-01 4.24276156e-01 5.52840133e-02 1.16828593e-05
 1.67919451e-02 3.81919279e-02 9.01727319e-03]
obj_value=-5157.957133165725
w=[4.83441378e-01 4.29320366e-01 5.49093118e-05 0.00000000e+00
 6.14802720e-02 2.57440563e-02 1.44024882e-06]
obj_value=-3233.315755466611
w=[4.59355277e-01 4.24780577e-01 4.97611029e-02 1.05145734e-05
 2.12607778e-02 3.69471408e-02 8.11567649e-03]
obj_value=-5164.95454611005
w=[4.59355292e-01 4.24780577e-01 4.97611029e-02 1.05145734e-05
 2.12607778e-02 3.69471408e-02 8.11567649e-03]
obj_value=-5164.954666681556
w=[4.59355277e-01 4.24780592e-01 4.97611029e-02 1.05145734e-05
 2.12607778e-02 3.69471408e-02 8.11567649e-03]
obj_value=-5164.954281038056
w=[4.59355277e-01 4.24780577e-01 4.97611178e-02 1.05145734e-05
 2.12607778e-02 3.69471408e-02 8.11567649e-03]
obj_value=-5164.954486353938
w=[4.59355277e-01 4.24780577e-01 4.97611029e-02 1.05294746e-05
 2.12607778e-02 3.69471408e-02 8.11567649e-03]
obj_value=-5164.953869616256
w=[4.59355277e-01 4.24780577e-01 4.97611029e-02 1.05145734e-05
 2.12607927e-02 3.69471408e-02 8.11567649e-03]
obj_value=-5164.954210940536
w=[4.59355277e-01 4.24780577e-01 4.97611029e-02 1.05145734e-05
 2.12607778e-02 3.69471557e-02 8.11567649e-03]
obj_value=-5164.954360304
w=[4.59355277e-01 4.24780577e-01 4.97611029e-02 1.05145734e-05
 2.12607778e-02 3.69471408e-02 8.11569139e-03]
obj_value=-5164.954203378177
w=[4.77194974e-01 4.47401295e-01 4.54710759e-02 2.17065123e-04
 4.03590055e-06 2.97168865e-02 0.00000000e+00]
obj_value=-4360.903455816259
w=[4.62802684e-01 4.29151885e-01 4.89320827e-02 5.04291414e-05
 1.71530489e-02 3.55499405e-02 6.54737409e-03]
obj_value=-5207.546561377816
w=[4.62802699e-01 4.29151885e-01 4.89320827e-02 5.04291414e-05
 1.71530489e-02 3.55499405e-02 6.54737409e-03]
obj_value=-5207.546184406553
w=[4.62802684e-01 4.29151900e-01 4.89320827e-02 5.04291414e-05
 1.71530489e-02 3.55499405e-02 6.54737409e-03]
obj_value=-5207.546790690177
w=[4.62802684e-01 4.29151885e-01 4.89320976e-02 5.04291414e-05
 1.71530489e-02 3.55499405e-02 6.54737409e-03]
obj_value=-5207.546492952204
w=[4.62802684e-01 4.29151885e-01 4.89320827e-02 5.04440426e-05
 1.71530489e-02 3.55499405e-02 6.54737409e-03]
obj_value=-5207.546166834041
w=[4.62802684e-01 4.29151885e-01 4.89320827e-02 5.04291414e-05
 1.71530638e-02 3.55499405e-02 6.54737409e-03]
obj_value=-5207.546586635815
w=[4.62802684e-01 4.29151885e-01 4.89320827e-02 5.04291414e-05
 1.71530489e-02 3.55499554e-02 6.54737409e-03]
obj_value=-5207.546631347534
w=[4.62802684e-01 4.29151885e-01 4.89320827e-02 5.04291414e-05
 1.71530489e-02 3.55499405e-02 6.54738899e-03]
obj_value=-5207.546393488595
w=[0.46491672 0.43507319 0.04641051 0.         0.012875   0.04073163
 0.        ]
obj_value=-5178.937032585394
w=[4.63687455e-01 4.31630082e-01 4.78767509e-02 2.93234410e-05
 1.53625897e-02 3.77185924e-02 3.80715461e-03]
obj_value=-5237.010705041293
w=[4.63687470e-01 4.31630082e-01 4.78767509e-02 2.93234410e-05
 1.53625897e-02 3.77185924e-02 3.80715461e-03]
obj_value=-5237.010605027181
w=[4.63687455e-01 4.31630097e-01 4.78767509e-02 2.93234410e-05
 1.53625897e-02 3.77185924e-02 3.80715461e-03]
obj_value=-5237.010650287598
w=[4.63687455e-01 4.31630082e-01 4.78767658e-02 2.93234410e-05
 1.53625897e-02 3.77185924e-02 3.80715461e-03]
obj_value=-5237.010634441721
w=[4.63687455e-01 4.31630082e-01 4.78767509e-02 2.93383422e-05
 1.53625897e-02 3.77185924e-02 3.80715461e-03]
obj_value=-5237.010110972966
w=[4.63687455e-01 4.31630082e-01 4.78767509e-02 2.93234410e-05
 1.53626046e-02 3.77185924e-02 3.80715461e-03]
obj_value=-5237.010615151152
w=[4.63687455e-01 4.31630082e-01 4.78767509e-02 2.93234410e-05
 1.53625897e-02 3.77186073e-02 3.80715461e-03]
obj_value=-5237.010624113137
w=[4.63687455e-01 4.31630082e-01 4.78767509e-02 2.93234410e-05
 1.53625897e-02 3.77185924e-02 3.80716951e-03]
obj_value=-5237.010652597886
w=[4.71943855e-01 4.61260815e-01 2.51078466e-02 2.25779917e-04
 3.40618660e-05 2.09331661e-02 2.04944761e-02]
obj_value=-4140.09988320827
w=[4.64513095e-01 4.34593155e-01 4.55998605e-02 4.89690887e-05
 1.38297369e-02 3.60400497e-02 5.47588676e-03]
obj_value=-5228.238982802228
w=[4.63857810e-01 4.32241455e-01 4.74069583e-02 3.33769434e-05
 1.50463149e-02 3.73722573e-02 4.15146546e-03]
obj_value=-5237.62857613494
w=[4.63857825e-01 4.32241455e-01 4.74069583e-02 3.33769434e-05
 1.50463149e-02 3.73722573e-02 4.15146546e-03]
obj_value=-5237.628516857631
w=[4.63857810e-01 4.32241470e-01 4.74069583e-02 3.33769434e-05
 1.50463149e-02 3.73722573e-02 4.15146546e-03]
obj_value=-5237.628479993327
w=[4.63857810e-01 4.32241455e-01 4.74069732e-02 3.33769434e-05
 1.50463149e-02 3.73722573e-02 4.15146546e-03]
obj_value=-5237.6285047309075
w=[4.63857810e-01 4.32241455e-01 4.74069583e-02 3.33918445e-05
 1.50463149e-02 3.73722573e-02 4.15146546e-03]
obj_value=-5237.627954637077
w=[4.63857810e-01 4.32241455e-01 4.74069583e-02 3.33769434e-05
 1.50463298e-02 3.73722573e-02 4.15146546e-03]
obj_value=-5237.628474573624
w=[4.63857810e-01 4.32241455e-01 4.74069583e-02 3.33769434e-05
 1.50463149e-02 3.73722722e-02 4.15146546e-03]
obj_value=-5237.628476781939
w=[4.63857810e-01 4.32241455e-01 4.74069583e-02 3.33769434e-05
 1.50463149e-02 3.73722573e-02 4.15148036e-03]
obj_value=-5237.628492162076
w=[0.46336276 0.4339486  0.05068858 0.         0.01543802 0.03278216
 0.00400693]
obj_value=-5239.019329005207
w=[0.46336277 0.4339486  0.05068858 0.         0.01543802 0.03278216
 0.00400693]
obj_value=-5239.019291956325
w=[0.46336276 0.43394861 0.05068858 0.         0.01543802 0.03278216
 0.00400693]
obj_value=-5239.019209926316
w=[0.46336276 0.4339486  0.0506886  0.         0.01543802 0.03278216
 0.00400693]
obj_value=-5239.019245610272
w=[4.63362759e-01 4.33948597e-01 5.06885837e-02 1.49011612e-08
 1.54380225e-02 3.27821561e-02 4.00693233e-03]
obj_value=-5239.018689027595
w=[0.46336276 0.4339486  0.05068858 0.         0.01543804 0.03278216
 0.00400693]
obj_value=-5239.0192253908535
w=[0.46336276 0.4339486  0.05068858 0.         0.01543802 0.03278217
 0.00400693]
obj_value=-5239.019236125917
w=[0.46336276 0.4339486  0.05068858 0.         0.01543802 0.03278216
 0.00400695]
obj_value=-5239.019240050282
w=[0.46386945 0.43414776 0.04930264 0.         0.01469364 0.03459073
 0.00396874]
obj_value=-5236.93570803199
w=[0.46341343 0.43396851 0.05054999 0.         0.01536358 0.03296301
 0.00400311]
obj_value=-5238.911749514509
w=[0.46336783 0.43395059 0.05067472 0.         0.01543058 0.03280024
 0.00400655]
obj_value=-5239.009580537506
w=[0.46336327 0.4339488  0.0506872  0.         0.01543728 0.03278396
 0.00400689]
obj_value=-5239.018364254324
w=[0.46336281 0.43394862 0.05068845 0.         0.01543795 0.03278234
 0.00400693]
obj_value=-5239.019232630606
w=[0.46336276 0.4339486  0.05068857 0.         0.01543802 0.03278217
 0.00400693]
obj_value=-5239.0193193689265
w=[0.46336276 0.4339486  0.05068858 0.         0.01543802 0.03278216
 0.00400693]
obj_value=-5239.019328041414
w=[0.46336276 0.4339486  0.05068858 0.         0.01543802 0.03278216
 0.00400693]
obj_value=-5239.019328908593
w=[0.46336276 0.4339486  0.05068858 0.         0.01543802 0.03278216
 0.00400693]
obj_value=-5239.019328995538
w=[0.46336276 0.4339486  0.05068858 0.         0.01543802 0.03278216
 0.00400693]
obj_value=-5239.019329004164
w=[0.46336276 0.4339486  0.05068858 0.         0.01543802 0.03278216
 0.00400693]
obj_value=-5239.019329004904
w=[0.46336277 0.4339486  0.05068858 0.         0.01543802 0.03278216
 0.00400693]
obj_value=-5239.019291956707
w=[0.46336276 0.43394861 0.05068858 0.         0.01543802 0.03278216
 0.00400693]
obj_value=-5239.0192099256765
w=[0.46336276 0.4339486  0.0506886  0.         0.01543802 0.03278216
 0.00400693]
obj_value=-5239.019245609971
w=[4.63362759e-01 4.33948597e-01 5.06885837e-02 1.49011612e-08
 1.54380225e-02 3.27821561e-02 4.00693233e-03]
obj_value=-5239.018689027284
w=[0.46336276 0.4339486  0.05068858 0.         0.01543804 0.03278216
 0.00400693]
obj_value=-5239.019225390552
w=[0.46336276 0.4339486  0.05068858 0.         0.01543802 0.03278217
 0.00400693]
obj_value=-5239.019236125615
w=[0.46336276 0.4339486  0.05068858 0.         0.01543802 0.03278216
 0.00400695]
obj_value=-5239.019240049978
w=[0.99851172 0.         0.         0.00544793 0.         0.
 0.        ]
obj_value=-3.8013713921279364
w=[0.55016507 0.3635612  0.04246679 0.00088367 0.01293394 0.02746482
 0.003357  ]
obj_value=-133.13140326539184
w=[4.72042990e-01 4.26909858e-01 4.98664040e-02 8.83666281e-05
 1.51876145e-02 3.22504225e-02 3.94193903e-03]
obj_value=-3794.8183288699106
w=[4.64230782e-01 4.33244723e-01 5.06063657e-02 8.83666281e-06
 1.54129817e-02 3.27289827e-02 4.00043300e-03]
obj_value=-5222.79239824285
w=[4.63450048e-01 4.33877815e-01 5.06803158e-02 8.88622269e-07
 1.54355044e-02 3.27768089e-02 4.00627875e-03]
obj_value=-5239.224795526951
w=[4.63450063e-01 4.33877815e-01 5.06803158e-02 8.88622269e-07
 1.54355044e-02 3.27768089e-02 4.00627875e-03]
obj_value=-5239.224720645583
w=[4.63450048e-01 4.33877830e-01 5.06803158e-02 8.88622269e-07
 1.54355044e-02 3.27768089e-02 4.00627875e-03]
obj_value=-5239.224714589761
w=[4.63450048e-01 4.33877815e-01 5.06803307e-02 8.88622269e-07
 1.54355044e-02 3.27768089e-02 4.00627875e-03]
obj_value=-5239.224712532366
w=[4.63450048e-01 4.33877815e-01 5.06803158e-02 9.03523430e-07
 1.54355044e-02 3.27768089e-02 4.00627875e-03]
obj_value=-5239.224180262781
w=[4.63450048e-01 4.33877815e-01 5.06803158e-02 8.88622269e-07
 1.54355193e-02 3.27768089e-02 4.00627875e-03]
obj_value=-5239.224711454764
w=[4.63450048e-01 4.33877815e-01 5.06803158e-02 8.88622269e-07
 1.54355044e-02 3.27768238e-02 4.00627875e-03]
obj_value=-5239.224721661996
w=[4.63450048e-01 4.33877815e-01 5.06803158e-02 8.88622269e-07
 1.54355044e-02 3.27768089e-02 4.00629365e-03]
obj_value=-5239.224714125446
w=[0.33382013 0.00430857 0.00216175 0.         0.00194965 0.66766415
 0.00195209]
obj_value=-351.33752431484106
w=[4.50487056e-01 3.90920891e-01 4.58284590e-02 7.99760042e-07
 1.40869190e-02 9.62655428e-02 3.80085945e-03]
obj_value=-4756.996264858714
w=[4.62153749e-01 4.29582123e-01 5.01951301e-02 8.79736047e-07
 1.53006458e-02 3.91256823e-02 3.98573682e-03]
obj_value=-5235.803941483494
w=[4.63237941e-01 4.33174935e-01 5.06009275e-02 8.87168266e-07
 1.54134382e-02 3.38156401e-02 4.00291759e-03]
obj_value=-5239.400417172958
w=[4.63237956e-01 4.33174935e-01 5.06009275e-02 8.87168266e-07
 1.54134382e-02 3.38156401e-02 4.00291759e-03]
obj_value=-5239.40034523572
w=[4.63237941e-01 4.33174950e-01 5.06009275e-02 8.87168266e-07
 1.54134382e-02 3.38156401e-02 4.00291759e-03]
obj_value=-5239.400333522256
w=[4.63237941e-01 4.33174935e-01 5.06009424e-02 8.87168266e-07
 1.54134382e-02 3.38156401e-02 4.00291759e-03]
obj_value=-5239.400334735835
w=[4.63237941e-01 4.33174935e-01 5.06009275e-02 9.02069427e-07
 1.54134382e-02 3.38156401e-02 4.00291759e-03]
obj_value=-5239.399799635336
w=[4.63237941e-01 4.33174935e-01 5.06009275e-02 8.87168266e-07
 1.54134531e-02 3.38156401e-02 4.00291759e-03]
obj_value=-5239.400330093433
w=[4.63237941e-01 4.33174935e-01 5.06009275e-02 8.87168266e-07
 1.54134382e-02 3.38156550e-02 4.00291759e-03]
obj_value=-5239.400337935941
w=[4.63237941e-01 4.33174935e-01 5.06009275e-02 8.87168266e-07
 1.54134382e-02 3.38156401e-02 4.00293249e-03]
obj_value=-5239.400336774583
w=[0.99967486 0.         0.         0.00174882 0.         0.
 0.        ]
obj_value=-3.7633399256481685
w=[5.16881633e-01 3.89857441e-01 4.55408348e-02 1.75680579e-04
 1.38720944e-02 3.04340761e-02 3.60262583e-03]
obj_value=-332.0559074423346
w=[4.68602311e-01 4.28843185e-01 5.00949182e-02 1.83665093e-05
 1.52593038e-02 3.34774837e-02 3.96288841e-03]
obj_value=-4563.405836724649
w=[4.63774378e-01 4.32741760e-01 5.05503266e-02 2.63510237e-06
 1.53980248e-02 3.37818244e-02 3.99891467e-03]
obj_value=-5231.9516866647255
w=[4.63291585e-01 4.33131617e-01 5.05958674e-02 1.06196168e-06
 1.54118969e-02 3.38122585e-02 4.00251730e-03]
obj_value=-5239.3565101102595
w=[4.63249598e-01 4.33165522e-01 5.05998280e-02 9.25150168e-07
 1.54131033e-02 3.38149053e-02 4.00283061e-03]
obj_value=-5239.404143789439
w=[4.63249613e-01 4.33165522e-01 5.05998280e-02 9.25150168e-07
 1.54131033e-02 3.38149053e-02 4.00283061e-03]
obj_value=-5239.404066792895
w=[4.63249598e-01 4.33165537e-01 5.05998280e-02 9.25150168e-07
 1.54131033e-02 3.38149053e-02 4.00283061e-03]
obj_value=-5239.404065241496
w=[4.63249598e-01 4.33165522e-01 5.05998429e-02 9.25150168e-07
 1.54131033e-02 3.38149053e-02 4.00283061e-03]
obj_value=-5239.404061407015
w=[4.63249598e-01 4.33165522e-01 5.05998280e-02 9.40051329e-07
 1.54131033e-02 3.38149053e-02 4.00283061e-03]
obj_value=-5239.40352957779
w=[4.63249598e-01 4.33165522e-01 5.05998280e-02 9.25150168e-07
 1.54131182e-02 3.38149053e-02 4.00283061e-03]
obj_value=-5239.404059324278
w=[4.63249598e-01 4.33165522e-01 5.05998280e-02 9.25150168e-07
 1.54131033e-02 3.38149202e-02 4.00283061e-03]
obj_value=-5239.404067096714
w=[4.63249598e-01 4.33165522e-01 5.05998280e-02 9.25150168e-07
 1.54131033e-02 3.38149053e-02 4.00284551e-03]
obj_value=-5239.4040644022225
_make_output_weights = OrderedDict([('BX4.PA', 0.4632495979602476), ('LVC.PA', 0.433165522084656), ('OBLI.PA', 0.05059982798689332), ('LQQ.PA', 9.251501679931436e-07), ('STZ.PA', 0.015413103282930878), ('CAC.PA', 0.033814905282293126), ('SAN.PA', 0.0040028306088712865)])
opto from 2021-04-27 00:00:00 to 2021-11-14 00:00:00 done
{'weights': OrderedDict([('BX4.PA', 0.46325), ('LVC.PA', 0.43317), ('OBLI.PA', 0.0506), ('LQQ.PA', 0.0), ('STZ.PA', 0.01541), ('CAC.PA', 0.03381), ('SAN.PA', 0.004)]), 'expected_return': 0.1132027481879773, 'volatility': 0.006905230248222533, 'sharpe_ratio': 13.497413531137287}
--- 1.0575828552246094 seconds ---
max_diversification = {"weights": {"BX4.PA": 0.46325, "LVC.PA": 0.43317, "OBLI.PA": 0.0506, "LQQ.PA": 0.0, "STZ.PA": 0.01541, "CAC.PA": 0.03381, "SAN.PA": 0.004}, "expected_return": 0.1132027481879773, "volatility": 0.006905230248222533, "sharpe_ratio": 13.497413531137287}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 5}], 'data': [{'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0000120578   SAN  ...          BBB            4
1  FR0007052782   CAC  ...          BBB            4
2  FR0013346681  OBLI  ...          BBB            4
3  IE00BKWQ0G16   STZ  ...          BBB            4
4  FR0010342592   LQQ  ...          BBB            4

[5 rows x 20 columns] 
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['SAN.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date   open   high  ...  volume    code  converted_date
0    2021-04-27  61.85  61.96  ...   15259  CAC.PA    1.619474e+09
1    2021-04-28  62.07  62.33  ...   42911  CAC.PA    1.619561e+09
2    2021-04-29  62.49  62.63  ...  421296  CAC.PA    1.619647e+09
3    2021-04-30  62.28  62.34  ...   38586  CAC.PA    1.619734e+09
4    2021-05-03  61.99  62.27  ...   23231  CAC.PA    1.619993e+09
..          ...    ...    ...  ...     ...     ...             ...
690  2021-11-01  62.54  63.27  ...    4444  STZ.PA    1.635721e+09
691  2021-11-02  62.93  63.04  ...    3303  STZ.PA    1.635808e+09
692  2021-11-03  62.85  63.26  ...  297542  STZ.PA    1.635894e+09
693  2021-11-04  63.74  63.74  ...    6536  STZ.PA    1.635980e+09
694  2021-11-05  62.44  63.24  ...    5383  STZ.PA    1.636067e+09

[695 rows x 9 columns]
 max_diversification cov =           OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA
OBLI.PA  0.001107  0.001840 -0.000955  0.000239  0.000640
LQQ.PA   0.001840  0.085409  0.022117  0.023811  0.009105
STZ.PA  -0.000955  0.022117  0.027707  0.018931  0.005820
CAC.PA   0.000239  0.023811  0.018931  0.019121  0.006685
SAN.PA   0.000640  0.009105  0.005820  0.006685  0.022572
 df_full  =             OBLI.PA  LQQ.PA  STZ.PA   CAC.PA   SAN.PA
2021-04-27   10.842   655.4   55.19  60.8151  82.2534
2021-04-28   10.826   650.5   55.77  61.1296  84.2472
2021-04-29   10.792   648.4   56.03  61.1198  83.6404
2021-04-30   10.786   650.7   55.86  60.7463  84.0545
2021-05-03   10.792   642.1   56.14  61.1100  83.4959
...             ...     ...     ...      ...      ...
2021-11-01   10.756   873.4   63.17  67.8700  88.3000
2021-11-02   10.826   882.3   63.04  68.2100  89.6100
2021-11-03   10.834   887.9   63.17  68.4500  90.2400
2021-11-04   10.876   925.2   62.52  68.7800  89.6900
2021-11-05   10.922   938.3   62.93  69.3100  88.4600

[139 rows x 5 columns]
expected_returns [0.01455338 1.14692491 0.30828684 0.29031185 0.14822153]
w=[0.2 0.2 0.2 0.2 0.2]
obj_value=-11.740834217866631
w=[0.20000001 0.2        0.2        0.2        0.2       ]
obj_value=-11.74083424004268
w=[0.2        0.20000001 0.2        0.2        0.2       ]
obj_value=-11.740833796497746
w=[0.2        0.2        0.20000001 0.2        0.2       ]
obj_value=-11.740834016922898
w=[0.2        0.2        0.2        0.20000001 0.2       ]
obj_value=-11.740834010779814
w=[0.2        0.2        0.2        0.2        0.20000001]
obj_value=-11.7408341503297
w=[1.00000000e+00 6.18727292e-13 2.73669976e-14 4.60187444e-14
 0.00000000e+00]
obj_value=-30.06051762771869
w=[9.99999985e-01 6.18727292e-13 2.73669976e-14 4.60187444e-14
 0.00000000e+00]
obj_value=-30.060518075655313
w=[1.00000000e+00 1.49017799e-08 2.73669976e-14 4.60187444e-14
 0.00000000e+00]
obj_value=-30.06052007343811
w=[1.00000000e+00 6.18727292e-13 1.49011886e-08 4.60187444e-14
 0.00000000e+00]
obj_value=-30.060520642554618
w=[1.00000000e+00 6.18727292e-13 2.73669976e-14 1.49012072e-08
 0.00000000e+00]
obj_value=-30.060519295844273
w=[1.00000000e+00 6.18727292e-13 2.73669976e-14 4.60187444e-14
 1.49011612e-08]
obj_value=-30.060519132733027
w=[0.         0.         0.04449943 0.         0.95550057]
obj_value=-7.135154813541534
w=[5.72322278e-01 3.54111413e-13 1.90314144e-02 2.63375526e-14
 4.08646307e-01]
obj_value=-18.53363002911345
w=[8.21623819e-01 5.08361080e-13 7.93763823e-03 3.78100965e-14
 1.70438543e-01]
obj_value=-34.19080511356801
w=[8.21623834e-01 5.08361080e-13 7.93763823e-03 3.78100965e-14
 1.70438543e-01]
obj_value=-34.19080477696847
w=[8.21623819e-01 1.49016696e-08 7.93763823e-03 3.78100965e-14
 1.70438543e-01]
obj_value=-34.190805777926435
w=[8.21623819e-01 5.08361080e-13 7.93765313e-03 3.78100965e-14
 1.70438543e-01]
obj_value=-34.19080640244176
w=[8.21623819e-01 5.08361080e-13 7.93763823e-03 1.49011990e-08
 1.70438543e-01]
obj_value=-34.19080545758269
w=[8.21623819e-01 5.08361080e-13 7.93763823e-03 3.78100965e-14
 1.70438558e-01]
obj_value=-34.19080368692411
w=[4.57444852e-01 0.00000000e+00 5.42555148e-01 0.00000000e+00
 6.87535029e-11]
obj_value=-13.335469782681619
w=[6.80973512e-01 3.12025904e-13 2.14413364e-01 2.32073815e-14
 1.04613123e-01]
obj_value=-35.14594799147381
w=[7.48752708e-01 4.06639564e-13 1.14912986e-01 3.02444104e-14
 1.36334306e-01]
obj_value=-41.50705085253883
w=[7.48752723e-01 4.06639564e-13 1.14912986e-01 3.02444104e-14
 1.36334306e-01]
obj_value=-41.5070505299912
w=[7.48752708e-01 1.49015678e-08 1.14912986e-01 3.02444104e-14
 1.36334306e-01]
obj_value=-41.507049547383886
w=[7.48752708e-01 4.06639564e-13 1.14913001e-01 3.02444104e-14
 1.36334306e-01]
obj_value=-41.507049852328755
w=[7.48752708e-01 4.06639564e-13 1.14912986e-01 1.49011914e-08
 1.36334306e-01]
obj_value=-41.507049578983455
w=[7.48752708e-01 4.06639564e-13 1.14912986e-01 3.02444104e-14
 1.36334320e-01]
obj_value=-41.50704893036874
w=[0.88296729 0.         0.11703271 0.         0.        ]
obj_value=-46.75881006129629
w=[0.8829673  0.         0.11703271 0.         0.        ]
obj_value=-46.75880938162641
w=[8.82967285e-01 1.49011612e-08 1.17032715e-01 0.00000000e+00
 0.00000000e+00]
obj_value=-46.758808610228755
w=[0.88296729 0.         0.11703273 0.         0.        ]
obj_value=-46.75880923559278
w=[8.82967285e-01 0.00000000e+00 1.17032715e-01 1.49011612e-08
 0.00000000e+00]
obj_value=-46.75880879652264
w=[8.82967285e-01 0.00000000e+00 1.17032715e-01 0.00000000e+00
 1.49011612e-08]
obj_value=-46.758810542025884
w=[0.8637808  0.         0.06966374 0.         0.06655546]
obj_value=-46.91960779389826
w=[0.87309288 0.         0.09265406 0.         0.03425306]
obj_value=-48.236073491182474
w=[0.87309289 0.         0.09265406 0.         0.03425306]
obj_value=-48.23607271582358
w=[8.73092875e-01 1.49011612e-08 9.26540624e-02 0.00000000e+00
 3.42530625e-02]
obj_value=-48.2360721799593
w=[0.87309288 0.         0.09265408 0.         0.03425306]
obj_value=-48.236073201991836
w=[8.73092875e-01 0.00000000e+00 9.26540624e-02 1.49011612e-08
 3.42530625e-02]
obj_value=-48.23607243082941
w=[0.87309288 0.         0.09265406 0.         0.03425308]
obj_value=-48.23607305272484
w=[0.80838699 0.         0.12947305 0.         0.06213996]
obj_value=-46.8710881185562
w=[0.85455439 0.         0.10320285 0.         0.04224277]
obj_value=-48.46651627496939
w=[0.8545544  0.         0.10320285 0.         0.04224277]
obj_value=-48.466515559562694
w=[8.54554386e-01 1.49011612e-08 1.03202847e-01 0.00000000e+00
 4.22427671e-02]
obj_value=-48.46651462494649
w=[0.85455439 0.         0.10320286 0.         0.04224277]
obj_value=-48.46651550473616
w=[8.54554386e-01 0.00000000e+00 1.03202847e-01 1.49011612e-08
 4.22427671e-02]
obj_value=-48.466514908407746
w=[0.85455439 0.         0.10320285 0.         0.04224278]
obj_value=-48.466515532518024
w=[8.56173941e-01 7.27488209e-12 1.02044965e-01 4.92329430e-12
 4.17810940e-02]
obj_value=-48.46919687474686
w=[8.56173956e-01 7.27488209e-12 1.02044965e-01 4.92329430e-12
 4.17810940e-02]
obj_value=-48.46919615283398
w=[8.56173941e-01 1.49084361e-08 1.02044965e-01 4.92329430e-12
 4.17810940e-02]
obj_value=-48.46919525398191
w=[8.56173941e-01 7.27488209e-12 1.02044980e-01 4.92329430e-12
 4.17810940e-02]
obj_value=-48.46919615033786
w=[8.56173941e-01 7.27488209e-12 1.02044965e-01 1.49060845e-08
 4.17810940e-02]
obj_value=-48.469195535737214
w=[8.56173941e-01 7.27488209e-12 1.02044965e-01 4.92329430e-12
 4.17811089e-02]
obj_value=-48.469196150925306
w=[8.56270658e-01 5.87762972e-12 1.01995679e-01 3.91428703e-12
 4.17336635e-02]
obj_value=-48.46920399298627
w=[8.56270673e-01 5.87762972e-12 1.01995679e-01 3.91428703e-12
 4.17336635e-02]
obj_value=-48.46920327073658
w=[8.56270658e-01 1.49070388e-08 1.01995679e-01 3.91428703e-12
 4.17336635e-02]
obj_value=-48.469202373659684
w=[8.56270658e-01 5.87762972e-12 1.01995693e-01 3.91428703e-12
 4.17336635e-02]
obj_value=-48.46920327075394
w=[8.56270658e-01 5.87762972e-12 1.01995679e-01 1.49050755e-08
 4.17336635e-02]
obj_value=-48.46920265532297
w=[8.56270658e-01 5.87762972e-12 1.01995679e-01 3.91428703e-12
 4.17336784e-02]
obj_value=-48.469203270748075
_make_output_weights = OrderedDict([('OBLI.PA', 0.8562706579294586), ('LQQ.PA', 5.877629715670286e-12), ('STZ.PA', 0.10199567853620292), ('CAC.PA', 3.914287026018232e-12), ('SAN.PA', 0.04173366352454665)])
opto from 2021-04-27 00:00:00 to 2021-11-14 00:00:00 done
{'weights': OrderedDict([('OBLI.PA', 0.85627), ('LQQ.PA', 0.0), ('STZ.PA', 0.102), ('CAC.PA', 0.0), ('SAN.PA', 0.04173)]), 'expected_return': 0.05009138706605099, 'volatility': 0.032669993141063926, 'sharpe_ratio': 0.9210711167315244}
--- 0.8649380207061768 seconds ---
max_diversification = {"weights": {"OBLI.PA": 0.85627, "LQQ.PA": 0.0, "STZ.PA": 0.102, "CAC.PA": 0.0, "SAN.PA": 0.04173}, "expected_return": 0.05009138706605099, "volatility": 0.032669993141063926, "sharpe_ratio": 0.9210711167315244}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 6}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            5
1  FR0000120578   SAN  ...          BBB            5
2  FR0007052782   CAC  ...          BBB            5
3  FR0013346681  OBLI  ...          BBB            5
4  IE00BKWQ0G16   STZ  ...          BBB            5
5  FR0010342592   LQQ  ...          BBB            5

[6 rows x 20 columns] 
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
829  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
830  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
831  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
832  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
833  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[834 rows x 9 columns]
 max_diversification cov =            BX4.PA   OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA
BX4.PA   0.071251 -0.000744 -0.046688 -0.036749 -0.035772 -0.014192
OBLI.PA -0.000744  0.001107  0.001840 -0.000955  0.000239  0.000640
LQQ.PA  -0.046688  0.001840  0.085409  0.022117  0.023811  0.009105
STZ.PA  -0.036749 -0.000955  0.022117  0.027707  0.018931  0.005820
CAC.PA  -0.035772  0.000239  0.023811  0.018931  0.019121  0.006685
SAN.PA  -0.014192  0.000640  0.009105  0.005820  0.006685  0.022572
 df_full  =             BX4.PA  OBLI.PA  LQQ.PA  STZ.PA   CAC.PA   SAN.PA
2021-04-27  1.7336   10.842   655.4   55.19  60.8151  82.2534
2021-04-28  1.7146   10.826   650.5   55.77  61.1296  84.2472
2021-04-29  1.7188   10.792   648.4   56.03  61.1198  83.6404
2021-04-30  1.7350   10.786   650.7   55.86  60.7463  84.0545
2021-05-03  1.7154   10.792   642.1   56.14  61.1100  83.4959
...            ...      ...     ...     ...      ...      ...
2021-11-01  1.3300   10.756   873.4   63.17  67.8700  88.3000
2021-11-02  1.3174   10.826   882.3   63.04  68.2100  89.6100
2021-11-03  1.3068   10.834   887.9   63.17  68.4500  90.2400
2021-11-04  1.2938   10.876   925.2   62.52  68.7800  89.6900
2021-11-05  1.2740   10.922   938.3   62.93  69.3100  88.4600

[139 rows x 6 columns]
expected_returns [-0.41817932  0.01455338  1.14692491  0.30828684  0.29031185  0.14822153]
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.43335106803055
w=[0.16666668 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433355984307845
w=[0.16666667 0.16666668 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433351069408694
w=[0.16666667 0.16666667 0.16666668 0.16666667 0.16666667 0.16666667]
obj_value=-46.43334636196783
w=[0.16666667 0.16666667 0.16666667 0.16666668 0.16666667 0.16666667]
obj_value=-46.43334946585318
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666668 0.16666667]
obj_value=-46.43334959070002
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666668]
obj_value=-46.433349784481216
w=[9.99999991e-01 0.00000000e+00 6.09079026e-09 1.37648126e-09
 1.18741994e-09 8.92885765e-10]
obj_value=-3.7463295452602385
w=[0.5408887  0.09182226 0.09182226 0.09182226 0.09182226 0.09182226]
obj_value=-20.92878635580864
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125849080727
w=[0.32924391 0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125152704742
w=[0.3292439  0.13415124 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125852413885
w=[0.3292439  0.13415122 0.13415124 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125464381268
w=[0.3292439  0.13415122 0.13415122 0.13415124 0.13415122 0.13415122]
obj_value=-103.79126353344603
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415124 0.13415122]
obj_value=-103.79126385167301
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415124]
obj_value=-103.79125746308361
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72189866217366
w=[3.84814011e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7218614927882
w=[3.84813996e-01 1.49011612e-08 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72190031816828
w=[3.84813996e-01 0.00000000e+00 2.03185568e-08 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7219294355354
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 1.49011612e-08
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72192087222
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15186014e-01 1.30681538e-09]
obj_value=-220.7219165661703
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.62079766e-08]
obj_value=-220.7219117212818
w=[0.24335099 0.         0.         0.         0.75664914 0.        ]
obj_value=-85.07993007641804
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391798622954
w=[3.28652739e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391989089929
w=[3.28652724e-01 1.49011612e-08 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391824098968
w=[3.28652724e-01 0.00000000e+00 1.81678332e-08 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391757532829
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 1.49011612e-08
 6.71347325e-01 7.88005434e-10]
obj_value=-341.53917239503346
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347339e-01 7.88005434e-10]
obj_value=-341.5391629573594
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 1.56891666e-08]
obj_value=-341.53918748941953
w=[2.41513932e-02 0.00000000e+00 3.53442515e-08 0.00000000e+00
 5.40064390e-06 9.75848421e-01]
obj_value=-7.334855562356588
w=[2.18590455e-01 0.00000000e+00 1.48611409e-08 0.00000000e+00
 4.28690205e-01 3.52721256e-01]
obj_value=-59.74596536608329
w=[2.99599867e-01 0.00000000e+00 6.32723438e-09 0.00000000e+00
 6.07293744e-01 9.31069311e-02]
obj_value=-301.3908897519344
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604648394507
w=[3.18854957e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66049305395285
w=[3.18854942e-01 1.49011612e-08 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66046710925406
w=[3.18854942e-01 0.00000000e+00 1.91999769e-08 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66045520097725
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 1.49011612e-08
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604536902379
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745918e-01 3.13993704e-02]
obj_value=-355.6604431572319
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993853e-02]
obj_value=-355.6604582100579
w=[4.07558797e-01 4.90098775e-07 5.01929187e-01 6.27447994e-07
 0.00000000e+00 9.05118670e-02]
obj_value=-18.927688594393825
w=[3.49619359e-01 1.69976864e-07 1.74079910e-01 2.17612546e-07
 4.24399960e-01 5.19008638e-02]
obj_value=-107.16187753705387
w=[3.26784841e-01 4.38135799e-08 4.48711925e-02 5.60922496e-08
 5.91660277e-01 3.66838768e-02]
obj_value=-343.04301198854245
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586999029359
w=[3.22200567e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1587251232327
w=[3.22200552e-01 3.33860342e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.15870165295433
w=[3.22200552e-01 1.84848730e-08 1.89310953e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586692749749
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 3.85663835e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586913060794
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239694e-01 3.36288944e-02]
obj_value=-370.15867941448994
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36289093e-02]
obj_value=-370.1586924158286
w=[6.61927269e-01 1.30124926e-06 1.15132082e-07 1.69137184e-06
 0.00000000e+00 3.38072114e-01]
obj_value=-8.288159802597914
w=[4.55529337e-01 5.21917214e-07 1.15014539e-02 6.78171580e-07
 3.79858781e-01 1.53110355e-01]
obj_value=-47.13199693309657
w=[3.63268724e-01 1.73553005e-07 1.66425935e-02 2.25267444e-07
 5.49657015e-01 7.04317883e-02]
obj_value=-264.0275093735188
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.80875658170476
w=[3.34534804e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087453767497
w=[3.34534789e-01 7.99585233e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087586737291
w=[3.34534789e-01 6.50573621e-08 1.82437811e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087487095439
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 9.91147190e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087673439772
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539525e-01 4.46821157e-02]
obj_value=-390.80875385652433
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821306e-02]
obj_value=-390.80875010443333
w=[3.28103352e-01 6.42061772e-07 5.06958166e-08 5.81028523e-01
 0.00000000e+00 9.08687718e-02]
obj_value=-66.70623845422602
w=[3.32547615e-01 2.43339105e-07 1.26068571e-02 1.79525164e-01
 4.16367980e-01 5.89527822e-02]
obj_value=-323.99255855266296
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654085512645
w=[3.33831381e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465275938523
w=[3.33831366e-01 1.43066968e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654531333374
w=[3.33831366e-01 1.28165807e-07 1.62484193e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465383365334
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486625e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465379800735
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638241e-01 4.97336681e-02]
obj_value=-419.24653869101655
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336830e-02]
obj_value=-419.24653210317666
w=[8.97439784e-02 7.59992965e-01 0.00000000e+00 1.50262800e-01
 2.66692769e-07 1.20788494e-09]
obj_value=-140.66001082485298
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160917182303
w=[0.253436   0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160675720134
w=[0.25343599 0.25031996 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160856484672
w=[0.25343599 0.25031994 0.01089666 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160789754363
w=[0.25343599 0.25031994 0.01089665 0.09210981 0.35988509 0.03335283]
obj_value=-556.3160856689376
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988511 0.03335283]
obj_value=-556.316093117244
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335284]
obj_value=-556.3160779773442
w=[1.91523888e-01 3.85966267e-01 1.22455771e-10 5.66267866e-11
 4.22509844e-01 8.17981169e-11]
obj_value=-330.19096471283507
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.563526438129
w=[0.24222354 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635289001531
w=[0.24222353 0.27488591 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635168394884
w=[0.24222353 0.27488589 0.00892325 0.07542844 0.37122662 0.02731253]
obj_value=-565.5634962842352
w=[0.24222353 0.27488589 0.00892323 0.07542846 0.37122662 0.02731253]
obj_value=-565.563515702558
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122664 0.02731253]
obj_value=-565.5635132307353
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731255]
obj_value=-565.5635116602341
w=[0.25141205 0.27285732 0.         0.0894487  0.38628193 0.        ]
obj_value=-535.1289924747424
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241992856902
w=[0.24427361 0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241956518582
w=[0.2442736  0.27443331 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241903730222
w=[0.2442736  0.27443329 0.00693236 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241802914074
w=[0.2442736  0.27443329 0.00693235 0.07855655 0.37458565 0.02121877]
obj_value=-568.2241886806165
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458566 0.02121877]
obj_value=-568.2241884586826
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121878]
obj_value=-568.2241939499611
w=[3.08489744e-01 9.30915116e-02 2.51159076e-12 7.05345993e-02
 4.64289820e-01 6.35943256e-02]
obj_value=-429.5232279770569
w=[0.25069521 0.25629912 0.00623911 0.07775434 0.38355606 0.02545632]
obj_value=-568.4776965740791
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.963958936339
w=[0.24781715 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639497680903
w=[0.24781714 0.26442661 0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639508353928
w=[0.24781714 0.2644266  0.00654983 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639458255937
w=[0.24781714 0.2644266  0.00654981 0.07811389 0.37953565 0.02355711]
obj_value=-568.9639506507142
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953566 0.02355711]
obj_value=-568.9639505841747
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355712]
obj_value=-568.9639521000439
w=[2.37506192e-01 2.87829035e-01 2.73995496e-12 8.11890305e-02
 3.65376119e-01 2.80996241e-02]
obj_value=-564.4202412710298
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.35749177576
w=[0.24556415 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574842278006
w=[0.24556414 0.26954018 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574833417131
w=[0.24556414 0.26954016 0.00511866 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574823714773
w=[0.24556414 0.26954016 0.00511864 0.07878583 0.37644171 0.02454967]
obj_value=-569.357482608173
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644173 0.02454967]
obj_value=-569.3574828184998
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454969]
obj_value=-569.3574830188323
w=[0.24610453 0.26907775 0.0044456  0.07691659 0.37974948 0.02370605]
obj_value=-569.2450065184668
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642348343279
w=[0.24566809 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642268672174
w=[0.24566807 0.26945124 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642264009754
w=[0.24566807 0.26945123 0.00498921 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642261194806
w=[0.24566807 0.26945123 0.00498919 0.07842631 0.37707791 0.02438742]
obj_value=-569.3642260299339
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707792 0.02438742]
obj_value=-569.3642260460759
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438743]
obj_value=-569.3642263574668
w=[0.23397821 0.31770151 0.0082876  0.07410712 0.33822207 0.02770349]
obj_value=-546.5637995563353
w=[0.24449909 0.27427625 0.00531903 0.07799438 0.37319233 0.02471902]
obj_value=-569.1896789892905
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368032085926
w=[0.24551943 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.3680237079865
w=[0.24551942 0.27006482 0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023592652
w=[0.24551942 0.2700648  0.00503115 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023429162
w=[0.24551942 0.2700648  0.00503114 0.07837139 0.3765838  0.02442959]
obj_value=-569.3680235986387
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.37658381 0.02442959]
obj_value=-569.3680235425043
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.0244296 ]
obj_value=-569.3680235900935
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683939873064
w=[0.24553014 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683854605621
w=[0.24553013 0.27008818 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855065983
w=[0.24553013 0.27008817 0.00500255 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855508764
w=[0.24553013 0.27008817 0.00500253 0.07850139 0.37644477 0.02443303]
obj_value=-569.3683855037883
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644479 0.02443303]
obj_value=-569.3683855260334
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443304]
obj_value=-569.368385524223
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684405257682
w=[0.24552476 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320418271
w=[0.24552475 0.27008134 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320414714
w=[0.24552475 0.27008133 0.00500642 0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320420189
w=[0.24552475 0.27008133 0.0050064  0.07846408 0.37648212 0.02444134]
obj_value=-569.3684320414642
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648213 0.02444134]
obj_value=-569.3684320413632
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444135]
obj_value=-569.368432040818
_make_output_weights = OrderedDict([('BX4.PA', 0.24552474657212184), ('OBLI.PA', 0.2700813300052892), ('LQQ.PA', 0.005006401592221771), ('STZ.PA', 0.07846406610149567), ('CAC.PA', 0.3764821169666443), ('SAN.PA', 0.024441338762227212)])
opto from 2021-04-27 00:00:00 to 2021-11-14 00:00:00 done
{'weights': OrderedDict([('BX4.PA', 0.24552), ('OBLI.PA', 0.27008), ('LQQ.PA', 0.00501), ('STZ.PA', 0.07846), ('CAC.PA', 0.37648), ('SAN.PA', 0.02444)]), 'expected_return': 0.04410858385753515, 'volatility': 0.015946072643852546, 'sharpe_ratio': 1.5118822293105112}
--- 0.8066189289093018 seconds ---
max_diversification = {"weights": {"BX4.PA": 0.24552, "OBLI.PA": 0.27008, "LQQ.PA": 0.00501, "STZ.PA": 0.07846, "CAC.PA": 0.37648, "SAN.PA": 0.02444}, "expected_return": 0.04410858385753515, "volatility": 0.015946072643852546, "sharpe_ratio": 1.5118822293105112}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 6}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            5
1  FR0000120578   SAN  ...          BBB            5
2  FR0007052782   CAC  ...          BBB            5
3  FR0013346681  OBLI  ...          BBB            5
4  IE00BKWQ0G16   STZ  ...          BBB            5
5  FR0010342592   LQQ  ...          BBB            5

[6 rows x 20 columns] 
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
829  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
830  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
831  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
832  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
833  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[834 rows x 9 columns]
 max_diversification cov =            BX4.PA   OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA
BX4.PA   0.071251 -0.000744 -0.046688 -0.036749 -0.035772 -0.014192
OBLI.PA -0.000744  0.001107  0.001840 -0.000955  0.000239  0.000640
LQQ.PA  -0.046688  0.001840  0.085409  0.022117  0.023811  0.009105
STZ.PA  -0.036749 -0.000955  0.022117  0.027707  0.018931  0.005820
CAC.PA  -0.035772  0.000239  0.023811  0.018931  0.019121  0.006685
SAN.PA  -0.014192  0.000640  0.009105  0.005820  0.006685  0.022572
 df_full  =             BX4.PA  OBLI.PA  LQQ.PA  STZ.PA   CAC.PA   SAN.PA
2021-04-27  1.7336   10.842   655.4   55.19  60.8151  82.2534
2021-04-28  1.7146   10.826   650.5   55.77  61.1296  84.2472
2021-04-29  1.7188   10.792   648.4   56.03  61.1198  83.6404
2021-04-30  1.7350   10.786   650.7   55.86  60.7463  84.0545
2021-05-03  1.7154   10.792   642.1   56.14  61.1100  83.4959
...            ...      ...     ...     ...      ...      ...
2021-11-01  1.3300   10.756   873.4   63.17  67.8700  88.3000
2021-11-02  1.3174   10.826   882.3   63.04  68.2100  89.6100
2021-11-03  1.3068   10.834   887.9   63.17  68.4500  90.2400
2021-11-04  1.2938   10.876   925.2   62.52  68.7800  89.6900
2021-11-05  1.2740   10.922   938.3   62.93  69.3100  88.4600

[139 rows x 6 columns]
expected_returns [-0.41817932  0.01455338  1.14692491  0.30828684  0.29031185  0.14822153]
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.43335106803055
w=[0.16666668 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433355984307845
w=[0.16666667 0.16666668 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433351069408694
w=[0.16666667 0.16666667 0.16666668 0.16666667 0.16666667 0.16666667]
obj_value=-46.43334636196783
w=[0.16666667 0.16666667 0.16666667 0.16666668 0.16666667 0.16666667]
obj_value=-46.43334946585318
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666668 0.16666667]
obj_value=-46.43334959070002
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666668]
obj_value=-46.433349784481216
w=[9.99999991e-01 0.00000000e+00 6.09079026e-09 1.37648126e-09
 1.18741994e-09 8.92885765e-10]
obj_value=-3.7463295452602385
w=[0.5408887  0.09182226 0.09182226 0.09182226 0.09182226 0.09182226]
obj_value=-20.92878635580864
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125849080727
w=[0.32924391 0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125152704742
w=[0.3292439  0.13415124 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125852413885
w=[0.3292439  0.13415122 0.13415124 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125464381268
w=[0.3292439  0.13415122 0.13415122 0.13415124 0.13415122 0.13415122]
obj_value=-103.79126353344603
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415124 0.13415122]
obj_value=-103.79126385167301
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415124]
obj_value=-103.79125746308361
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72189866217366
w=[3.84814011e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7218614927882
w=[3.84813996e-01 1.49011612e-08 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72190031816828
w=[3.84813996e-01 0.00000000e+00 2.03185568e-08 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7219294355354
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 1.49011612e-08
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72192087222
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15186014e-01 1.30681538e-09]
obj_value=-220.7219165661703
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.62079766e-08]
obj_value=-220.7219117212818
w=[0.24335099 0.         0.         0.         0.75664914 0.        ]
obj_value=-85.07993007641804
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391798622954
w=[3.28652739e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391989089929
w=[3.28652724e-01 1.49011612e-08 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391824098968
w=[3.28652724e-01 0.00000000e+00 1.81678332e-08 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391757532829
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 1.49011612e-08
 6.71347325e-01 7.88005434e-10]
obj_value=-341.53917239503346
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347339e-01 7.88005434e-10]
obj_value=-341.5391629573594
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 1.56891666e-08]
obj_value=-341.53918748941953
w=[2.41513932e-02 0.00000000e+00 3.53442515e-08 0.00000000e+00
 5.40064390e-06 9.75848421e-01]
obj_value=-7.334855562356588
w=[2.18590455e-01 0.00000000e+00 1.48611409e-08 0.00000000e+00
 4.28690205e-01 3.52721256e-01]
obj_value=-59.74596536608329
w=[2.99599867e-01 0.00000000e+00 6.32723438e-09 0.00000000e+00
 6.07293744e-01 9.31069311e-02]
obj_value=-301.3908897519344
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604648394507
w=[3.18854957e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66049305395285
w=[3.18854942e-01 1.49011612e-08 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66046710925406
w=[3.18854942e-01 0.00000000e+00 1.91999769e-08 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66045520097725
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 1.49011612e-08
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604536902379
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745918e-01 3.13993704e-02]
obj_value=-355.6604431572319
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993853e-02]
obj_value=-355.6604582100579
w=[4.07558797e-01 4.90098775e-07 5.01929187e-01 6.27447994e-07
 0.00000000e+00 9.05118670e-02]
obj_value=-18.927688594393825
w=[3.49619359e-01 1.69976864e-07 1.74079910e-01 2.17612546e-07
 4.24399960e-01 5.19008638e-02]
obj_value=-107.16187753705387
w=[3.26784841e-01 4.38135799e-08 4.48711925e-02 5.60922496e-08
 5.91660277e-01 3.66838768e-02]
obj_value=-343.04301198854245
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586999029359
w=[3.22200567e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1587251232327
w=[3.22200552e-01 3.33860342e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.15870165295433
w=[3.22200552e-01 1.84848730e-08 1.89310953e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586692749749
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 3.85663835e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586913060794
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239694e-01 3.36288944e-02]
obj_value=-370.15867941448994
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36289093e-02]
obj_value=-370.1586924158286
w=[6.61927269e-01 1.30124926e-06 1.15132082e-07 1.69137184e-06
 0.00000000e+00 3.38072114e-01]
obj_value=-8.288159802597914
w=[4.55529337e-01 5.21917214e-07 1.15014539e-02 6.78171580e-07
 3.79858781e-01 1.53110355e-01]
obj_value=-47.13199693309657
w=[3.63268724e-01 1.73553005e-07 1.66425935e-02 2.25267444e-07
 5.49657015e-01 7.04317883e-02]
obj_value=-264.0275093735188
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.80875658170476
w=[3.34534804e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087453767497
w=[3.34534789e-01 7.99585233e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087586737291
w=[3.34534789e-01 6.50573621e-08 1.82437811e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087487095439
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 9.91147190e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087673439772
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539525e-01 4.46821157e-02]
obj_value=-390.80875385652433
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821306e-02]
obj_value=-390.80875010443333
w=[3.28103352e-01 6.42061772e-07 5.06958166e-08 5.81028523e-01
 0.00000000e+00 9.08687718e-02]
obj_value=-66.70623845422602
w=[3.32547615e-01 2.43339105e-07 1.26068571e-02 1.79525164e-01
 4.16367980e-01 5.89527822e-02]
obj_value=-323.99255855266296
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654085512645
w=[3.33831381e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465275938523
w=[3.33831366e-01 1.43066968e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654531333374
w=[3.33831366e-01 1.28165807e-07 1.62484193e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465383365334
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486625e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465379800735
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638241e-01 4.97336681e-02]
obj_value=-419.24653869101655
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336830e-02]
obj_value=-419.24653210317666
w=[8.97439784e-02 7.59992965e-01 0.00000000e+00 1.50262800e-01
 2.66692769e-07 1.20788494e-09]
obj_value=-140.66001082485298
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160917182303
w=[0.253436   0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160675720134
w=[0.25343599 0.25031996 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160856484672
w=[0.25343599 0.25031994 0.01089666 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160789754363
w=[0.25343599 0.25031994 0.01089665 0.09210981 0.35988509 0.03335283]
obj_value=-556.3160856689376
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988511 0.03335283]
obj_value=-556.316093117244
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335284]
obj_value=-556.3160779773442
w=[1.91523888e-01 3.85966267e-01 1.22455771e-10 5.66267866e-11
 4.22509844e-01 8.17981169e-11]
obj_value=-330.19096471283507
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.563526438129
w=[0.24222354 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635289001531
w=[0.24222353 0.27488591 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635168394884
w=[0.24222353 0.27488589 0.00892325 0.07542844 0.37122662 0.02731253]
obj_value=-565.5634962842352
w=[0.24222353 0.27488589 0.00892323 0.07542846 0.37122662 0.02731253]
obj_value=-565.563515702558
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122664 0.02731253]
obj_value=-565.5635132307353
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731255]
obj_value=-565.5635116602341
w=[0.25141205 0.27285732 0.         0.0894487  0.38628193 0.        ]
obj_value=-535.1289924747424
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241992856902
w=[0.24427361 0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241956518582
w=[0.2442736  0.27443331 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241903730222
w=[0.2442736  0.27443329 0.00693236 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241802914074
w=[0.2442736  0.27443329 0.00693235 0.07855655 0.37458565 0.02121877]
obj_value=-568.2241886806165
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458566 0.02121877]
obj_value=-568.2241884586826
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121878]
obj_value=-568.2241939499611
w=[3.08489744e-01 9.30915116e-02 2.51159076e-12 7.05345993e-02
 4.64289820e-01 6.35943256e-02]
obj_value=-429.5232279770569
w=[0.25069521 0.25629912 0.00623911 0.07775434 0.38355606 0.02545632]
obj_value=-568.4776965740791
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.963958936339
w=[0.24781715 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639497680903
w=[0.24781714 0.26442661 0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639508353928
w=[0.24781714 0.2644266  0.00654983 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639458255937
w=[0.24781714 0.2644266  0.00654981 0.07811389 0.37953565 0.02355711]
obj_value=-568.9639506507142
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953566 0.02355711]
obj_value=-568.9639505841747
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355712]
obj_value=-568.9639521000439
w=[2.37506192e-01 2.87829035e-01 2.73995496e-12 8.11890305e-02
 3.65376119e-01 2.80996241e-02]
obj_value=-564.4202412710298
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.35749177576
w=[0.24556415 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574842278006
w=[0.24556414 0.26954018 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574833417131
w=[0.24556414 0.26954016 0.00511866 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574823714773
w=[0.24556414 0.26954016 0.00511864 0.07878583 0.37644171 0.02454967]
obj_value=-569.357482608173
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644173 0.02454967]
obj_value=-569.3574828184998
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454969]
obj_value=-569.3574830188323
w=[0.24610453 0.26907775 0.0044456  0.07691659 0.37974948 0.02370605]
obj_value=-569.2450065184668
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642348343279
w=[0.24566809 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642268672174
w=[0.24566807 0.26945124 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642264009754
w=[0.24566807 0.26945123 0.00498921 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642261194806
w=[0.24566807 0.26945123 0.00498919 0.07842631 0.37707791 0.02438742]
obj_value=-569.3642260299339
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707792 0.02438742]
obj_value=-569.3642260460759
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438743]
obj_value=-569.3642263574668
w=[0.23397821 0.31770151 0.0082876  0.07410712 0.33822207 0.02770349]
obj_value=-546.5637995563353
w=[0.24449909 0.27427625 0.00531903 0.07799438 0.37319233 0.02471902]
obj_value=-569.1896789892905
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368032085926
w=[0.24551943 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.3680237079865
w=[0.24551942 0.27006482 0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023592652
w=[0.24551942 0.2700648  0.00503115 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023429162
w=[0.24551942 0.2700648  0.00503114 0.07837139 0.3765838  0.02442959]
obj_value=-569.3680235986387
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.37658381 0.02442959]
obj_value=-569.3680235425043
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.0244296 ]
obj_value=-569.3680235900935
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683939873064
w=[0.24553014 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683854605621
w=[0.24553013 0.27008818 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855065983
w=[0.24553013 0.27008817 0.00500255 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855508764
w=[0.24553013 0.27008817 0.00500253 0.07850139 0.37644477 0.02443303]
obj_value=-569.3683855037883
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644479 0.02443303]
obj_value=-569.3683855260334
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443304]
obj_value=-569.368385524223
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684405257682
w=[0.24552476 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320418271
w=[0.24552475 0.27008134 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320414714
w=[0.24552475 0.27008133 0.00500642 0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320420189
w=[0.24552475 0.27008133 0.0050064  0.07846408 0.37648212 0.02444134]
obj_value=-569.3684320414642
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648213 0.02444134]
obj_value=-569.3684320413632
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444135]
obj_value=-569.368432040818
_make_output_weights = OrderedDict([('BX4.PA', 0.24552474657212184), ('OBLI.PA', 0.2700813300052892), ('LQQ.PA', 0.005006401592221771), ('STZ.PA', 0.07846406610149567), ('CAC.PA', 0.3764821169666443), ('SAN.PA', 0.024441338762227212)])
opto from 2021-04-27 00:00:00 to 2021-11-14 00:00:00 done
{'weights': OrderedDict([('BX4.PA', 0.24552), ('OBLI.PA', 0.27008), ('LQQ.PA', 0.00501), ('STZ.PA', 0.07846), ('CAC.PA', 0.37648), ('SAN.PA', 0.02444)]), 'expected_return': 0.04410858385753515, 'volatility': 0.015946072643852546, 'sharpe_ratio': 1.5118822293105112}
--- 1.2137911319732666 seconds ---
max_diversification = {"weights": {"BX4.PA": 0.24552, "OBLI.PA": 0.27008, "LQQ.PA": 0.00501, "STZ.PA": 0.07846, "CAC.PA": 0.37648, "SAN.PA": 0.02444}, "expected_return": 0.04410858385753515, "volatility": 0.015946072643852546, "sharpe_ratio": 1.5118822293105112}
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 6}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            5
1  FR0000120578   SAN  ...          BBB            5
2  FR0007052782   CAC  ...          BBB            5
3  FR0013346681  OBLI  ...          BBB            5
4  IE00BKWQ0G16   STZ  ...          BBB            5
5  FR0010342592   LQQ  ...          BBB            5

[6 rows x 20 columns] 
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
829  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
830  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
831  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
832  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
833  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[834 rows x 9 columns]
 max_diversification cov =            BX4.PA   OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA
BX4.PA   0.071251 -0.000744 -0.046688 -0.036749 -0.035772 -0.014192
OBLI.PA -0.000744  0.001107  0.001840 -0.000955  0.000239  0.000640
LQQ.PA  -0.046688  0.001840  0.085409  0.022117  0.023811  0.009105
STZ.PA  -0.036749 -0.000955  0.022117  0.027707  0.018931  0.005820
CAC.PA  -0.035772  0.000239  0.023811  0.018931  0.019121  0.006685
SAN.PA  -0.014192  0.000640  0.009105  0.005820  0.006685  0.022572
 df_full  =             BX4.PA  OBLI.PA  LQQ.PA  STZ.PA   CAC.PA   SAN.PA
2021-04-27  1.7336   10.842   655.4   55.19  60.8151  82.2534
2021-04-28  1.7146   10.826   650.5   55.77  61.1296  84.2472
2021-04-29  1.7188   10.792   648.4   56.03  61.1198  83.6404
2021-04-30  1.7350   10.786   650.7   55.86  60.7463  84.0545
2021-05-03  1.7154   10.792   642.1   56.14  61.1100  83.4959
...            ...      ...     ...     ...      ...      ...
2021-11-01  1.3300   10.756   873.4   63.17  67.8700  88.3000
2021-11-02  1.3174   10.826   882.3   63.04  68.2100  89.6100
2021-11-03  1.3068   10.834   887.9   63.17  68.4500  90.2400
2021-11-04  1.2938   10.876   925.2   62.52  68.7800  89.6900
2021-11-05  1.2740   10.922   938.3   62.93  69.3100  88.4600

[139 rows x 6 columns]
expected_returns [-0.41817932  0.01455338  1.14692491  0.30828684  0.29031185  0.14822153]
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.43335106803055
w=[0.16666668 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433355984307845
w=[0.16666667 0.16666668 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433351069408694
w=[0.16666667 0.16666667 0.16666668 0.16666667 0.16666667 0.16666667]
obj_value=-46.43334636196783
w=[0.16666667 0.16666667 0.16666667 0.16666668 0.16666667 0.16666667]
obj_value=-46.43334946585318
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666668 0.16666667]
obj_value=-46.43334959070002
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666668]
obj_value=-46.433349784481216
w=[9.99999991e-01 0.00000000e+00 6.09079026e-09 1.37648126e-09
 1.18741994e-09 8.92885765e-10]
obj_value=-3.7463295452602385
w=[0.5408887  0.09182226 0.09182226 0.09182226 0.09182226 0.09182226]
obj_value=-20.92878635580864
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125849080727
w=[0.32924391 0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125152704742
w=[0.3292439  0.13415124 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125852413885
w=[0.3292439  0.13415122 0.13415124 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125464381268
w=[0.3292439  0.13415122 0.13415122 0.13415124 0.13415122 0.13415122]
obj_value=-103.79126353344603
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415124 0.13415122]
obj_value=-103.79126385167301
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415124]
obj_value=-103.79125746308361
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72189866217366
w=[3.84814011e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7218614927882
w=[3.84813996e-01 1.49011612e-08 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72190031816828
w=[3.84813996e-01 0.00000000e+00 2.03185568e-08 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7219294355354
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 1.49011612e-08
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72192087222
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15186014e-01 1.30681538e-09]
obj_value=-220.7219165661703
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.62079766e-08]
obj_value=-220.7219117212818
w=[0.24335099 0.         0.         0.         0.75664914 0.        ]
obj_value=-85.07993007641804
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391798622954
w=[3.28652739e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391989089929
w=[3.28652724e-01 1.49011612e-08 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391824098968
w=[3.28652724e-01 0.00000000e+00 1.81678332e-08 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391757532829
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 1.49011612e-08
 6.71347325e-01 7.88005434e-10]
obj_value=-341.53917239503346
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347339e-01 7.88005434e-10]
obj_value=-341.5391629573594
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 1.56891666e-08]
obj_value=-341.53918748941953
w=[2.41513932e-02 0.00000000e+00 3.53442515e-08 0.00000000e+00
 5.40064390e-06 9.75848421e-01]
obj_value=-7.334855562356588
w=[2.18590455e-01 0.00000000e+00 1.48611409e-08 0.00000000e+00
 4.28690205e-01 3.52721256e-01]
obj_value=-59.74596536608329
w=[2.99599867e-01 0.00000000e+00 6.32723438e-09 0.00000000e+00
 6.07293744e-01 9.31069311e-02]
obj_value=-301.3908897519344
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604648394507
w=[3.18854957e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66049305395285
w=[3.18854942e-01 1.49011612e-08 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66046710925406
w=[3.18854942e-01 0.00000000e+00 1.91999769e-08 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66045520097725
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 1.49011612e-08
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604536902379
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745918e-01 3.13993704e-02]
obj_value=-355.6604431572319
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993853e-02]
obj_value=-355.6604582100579
w=[4.07558797e-01 4.90098775e-07 5.01929187e-01 6.27447994e-07
 0.00000000e+00 9.05118670e-02]
obj_value=-18.927688594393825
w=[3.49619359e-01 1.69976864e-07 1.74079910e-01 2.17612546e-07
 4.24399960e-01 5.19008638e-02]
obj_value=-107.16187753705387
w=[3.26784841e-01 4.38135799e-08 4.48711925e-02 5.60922496e-08
 5.91660277e-01 3.66838768e-02]
obj_value=-343.04301198854245
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586999029359
w=[3.22200567e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1587251232327
w=[3.22200552e-01 3.33860342e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.15870165295433
w=[3.22200552e-01 1.84848730e-08 1.89310953e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586692749749
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 3.85663835e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586913060794
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239694e-01 3.36288944e-02]
obj_value=-370.15867941448994
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36289093e-02]
obj_value=-370.1586924158286
w=[6.61927269e-01 1.30124926e-06 1.15132082e-07 1.69137184e-06
 0.00000000e+00 3.38072114e-01]
obj_value=-8.288159802597914
w=[4.55529337e-01 5.21917214e-07 1.15014539e-02 6.78171580e-07
 3.79858781e-01 1.53110355e-01]
obj_value=-47.13199693309657
w=[3.63268724e-01 1.73553005e-07 1.66425935e-02 2.25267444e-07
 5.49657015e-01 7.04317883e-02]
obj_value=-264.0275093735188
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.80875658170476
w=[3.34534804e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087453767497
w=[3.34534789e-01 7.99585233e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087586737291
w=[3.34534789e-01 6.50573621e-08 1.82437811e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087487095439
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 9.91147190e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087673439772
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539525e-01 4.46821157e-02]
obj_value=-390.80875385652433
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821306e-02]
obj_value=-390.80875010443333
w=[3.28103352e-01 6.42061772e-07 5.06958166e-08 5.81028523e-01
 0.00000000e+00 9.08687718e-02]
obj_value=-66.70623845422602
w=[3.32547615e-01 2.43339105e-07 1.26068571e-02 1.79525164e-01
 4.16367980e-01 5.89527822e-02]
obj_value=-323.99255855266296
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654085512645
w=[3.33831381e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465275938523
w=[3.33831366e-01 1.43066968e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654531333374
w=[3.33831366e-01 1.28165807e-07 1.62484193e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465383365334
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486625e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465379800735
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638241e-01 4.97336681e-02]
obj_value=-419.24653869101655
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336830e-02]
obj_value=-419.24653210317666
w=[8.97439784e-02 7.59992965e-01 0.00000000e+00 1.50262800e-01
 2.66692769e-07 1.20788494e-09]
obj_value=-140.66001082485298
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160917182303
w=[0.253436   0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160675720134
w=[0.25343599 0.25031996 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160856484672
w=[0.25343599 0.25031994 0.01089666 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160789754363
w=[0.25343599 0.25031994 0.01089665 0.09210981 0.35988509 0.03335283]
obj_value=-556.3160856689376
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988511 0.03335283]
obj_value=-556.316093117244
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335284]
obj_value=-556.3160779773442
w=[1.91523888e-01 3.85966267e-01 1.22455771e-10 5.66267866e-11
 4.22509844e-01 8.17981169e-11]
obj_value=-330.19096471283507
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.563526438129
w=[0.24222354 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635289001531
w=[0.24222353 0.27488591 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635168394884
w=[0.24222353 0.27488589 0.00892325 0.07542844 0.37122662 0.02731253]
obj_value=-565.5634962842352
w=[0.24222353 0.27488589 0.00892323 0.07542846 0.37122662 0.02731253]
obj_value=-565.563515702558
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122664 0.02731253]
obj_value=-565.5635132307353
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731255]
obj_value=-565.5635116602341
w=[0.25141205 0.27285732 0.         0.0894487  0.38628193 0.        ]
obj_value=-535.1289924747424
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241992856902
w=[0.24427361 0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241956518582
w=[0.2442736  0.27443331 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241903730222
w=[0.2442736  0.27443329 0.00693236 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241802914074
w=[0.2442736  0.27443329 0.00693235 0.07855655 0.37458565 0.02121877]
obj_value=-568.2241886806165
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458566 0.02121877]
obj_value=-568.2241884586826
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121878]
obj_value=-568.2241939499611
w=[3.08489744e-01 9.30915116e-02 2.51159076e-12 7.05345993e-02
 4.64289820e-01 6.35943256e-02]
obj_value=-429.5232279770569
w=[0.25069521 0.25629912 0.00623911 0.07775434 0.38355606 0.02545632]
obj_value=-568.4776965740791
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.963958936339
w=[0.24781715 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639497680903
w=[0.24781714 0.26442661 0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639508353928
w=[0.24781714 0.2644266  0.00654983 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639458255937
w=[0.24781714 0.2644266  0.00654981 0.07811389 0.37953565 0.02355711]
obj_value=-568.9639506507142
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953566 0.02355711]
obj_value=-568.9639505841747
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355712]
obj_value=-568.9639521000439
w=[2.37506192e-01 2.87829035e-01 2.73995496e-12 8.11890305e-02
 3.65376119e-01 2.80996241e-02]
obj_value=-564.4202412710298
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.35749177576
w=[0.24556415 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574842278006
w=[0.24556414 0.26954018 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574833417131
w=[0.24556414 0.26954016 0.00511866 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574823714773
w=[0.24556414 0.26954016 0.00511864 0.07878583 0.37644171 0.02454967]
obj_value=-569.357482608173
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644173 0.02454967]
obj_value=-569.3574828184998
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454969]
obj_value=-569.3574830188323
w=[0.24610453 0.26907775 0.0044456  0.07691659 0.37974948 0.02370605]
obj_value=-569.2450065184668
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642348343279
w=[0.24566809 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642268672174
w=[0.24566807 0.26945124 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642264009754
w=[0.24566807 0.26945123 0.00498921 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642261194806
w=[0.24566807 0.26945123 0.00498919 0.07842631 0.37707791 0.02438742]
obj_value=-569.3642260299339
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707792 0.02438742]
obj_value=-569.3642260460759
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438743]
obj_value=-569.3642263574668
w=[0.23397821 0.31770151 0.0082876  0.07410712 0.33822207 0.02770349]
obj_value=-546.5637995563353
w=[0.24449909 0.27427625 0.00531903 0.07799438 0.37319233 0.02471902]
obj_value=-569.1896789892905
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368032085926
w=[0.24551943 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.3680237079865
w=[0.24551942 0.27006482 0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023592652
w=[0.24551942 0.2700648  0.00503115 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023429162
w=[0.24551942 0.2700648  0.00503114 0.07837139 0.3765838  0.02442959]
obj_value=-569.3680235986387
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.37658381 0.02442959]
obj_value=-569.3680235425043
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.0244296 ]
obj_value=-569.3680235900935
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683939873064
w=[0.24553014 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683854605621
w=[0.24553013 0.27008818 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855065983
w=[0.24553013 0.27008817 0.00500255 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855508764
w=[0.24553013 0.27008817 0.00500253 0.07850139 0.37644477 0.02443303]
obj_value=-569.3683855037883
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644479 0.02443303]
obj_value=-569.3683855260334
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443304]
obj_value=-569.368385524223
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684405257682
w=[0.24552476 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320418271
w=[0.24552475 0.27008134 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320414714
w=[0.24552475 0.27008133 0.00500642 0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320420189
w=[0.24552475 0.27008133 0.0050064  0.07846408 0.37648212 0.02444134]
obj_value=-569.3684320414642
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648213 0.02444134]
obj_value=-569.3684320413632
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444135]
obj_value=-569.368432040818
_make_output_weights = OrderedDict([('BX4.PA', 0.24552474657212184), ('OBLI.PA', 0.2700813300052892), ('LQQ.PA', 0.005006401592221771), ('STZ.PA', 0.07846406610149567), ('CAC.PA', 0.3764821169666443), ('SAN.PA', 0.024441338762227212)])
opto from 2021-04-27 00:00:00 to 2021-11-14 00:00:00 done
{'weights': OrderedDict([('BX4.PA', 0.24552), ('OBLI.PA', 0.27008), ('LQQ.PA', 0.00501), ('STZ.PA', 0.07846), ('CAC.PA', 0.37648), ('SAN.PA', 0.02444)]), 'expected_return': 0.04410858385753515, 'volatility': 0.015946072643852546, 'sharpe_ratio': 1.5118822293105112}
--- 1.0417039394378662 seconds ---
max_diversification = {"weights": {"BX4.PA": 0.24552, "OBLI.PA": 0.27008, "LQQ.PA": 0.00501, "STZ.PA": 0.07846, "CAC.PA": 0.37648, "SAN.PA": 0.02444}, "expected_return": 0.04410858385753515, "volatility": 0.015946072643852546, "sharpe_ratio": 1.5118822293105112}, type <class 'str'>
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 6}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            5
1  FR0000120578   SAN  ...          BBB            5
2  FR0007052782   CAC  ...          BBB            5
3  FR0013346681  OBLI  ...          BBB            5
4  IE00BKWQ0G16   STZ  ...          BBB            5
5  FR0010342592   LQQ  ...          BBB            5

[6 rows x 20 columns] 
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
829  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
830  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
831  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
832  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
833  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[834 rows x 9 columns]
 max_diversification cov =            BX4.PA   OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA
BX4.PA   0.071251 -0.000744 -0.046688 -0.036749 -0.035772 -0.014192
OBLI.PA -0.000744  0.001107  0.001840 -0.000955  0.000239  0.000640
LQQ.PA  -0.046688  0.001840  0.085409  0.022117  0.023811  0.009105
STZ.PA  -0.036749 -0.000955  0.022117  0.027707  0.018931  0.005820
CAC.PA  -0.035772  0.000239  0.023811  0.018931  0.019121  0.006685
SAN.PA  -0.014192  0.000640  0.009105  0.005820  0.006685  0.022572
 df_full  =             BX4.PA  OBLI.PA  LQQ.PA  STZ.PA   CAC.PA   SAN.PA
2021-04-27  1.7336   10.842   655.4   55.19  60.8151  82.2534
2021-04-28  1.7146   10.826   650.5   55.77  61.1296  84.2472
2021-04-29  1.7188   10.792   648.4   56.03  61.1198  83.6404
2021-04-30  1.7350   10.786   650.7   55.86  60.7463  84.0545
2021-05-03  1.7154   10.792   642.1   56.14  61.1100  83.4959
...            ...      ...     ...     ...      ...      ...
2021-11-01  1.3300   10.756   873.4   63.17  67.8700  88.3000
2021-11-02  1.3174   10.826   882.3   63.04  68.2100  89.6100
2021-11-03  1.3068   10.834   887.9   63.17  68.4500  90.2400
2021-11-04  1.2938   10.876   925.2   62.52  68.7800  89.6900
2021-11-05  1.2740   10.922   938.3   62.93  69.3100  88.4600

[139 rows x 6 columns]
expected_returns [-0.41817932  0.01455338  1.14692491  0.30828684  0.29031185  0.14822153]
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.43335106803055
w=[0.16666668 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433355984307845
w=[0.16666667 0.16666668 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433351069408694
w=[0.16666667 0.16666667 0.16666668 0.16666667 0.16666667 0.16666667]
obj_value=-46.43334636196783
w=[0.16666667 0.16666667 0.16666667 0.16666668 0.16666667 0.16666667]
obj_value=-46.43334946585318
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666668 0.16666667]
obj_value=-46.43334959070002
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666668]
obj_value=-46.433349784481216
w=[9.99999991e-01 0.00000000e+00 6.09079026e-09 1.37648126e-09
 1.18741994e-09 8.92885765e-10]
obj_value=-3.7463295452602385
w=[0.5408887  0.09182226 0.09182226 0.09182226 0.09182226 0.09182226]
obj_value=-20.92878635580864
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125849080727
w=[0.32924391 0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125152704742
w=[0.3292439  0.13415124 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125852413885
w=[0.3292439  0.13415122 0.13415124 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125464381268
w=[0.3292439  0.13415122 0.13415122 0.13415124 0.13415122 0.13415122]
obj_value=-103.79126353344603
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415124 0.13415122]
obj_value=-103.79126385167301
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415124]
obj_value=-103.79125746308361
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72189866217366
w=[3.84814011e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7218614927882
w=[3.84813996e-01 1.49011612e-08 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72190031816828
w=[3.84813996e-01 0.00000000e+00 2.03185568e-08 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7219294355354
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 1.49011612e-08
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72192087222
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15186014e-01 1.30681538e-09]
obj_value=-220.7219165661703
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.62079766e-08]
obj_value=-220.7219117212818
w=[0.24335099 0.         0.         0.         0.75664914 0.        ]
obj_value=-85.07993007641804
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391798622954
w=[3.28652739e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391989089929
w=[3.28652724e-01 1.49011612e-08 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391824098968
w=[3.28652724e-01 0.00000000e+00 1.81678332e-08 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391757532829
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 1.49011612e-08
 6.71347325e-01 7.88005434e-10]
obj_value=-341.53917239503346
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347339e-01 7.88005434e-10]
obj_value=-341.5391629573594
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 1.56891666e-08]
obj_value=-341.53918748941953
w=[2.41513932e-02 0.00000000e+00 3.53442515e-08 0.00000000e+00
 5.40064390e-06 9.75848421e-01]
obj_value=-7.334855562356588
w=[2.18590455e-01 0.00000000e+00 1.48611409e-08 0.00000000e+00
 4.28690205e-01 3.52721256e-01]
obj_value=-59.74596536608329
w=[2.99599867e-01 0.00000000e+00 6.32723438e-09 0.00000000e+00
 6.07293744e-01 9.31069311e-02]
obj_value=-301.3908897519344
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604648394507
w=[3.18854957e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66049305395285
w=[3.18854942e-01 1.49011612e-08 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66046710925406
w=[3.18854942e-01 0.00000000e+00 1.91999769e-08 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66045520097725
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 1.49011612e-08
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604536902379
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745918e-01 3.13993704e-02]
obj_value=-355.6604431572319
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993853e-02]
obj_value=-355.6604582100579
w=[4.07558797e-01 4.90098775e-07 5.01929187e-01 6.27447994e-07
 0.00000000e+00 9.05118670e-02]
obj_value=-18.927688594393825
w=[3.49619359e-01 1.69976864e-07 1.74079910e-01 2.17612546e-07
 4.24399960e-01 5.19008638e-02]
obj_value=-107.16187753705387
w=[3.26784841e-01 4.38135799e-08 4.48711925e-02 5.60922496e-08
 5.91660277e-01 3.66838768e-02]
obj_value=-343.04301198854245
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586999029359
w=[3.22200567e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1587251232327
w=[3.22200552e-01 3.33860342e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.15870165295433
w=[3.22200552e-01 1.84848730e-08 1.89310953e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586692749749
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 3.85663835e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586913060794
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239694e-01 3.36288944e-02]
obj_value=-370.15867941448994
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36289093e-02]
obj_value=-370.1586924158286
w=[6.61927269e-01 1.30124926e-06 1.15132082e-07 1.69137184e-06
 0.00000000e+00 3.38072114e-01]
obj_value=-8.288159802597914
w=[4.55529337e-01 5.21917214e-07 1.15014539e-02 6.78171580e-07
 3.79858781e-01 1.53110355e-01]
obj_value=-47.13199693309657
w=[3.63268724e-01 1.73553005e-07 1.66425935e-02 2.25267444e-07
 5.49657015e-01 7.04317883e-02]
obj_value=-264.0275093735188
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.80875658170476
w=[3.34534804e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087453767497
w=[3.34534789e-01 7.99585233e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087586737291
w=[3.34534789e-01 6.50573621e-08 1.82437811e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087487095439
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 9.91147190e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087673439772
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539525e-01 4.46821157e-02]
obj_value=-390.80875385652433
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821306e-02]
obj_value=-390.80875010443333
w=[3.28103352e-01 6.42061772e-07 5.06958166e-08 5.81028523e-01
 0.00000000e+00 9.08687718e-02]
obj_value=-66.70623845422602
w=[3.32547615e-01 2.43339105e-07 1.26068571e-02 1.79525164e-01
 4.16367980e-01 5.89527822e-02]
obj_value=-323.99255855266296
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654085512645
w=[3.33831381e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465275938523
w=[3.33831366e-01 1.43066968e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654531333374
w=[3.33831366e-01 1.28165807e-07 1.62484193e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465383365334
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486625e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465379800735
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638241e-01 4.97336681e-02]
obj_value=-419.24653869101655
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336830e-02]
obj_value=-419.24653210317666
w=[8.97439784e-02 7.59992965e-01 0.00000000e+00 1.50262800e-01
 2.66692769e-07 1.20788494e-09]
obj_value=-140.66001082485298
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160917182303
w=[0.253436   0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160675720134
w=[0.25343599 0.25031996 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160856484672
w=[0.25343599 0.25031994 0.01089666 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160789754363
w=[0.25343599 0.25031994 0.01089665 0.09210981 0.35988509 0.03335283]
obj_value=-556.3160856689376
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988511 0.03335283]
obj_value=-556.316093117244
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335284]
obj_value=-556.3160779773442
w=[1.91523888e-01 3.85966267e-01 1.22455771e-10 5.66267866e-11
 4.22509844e-01 8.17981169e-11]
obj_value=-330.19096471283507
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.563526438129
w=[0.24222354 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635289001531
w=[0.24222353 0.27488591 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635168394884
w=[0.24222353 0.27488589 0.00892325 0.07542844 0.37122662 0.02731253]
obj_value=-565.5634962842352
w=[0.24222353 0.27488589 0.00892323 0.07542846 0.37122662 0.02731253]
obj_value=-565.563515702558
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122664 0.02731253]
obj_value=-565.5635132307353
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731255]
obj_value=-565.5635116602341
w=[0.25141205 0.27285732 0.         0.0894487  0.38628193 0.        ]
obj_value=-535.1289924747424
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241992856902
w=[0.24427361 0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241956518582
w=[0.2442736  0.27443331 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241903730222
w=[0.2442736  0.27443329 0.00693236 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241802914074
w=[0.2442736  0.27443329 0.00693235 0.07855655 0.37458565 0.02121877]
obj_value=-568.2241886806165
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458566 0.02121877]
obj_value=-568.2241884586826
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121878]
obj_value=-568.2241939499611
w=[3.08489744e-01 9.30915116e-02 2.51159076e-12 7.05345993e-02
 4.64289820e-01 6.35943256e-02]
obj_value=-429.5232279770569
w=[0.25069521 0.25629912 0.00623911 0.07775434 0.38355606 0.02545632]
obj_value=-568.4776965740791
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.963958936339
w=[0.24781715 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639497680903
w=[0.24781714 0.26442661 0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639508353928
w=[0.24781714 0.2644266  0.00654983 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639458255937
w=[0.24781714 0.2644266  0.00654981 0.07811389 0.37953565 0.02355711]
obj_value=-568.9639506507142
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953566 0.02355711]
obj_value=-568.9639505841747
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355712]
obj_value=-568.9639521000439
w=[2.37506192e-01 2.87829035e-01 2.73995496e-12 8.11890305e-02
 3.65376119e-01 2.80996241e-02]
obj_value=-564.4202412710298
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.35749177576
w=[0.24556415 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574842278006
w=[0.24556414 0.26954018 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574833417131
w=[0.24556414 0.26954016 0.00511866 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574823714773
w=[0.24556414 0.26954016 0.00511864 0.07878583 0.37644171 0.02454967]
obj_value=-569.357482608173
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644173 0.02454967]
obj_value=-569.3574828184998
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454969]
obj_value=-569.3574830188323
w=[0.24610453 0.26907775 0.0044456  0.07691659 0.37974948 0.02370605]
obj_value=-569.2450065184668
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642348343279
w=[0.24566809 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642268672174
w=[0.24566807 0.26945124 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642264009754
w=[0.24566807 0.26945123 0.00498921 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642261194806
w=[0.24566807 0.26945123 0.00498919 0.07842631 0.37707791 0.02438742]
obj_value=-569.3642260299339
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707792 0.02438742]
obj_value=-569.3642260460759
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438743]
obj_value=-569.3642263574668
w=[0.23397821 0.31770151 0.0082876  0.07410712 0.33822207 0.02770349]
obj_value=-546.5637995563353
w=[0.24449909 0.27427625 0.00531903 0.07799438 0.37319233 0.02471902]
obj_value=-569.1896789892905
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368032085926
w=[0.24551943 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.3680237079865
w=[0.24551942 0.27006482 0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023592652
w=[0.24551942 0.2700648  0.00503115 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023429162
w=[0.24551942 0.2700648  0.00503114 0.07837139 0.3765838  0.02442959]
obj_value=-569.3680235986387
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.37658381 0.02442959]
obj_value=-569.3680235425043
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.0244296 ]
obj_value=-569.3680235900935
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683939873064
w=[0.24553014 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683854605621
w=[0.24553013 0.27008818 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855065983
w=[0.24553013 0.27008817 0.00500255 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855508764
w=[0.24553013 0.27008817 0.00500253 0.07850139 0.37644477 0.02443303]
obj_value=-569.3683855037883
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644479 0.02443303]
obj_value=-569.3683855260334
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443304]
obj_value=-569.368385524223
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684405257682
w=[0.24552476 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320418271
w=[0.24552475 0.27008134 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320414714
w=[0.24552475 0.27008133 0.00500642 0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320420189
w=[0.24552475 0.27008133 0.0050064  0.07846408 0.37648212 0.02444134]
obj_value=-569.3684320414642
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648213 0.02444134]
obj_value=-569.3684320413632
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444135]
obj_value=-569.368432040818
_make_output_weights = OrderedDict([('BX4.PA', 0.24552474657212184), ('OBLI.PA', 0.2700813300052892), ('LQQ.PA', 0.005006401592221771), ('STZ.PA', 0.07846406610149567), ('CAC.PA', 0.3764821169666443), ('SAN.PA', 0.024441338762227212)])
opto from 2021-04-27 00:00:00 to 2021-11-14 00:00:00 done
{'weights': OrderedDict([('BX4.PA', 0.24552), ('OBLI.PA', 0.27008), ('LQQ.PA', 0.00501), ('STZ.PA', 0.07846), ('CAC.PA', 0.37648), ('SAN.PA', 0.02444)]), 'expected_return': 0.04410858385753515, 'volatility': 0.015946072643852546, 'sharpe_ratio': 1.5118822293105112}
--- 1.3481700420379639 seconds ---
max_diversification = {"weights": {"BX4.PA": 0.24552, "OBLI.PA": 0.27008, "LQQ.PA": 0.00501, "STZ.PA": 0.07846, "CAC.PA": 0.37648, "SAN.PA": 0.02444}, "expected_return": 0.04410858385753515, "volatility": 0.015946072643852546, "sharpe_ratio": 1.5118822293105112}, type <class 'str'>
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 6}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            5
1  FR0000120578   SAN  ...          BBB            5
2  FR0007052782   CAC  ...          BBB            5
3  FR0013346681  OBLI  ...          BBB            5
4  IE00BKWQ0G16   STZ  ...          BBB            5
5  FR0010342592   LQQ  ...          BBB            5

[6 rows x 20 columns] 
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
829  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
830  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
831  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
832  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
833  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[834 rows x 9 columns]
 max_diversification cov =            BX4.PA   OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA
BX4.PA   0.071251 -0.000744 -0.046688 -0.036749 -0.035772 -0.014192
OBLI.PA -0.000744  0.001107  0.001840 -0.000955  0.000239  0.000640
LQQ.PA  -0.046688  0.001840  0.085409  0.022117  0.023811  0.009105
STZ.PA  -0.036749 -0.000955  0.022117  0.027707  0.018931  0.005820
CAC.PA  -0.035772  0.000239  0.023811  0.018931  0.019121  0.006685
SAN.PA  -0.014192  0.000640  0.009105  0.005820  0.006685  0.022572
 df_full  =             BX4.PA  OBLI.PA  LQQ.PA  STZ.PA   CAC.PA   SAN.PA
2021-04-27  1.7336   10.842   655.4   55.19  60.8151  82.2534
2021-04-28  1.7146   10.826   650.5   55.77  61.1296  84.2472
2021-04-29  1.7188   10.792   648.4   56.03  61.1198  83.6404
2021-04-30  1.7350   10.786   650.7   55.86  60.7463  84.0545
2021-05-03  1.7154   10.792   642.1   56.14  61.1100  83.4959
...            ...      ...     ...     ...      ...      ...
2021-11-01  1.3300   10.756   873.4   63.17  67.8700  88.3000
2021-11-02  1.3174   10.826   882.3   63.04  68.2100  89.6100
2021-11-03  1.3068   10.834   887.9   63.17  68.4500  90.2400
2021-11-04  1.2938   10.876   925.2   62.52  68.7800  89.6900
2021-11-05  1.2740   10.922   938.3   62.93  69.3100  88.4600

[139 rows x 6 columns]
expected_returns [-0.41817932  0.01455338  1.14692491  0.30828684  0.29031185  0.14822153]
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.43335106803055
w=[0.16666668 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433355984307845
w=[0.16666667 0.16666668 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433351069408694
w=[0.16666667 0.16666667 0.16666668 0.16666667 0.16666667 0.16666667]
obj_value=-46.43334636196783
w=[0.16666667 0.16666667 0.16666667 0.16666668 0.16666667 0.16666667]
obj_value=-46.43334946585318
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666668 0.16666667]
obj_value=-46.43334959070002
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666668]
obj_value=-46.433349784481216
w=[9.99999991e-01 0.00000000e+00 6.09079026e-09 1.37648126e-09
 1.18741994e-09 8.92885765e-10]
obj_value=-3.7463295452602385
w=[0.5408887  0.09182226 0.09182226 0.09182226 0.09182226 0.09182226]
obj_value=-20.92878635580864
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125849080727
w=[0.32924391 0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125152704742
w=[0.3292439  0.13415124 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125852413885
w=[0.3292439  0.13415122 0.13415124 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125464381268
w=[0.3292439  0.13415122 0.13415122 0.13415124 0.13415122 0.13415122]
obj_value=-103.79126353344603
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415124 0.13415122]
obj_value=-103.79126385167301
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415124]
obj_value=-103.79125746308361
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72189866217366
w=[3.84814011e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7218614927882
w=[3.84813996e-01 1.49011612e-08 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72190031816828
w=[3.84813996e-01 0.00000000e+00 2.03185568e-08 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7219294355354
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 1.49011612e-08
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72192087222
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15186014e-01 1.30681538e-09]
obj_value=-220.7219165661703
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.62079766e-08]
obj_value=-220.7219117212818
w=[0.24335099 0.         0.         0.         0.75664914 0.        ]
obj_value=-85.07993007641804
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391798622954
w=[3.28652739e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391989089929
w=[3.28652724e-01 1.49011612e-08 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391824098968
w=[3.28652724e-01 0.00000000e+00 1.81678332e-08 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391757532829
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 1.49011612e-08
 6.71347325e-01 7.88005434e-10]
obj_value=-341.53917239503346
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347339e-01 7.88005434e-10]
obj_value=-341.5391629573594
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 1.56891666e-08]
obj_value=-341.53918748941953
w=[2.41513932e-02 0.00000000e+00 3.53442515e-08 0.00000000e+00
 5.40064390e-06 9.75848421e-01]
obj_value=-7.334855562356588
w=[2.18590455e-01 0.00000000e+00 1.48611409e-08 0.00000000e+00
 4.28690205e-01 3.52721256e-01]
obj_value=-59.74596536608329
w=[2.99599867e-01 0.00000000e+00 6.32723438e-09 0.00000000e+00
 6.07293744e-01 9.31069311e-02]
obj_value=-301.3908897519344
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604648394507
w=[3.18854957e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66049305395285
w=[3.18854942e-01 1.49011612e-08 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66046710925406
w=[3.18854942e-01 0.00000000e+00 1.91999769e-08 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66045520097725
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 1.49011612e-08
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604536902379
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745918e-01 3.13993704e-02]
obj_value=-355.6604431572319
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993853e-02]
obj_value=-355.6604582100579
w=[4.07558797e-01 4.90098775e-07 5.01929187e-01 6.27447994e-07
 0.00000000e+00 9.05118670e-02]
obj_value=-18.927688594393825
w=[3.49619359e-01 1.69976864e-07 1.74079910e-01 2.17612546e-07
 4.24399960e-01 5.19008638e-02]
obj_value=-107.16187753705387
w=[3.26784841e-01 4.38135799e-08 4.48711925e-02 5.60922496e-08
 5.91660277e-01 3.66838768e-02]
obj_value=-343.04301198854245
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586999029359
w=[3.22200567e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1587251232327
w=[3.22200552e-01 3.33860342e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.15870165295433
w=[3.22200552e-01 1.84848730e-08 1.89310953e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586692749749
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 3.85663835e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586913060794
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239694e-01 3.36288944e-02]
obj_value=-370.15867941448994
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36289093e-02]
obj_value=-370.1586924158286
w=[6.61927269e-01 1.30124926e-06 1.15132082e-07 1.69137184e-06
 0.00000000e+00 3.38072114e-01]
obj_value=-8.288159802597914
w=[4.55529337e-01 5.21917214e-07 1.15014539e-02 6.78171580e-07
 3.79858781e-01 1.53110355e-01]
obj_value=-47.13199693309657
w=[3.63268724e-01 1.73553005e-07 1.66425935e-02 2.25267444e-07
 5.49657015e-01 7.04317883e-02]
obj_value=-264.0275093735188
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.80875658170476
w=[3.34534804e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087453767497
w=[3.34534789e-01 7.99585233e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087586737291
w=[3.34534789e-01 6.50573621e-08 1.82437811e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087487095439
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 9.91147190e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087673439772
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539525e-01 4.46821157e-02]
obj_value=-390.80875385652433
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821306e-02]
obj_value=-390.80875010443333
w=[3.28103352e-01 6.42061772e-07 5.06958166e-08 5.81028523e-01
 0.00000000e+00 9.08687718e-02]
obj_value=-66.70623845422602
w=[3.32547615e-01 2.43339105e-07 1.26068571e-02 1.79525164e-01
 4.16367980e-01 5.89527822e-02]
obj_value=-323.99255855266296
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654085512645
w=[3.33831381e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465275938523
w=[3.33831366e-01 1.43066968e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654531333374
w=[3.33831366e-01 1.28165807e-07 1.62484193e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465383365334
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486625e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465379800735
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638241e-01 4.97336681e-02]
obj_value=-419.24653869101655
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336830e-02]
obj_value=-419.24653210317666
w=[8.97439784e-02 7.59992965e-01 0.00000000e+00 1.50262800e-01
 2.66692769e-07 1.20788494e-09]
obj_value=-140.66001082485298
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160917182303
w=[0.253436   0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160675720134
w=[0.25343599 0.25031996 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160856484672
w=[0.25343599 0.25031994 0.01089666 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160789754363
w=[0.25343599 0.25031994 0.01089665 0.09210981 0.35988509 0.03335283]
obj_value=-556.3160856689376
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988511 0.03335283]
obj_value=-556.316093117244
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335284]
obj_value=-556.3160779773442
w=[1.91523888e-01 3.85966267e-01 1.22455771e-10 5.66267866e-11
 4.22509844e-01 8.17981169e-11]
obj_value=-330.19096471283507
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.563526438129
w=[0.24222354 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635289001531
w=[0.24222353 0.27488591 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635168394884
w=[0.24222353 0.27488589 0.00892325 0.07542844 0.37122662 0.02731253]
obj_value=-565.5634962842352
w=[0.24222353 0.27488589 0.00892323 0.07542846 0.37122662 0.02731253]
obj_value=-565.563515702558
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122664 0.02731253]
obj_value=-565.5635132307353
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731255]
obj_value=-565.5635116602341
w=[0.25141205 0.27285732 0.         0.0894487  0.38628193 0.        ]
obj_value=-535.1289924747424
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241992856902
w=[0.24427361 0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241956518582
w=[0.2442736  0.27443331 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241903730222
w=[0.2442736  0.27443329 0.00693236 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241802914074
w=[0.2442736  0.27443329 0.00693235 0.07855655 0.37458565 0.02121877]
obj_value=-568.2241886806165
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458566 0.02121877]
obj_value=-568.2241884586826
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121878]
obj_value=-568.2241939499611
w=[3.08489744e-01 9.30915116e-02 2.51159076e-12 7.05345993e-02
 4.64289820e-01 6.35943256e-02]
obj_value=-429.5232279770569
w=[0.25069521 0.25629912 0.00623911 0.07775434 0.38355606 0.02545632]
obj_value=-568.4776965740791
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.963958936339
w=[0.24781715 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639497680903
w=[0.24781714 0.26442661 0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639508353928
w=[0.24781714 0.2644266  0.00654983 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639458255937
w=[0.24781714 0.2644266  0.00654981 0.07811389 0.37953565 0.02355711]
obj_value=-568.9639506507142
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953566 0.02355711]
obj_value=-568.9639505841747
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355712]
obj_value=-568.9639521000439
w=[2.37506192e-01 2.87829035e-01 2.73995496e-12 8.11890305e-02
 3.65376119e-01 2.80996241e-02]
obj_value=-564.4202412710298
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.35749177576
w=[0.24556415 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574842278006
w=[0.24556414 0.26954018 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574833417131
w=[0.24556414 0.26954016 0.00511866 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574823714773
w=[0.24556414 0.26954016 0.00511864 0.07878583 0.37644171 0.02454967]
obj_value=-569.357482608173
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644173 0.02454967]
obj_value=-569.3574828184998
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454969]
obj_value=-569.3574830188323
w=[0.24610453 0.26907775 0.0044456  0.07691659 0.37974948 0.02370605]
obj_value=-569.2450065184668
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642348343279
w=[0.24566809 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642268672174
w=[0.24566807 0.26945124 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642264009754
w=[0.24566807 0.26945123 0.00498921 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642261194806
w=[0.24566807 0.26945123 0.00498919 0.07842631 0.37707791 0.02438742]
obj_value=-569.3642260299339
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707792 0.02438742]
obj_value=-569.3642260460759
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438743]
obj_value=-569.3642263574668
w=[0.23397821 0.31770151 0.0082876  0.07410712 0.33822207 0.02770349]
obj_value=-546.5637995563353
w=[0.24449909 0.27427625 0.00531903 0.07799438 0.37319233 0.02471902]
obj_value=-569.1896789892905
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368032085926
w=[0.24551943 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.3680237079865
w=[0.24551942 0.27006482 0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023592652
w=[0.24551942 0.2700648  0.00503115 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023429162
w=[0.24551942 0.2700648  0.00503114 0.07837139 0.3765838  0.02442959]
obj_value=-569.3680235986387
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.37658381 0.02442959]
obj_value=-569.3680235425043
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.0244296 ]
obj_value=-569.3680235900935
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683939873064
w=[0.24553014 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683854605621
w=[0.24553013 0.27008818 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855065983
w=[0.24553013 0.27008817 0.00500255 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855508764
w=[0.24553013 0.27008817 0.00500253 0.07850139 0.37644477 0.02443303]
obj_value=-569.3683855037883
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644479 0.02443303]
obj_value=-569.3683855260334
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443304]
obj_value=-569.368385524223
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684405257682
w=[0.24552476 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320418271
w=[0.24552475 0.27008134 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320414714
w=[0.24552475 0.27008133 0.00500642 0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320420189
w=[0.24552475 0.27008133 0.0050064  0.07846408 0.37648212 0.02444134]
obj_value=-569.3684320414642
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648213 0.02444134]
obj_value=-569.3684320413632
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444135]
obj_value=-569.368432040818
_make_output_weights = OrderedDict([('BX4.PA', 0.24552474657212184), ('OBLI.PA', 0.2700813300052892), ('LQQ.PA', 0.005006401592221771), ('STZ.PA', 0.07846406610149567), ('CAC.PA', 0.3764821169666443), ('SAN.PA', 0.024441338762227212)])
opto from 2021-04-27 00:00:00 to 2021-11-14 00:00:00 done
{'weights': OrderedDict([('BX4.PA', 0.24552), ('OBLI.PA', 0.27008), ('LQQ.PA', 0.00501), ('STZ.PA', 0.07846), ('CAC.PA', 0.37648), ('SAN.PA', 0.02444)]), 'expected_return': 0.04410858385753515, 'volatility': 0.015946072643852546, 'sharpe_ratio': 1.5118822293105112}
--- 0.8535239696502686 seconds ---
max_diversification = {'weights': OrderedDict([('BX4.PA', 0.24552), ('OBLI.PA', 0.27008), ('LQQ.PA', 0.00501), ('STZ.PA', 0.07846), ('CAC.PA', 0.37648), ('SAN.PA', 0.02444)]), 'expected_return': 0.04410858385753515, 'volatility': 0.015946072643852546, 'sharpe_ratio': 1.5118822293105112}, type <class 'dict'>
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
829  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
830  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
831  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
832  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
833  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[834 rows x 9 columns]
Getting data --- 0.41307806968688965 seconds ---
--- end init 0.5003666877746582 seconds ---
monte carlo from 2021-04-27 00:00:00 to 2021-11-14 00:00:00 done
            BX4.PA_adjusted_close     date_x  ...  portfolio_value  portfolio_return
date                                          ...                                   
2021-04-30                 1.7350 2021-04-30  ...        49.999500          0.000000
2021-05-31                 1.5912 2021-05-31  ...        49.918710          0.000835
2021-06-30                 1.5440 2021-06-30  ...        99.366035         -0.001667
2021-07-31                 1.4818 2021-07-30  ...       148.825853          0.002027
2021-08-31                 1.4428 2021-08-31  ...       197.584451         -0.001747
2021-09-30                 1.4990 2021-09-30  ...       245.517782         -0.002942
2021-10-31                 1.3548 2021-10-29  ...       294.282202          0.003498
2021-11-30                 1.2740 2021-11-05  ...       343.317079          0.003139

[8 rows x 38 columns]
--- 0.5444929599761963 seconds ---
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 6}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            5
1  FR0000120578   SAN  ...          BBB            5
2  FR0007052782   CAC  ...          BBB            5
3  FR0013346681  OBLI  ...          BBB            5
4  IE00BKWQ0G16   STZ  ...          BBB            5
5  FR0010342592   LQQ  ...          BBB            5

[6 rows x 20 columns] 
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
829  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
830  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
831  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
832  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
833  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[834 rows x 9 columns]
 max_diversification cov =            BX4.PA   OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA
BX4.PA   0.071251 -0.000744 -0.046688 -0.036749 -0.035772 -0.014192
OBLI.PA -0.000744  0.001107  0.001840 -0.000955  0.000239  0.000640
LQQ.PA  -0.046688  0.001840  0.085409  0.022117  0.023811  0.009105
STZ.PA  -0.036749 -0.000955  0.022117  0.027707  0.018931  0.005820
CAC.PA  -0.035772  0.000239  0.023811  0.018931  0.019121  0.006685
SAN.PA  -0.014192  0.000640  0.009105  0.005820  0.006685  0.022572
 df_full  =             BX4.PA  OBLI.PA  LQQ.PA  STZ.PA   CAC.PA   SAN.PA
2021-04-27  1.7336   10.842   655.4   55.19  60.8151  82.2534
2021-04-28  1.7146   10.826   650.5   55.77  61.1296  84.2472
2021-04-29  1.7188   10.792   648.4   56.03  61.1198  83.6404
2021-04-30  1.7350   10.786   650.7   55.86  60.7463  84.0545
2021-05-03  1.7154   10.792   642.1   56.14  61.1100  83.4959
...            ...      ...     ...     ...      ...      ...
2021-11-01  1.3300   10.756   873.4   63.17  67.8700  88.3000
2021-11-02  1.3174   10.826   882.3   63.04  68.2100  89.6100
2021-11-03  1.3068   10.834   887.9   63.17  68.4500  90.2400
2021-11-04  1.2938   10.876   925.2   62.52  68.7800  89.6900
2021-11-05  1.2740   10.922   938.3   62.93  69.3100  88.4600

[139 rows x 6 columns]
expected_returns [-0.41817932  0.01455338  1.14692491  0.30828684  0.29031185  0.14822153]
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.43335106803055
w=[0.16666668 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433355984307845
w=[0.16666667 0.16666668 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433351069408694
w=[0.16666667 0.16666667 0.16666668 0.16666667 0.16666667 0.16666667]
obj_value=-46.43334636196783
w=[0.16666667 0.16666667 0.16666667 0.16666668 0.16666667 0.16666667]
obj_value=-46.43334946585318
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666668 0.16666667]
obj_value=-46.43334959070002
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666668]
obj_value=-46.433349784481216
w=[9.99999991e-01 0.00000000e+00 6.09079026e-09 1.37648126e-09
 1.18741994e-09 8.92885765e-10]
obj_value=-3.7463295452602385
w=[0.5408887  0.09182226 0.09182226 0.09182226 0.09182226 0.09182226]
obj_value=-20.92878635580864
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125849080727
w=[0.32924391 0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125152704742
w=[0.3292439  0.13415124 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125852413885
w=[0.3292439  0.13415122 0.13415124 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125464381268
w=[0.3292439  0.13415122 0.13415122 0.13415124 0.13415122 0.13415122]
obj_value=-103.79126353344603
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415124 0.13415122]
obj_value=-103.79126385167301
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415124]
obj_value=-103.79125746308361
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72189866217366
w=[3.84814011e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7218614927882
w=[3.84813996e-01 1.49011612e-08 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72190031816828
w=[3.84813996e-01 0.00000000e+00 2.03185568e-08 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7219294355354
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 1.49011612e-08
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72192087222
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15186014e-01 1.30681538e-09]
obj_value=-220.7219165661703
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.62079766e-08]
obj_value=-220.7219117212818
w=[0.24335099 0.         0.         0.         0.75664914 0.        ]
obj_value=-85.07993007641804
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391798622954
w=[3.28652739e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391989089929
w=[3.28652724e-01 1.49011612e-08 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391824098968
w=[3.28652724e-01 0.00000000e+00 1.81678332e-08 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391757532829
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 1.49011612e-08
 6.71347325e-01 7.88005434e-10]
obj_value=-341.53917239503346
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347339e-01 7.88005434e-10]
obj_value=-341.5391629573594
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 1.56891666e-08]
obj_value=-341.53918748941953
w=[2.41513932e-02 0.00000000e+00 3.53442515e-08 0.00000000e+00
 5.40064390e-06 9.75848421e-01]
obj_value=-7.334855562356588
w=[2.18590455e-01 0.00000000e+00 1.48611409e-08 0.00000000e+00
 4.28690205e-01 3.52721256e-01]
obj_value=-59.74596536608329
w=[2.99599867e-01 0.00000000e+00 6.32723438e-09 0.00000000e+00
 6.07293744e-01 9.31069311e-02]
obj_value=-301.3908897519344
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604648394507
w=[3.18854957e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66049305395285
w=[3.18854942e-01 1.49011612e-08 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66046710925406
w=[3.18854942e-01 0.00000000e+00 1.91999769e-08 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66045520097725
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 1.49011612e-08
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604536902379
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745918e-01 3.13993704e-02]
obj_value=-355.6604431572319
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993853e-02]
obj_value=-355.6604582100579
w=[4.07558797e-01 4.90098775e-07 5.01929187e-01 6.27447994e-07
 0.00000000e+00 9.05118670e-02]
obj_value=-18.927688594393825
w=[3.49619359e-01 1.69976864e-07 1.74079910e-01 2.17612546e-07
 4.24399960e-01 5.19008638e-02]
obj_value=-107.16187753705387
w=[3.26784841e-01 4.38135799e-08 4.48711925e-02 5.60922496e-08
 5.91660277e-01 3.66838768e-02]
obj_value=-343.04301198854245
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586999029359
w=[3.22200567e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1587251232327
w=[3.22200552e-01 3.33860342e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.15870165295433
w=[3.22200552e-01 1.84848730e-08 1.89310953e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586692749749
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 3.85663835e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586913060794
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239694e-01 3.36288944e-02]
obj_value=-370.15867941448994
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36289093e-02]
obj_value=-370.1586924158286
w=[6.61927269e-01 1.30124926e-06 1.15132082e-07 1.69137184e-06
 0.00000000e+00 3.38072114e-01]
obj_value=-8.288159802597914
w=[4.55529337e-01 5.21917214e-07 1.15014539e-02 6.78171580e-07
 3.79858781e-01 1.53110355e-01]
obj_value=-47.13199693309657
w=[3.63268724e-01 1.73553005e-07 1.66425935e-02 2.25267444e-07
 5.49657015e-01 7.04317883e-02]
obj_value=-264.0275093735188
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.80875658170476
w=[3.34534804e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087453767497
w=[3.34534789e-01 7.99585233e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087586737291
w=[3.34534789e-01 6.50573621e-08 1.82437811e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087487095439
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 9.91147190e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087673439772
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539525e-01 4.46821157e-02]
obj_value=-390.80875385652433
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821306e-02]
obj_value=-390.80875010443333
w=[3.28103352e-01 6.42061772e-07 5.06958166e-08 5.81028523e-01
 0.00000000e+00 9.08687718e-02]
obj_value=-66.70623845422602
w=[3.32547615e-01 2.43339105e-07 1.26068571e-02 1.79525164e-01
 4.16367980e-01 5.89527822e-02]
obj_value=-323.99255855266296
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654085512645
w=[3.33831381e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465275938523
w=[3.33831366e-01 1.43066968e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654531333374
w=[3.33831366e-01 1.28165807e-07 1.62484193e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465383365334
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486625e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465379800735
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638241e-01 4.97336681e-02]
obj_value=-419.24653869101655
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336830e-02]
obj_value=-419.24653210317666
w=[8.97439784e-02 7.59992965e-01 0.00000000e+00 1.50262800e-01
 2.66692769e-07 1.20788494e-09]
obj_value=-140.66001082485298
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160917182303
w=[0.253436   0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160675720134
w=[0.25343599 0.25031996 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160856484672
w=[0.25343599 0.25031994 0.01089666 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160789754363
w=[0.25343599 0.25031994 0.01089665 0.09210981 0.35988509 0.03335283]
obj_value=-556.3160856689376
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988511 0.03335283]
obj_value=-556.316093117244
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335284]
obj_value=-556.3160779773442
w=[1.91523888e-01 3.85966267e-01 1.22455771e-10 5.66267866e-11
 4.22509844e-01 8.17981169e-11]
obj_value=-330.19096471283507
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.563526438129
w=[0.24222354 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635289001531
w=[0.24222353 0.27488591 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635168394884
w=[0.24222353 0.27488589 0.00892325 0.07542844 0.37122662 0.02731253]
obj_value=-565.5634962842352
w=[0.24222353 0.27488589 0.00892323 0.07542846 0.37122662 0.02731253]
obj_value=-565.563515702558
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122664 0.02731253]
obj_value=-565.5635132307353
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731255]
obj_value=-565.5635116602341
w=[0.25141205 0.27285732 0.         0.0894487  0.38628193 0.        ]
obj_value=-535.1289924747424
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241992856902
w=[0.24427361 0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241956518582
w=[0.2442736  0.27443331 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241903730222
w=[0.2442736  0.27443329 0.00693236 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241802914074
w=[0.2442736  0.27443329 0.00693235 0.07855655 0.37458565 0.02121877]
obj_value=-568.2241886806165
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458566 0.02121877]
obj_value=-568.2241884586826
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121878]
obj_value=-568.2241939499611
w=[3.08489744e-01 9.30915116e-02 2.51159076e-12 7.05345993e-02
 4.64289820e-01 6.35943256e-02]
obj_value=-429.5232279770569
w=[0.25069521 0.25629912 0.00623911 0.07775434 0.38355606 0.02545632]
obj_value=-568.4776965740791
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.963958936339
w=[0.24781715 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639497680903
w=[0.24781714 0.26442661 0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639508353928
w=[0.24781714 0.2644266  0.00654983 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639458255937
w=[0.24781714 0.2644266  0.00654981 0.07811389 0.37953565 0.02355711]
obj_value=-568.9639506507142
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953566 0.02355711]
obj_value=-568.9639505841747
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355712]
obj_value=-568.9639521000439
w=[2.37506192e-01 2.87829035e-01 2.73995496e-12 8.11890305e-02
 3.65376119e-01 2.80996241e-02]
obj_value=-564.4202412710298
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.35749177576
w=[0.24556415 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574842278006
w=[0.24556414 0.26954018 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574833417131
w=[0.24556414 0.26954016 0.00511866 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574823714773
w=[0.24556414 0.26954016 0.00511864 0.07878583 0.37644171 0.02454967]
obj_value=-569.357482608173
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644173 0.02454967]
obj_value=-569.3574828184998
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454969]
obj_value=-569.3574830188323
w=[0.24610453 0.26907775 0.0044456  0.07691659 0.37974948 0.02370605]
obj_value=-569.2450065184668
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642348343279
w=[0.24566809 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642268672174
w=[0.24566807 0.26945124 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642264009754
w=[0.24566807 0.26945123 0.00498921 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642261194806
w=[0.24566807 0.26945123 0.00498919 0.07842631 0.37707791 0.02438742]
obj_value=-569.3642260299339
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707792 0.02438742]
obj_value=-569.3642260460759
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438743]
obj_value=-569.3642263574668
w=[0.23397821 0.31770151 0.0082876  0.07410712 0.33822207 0.02770349]
obj_value=-546.5637995563353
w=[0.24449909 0.27427625 0.00531903 0.07799438 0.37319233 0.02471902]
obj_value=-569.1896789892905
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368032085926
w=[0.24551943 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.3680237079865
w=[0.24551942 0.27006482 0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023592652
w=[0.24551942 0.2700648  0.00503115 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023429162
w=[0.24551942 0.2700648  0.00503114 0.07837139 0.3765838  0.02442959]
obj_value=-569.3680235986387
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.37658381 0.02442959]
obj_value=-569.3680235425043
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.0244296 ]
obj_value=-569.3680235900935
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683939873064
w=[0.24553014 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683854605621
w=[0.24553013 0.27008818 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855065983
w=[0.24553013 0.27008817 0.00500255 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855508764
w=[0.24553013 0.27008817 0.00500253 0.07850139 0.37644477 0.02443303]
obj_value=-569.3683855037883
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644479 0.02443303]
obj_value=-569.3683855260334
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443304]
obj_value=-569.368385524223
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684405257682
w=[0.24552476 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320418271
w=[0.24552475 0.27008134 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320414714
w=[0.24552475 0.27008133 0.00500642 0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320420189
w=[0.24552475 0.27008133 0.0050064  0.07846408 0.37648212 0.02444134]
obj_value=-569.3684320414642
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648213 0.02444134]
obj_value=-569.3684320413632
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444135]
obj_value=-569.368432040818
_make_output_weights = OrderedDict([('BX4.PA', 0.24552474657212184), ('OBLI.PA', 0.2700813300052892), ('LQQ.PA', 0.005006401592221771), ('STZ.PA', 0.07846406610149567), ('CAC.PA', 0.3764821169666443), ('SAN.PA', 0.024441338762227212)])
opto from 2021-04-27 00:00:00 to 2021-11-14 00:00:00 done
{'weights': OrderedDict([('BX4.PA', 0.24552), ('OBLI.PA', 0.27008), ('LQQ.PA', 0.00501), ('STZ.PA', 0.07846), ('CAC.PA', 0.37648), ('SAN.PA', 0.02444)]), 'expected_return': 0.04410858385753515, 'volatility': 0.015946072643852546, 'sharpe_ratio': 1.5118822293105112}
--- 1.001758098602295 seconds ---
max_diversification = {'weights': OrderedDict([('BX4.PA', 0.24552), ('OBLI.PA', 0.27008), ('LQQ.PA', 0.00501), ('STZ.PA', 0.07846), ('CAC.PA', 0.37648), ('SAN.PA', 0.02444)]), 'expected_return': 0.04410858385753515, 'volatility': 0.015946072643852546, 'sharpe_ratio': 1.5118822293105112}, type <class 'dict'>
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
829  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
830  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
831  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
832  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
833  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[834 rows x 9 columns]
Getting data --- 0.35971903800964355 seconds ---
--- end init 0.4226369857788086 seconds ---
back_test_portfolio from 2021-04-27 00:00:00 to 2021-11-14 00:00:00 done, columns Index(['BX4.PA_adjusted_close', 'date_x', 'BX4.PA_return', 'BX4.PA_weight',
       'BX4.PA_nb_shares', 'BX4.PA_value', 'OBLI.PA_adjusted_close', 'date_y',
       'OBLI.PA_return', 'OBLI.PA_weight', 'OBLI.PA_nb_shares',
       'OBLI.PA_value', 'LQQ.PA_adjusted_close', 'date_x', 'LQQ.PA_return',
       'LQQ.PA_weight', 'LQQ.PA_nb_shares', 'LQQ.PA_value',
       'STZ.PA_adjusted_close', 'date_y', 'STZ.PA_return', 'STZ.PA_weight',
       'STZ.PA_nb_shares', 'STZ.PA_value', 'CAC.PA_adjusted_close', 'date_x',
       'CAC.PA_return', 'CAC.PA_weight', 'CAC.PA_nb_shares', 'CAC.PA_value',
       'SAN.PA_adjusted_close', 'date_y', 'SAN.PA_return', 'SAN.PA_weight',
       'SAN.PA_nb_shares', 'SAN.PA_value', 'portfolio_value',
       'portfolio_return'],
      dtype='object')
            BX4.PA_adjusted_close     date_x  ...  portfolio_value  portfolio_return
date                                          ...                                   
2021-04-30                 1.7350 2021-04-30  ...        49.999500          0.000000
2021-05-31                 1.5912 2021-05-31  ...        49.918710          0.000835
2021-06-30                 1.5440 2021-06-30  ...        99.366035         -0.001667
2021-07-31                 1.4818 2021-07-30  ...       148.825853          0.002027
2021-08-31                 1.4428 2021-08-31  ...       197.584451         -0.001747
2021-09-30                 1.4990 2021-09-30  ...       245.517782         -0.002942
2021-10-31                 1.3548 2021-10-29  ...       294.282202          0.003498
2021-11-30                 1.2740 2021-11-05  ...       343.317079          0.003139

[8 rows x 38 columns]
--- 0.4603281021118164 seconds ---
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 6}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            5
1  FR0000120578   SAN  ...          BBB            5
2  FR0007052782   CAC  ...          BBB            5
3  FR0013346681  OBLI  ...          BBB            5
4  IE00BKWQ0G16   STZ  ...          BBB            5
5  FR0010342592   LQQ  ...          BBB            5

[6 rows x 20 columns] 
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
829  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
830  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
831  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
832  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
833  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[834 rows x 9 columns]
 max_diversification cov =            BX4.PA   OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA
BX4.PA   0.071251 -0.000744 -0.046688 -0.036749 -0.035772 -0.014192
OBLI.PA -0.000744  0.001107  0.001840 -0.000955  0.000239  0.000640
LQQ.PA  -0.046688  0.001840  0.085409  0.022117  0.023811  0.009105
STZ.PA  -0.036749 -0.000955  0.022117  0.027707  0.018931  0.005820
CAC.PA  -0.035772  0.000239  0.023811  0.018931  0.019121  0.006685
SAN.PA  -0.014192  0.000640  0.009105  0.005820  0.006685  0.022572
 df_full  =             BX4.PA  OBLI.PA  LQQ.PA  STZ.PA   CAC.PA   SAN.PA
2021-04-27  1.7336   10.842   655.4   55.19  60.8151  82.2534
2021-04-28  1.7146   10.826   650.5   55.77  61.1296  84.2472
2021-04-29  1.7188   10.792   648.4   56.03  61.1198  83.6404
2021-04-30  1.7350   10.786   650.7   55.86  60.7463  84.0545
2021-05-03  1.7154   10.792   642.1   56.14  61.1100  83.4959
...            ...      ...     ...     ...      ...      ...
2021-11-01  1.3300   10.756   873.4   63.17  67.8700  88.3000
2021-11-02  1.3174   10.826   882.3   63.04  68.2100  89.6100
2021-11-03  1.3068   10.834   887.9   63.17  68.4500  90.2400
2021-11-04  1.2938   10.876   925.2   62.52  68.7800  89.6900
2021-11-05  1.2740   10.922   938.3   62.93  69.3100  88.4600

[139 rows x 6 columns]
expected_returns [-0.41817932  0.01455338  1.14692491  0.30828684  0.29031185  0.14822153]
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.43335106803055
w=[0.16666668 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433355984307845
w=[0.16666667 0.16666668 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433351069408694
w=[0.16666667 0.16666667 0.16666668 0.16666667 0.16666667 0.16666667]
obj_value=-46.43334636196783
w=[0.16666667 0.16666667 0.16666667 0.16666668 0.16666667 0.16666667]
obj_value=-46.43334946585318
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666668 0.16666667]
obj_value=-46.43334959070002
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666668]
obj_value=-46.433349784481216
w=[9.99999991e-01 0.00000000e+00 6.09079026e-09 1.37648126e-09
 1.18741994e-09 8.92885765e-10]
obj_value=-3.7463295452602385
w=[0.5408887  0.09182226 0.09182226 0.09182226 0.09182226 0.09182226]
obj_value=-20.92878635580864
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125849080727
w=[0.32924391 0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125152704742
w=[0.3292439  0.13415124 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125852413885
w=[0.3292439  0.13415122 0.13415124 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125464381268
w=[0.3292439  0.13415122 0.13415122 0.13415124 0.13415122 0.13415122]
obj_value=-103.79126353344603
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415124 0.13415122]
obj_value=-103.79126385167301
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415124]
obj_value=-103.79125746308361
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72189866217366
w=[3.84814011e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7218614927882
w=[3.84813996e-01 1.49011612e-08 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72190031816828
w=[3.84813996e-01 0.00000000e+00 2.03185568e-08 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7219294355354
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 1.49011612e-08
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72192087222
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15186014e-01 1.30681538e-09]
obj_value=-220.7219165661703
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.62079766e-08]
obj_value=-220.7219117212818
w=[0.24335099 0.         0.         0.         0.75664914 0.        ]
obj_value=-85.07993007641804
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391798622954
w=[3.28652739e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391989089929
w=[3.28652724e-01 1.49011612e-08 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391824098968
w=[3.28652724e-01 0.00000000e+00 1.81678332e-08 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391757532829
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 1.49011612e-08
 6.71347325e-01 7.88005434e-10]
obj_value=-341.53917239503346
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347339e-01 7.88005434e-10]
obj_value=-341.5391629573594
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 1.56891666e-08]
obj_value=-341.53918748941953
w=[2.41513932e-02 0.00000000e+00 3.53442515e-08 0.00000000e+00
 5.40064390e-06 9.75848421e-01]
obj_value=-7.334855562356588
w=[2.18590455e-01 0.00000000e+00 1.48611409e-08 0.00000000e+00
 4.28690205e-01 3.52721256e-01]
obj_value=-59.74596536608329
w=[2.99599867e-01 0.00000000e+00 6.32723438e-09 0.00000000e+00
 6.07293744e-01 9.31069311e-02]
obj_value=-301.3908897519344
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604648394507
w=[3.18854957e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66049305395285
w=[3.18854942e-01 1.49011612e-08 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66046710925406
w=[3.18854942e-01 0.00000000e+00 1.91999769e-08 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66045520097725
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 1.49011612e-08
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604536902379
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745918e-01 3.13993704e-02]
obj_value=-355.6604431572319
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993853e-02]
obj_value=-355.6604582100579
w=[4.07558797e-01 4.90098775e-07 5.01929187e-01 6.27447994e-07
 0.00000000e+00 9.05118670e-02]
obj_value=-18.927688594393825
w=[3.49619359e-01 1.69976864e-07 1.74079910e-01 2.17612546e-07
 4.24399960e-01 5.19008638e-02]
obj_value=-107.16187753705387
w=[3.26784841e-01 4.38135799e-08 4.48711925e-02 5.60922496e-08
 5.91660277e-01 3.66838768e-02]
obj_value=-343.04301198854245
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586999029359
w=[3.22200567e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1587251232327
w=[3.22200552e-01 3.33860342e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.15870165295433
w=[3.22200552e-01 1.84848730e-08 1.89310953e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586692749749
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 3.85663835e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586913060794
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239694e-01 3.36288944e-02]
obj_value=-370.15867941448994
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36289093e-02]
obj_value=-370.1586924158286
w=[6.61927269e-01 1.30124926e-06 1.15132082e-07 1.69137184e-06
 0.00000000e+00 3.38072114e-01]
obj_value=-8.288159802597914
w=[4.55529337e-01 5.21917214e-07 1.15014539e-02 6.78171580e-07
 3.79858781e-01 1.53110355e-01]
obj_value=-47.13199693309657
w=[3.63268724e-01 1.73553005e-07 1.66425935e-02 2.25267444e-07
 5.49657015e-01 7.04317883e-02]
obj_value=-264.0275093735188
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.80875658170476
w=[3.34534804e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087453767497
w=[3.34534789e-01 7.99585233e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087586737291
w=[3.34534789e-01 6.50573621e-08 1.82437811e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087487095439
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 9.91147190e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087673439772
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539525e-01 4.46821157e-02]
obj_value=-390.80875385652433
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821306e-02]
obj_value=-390.80875010443333
w=[3.28103352e-01 6.42061772e-07 5.06958166e-08 5.81028523e-01
 0.00000000e+00 9.08687718e-02]
obj_value=-66.70623845422602
w=[3.32547615e-01 2.43339105e-07 1.26068571e-02 1.79525164e-01
 4.16367980e-01 5.89527822e-02]
obj_value=-323.99255855266296
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654085512645
w=[3.33831381e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465275938523
w=[3.33831366e-01 1.43066968e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654531333374
w=[3.33831366e-01 1.28165807e-07 1.62484193e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465383365334
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486625e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465379800735
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638241e-01 4.97336681e-02]
obj_value=-419.24653869101655
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336830e-02]
obj_value=-419.24653210317666
w=[8.97439784e-02 7.59992965e-01 0.00000000e+00 1.50262800e-01
 2.66692769e-07 1.20788494e-09]
obj_value=-140.66001082485298
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160917182303
w=[0.253436   0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160675720134
w=[0.25343599 0.25031996 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160856484672
w=[0.25343599 0.25031994 0.01089666 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160789754363
w=[0.25343599 0.25031994 0.01089665 0.09210981 0.35988509 0.03335283]
obj_value=-556.3160856689376
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988511 0.03335283]
obj_value=-556.316093117244
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335284]
obj_value=-556.3160779773442
w=[1.91523888e-01 3.85966267e-01 1.22455771e-10 5.66267866e-11
 4.22509844e-01 8.17981169e-11]
obj_value=-330.19096471283507
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.563526438129
w=[0.24222354 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635289001531
w=[0.24222353 0.27488591 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635168394884
w=[0.24222353 0.27488589 0.00892325 0.07542844 0.37122662 0.02731253]
obj_value=-565.5634962842352
w=[0.24222353 0.27488589 0.00892323 0.07542846 0.37122662 0.02731253]
obj_value=-565.563515702558
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122664 0.02731253]
obj_value=-565.5635132307353
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731255]
obj_value=-565.5635116602341
w=[0.25141205 0.27285732 0.         0.0894487  0.38628193 0.        ]
obj_value=-535.1289924747424
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241992856902
w=[0.24427361 0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241956518582
w=[0.2442736  0.27443331 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241903730222
w=[0.2442736  0.27443329 0.00693236 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241802914074
w=[0.2442736  0.27443329 0.00693235 0.07855655 0.37458565 0.02121877]
obj_value=-568.2241886806165
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458566 0.02121877]
obj_value=-568.2241884586826
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121878]
obj_value=-568.2241939499611
w=[3.08489744e-01 9.30915116e-02 2.51159076e-12 7.05345993e-02
 4.64289820e-01 6.35943256e-02]
obj_value=-429.5232279770569
w=[0.25069521 0.25629912 0.00623911 0.07775434 0.38355606 0.02545632]
obj_value=-568.4776965740791
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.963958936339
w=[0.24781715 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639497680903
w=[0.24781714 0.26442661 0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639508353928
w=[0.24781714 0.2644266  0.00654983 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639458255937
w=[0.24781714 0.2644266  0.00654981 0.07811389 0.37953565 0.02355711]
obj_value=-568.9639506507142
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953566 0.02355711]
obj_value=-568.9639505841747
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355712]
obj_value=-568.9639521000439
w=[2.37506192e-01 2.87829035e-01 2.73995496e-12 8.11890305e-02
 3.65376119e-01 2.80996241e-02]
obj_value=-564.4202412710298
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.35749177576
w=[0.24556415 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574842278006
w=[0.24556414 0.26954018 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574833417131
w=[0.24556414 0.26954016 0.00511866 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574823714773
w=[0.24556414 0.26954016 0.00511864 0.07878583 0.37644171 0.02454967]
obj_value=-569.357482608173
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644173 0.02454967]
obj_value=-569.3574828184998
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454969]
obj_value=-569.3574830188323
w=[0.24610453 0.26907775 0.0044456  0.07691659 0.37974948 0.02370605]
obj_value=-569.2450065184668
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642348343279
w=[0.24566809 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642268672174
w=[0.24566807 0.26945124 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642264009754
w=[0.24566807 0.26945123 0.00498921 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642261194806
w=[0.24566807 0.26945123 0.00498919 0.07842631 0.37707791 0.02438742]
obj_value=-569.3642260299339
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707792 0.02438742]
obj_value=-569.3642260460759
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438743]
obj_value=-569.3642263574668
w=[0.23397821 0.31770151 0.0082876  0.07410712 0.33822207 0.02770349]
obj_value=-546.5637995563353
w=[0.24449909 0.27427625 0.00531903 0.07799438 0.37319233 0.02471902]
obj_value=-569.1896789892905
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368032085926
w=[0.24551943 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.3680237079865
w=[0.24551942 0.27006482 0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023592652
w=[0.24551942 0.2700648  0.00503115 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023429162
w=[0.24551942 0.2700648  0.00503114 0.07837139 0.3765838  0.02442959]
obj_value=-569.3680235986387
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.37658381 0.02442959]
obj_value=-569.3680235425043
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.0244296 ]
obj_value=-569.3680235900935
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683939873064
w=[0.24553014 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683854605621
w=[0.24553013 0.27008818 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855065983
w=[0.24553013 0.27008817 0.00500255 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855508764
w=[0.24553013 0.27008817 0.00500253 0.07850139 0.37644477 0.02443303]
obj_value=-569.3683855037883
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644479 0.02443303]
obj_value=-569.3683855260334
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443304]
obj_value=-569.368385524223
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684405257682
w=[0.24552476 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320418271
w=[0.24552475 0.27008134 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320414714
w=[0.24552475 0.27008133 0.00500642 0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320420189
w=[0.24552475 0.27008133 0.0050064  0.07846408 0.37648212 0.02444134]
obj_value=-569.3684320414642
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648213 0.02444134]
obj_value=-569.3684320413632
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444135]
obj_value=-569.368432040818
_make_output_weights = OrderedDict([('BX4.PA', 0.24552474657212184), ('OBLI.PA', 0.2700813300052892), ('LQQ.PA', 0.005006401592221771), ('STZ.PA', 0.07846406610149567), ('CAC.PA', 0.3764821169666443), ('SAN.PA', 0.024441338762227212)])
opto from 2021-04-27 00:00:00 to 2021-11-14 00:00:00 done
{'weights': OrderedDict([('BX4.PA', 0.24552), ('OBLI.PA', 0.27008), ('LQQ.PA', 0.00501), ('STZ.PA', 0.07846), ('CAC.PA', 0.37648), ('SAN.PA', 0.02444)]), 'expected_return': 0.04410858385753515, 'volatility': 0.015946072643852546, 'sharpe_ratio': 1.5118822293105112}
--- 1.120359182357788 seconds ---
max_diversification = {'weights': OrderedDict([('BX4.PA', 0.24552), ('OBLI.PA', 0.27008), ('LQQ.PA', 0.00501), ('STZ.PA', 0.07846), ('CAC.PA', 0.37648), ('SAN.PA', 0.02444)]), 'expected_return': 0.04410858385753515, 'volatility': 0.015946072643852546, 'sharpe_ratio': 1.5118822293105112}, type <class 'dict'>
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
829  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
830  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
831  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
832  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
833  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[834 rows x 9 columns]
Getting data --- 0.28617310523986816 seconds ---
--- end init 0.3356161117553711 seconds ---
back_test_portfolio from 2021-04-27 00:00:00 to 2021-11-14 00:00:00 done, columns Index(['BX4.PA_adjusted_close', 'date_x', 'BX4.PA_return', 'BX4.PA_weight',
       'BX4.PA_nb_shares', 'BX4.PA_value', 'OBLI.PA_adjusted_close', 'date_y',
       'OBLI.PA_return', 'OBLI.PA_weight', 'OBLI.PA_nb_shares',
       'OBLI.PA_value', 'LQQ.PA_adjusted_close', 'date_x', 'LQQ.PA_return',
       'LQQ.PA_weight', 'LQQ.PA_nb_shares', 'LQQ.PA_value',
       'STZ.PA_adjusted_close', 'date_y', 'STZ.PA_return', 'STZ.PA_weight',
       'STZ.PA_nb_shares', 'STZ.PA_value', 'CAC.PA_adjusted_close', 'date_x',
       'CAC.PA_return', 'CAC.PA_weight', 'CAC.PA_nb_shares', 'CAC.PA_value',
       'SAN.PA_adjusted_close', 'date_y', 'SAN.PA_return', 'SAN.PA_weight',
       'SAN.PA_nb_shares', 'SAN.PA_value', 'portfolio_value',
       'portfolio_return'],
      dtype='object')
            BX4.PA_adjusted_close     date_x  ...  portfolio_value  portfolio_return
date                                          ...                                   
2021-04-30                 1.7350 2021-04-30  ...        49.999500          0.000000
2021-05-31                 1.5912 2021-05-31  ...        49.918710          0.000835
2021-06-30                 1.5440 2021-06-30  ...        99.366035         -0.001667
2021-07-31                 1.4818 2021-07-30  ...       148.825853          0.002027
2021-08-31                 1.4428 2021-08-31  ...       197.584451         -0.001747
2021-09-30                 1.4990 2021-09-30  ...       245.517782         -0.002942
2021-10-31                 1.3548 2021-10-29  ...       294.282202          0.003498
2021-11-30                 1.2740 2021-11-05  ...       343.317079          0.003139

[8 rows x 38 columns]
--- 0.3695371150970459 seconds ---
result max_diversification backtest= [{"BX4.PA_adjusted_close":1.735,"date_x":1619740800000,"BX4.PA_return":0.0,"BX4.PA_weight":0.2455224552,"BX4.PA_nb_shares":null,"BX4.PA_value":12.276,"OBLI.PA_adjusted_close":10.786,"date_y":1619740800000,"OBLI.PA_return":0.0,"OBLI.PA_weight":0.2700827008,"OBLI.PA_nb_shares":null,"OBLI.PA_value":13.504,"LQQ.PA_adjusted_close":650.7,"LQQ.PA_return":0.0,"LQQ.PA_weight":0.0050100501,"LQQ.PA_nb_shares":null,"LQQ.PA_value":0.2505,"STZ.PA_adjusted_close":55.86,"STZ.PA_return":0.0,"STZ.PA_weight":0.0784607846,"STZ.PA_nb_shares":null,"STZ.PA_value":3.923,"CAC.PA_adjusted_close":60.7463,"CAC.PA_return":0.0,"CAC.PA_weight":0.3764837648,"CAC.PA_nb_shares":null,"CAC.PA_value":18.824,"SAN.PA_adjusted_close":84.0545,"SAN.PA_return":0.0,"SAN.PA_weight":0.0244402444,"SAN.PA_nb_shares":null,"SAN.PA_value":1.222,"portfolio_value":49.9995,"portfolio_return":0.0},{"BX4.PA_adjusted_close":1.5912,"date_x":1622419200000,"BX4.PA_return":-0.0828818444,"BX4.PA_weight":0.2255375268,"BX4.PA_nb_shares":14.7955043228,"BX4.PA_value":11.2585424784,"OBLI.PA_adjusted_close":10.788,"date_y":1622419200000,"OBLI.PA_return":0.0001854256,"OBLI.PA_weight":0.2705699703,"OBLI.PA_nb_shares":2.5019933247,"OBLI.PA_value":13.5065039866,"LQQ.PA_adjusted_close":618.2,"LQQ.PA_return":-0.0499462118,"LQQ.PA_weight":0.0047675205,"LQQ.PA_nb_shares":0.00038497,"LQQ.PA_value":0.237988474,"STZ.PA_adjusted_close":57.85,"STZ.PA_return":0.0356247762,"STZ.PA_weight":0.081387439,"STZ.PA_nb_shares":0.1402291443,"STZ.PA_value":4.0627559971,"CAC.PA_adjusted_close":63.2135,"CAC.PA_return":0.0406148193,"CAC.PA_weight":0.3924086422,"CAC.PA_nb_shares":0.6098789556,"CAC.PA_value":19.5885333592,"SAN.PA_adjusted_close":86.97,"SAN.PA_return":0.0346858288,"SAN.PA_weight":0.0253289012,"SAN.PA_nb_shares":0.0245381865,"SAN.PA_value":1.2643860828,"portfolio_value":49.9187103782,"portfolio_return":0.0008346541},{"BX4.PA_adjusted_close":1.544,"date_x":1625011200000,"BX4.PA_return":-0.0296631473,"BX4.PA_weight":0.2299000728,"BX4.PA_nb_shares":23.2455043228,"BX4.PA_value":22.8442586744,"OBLI.PA_adjusted_close":10.83,"date_y":1625011200000,"OBLI.PA_return":0.0038932147,"OBLI.PA_weight":0.2726946658,"OBLI.PA_nb_shares":3.7419933247,"OBLI.PA_value":27.0965877063,"LQQ.PA_adjusted_close":722.0,"LQQ.PA_return":0.1679068263,"LQQ.PA_weight":0.002797217,"LQQ.PA_nb_shares":0.00038497,"LQQ.PA_value":0.2779483633,"STZ.PA_adjusted_close":56.5,"STZ.PA_return":-0.0233362143,"STZ.PA_weight":0.0797349583,"STZ.PA_nb_shares":0.2102291443,"STZ.PA_value":7.9229466523,"CAC.PA_adjusted_close":64.0391,"CAC.PA_return":0.0130605013,"CAC.PA_weight":0.3930528116,"CAC.PA_nb_shares":0.8898789556,"CAC.PA_value":39.056099425,"SAN.PA_adjusted_close":88.36,"SAN.PA_return":0.0159825227,"SAN.PA_weight":0.0218202745,"SAN.PA_nb_shares":0.0345381865,"SAN.PA_value":2.1681941621,"portfolio_value":99.3660349834,"portfolio_return":-0.0016667313},{"BX4.PA_adjusted_close":1.4818,"date_x":1627603200000,"BX4.PA_return":-0.0402849741,"BX4.PA_weight":0.2314462687,"BX4.PA_nb_shares":32.4655043228,"BX4.PA_value":34.4451883055,"OBLI.PA_adjusted_close":11.03,"date_y":1627603200000,"OBLI.PA_return":0.0184672207,"OBLI.PA_weight":0.2773321006,"OBLI.PA_nb_shares":4.9019933247,"OBLI.PA_value":41.2741863712,"LQQ.PA_adjusted_close":760.4,"LQQ.PA_return":0.0531855956,"LQQ.PA_weight":0.0019669379,"LQQ.PA_nb_shares":0.00038497,"LQQ.PA_value":0.2927312125,"STZ.PA_adjusted_close":56.9,"STZ.PA_return":0.007079646,"STZ.PA_weight":0.0803760777,"STZ.PA_nb_shares":0.2702291443,"STZ.PA_value":11.9620383101,"CAC.PA_adjusted_close":65.01,"CAC.PA_return":0.01516105,"CAC.PA_weight":0.3887162736,"CAC.PA_nb_shares":1.1598789556,"CAC.PA_value":57.851030903,"SAN.PA_adjusted_close":86.88,"SAN.PA_return":-0.0167496605,"SAN.PA_weight":0.0201623414,"SAN.PA_nb_shares":0.0545381865,"SAN.PA_value":3.0006776461,"portfolio_value":148.8258527483,"portfolio_return":0.0020270276},{"BX4.PA_adjusted_close":1.4428,"date_x":1630368000000,"BX4.PA_return":-0.0263193413,"BX4.PA_weight":0.2370694119,"BX4.PA_nb_shares":41.8455043228,"BX4.PA_value":46.8412296369,"OBLI.PA_adjusted_close":10.95,"date_y":1630368000000,"OBLI.PA_return":-0.0072529465,"OBLI.PA_weight":0.2716652378,"OBLI.PA_nb_shares":6.1119933247,"OBLI.PA_value":53.6768269052,"LQQ.PA_adjusted_close":829.5,"LQQ.PA_return":0.0908732246,"LQQ.PA_weight":0.0016161831,"LQQ.PA_nb_shares":0.00038497,"LQQ.PA_value":0.3193326418,"STZ.PA_adjusted_close":58.38,"STZ.PA_return":0.0260105448,"STZ.PA_weight":0.0798442254,"STZ.PA_nb_shares":0.3402291443,"STZ.PA_value":15.7759774436,"CAC.PA_adjusted_close":65.69,"CAC.PA_return":0.0104599292,"CAC.PA_weight":0.3856196586,"CAC.PA_nb_shares":1.4198789556,"CAC.PA_value":76.1924485928,"SAN.PA_adjusted_close":87.62,"SAN.PA_return":0.0085174954,"SAN.PA_weight":0.0241852832,"SAN.PA_nb_shares":0.0645381865,"SAN.PA_value":4.7786359041,"portfolio_value":197.5844511244,"portfolio_return":-0.0017466723},{"BX4.PA_adjusted_close":1.499,"date_x":1632960000000,"BX4.PA_return":0.0389520377,"BX4.PA_weight":0.2554862232,"BX4.PA_nb_shares":48.7355043228,"BX4.PA_value":62.7264109798,"OBLI.PA_adjusted_close":10.826,"date_y":1632960000000,"OBLI.PA_return":-0.0113242009,"OBLI.PA_weight":0.2695056915,"OBLI.PA_nb_shares":7.3519933247,"OBLI.PA_value":66.168439733,"LQQ.PA_adjusted_close":762.3,"LQQ.PA_return":-0.0810126582,"LQQ.PA_weight":0.0011952807,"LQQ.PA_nb_shares":0.00038497,"LQQ.PA_value":0.2934626556,"STZ.PA_adjusted_close":58.48,"STZ.PA_return":0.0017129154,"STZ.PA_weight":0.0810393453,"STZ.PA_nb_shares":0.4002291443,"STZ.PA_value":19.896600358,"CAC.PA_adjusted_close":64.14,"CAC.PA_return":-0.0235956767,"CAC.PA_weight":0.3709345828,"CAC.PA_nb_shares":1.7298789556,"CAC.PA_value":91.0710362116,"SAN.PA_adjusted_close":83.08,"SAN.PA_return":-0.0518146542,"SAN.PA_weight":0.0218388765,"SAN.PA_nb_shares":0.0845381865,"SAN.PA_value":5.3618325372,"portfolio_value":245.5177824753,"portfolio_return":-0.0029422732},{"BX4.PA_adjusted_close":1.3548,"date_x":1635465600000,"BX4.PA_return":-0.096197465,"BX4.PA_weight":0.2243657982,"BX4.PA_nb_shares":61.6055043228,"BX4.PA_value":66.0268612565,"OBLI.PA_adjusted_close":10.774,"date_y":1635465600000,"OBLI.PA_return":-0.0048032514,"OBLI.PA_weight":0.2691646841,"OBLI.PA_nb_shares":8.6019933247,"OBLI.PA_value":79.2103760801,"LQQ.PA_adjusted_close":863.6,"LQQ.PA_return":0.1328873147,"LQQ.PA_weight":0.0011297323,"LQQ.PA_nb_shares":0.00038497,"LQQ.PA_value":0.3324601199,"STZ.PA_adjusted_close":62.47,"STZ.PA_return":0.0682284542,"STZ.PA_weight":0.0849603355,"STZ.PA_nb_shares":0.4402291443,"STZ.PA_value":25.0023146438,"CAC.PA_adjusted_close":67.29,"CAC.PA_return":0.049111319,"CAC.PA_weight":0.3955507806,"CAC.PA_nb_shares":1.9398789556,"CAC.PA_value":116.4035549217,"SAN.PA_adjusted_close":86.43,"SAN.PA_return":0.0403225806,"SAN.PA_weight":0.0248286692,"SAN.PA_nb_shares":0.0945381865,"SAN.PA_value":7.3066354621,"portfolio_value":294.282202484,"portfolio_return":0.0034977294},{"BX4.PA_adjusted_close":1.274,"date_x":1636070400000,"BX4.PA_return":-0.0596397992,"BX4.PA_weight":0.2286091116,"BX4.PA_nb_shares":75.1355043228,"BX4.PA_value":78.4854125072,"OBLI.PA_adjusted_close":10.922,"date_y":1636070400000,"OBLI.PA_return":0.0137367737,"OBLI.PA_weight":0.2736565604,"OBLI.PA_nb_shares":9.7419933247,"OBLI.PA_value":93.9509710922,"LQQ.PA_adjusted_close":938.3,"LQQ.PA_return":0.0864983789,"LQQ.PA_weight":0.0010521393,"LQQ.PA_nb_shares":0.00038497,"LQQ.PA_value":0.3612173813,"STZ.PA_adjusted_close":62.93,"STZ.PA_return":0.0073635345,"STZ.PA_weight":0.0806939757,"STZ.PA_nb_shares":0.4902291443,"STZ.PA_value":27.7036200501,"CAC.PA_adjusted_close":69.31,"CAC.PA_return":0.0300193194,"CAC.PA_weight":0.3916292502,"CAC.PA_nb_shares":2.1398789556,"CAC.PA_value":134.453010412,"SAN.PA_adjusted_close":88.46,"SAN.PA_return":0.0234872151,"SAN.PA_weight":0.0243589628,"SAN.PA_nb_shares":0.1045381865,"SAN.PA_value":8.3628479808,"portfolio_value":343.3170794235,"portfolio_return":0.0031387257}]
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 6}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            5
1  FR0000120578   SAN  ...          BBB            5
2  FR0007052782   CAC  ...          BBB            5
3  FR0013346681  OBLI  ...          BBB            5
4  IE00BKWQ0G16   STZ  ...          BBB            5
5  FR0010342592   LQQ  ...          BBB            5

[6 rows x 20 columns] 
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
829  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
830  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
831  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
832  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
833  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[834 rows x 9 columns]
 max_diversification cov =            BX4.PA   OBLI.PA    LQQ.PA    STZ.PA    CAC.PA    SAN.PA
BX4.PA   0.071251 -0.000744 -0.046688 -0.036749 -0.035772 -0.014192
OBLI.PA -0.000744  0.001107  0.001840 -0.000955  0.000239  0.000640
LQQ.PA  -0.046688  0.001840  0.085409  0.022117  0.023811  0.009105
STZ.PA  -0.036749 -0.000955  0.022117  0.027707  0.018931  0.005820
CAC.PA  -0.035772  0.000239  0.023811  0.018931  0.019121  0.006685
SAN.PA  -0.014192  0.000640  0.009105  0.005820  0.006685  0.022572
 df_full  =             BX4.PA  OBLI.PA  LQQ.PA  STZ.PA   CAC.PA   SAN.PA
2021-04-27  1.7336   10.842   655.4   55.19  60.8151  82.2534
2021-04-28  1.7146   10.826   650.5   55.77  61.1296  84.2472
2021-04-29  1.7188   10.792   648.4   56.03  61.1198  83.6404
2021-04-30  1.7350   10.786   650.7   55.86  60.7463  84.0545
2021-05-03  1.7154   10.792   642.1   56.14  61.1100  83.4959
...            ...      ...     ...     ...      ...      ...
2021-11-01  1.3300   10.756   873.4   63.17  67.8700  88.3000
2021-11-02  1.3174   10.826   882.3   63.04  68.2100  89.6100
2021-11-03  1.3068   10.834   887.9   63.17  68.4500  90.2400
2021-11-04  1.2938   10.876   925.2   62.52  68.7800  89.6900
2021-11-05  1.2740   10.922   938.3   62.93  69.3100  88.4600

[139 rows x 6 columns]
expected_returns [-0.41817932  0.01455338  1.14692491  0.30828684  0.29031185  0.14822153]
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.43335106803055
w=[0.16666668 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433355984307845
w=[0.16666667 0.16666668 0.16666667 0.16666667 0.16666667 0.16666667]
obj_value=-46.433351069408694
w=[0.16666667 0.16666667 0.16666668 0.16666667 0.16666667 0.16666667]
obj_value=-46.43334636196783
w=[0.16666667 0.16666667 0.16666667 0.16666668 0.16666667 0.16666667]
obj_value=-46.43334946585318
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666668 0.16666667]
obj_value=-46.43334959070002
w=[0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666668]
obj_value=-46.433349784481216
w=[9.99999991e-01 0.00000000e+00 6.09079026e-09 1.37648126e-09
 1.18741994e-09 8.92885765e-10]
obj_value=-3.7463295452602385
w=[0.5408887  0.09182226 0.09182226 0.09182226 0.09182226 0.09182226]
obj_value=-20.92878635580864
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125849080727
w=[0.32924391 0.13415122 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125152704742
w=[0.3292439  0.13415124 0.13415122 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125852413885
w=[0.3292439  0.13415122 0.13415124 0.13415122 0.13415122 0.13415122]
obj_value=-103.79125464381268
w=[0.3292439  0.13415122 0.13415122 0.13415124 0.13415122 0.13415122]
obj_value=-103.79126353344603
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415124 0.13415122]
obj_value=-103.79126385167301
w=[0.3292439  0.13415122 0.13415122 0.13415122 0.13415122 0.13415124]
obj_value=-103.79125746308361
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72189866217366
w=[3.84814011e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7218614927882
w=[3.84813996e-01 1.49011612e-08 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72190031816828
w=[3.84813996e-01 0.00000000e+00 2.03185568e-08 0.00000000e+00
 6.15185999e-01 1.30681538e-09]
obj_value=-220.7219294355354
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 1.49011612e-08
 6.15185999e-01 1.30681538e-09]
obj_value=-220.72192087222
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15186014e-01 1.30681538e-09]
obj_value=-220.7219165661703
w=[3.84813996e-01 0.00000000e+00 5.41739564e-09 0.00000000e+00
 6.15185999e-01 1.62079766e-08]
obj_value=-220.7219117212818
w=[0.24335099 0.         0.         0.         0.75664914 0.        ]
obj_value=-85.07993007641804
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391798622954
w=[3.28652739e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391989089929
w=[3.28652724e-01 1.49011612e-08 3.26667200e-09 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391824098968
w=[3.28652724e-01 0.00000000e+00 1.81678332e-08 0.00000000e+00
 6.71347325e-01 7.88005434e-10]
obj_value=-341.5391757532829
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 1.49011612e-08
 6.71347325e-01 7.88005434e-10]
obj_value=-341.53917239503346
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347339e-01 7.88005434e-10]
obj_value=-341.5391629573594
w=[3.28652724e-01 0.00000000e+00 3.26667200e-09 0.00000000e+00
 6.71347325e-01 1.56891666e-08]
obj_value=-341.53918748941953
w=[2.41513932e-02 0.00000000e+00 3.53442515e-08 0.00000000e+00
 5.40064390e-06 9.75848421e-01]
obj_value=-7.334855562356588
w=[2.18590455e-01 0.00000000e+00 1.48611409e-08 0.00000000e+00
 4.28690205e-01 3.52721256e-01]
obj_value=-59.74596536608329
w=[2.99599867e-01 0.00000000e+00 6.32723438e-09 0.00000000e+00
 6.07293744e-01 9.31069311e-02]
obj_value=-301.3908897519344
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604648394507
w=[3.18854957e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66049305395285
w=[3.18854942e-01 1.49011612e-08 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66046710925406
w=[3.18854942e-01 0.00000000e+00 1.91999769e-08 0.00000000e+00
 6.49745903e-01 3.13993704e-02]
obj_value=-355.66045520097725
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 1.49011612e-08
 6.49745903e-01 3.13993704e-02]
obj_value=-355.6604536902379
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745918e-01 3.13993704e-02]
obj_value=-355.6604431572319
w=[3.18854942e-01 0.00000000e+00 4.29881568e-09 0.00000000e+00
 6.49745903e-01 3.13993853e-02]
obj_value=-355.6604582100579
w=[4.07558797e-01 4.90098775e-07 5.01929187e-01 6.27447994e-07
 0.00000000e+00 9.05118670e-02]
obj_value=-18.927688594393825
w=[3.49619359e-01 1.69976864e-07 1.74079910e-01 2.17612546e-07
 4.24399960e-01 5.19008638e-02]
obj_value=-107.16187753705387
w=[3.26784841e-01 4.38135799e-08 4.48711925e-02 5.60922496e-08
 5.91660277e-01 3.66838768e-02]
obj_value=-343.04301198854245
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586999029359
w=[3.22200567e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1587251232327
w=[3.22200552e-01 3.33860342e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.15870165295433
w=[3.22200552e-01 1.84848730e-08 1.89310953e-02 2.36652223e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586692749749
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 3.85663835e-08
 6.25239679e-01 3.36288944e-02]
obj_value=-370.1586913060794
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239694e-01 3.36288944e-02]
obj_value=-370.15867941448994
w=[3.22200552e-01 1.84848730e-08 1.89310804e-02 2.36652223e-08
 6.25239679e-01 3.36289093e-02]
obj_value=-370.1586924158286
w=[6.61927269e-01 1.30124926e-06 1.15132082e-07 1.69137184e-06
 0.00000000e+00 3.38072114e-01]
obj_value=-8.288159802597914
w=[4.55529337e-01 5.21917214e-07 1.15014539e-02 6.78171580e-07
 3.79858781e-01 1.53110355e-01]
obj_value=-47.13199693309657
w=[3.63268724e-01 1.73553005e-07 1.66425935e-02 2.25267444e-07
 5.49657015e-01 7.04317883e-02]
obj_value=-264.0275093735188
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.80875658170476
w=[3.34534804e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087453767497
w=[3.34534789e-01 7.99585233e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087586737291
w=[3.34534789e-01 6.50573621e-08 1.82437811e-02 8.42135578e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087487095439
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 9.91147190e-08
 6.02539510e-01 4.46821157e-02]
obj_value=-390.8087673439772
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539525e-01 4.46821157e-02]
obj_value=-390.80875385652433
w=[3.34534789e-01 6.50573621e-08 1.82437662e-02 8.42135578e-08
 6.02539510e-01 4.46821306e-02]
obj_value=-390.80875010443333
w=[3.28103352e-01 6.42061772e-07 5.06958166e-08 5.81028523e-01
 0.00000000e+00 9.08687718e-02]
obj_value=-66.70623845422602
w=[3.32547615e-01 2.43339105e-07 1.26068571e-02 1.79525164e-01
 4.16367980e-01 5.89527822e-02]
obj_value=-323.99255855266296
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654085512645
w=[3.33831381e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465275938523
w=[3.33831366e-01 1.43066968e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.24654531333374
w=[3.33831366e-01 1.28165807e-07 1.62484193e-02 6.35486476e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465383365334
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486625e-02
 5.36638226e-01 4.97336681e-02]
obj_value=-419.2465379800735
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638241e-01 4.97336681e-02]
obj_value=-419.24653869101655
w=[3.33831366e-01 1.28165807e-07 1.62484044e-02 6.35486476e-02
 5.36638226e-01 4.97336830e-02]
obj_value=-419.24653210317666
w=[8.97439784e-02 7.59992965e-01 0.00000000e+00 1.50262800e-01
 2.66692769e-07 1.20788494e-09]
obj_value=-140.66001082485298
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160917182303
w=[0.253436   0.25031994 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160675720134
w=[0.25343599 0.25031996 0.01089665 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160856484672
w=[0.25343599 0.25031994 0.01089666 0.0921098  0.35988509 0.03335283]
obj_value=-556.3160789754363
w=[0.25343599 0.25031994 0.01089665 0.09210981 0.35988509 0.03335283]
obj_value=-556.3160856689376
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988511 0.03335283]
obj_value=-556.316093117244
w=[0.25343599 0.25031994 0.01089665 0.0921098  0.35988509 0.03335284]
obj_value=-556.3160779773442
w=[1.91523888e-01 3.85966267e-01 1.22455771e-10 5.66267866e-11
 4.22509844e-01 8.17981169e-11]
obj_value=-330.19096471283507
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.563526438129
w=[0.24222354 0.27488589 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635289001531
w=[0.24222353 0.27488591 0.00892323 0.07542844 0.37122662 0.02731253]
obj_value=-565.5635168394884
w=[0.24222353 0.27488589 0.00892325 0.07542844 0.37122662 0.02731253]
obj_value=-565.5634962842352
w=[0.24222353 0.27488589 0.00892323 0.07542846 0.37122662 0.02731253]
obj_value=-565.563515702558
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122664 0.02731253]
obj_value=-565.5635132307353
w=[0.24222353 0.27488589 0.00892323 0.07542844 0.37122662 0.02731255]
obj_value=-565.5635116602341
w=[0.25141205 0.27285732 0.         0.0894487  0.38628193 0.        ]
obj_value=-535.1289924747424
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241992856902
w=[0.24427361 0.27443329 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241956518582
w=[0.2442736  0.27443331 0.00693235 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241903730222
w=[0.2442736  0.27443329 0.00693236 0.07855654 0.37458565 0.02121877]
obj_value=-568.2241802914074
w=[0.2442736  0.27443329 0.00693235 0.07855655 0.37458565 0.02121877]
obj_value=-568.2241886806165
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458566 0.02121877]
obj_value=-568.2241884586826
w=[0.2442736  0.27443329 0.00693235 0.07855654 0.37458565 0.02121878]
obj_value=-568.2241939499611
w=[3.08489744e-01 9.30915116e-02 2.51159076e-12 7.05345993e-02
 4.64289820e-01 6.35943256e-02]
obj_value=-429.5232279770569
w=[0.25069521 0.25629912 0.00623911 0.07775434 0.38355606 0.02545632]
obj_value=-568.4776965740791
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.963958936339
w=[0.24781715 0.2644266  0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639497680903
w=[0.24781714 0.26442661 0.00654981 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639508353928
w=[0.24781714 0.2644266  0.00654983 0.07811387 0.37953565 0.02355711]
obj_value=-568.9639458255937
w=[0.24781714 0.2644266  0.00654981 0.07811389 0.37953565 0.02355711]
obj_value=-568.9639506507142
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953566 0.02355711]
obj_value=-568.9639505841747
w=[0.24781714 0.2644266  0.00654981 0.07811387 0.37953565 0.02355712]
obj_value=-568.9639521000439
w=[2.37506192e-01 2.87829035e-01 2.73995496e-12 8.11890305e-02
 3.65376119e-01 2.80996241e-02]
obj_value=-564.4202412710298
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.35749177576
w=[0.24556415 0.26954016 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574842278006
w=[0.24556414 0.26954018 0.00511864 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574833417131
w=[0.24556414 0.26954016 0.00511866 0.07878581 0.37644171 0.02454967]
obj_value=-569.3574823714773
w=[0.24556414 0.26954016 0.00511864 0.07878583 0.37644171 0.02454967]
obj_value=-569.357482608173
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644173 0.02454967]
obj_value=-569.3574828184998
w=[0.24556414 0.26954016 0.00511864 0.07878581 0.37644171 0.02454969]
obj_value=-569.3574830188323
w=[0.24610453 0.26907775 0.0044456  0.07691659 0.37974948 0.02370605]
obj_value=-569.2450065184668
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642348343279
w=[0.24566809 0.26945123 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642268672174
w=[0.24566807 0.26945124 0.00498919 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642264009754
w=[0.24566807 0.26945123 0.00498921 0.0784263  0.37707791 0.02438742]
obj_value=-569.3642261194806
w=[0.24566807 0.26945123 0.00498919 0.07842631 0.37707791 0.02438742]
obj_value=-569.3642260299339
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707792 0.02438742]
obj_value=-569.3642260460759
w=[0.24566807 0.26945123 0.00498919 0.0784263  0.37707791 0.02438743]
obj_value=-569.3642263574668
w=[0.23397821 0.31770151 0.0082876  0.07410712 0.33822207 0.02770349]
obj_value=-546.5637995563353
w=[0.24449909 0.27427625 0.00531903 0.07799438 0.37319233 0.02471902]
obj_value=-569.1896789892905
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368032085926
w=[0.24551943 0.2700648  0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.3680237079865
w=[0.24551942 0.27006482 0.00503114 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023592652
w=[0.24551942 0.2700648  0.00503115 0.07837137 0.3765838  0.02442959]
obj_value=-569.368023429162
w=[0.24551942 0.2700648  0.00503114 0.07837139 0.3765838  0.02442959]
obj_value=-569.3680235986387
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.37658381 0.02442959]
obj_value=-569.3680235425043
w=[0.24551942 0.2700648  0.00503114 0.07837137 0.3765838  0.0244296 ]
obj_value=-569.3680235900935
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683939873064
w=[0.24553014 0.27008817 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683854605621
w=[0.24553013 0.27008818 0.00500253 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855065983
w=[0.24553013 0.27008817 0.00500255 0.07850138 0.37644477 0.02443303]
obj_value=-569.3683855508764
w=[0.24553013 0.27008817 0.00500253 0.07850139 0.37644477 0.02443303]
obj_value=-569.3683855037883
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644479 0.02443303]
obj_value=-569.3683855260334
w=[0.24553013 0.27008817 0.00500253 0.07850138 0.37644477 0.02443304]
obj_value=-569.368385524223
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684405257682
w=[0.24552476 0.27008133 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320418271
w=[0.24552475 0.27008134 0.0050064  0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320414714
w=[0.24552475 0.27008133 0.00500642 0.07846407 0.37648212 0.02444134]
obj_value=-569.3684320420189
w=[0.24552475 0.27008133 0.0050064  0.07846408 0.37648212 0.02444134]
obj_value=-569.3684320414642
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648213 0.02444134]
obj_value=-569.3684320413632
w=[0.24552475 0.27008133 0.0050064  0.07846407 0.37648212 0.02444135]
obj_value=-569.368432040818
_make_output_weights = OrderedDict([('BX4.PA', 0.24552474657212184), ('OBLI.PA', 0.2700813300052892), ('LQQ.PA', 0.005006401592221771), ('STZ.PA', 0.07846406610149567), ('CAC.PA', 0.3764821169666443), ('SAN.PA', 0.024441338762227212)])
opto from 2021-04-27 00:00:00 to 2021-11-14 00:00:00 done
{'weights': OrderedDict([('BX4.PA', 0.24552), ('OBLI.PA', 0.27008), ('LQQ.PA', 0.00501), ('STZ.PA', 0.07846), ('CAC.PA', 0.37648), ('SAN.PA', 0.02444)]), 'expected_return': 0.04410858385753515, 'volatility': 0.015946072643852546, 'sharpe_ratio': 1.5118822293105112}
--- 1.0258800983428955 seconds ---
max_diversification = {'weights': OrderedDict([('BX4.PA', 0.24552), ('OBLI.PA', 0.27008), ('LQQ.PA', 0.00501), ('STZ.PA', 0.07846), ('CAC.PA', 0.37648), ('SAN.PA', 0.02444)]), 'expected_return': 0.04410858385753515, 'volatility': 0.015946072643852546, 'sharpe_ratio': 1.5118822293105112}, type <class 'dict'>
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
829  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
830  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
831  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
832  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
833  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[834 rows x 9 columns]
Getting data --- 0.43712782859802246 seconds ---
--- end init 0.5083959102630615 seconds ---
back_test_portfolio from 2021-04-27 00:00:00 to 2021-11-14 00:00:00 done, columns Index(['BX4.PA_adjusted_close', 'date_x', 'BX4.PA_return', 'BX4.PA_weight',
       'BX4.PA_nb_shares', 'BX4.PA_value', 'OBLI.PA_adjusted_close', 'date_y',
       'OBLI.PA_return', 'OBLI.PA_weight', 'OBLI.PA_nb_shares',
       'OBLI.PA_value', 'LQQ.PA_adjusted_close', 'date_x', 'LQQ.PA_return',
       'LQQ.PA_weight', 'LQQ.PA_nb_shares', 'LQQ.PA_value',
       'STZ.PA_adjusted_close', 'date_y', 'STZ.PA_return', 'STZ.PA_weight',
       'STZ.PA_nb_shares', 'STZ.PA_value', 'CAC.PA_adjusted_close', 'date_x',
       'CAC.PA_return', 'CAC.PA_weight', 'CAC.PA_nb_shares', 'CAC.PA_value',
       'SAN.PA_adjusted_close', 'date_y', 'SAN.PA_return', 'SAN.PA_weight',
       'SAN.PA_nb_shares', 'SAN.PA_value', 'portfolio_value',
       'portfolio_return'],
      dtype='object')
            BX4.PA_adjusted_close     date_x  ...  portfolio_value  portfolio_return
date                                          ...                                   
2021-04-30                 1.7350 2021-04-30  ...        49.999500          0.000000
2021-05-31                 1.5912 2021-05-31  ...        49.918710          0.000835
2021-06-30                 1.5440 2021-06-30  ...        99.366035         -0.001667
2021-07-31                 1.4818 2021-07-30  ...       148.825853          0.002027
2021-08-31                 1.4428 2021-08-31  ...       197.584451         -0.001747
2021-09-30                 1.4990 2021-09-30  ...       245.517782         -0.002942
2021-10-31                 1.3548 2021-10-29  ...       294.282202          0.003498
2021-11-30                 1.2740 2021-11-05  ...       343.317079          0.003139

[8 rows x 38 columns]
--- 0.5442709922790527 seconds ---
result max_diversification backtest= [{"BX4.PA_adjusted_close":1.735,"date_x":1619740800000,"BX4.PA_return":0.0,"BX4.PA_weight":0.2455224552,"BX4.PA_nb_shares":null,"BX4.PA_value":12.276,"OBLI.PA_adjusted_close":10.786,"date_y":1619740800000,"OBLI.PA_return":0.0,"OBLI.PA_weight":0.2700827008,"OBLI.PA_nb_shares":null,"OBLI.PA_value":13.504,"LQQ.PA_adjusted_close":650.7,"LQQ.PA_return":0.0,"LQQ.PA_weight":0.0050100501,"LQQ.PA_nb_shares":null,"LQQ.PA_value":0.2505,"STZ.PA_adjusted_close":55.86,"STZ.PA_return":0.0,"STZ.PA_weight":0.0784607846,"STZ.PA_nb_shares":null,"STZ.PA_value":3.923,"CAC.PA_adjusted_close":60.7463,"CAC.PA_return":0.0,"CAC.PA_weight":0.3764837648,"CAC.PA_nb_shares":null,"CAC.PA_value":18.824,"SAN.PA_adjusted_close":84.0545,"SAN.PA_return":0.0,"SAN.PA_weight":0.0244402444,"SAN.PA_nb_shares":null,"SAN.PA_value":1.222,"portfolio_value":49.9995,"portfolio_return":0.0},{"BX4.PA_adjusted_close":1.5912,"date_x":1622419200000,"BX4.PA_return":-0.0828818444,"BX4.PA_weight":0.2255375268,"BX4.PA_nb_shares":14.7955043228,"BX4.PA_value":11.2585424784,"OBLI.PA_adjusted_close":10.788,"date_y":1622419200000,"OBLI.PA_return":0.0001854256,"OBLI.PA_weight":0.2705699703,"OBLI.PA_nb_shares":2.5019933247,"OBLI.PA_value":13.5065039866,"LQQ.PA_adjusted_close":618.2,"LQQ.PA_return":-0.0499462118,"LQQ.PA_weight":0.0047675205,"LQQ.PA_nb_shares":0.00038497,"LQQ.PA_value":0.237988474,"STZ.PA_adjusted_close":57.85,"STZ.PA_return":0.0356247762,"STZ.PA_weight":0.081387439,"STZ.PA_nb_shares":0.1402291443,"STZ.PA_value":4.0627559971,"CAC.PA_adjusted_close":63.2135,"CAC.PA_return":0.0406148193,"CAC.PA_weight":0.3924086422,"CAC.PA_nb_shares":0.6098789556,"CAC.PA_value":19.5885333592,"SAN.PA_adjusted_close":86.97,"SAN.PA_return":0.0346858288,"SAN.PA_weight":0.0253289012,"SAN.PA_nb_shares":0.0245381865,"SAN.PA_value":1.2643860828,"portfolio_value":49.9187103782,"portfolio_return":0.0008346541},{"BX4.PA_adjusted_close":1.544,"date_x":1625011200000,"BX4.PA_return":-0.0296631473,"BX4.PA_weight":0.2299000728,"BX4.PA_nb_shares":23.2455043228,"BX4.PA_value":22.8442586744,"OBLI.PA_adjusted_close":10.83,"date_y":1625011200000,"OBLI.PA_return":0.0038932147,"OBLI.PA_weight":0.2726946658,"OBLI.PA_nb_shares":3.7419933247,"OBLI.PA_value":27.0965877063,"LQQ.PA_adjusted_close":722.0,"LQQ.PA_return":0.1679068263,"LQQ.PA_weight":0.002797217,"LQQ.PA_nb_shares":0.00038497,"LQQ.PA_value":0.2779483633,"STZ.PA_adjusted_close":56.5,"STZ.PA_return":-0.0233362143,"STZ.PA_weight":0.0797349583,"STZ.PA_nb_shares":0.2102291443,"STZ.PA_value":7.9229466523,"CAC.PA_adjusted_close":64.0391,"CAC.PA_return":0.0130605013,"CAC.PA_weight":0.3930528116,"CAC.PA_nb_shares":0.8898789556,"CAC.PA_value":39.056099425,"SAN.PA_adjusted_close":88.36,"SAN.PA_return":0.0159825227,"SAN.PA_weight":0.0218202745,"SAN.PA_nb_shares":0.0345381865,"SAN.PA_value":2.1681941621,"portfolio_value":99.3660349834,"portfolio_return":-0.0016667313},{"BX4.PA_adjusted_close":1.4818,"date_x":1627603200000,"BX4.PA_return":-0.0402849741,"BX4.PA_weight":0.2314462687,"BX4.PA_nb_shares":32.4655043228,"BX4.PA_value":34.4451883055,"OBLI.PA_adjusted_close":11.03,"date_y":1627603200000,"OBLI.PA_return":0.0184672207,"OBLI.PA_weight":0.2773321006,"OBLI.PA_nb_shares":4.9019933247,"OBLI.PA_value":41.2741863712,"LQQ.PA_adjusted_close":760.4,"LQQ.PA_return":0.0531855956,"LQQ.PA_weight":0.0019669379,"LQQ.PA_nb_shares":0.00038497,"LQQ.PA_value":0.2927312125,"STZ.PA_adjusted_close":56.9,"STZ.PA_return":0.007079646,"STZ.PA_weight":0.0803760777,"STZ.PA_nb_shares":0.2702291443,"STZ.PA_value":11.9620383101,"CAC.PA_adjusted_close":65.01,"CAC.PA_return":0.01516105,"CAC.PA_weight":0.3887162736,"CAC.PA_nb_shares":1.1598789556,"CAC.PA_value":57.851030903,"SAN.PA_adjusted_close":86.88,"SAN.PA_return":-0.0167496605,"SAN.PA_weight":0.0201623414,"SAN.PA_nb_shares":0.0545381865,"SAN.PA_value":3.0006776461,"portfolio_value":148.8258527483,"portfolio_return":0.0020270276},{"BX4.PA_adjusted_close":1.4428,"date_x":1630368000000,"BX4.PA_return":-0.0263193413,"BX4.PA_weight":0.2370694119,"BX4.PA_nb_shares":41.8455043228,"BX4.PA_value":46.8412296369,"OBLI.PA_adjusted_close":10.95,"date_y":1630368000000,"OBLI.PA_return":-0.0072529465,"OBLI.PA_weight":0.2716652378,"OBLI.PA_nb_shares":6.1119933247,"OBLI.PA_value":53.6768269052,"LQQ.PA_adjusted_close":829.5,"LQQ.PA_return":0.0908732246,"LQQ.PA_weight":0.0016161831,"LQQ.PA_nb_shares":0.00038497,"LQQ.PA_value":0.3193326418,"STZ.PA_adjusted_close":58.38,"STZ.PA_return":0.0260105448,"STZ.PA_weight":0.0798442254,"STZ.PA_nb_shares":0.3402291443,"STZ.PA_value":15.7759774436,"CAC.PA_adjusted_close":65.69,"CAC.PA_return":0.0104599292,"CAC.PA_weight":0.3856196586,"CAC.PA_nb_shares":1.4198789556,"CAC.PA_value":76.1924485928,"SAN.PA_adjusted_close":87.62,"SAN.PA_return":0.0085174954,"SAN.PA_weight":0.0241852832,"SAN.PA_nb_shares":0.0645381865,"SAN.PA_value":4.7786359041,"portfolio_value":197.5844511244,"portfolio_return":-0.0017466723},{"BX4.PA_adjusted_close":1.499,"date_x":1632960000000,"BX4.PA_return":0.0389520377,"BX4.PA_weight":0.2554862232,"BX4.PA_nb_shares":48.7355043228,"BX4.PA_value":62.7264109798,"OBLI.PA_adjusted_close":10.826,"date_y":1632960000000,"OBLI.PA_return":-0.0113242009,"OBLI.PA_weight":0.2695056915,"OBLI.PA_nb_shares":7.3519933247,"OBLI.PA_value":66.168439733,"LQQ.PA_adjusted_close":762.3,"LQQ.PA_return":-0.0810126582,"LQQ.PA_weight":0.0011952807,"LQQ.PA_nb_shares":0.00038497,"LQQ.PA_value":0.2934626556,"STZ.PA_adjusted_close":58.48,"STZ.PA_return":0.0017129154,"STZ.PA_weight":0.0810393453,"STZ.PA_nb_shares":0.4002291443,"STZ.PA_value":19.896600358,"CAC.PA_adjusted_close":64.14,"CAC.PA_return":-0.0235956767,"CAC.PA_weight":0.3709345828,"CAC.PA_nb_shares":1.7298789556,"CAC.PA_value":91.0710362116,"SAN.PA_adjusted_close":83.08,"SAN.PA_return":-0.0518146542,"SAN.PA_weight":0.0218388765,"SAN.PA_nb_shares":0.0845381865,"SAN.PA_value":5.3618325372,"portfolio_value":245.5177824753,"portfolio_return":-0.0029422732},{"BX4.PA_adjusted_close":1.3548,"date_x":1635465600000,"BX4.PA_return":-0.096197465,"BX4.PA_weight":0.2243657982,"BX4.PA_nb_shares":61.6055043228,"BX4.PA_value":66.0268612565,"OBLI.PA_adjusted_close":10.774,"date_y":1635465600000,"OBLI.PA_return":-0.0048032514,"OBLI.PA_weight":0.2691646841,"OBLI.PA_nb_shares":8.6019933247,"OBLI.PA_value":79.2103760801,"LQQ.PA_adjusted_close":863.6,"LQQ.PA_return":0.1328873147,"LQQ.PA_weight":0.0011297323,"LQQ.PA_nb_shares":0.00038497,"LQQ.PA_value":0.3324601199,"STZ.PA_adjusted_close":62.47,"STZ.PA_return":0.0682284542,"STZ.PA_weight":0.0849603355,"STZ.PA_nb_shares":0.4402291443,"STZ.PA_value":25.0023146438,"CAC.PA_adjusted_close":67.29,"CAC.PA_return":0.049111319,"CAC.PA_weight":0.3955507806,"CAC.PA_nb_shares":1.9398789556,"CAC.PA_value":116.4035549217,"SAN.PA_adjusted_close":86.43,"SAN.PA_return":0.0403225806,"SAN.PA_weight":0.0248286692,"SAN.PA_nb_shares":0.0945381865,"SAN.PA_value":7.3066354621,"portfolio_value":294.282202484,"portfolio_return":0.0034977294},{"BX4.PA_adjusted_close":1.274,"date_x":1636070400000,"BX4.PA_return":-0.0596397992,"BX4.PA_weight":0.2286091116,"BX4.PA_nb_shares":75.1355043228,"BX4.PA_value":78.4854125072,"OBLI.PA_adjusted_close":10.922,"date_y":1636070400000,"OBLI.PA_return":0.0137367737,"OBLI.PA_weight":0.2736565604,"OBLI.PA_nb_shares":9.7419933247,"OBLI.PA_value":93.9509710922,"LQQ.PA_adjusted_close":938.3,"LQQ.PA_return":0.0864983789,"LQQ.PA_weight":0.0010521393,"LQQ.PA_nb_shares":0.00038497,"LQQ.PA_value":0.3612173813,"STZ.PA_adjusted_close":62.93,"STZ.PA_return":0.0073635345,"STZ.PA_weight":0.0806939757,"STZ.PA_nb_shares":0.4902291443,"STZ.PA_value":27.7036200501,"CAC.PA_adjusted_close":69.31,"CAC.PA_return":0.0300193194,"CAC.PA_weight":0.3916292502,"CAC.PA_nb_shares":2.1398789556,"CAC.PA_value":134.453010412,"SAN.PA_adjusted_close":88.46,"SAN.PA_return":0.0234872151,"SAN.PA_weight":0.0243589628,"SAN.PA_nb_shares":0.1045381865,"SAN.PA_value":8.3628479808,"portfolio_value":343.3170794235,"portfolio_return":0.0031387257}]
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 6}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            5
1  FR0000120578   SAN  ...          BBB            5
2  FR0007052782   CAC  ...          BBB            5
3  FR0013346681  OBLI  ...          BBB            5
4  IE00BKWQ0G16   STZ  ...          BBB            5
5  FR0010342592   LQQ  ...          BBB            5

[6 rows x 20 columns] 
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
829  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
830  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
831  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
832  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
833  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[834 rows x 9 columns]
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 6}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            5
1  FR0000120578   SAN  ...          BBB            5
2  FR0007052782   CAC  ...          BBB            5
3  FR0013346681  OBLI  ...          BBB            5
4  IE00BKWQ0G16   STZ  ...          BBB            5
5  FR0010342592   LQQ  ...          BBB            5

[6 rows x 20 columns] 
dates sent from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
dates Computed from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1619474400.0]}, {'$lte': ['$$price.converted_date', 1636844400.0]}]}}}, 'code': 1}}]: dates from 2021-04-27 00:00:00 to 2021-11-14 00:00:00
Data returned            date     open     high  ...   volume    code  converted_date
0    2021-04-27   1.7336   1.7436  ...  2270741  BX4.PA    1.619474e+09
1    2021-04-28   1.7220   1.7282  ...  4411200  BX4.PA    1.619561e+09
2    2021-04-29   1.6996   1.7252  ...  4494761  BX4.PA    1.619647e+09
3    2021-04-30   1.7108   1.7354  ...  4020190  BX4.PA    1.619734e+09
4    2021-05-03   1.7274   1.7444  ...  4487623  BX4.PA    1.619993e+09
..          ...      ...      ...  ...      ...     ...             ...
829  2021-11-01  62.5400  63.2700  ...     4444  STZ.PA    1.635721e+09
830  2021-11-02  62.9300  63.0400  ...     3303  STZ.PA    1.635808e+09
831  2021-11-03  62.8500  63.2600  ...   297542  STZ.PA    1.635894e+09
832  2021-11-04  63.7400  63.7400  ...     6536  STZ.PA    1.635980e+09
833  2021-11-05  62.4400  63.2400  ...     5383  STZ.PA    1.636067e+09

[834 rows x 9 columns]
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 6}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452, 'AssetType': 'Equity'}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657, 'AssetType': 'Equity'}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656, 'AssetType': 'Fixed Income'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878, 'AssetType': 'Equity'}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656, 'AssetType': 'Fixed Income'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878, 'AssetType': 'Equity'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            5
1  FR0000120578   SAN  ...          BBB            5
2  FR0007052782   CAC  ...          BBB            5
3  FR0013346681  OBLI  ...          BBB            5
4  IE00BKWQ0G16   STZ  ...          BBB            5
5  FR0010342592   LQQ  ...          BBB            5

[6 rows x 21 columns] 
dates sent from 2021-05-04 00:00:00 to 2021-11-21 00:00:00
dates Computed from 2021-05-04 00:00:00 to 2021-11-21 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620079200.0]}, {'$lte': ['$$price.converted_date', 1637449200.0]}]}}}, 'code': 1}}]: dates from 2021-05-04 00:00:00 to 2021-11-21 00:00:00
Data returned            date     open     high  ...    volume    code  converted_date
0    2021-05-04   1.7062   1.7490  ...  12616073  BX4.PA    1.620079e+09
1    2021-05-05   1.7164   1.7190  ...   6768217  BX4.PA    1.620166e+09
2    2021-05-06   1.6714   1.6938  ...   5728005  BX4.PA    1.620252e+09
3    2021-05-07   1.6558   1.6754  ...   5830780  BX4.PA    1.620338e+09
4    2021-05-10   1.6446   1.6556  ...   3260656  BX4.PA    1.620598e+09
..          ...      ...      ...  ...       ...     ...             ...
799  2021-11-01  62.5400  63.2700  ...      4444  STZ.PA    1.635721e+09
800  2021-11-02  62.9300  63.0400  ...      3303  STZ.PA    1.635808e+09
801  2021-11-03  62.8500  63.2600  ...    297542  STZ.PA    1.635894e+09
802  2021-11-04  63.7400  63.7400  ...      6536  STZ.PA    1.635980e+09
803  2021-11-05  62.4400  63.2400  ...      5383  STZ.PA    1.636067e+09

[804 rows x 9 columns]
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query get_universe [{'$match': {'Active': 1, 'FullCode': {'$in': ['BX4.PA', 'OBLI.PA', 'LQQ.PA', 'STZ.PA', 'CAC.PA', 'SAN.PA']}}}, {'$sort': {'last_price_volume': -1}}, {'$facet': {'metadata': [{'$count': 'total'}], 'data': [{'$skip': 0}, {'$limit': 5000}, {'$project': {'ISIN': 1, 'Code': 1, 'General.Name': 1, 'Country': 1, 'Type': 1, 'General.Exchange': 1, 'General.CurrencyCode': 1, 'General.Type': 1, 'Exchange': 1, 'AssetType': 1, 'last_price_volume': 1, 'General.LogoURL': 1}}]}}] 
Query result {'metadata': [{'total': 6}], 'data': [{'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452, 'AssetType': 'Equity'}, {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657, 'AssetType': 'Equity'}, {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384, 'AssetType': 'Equity'}, {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656, 'AssetType': 'Fixed Income'}, {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383, 'AssetType': 'Equity'}, {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878, 'AssetType': 'Equity'}]} 
Query itx = {'_id': ObjectId('6114235bc889609c91418aef'), 'Code': 'BX4', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 Daily Double Short UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010411884', 'Type': 'ETF', 'last_price_volume': 11851452, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('61364fff86ee1aff11e5e2fd'), 'Code': 'SAN', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'Common Stock', 'Name': 'Sanofi', 'Exchange': 'PA', 'CurrencyCode': 'EUR', 'LogoURL': '/img/logos/PA/SAN.png'}, 'ISIN': 'FR0000120578', 'Type': 'Common Stock', 'last_price_volume': 2105657, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('611424a7c889609c914222f7'), 'Code': 'CAC', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Lyxor CAC 40 (DR) UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0007052782', 'Type': 'ETF', 'last_price_volume': 51384, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('60dead3b094f5da1d4664350'), 'Code': 'OBLI', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': "Lyxor Index Fund - Lyxor PEA Obligations d'Etat Euro UCITS ETF", 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0013346681', 'Type': 'ETF', 'last_price_volume': 7656, 'AssetType': 'Fixed Income'}
Query itx = {'_id': ObjectId('6114249fc889609c91421fff'), 'Code': 'STZ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'SSgA SPDR ETFs Europe II Public Limited Company - SPDR MSCI Europe Financials UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'IE00BKWQ0G16', 'Type': 'ETF', 'last_price_volume': 5383, 'AssetType': 'Equity'}
Query itx = {'_id': ObjectId('6114249dc889609c91421f30'), 'Code': 'LQQ', 'Country': 'France', 'Exchange': 'PA', 'General': {'Type': 'ETF', 'Name': 'Multi Units France - Lyxor PEA Nasdaq 100 Daily (2X) leveraged UCITS ETF', 'Exchange': 'PA', 'CurrencyCode': 'EUR'}, 'ISIN': 'FR0010342592', 'Type': 'ETF', 'last_price_volume': 3878, 'AssetType': 'Equity'}
NumExpr defaulting to 8 threads.
df  result            ISIN  Code  ... EsgScoreNote total_stocks
0  FR0010411884   BX4  ...          BBB            5
1  FR0000120578   SAN  ...          BBB            5
2  FR0007052782   CAC  ...          BBB            5
3  FR0013346681  OBLI  ...          BBB            5
4  IE00BKWQ0G16   STZ  ...          BBB            5
5  FR0010342592   LQQ  ...          BBB            5

[6 rows x 21 columns] 
dates sent from 2021-05-04 00:00:00 to 2021-11-21 00:00:00
dates Computed from 2021-05-04 00:00:00 to 2021-11-21 00:00:00
Done get_prices: historical, query : [{'$match': {'FullCode': {'$in': ['BX4.PA', 'SAN.PA', 'CAC.PA', 'OBLI.PA', 'STZ.PA', 'LQQ.PA']}}}, {'$project': {'prices': {'$filter': {'input': '$prices', 'as': 'price', 'cond': {'$and': [{'$gte': ['$$price.converted_date', 1620079200.0]}, {'$lte': ['$$price.converted_date', 1637449200.0]}]}}}, 'code': 1}}]: dates from 2021-05-04 00:00:00 to 2021-11-21 00:00:00
Data returned            date     open     high  ...    volume    code  converted_date
0    2021-05-04   1.7062   1.7490  ...  12616073  BX4.PA    1.620079e+09
1    2021-05-05   1.7164   1.7190  ...   6768217  BX4.PA    1.620166e+09
2    2021-05-06   1.6714   1.6938  ...   5728005  BX4.PA    1.620252e+09
3    2021-05-07   1.6558   1.6754  ...   5830780  BX4.PA    1.620338e+09
4    2021-05-10   1.6446   1.6556  ...   3260656  BX4.PA    1.620598e+09
..          ...      ...      ...  ...       ...     ...             ...
799  2021-11-01  62.5400  63.2700  ...      4444  STZ.PA    1.635721e+09
800  2021-11-02  62.9300  63.0400  ...      3303  STZ.PA    1.635808e+09
801  2021-11-03  62.8500  63.2600  ...    297542  STZ.PA    1.635894e+09
802  2021-11-04  63.7400  63.7400  ...      6536  STZ.PA    1.635980e+09
803  2021-11-05  62.4400  63.2400  ...      5383  STZ.PA    1.636067e+09

[804 rows x 9 columns]
